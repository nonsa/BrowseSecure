/**
 * MASKME Copyright (c) 2008-2013 by Abine, Inc. All Rights Reserved.
 *
 * This software is the confidential and proprietary information
 * of Abine, Inc. ("Confidential Information"), subject
 * to the Non-Disclosure Agreement and/or License Agreement you entered
 * into with Abine. You shall use such Confidential Information only
 * in accordance with the terms of said Agreement(s). Abine makes
 * no representations or warranties about the suitability of the
 * software. The software is provided with ABSOLUTELY NO WARRANTY
 * and Abine will NOT BE LIABLE for ANY DAMAGES resulting from
 * the use of the software.
 *
 * Contact license@getabine.com with any license-related questions.
 *
 * https://www.abine.com
 * @license
 *
 */
/*Copyright (c) 2009 pidder <www.pidder.com>*/
function pidCrypt(){function e(e){e||(e=8);for(var t=new Array(e),n=[],i=0;256>i;i++)n[i]=i;for(i=0;t.length>i;i++)t[i]=n[Math.floor(Math.random()*n.length)];return t}this.setDefaults=function(){this.params.nBits=256,this.params.salt=e(8),this.params.salt=pidCryptUtil.byteArray2String(this.params.salt),this.params.salt=pidCryptUtil.convertToHex(this.params.salt),this.params.blockSize=16,this.params.UTF8=!0,this.params.A0_PAD=!0},this.debug=!0,this.params={},this.params.dataIn="",this.params.dataOut="",this.params.decryptIn="",this.params.decryptOut="",this.params.encryptIn="",this.params.encryptOut="",this.params.key="",this.params.iv="",this.params.clear=!0,this.setDefaults(),this.errors="",this.warnings="",this.infos="",this.debugMsg="",this.setParams=function(e){e||(e={});for(var t in e)this.params[t]=e[t]},this.getParams=function(){return this.params},this.getParam=function(e){return this.params[e]||""},this.clearParams=function(){this.params={}},this.getNBits=function(){return this.params.nBits},this.getOutput=function(){return this.params.dataOut},this.setError=function(e){this.error=e},this.appendError=function(e){return this.errors+=e,""},this.getErrors=function(){return this.errors},this.isError=function(){return this.errors.length>0?!0:!1},this.appendInfo=function(e){return this.infos+=e,""},this.getInfos=function(){return this.infos},this.setDebug=function(e){this.debug=e},this.appendDebug=function(e){return this.debugMsg+=e,""},this.isDebug=function(){return this.debug},this.getAllMessages=function(e){var t={lf:"\n",clr_mes:!1,verbose:15};e||(e=t);for(var n in t)"undefined"==typeof e[n]&&(e[n]=t[n]);var i="",a="";for(var r in this.params){switch(r){case"encryptOut":a=pidCryptUtil.toByteArray(this.params[r].toString()),a=pidCryptUtil.fragment(a.join(),64,e.lf);break;case"key":case"iv":a=pidCryptUtil.formatHex(this.params[r],48);break;default:a=pidCryptUtil.fragment(this.params[r].toString(),64,e.lf)}i+="<p><b>"+r+"</b>:<pre>"+a+"</pre></p>"}return this.debug&&(i+="debug: "+this.debug+e.lf),this.errors.length>0&&1==(1&e.verbose)&&(i+="Errors:"+e.lf+this.errors+e.lf),this.warnings.length>0&&2==(2&e.verbose)&&(i+="Warnings:"+e.lf+this.warnings+e.lf),this.infos.length>0&&4==(4&e.verbose)&&(i+="Infos:"+e.lf+this.infos+e.lf),this.debug&&8==(8&e.verbose)&&(i+="Debug messages:"+e.lf+this.debugMsg+e.lf),e.clr_mes&&(this.errors=this.infos=this.warnings=this.debug=""),i},this.getRandomBytes=function(t){return e(t)}}/**
 * almond 0.0.3 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
var requirejs,require,define;(function(e){function t(e,t){if(e&&"."===e.charAt(0)&&t){t=t.split("/"),t=t.slice(0,t.length-1),e=t.concat(e.split("/"));var n,i;for(n=0;i=e[n];n++)if("."===i)e.splice(n,1),n-=1;else if(".."===i){if(1===n&&(".."===e[2]||".."===e[0]))break;n>0&&(e.splice(n-1,2),n-=2)}e=e.join("/")}return e}function n(t,n){return function(){return c.apply(e,u.call(arguments,0).concat([t,n]))}}function i(e){return function(n){return t(n,e)}}function a(e){return function(t){l[e]=t}}function r(t){if(d.hasOwnProperty(t)){var n=d[t];delete d[t],o.apply(e,n)}return l[t]}function s(e,n){var a,s,o=e.indexOf("!");return-1!==o?(a=t(e.slice(0,o),n),e=e.slice(o+1),s=r(a),e=s&&s.normalize?s.normalize(e,i(n)):t(e,n)):e=t(e,n),{f:a?a+"!"+e:e,n:e,p:s}}var o,c,l={},d={},u=[].slice;"function"!=typeof define&&(o=function(t,i,o,c){var u,h,f,p,m,g,y=[];if(c||(c=t),"function"==typeof o){for(!i.length&&o.length&&(i=["require","exports","module"]),p=0;i.length>p;p++)if(g=s(i[p],c),f=g.f,"require"===f)y[p]=n(t);else if("exports"===f)y[p]=l[t]={},u=!0;else if("module"===f)h=y[p]={id:t,uri:"",exports:l[t]};else if(l.hasOwnProperty(f)||d.hasOwnProperty(f))y[p]=r(f);else{if(!g.p)throw t+" missing "+f;g.p.load(g.n,n(c,!0),a(f),{}),y[p]=l[f]}m=o.apply(l[t],y),t&&(h&&h.exports!==e?l[t]=h.exports:u||(l[t]=m))}else t&&(l[t]=o)},requirejs=c=function(t,n,i,a){return"string"==typeof t?r(s(t,n).f):(t.splice||(n.splice?(t=n,n=arguments[2]):t=[]),a?o(e,t,n,i):setTimeout(function(){o(e,t,n,i)},15),c)},c.config=function(){return c},require||(require=c),define=function(e,t,n){t.splice||(n=t,t=[]),define.unordered?d[e]=[e,t,n]:o(e,t,n)},define.amd={jQuery:!0})})();var ABINEMASKME=ABINEMASKME||{};ABINEMASKME.startTime=Date.now(),window.ABINEMASKME=window.ABINEMASKME||ABINEMASKME,define.unordered=!0,ABINEMASKME.require=require,ABINEMASKME.define=define,ABINEMASKME.define("jquery",["abine/timer"],function(e){function t(e,t,n,i,a){var r="@mozilla.org/parserutils;1";if(r in Components.classes){var s=Components.classes[r].getService(Components.interfaces.nsIParserUtils);if("parseFragment"in s)return s.parseFragment(t,n?s.SanitizerAllowStyle:0,!!a,i,e.documentElement)}return Components.classes["@mozilla.org/feed-unescapehtml;1"].getService(Components.interfaces.nsIScriptableUnescapeHTML).parseFragment(t,!!a,i,e.documentElement)}function n(n){if(!n.abineMaskmejQuery){var i={window:n,document:n.document,navigator:n.navigator,location:n.location,setTimeout:e.setTimeout,clearTimeout:e.clearTimeout,setInterval:e.setInterval,clearInterval:e.clearInterval},a=Components.classes["@mozilla.org/moz/jssubscript-loader;1"].getService(Components.interfaces.mozIJSSubScriptLoader);a.loadSubScript("resource://idme/content/vendor/jquery-min.js",i),n.abineMaskmejQuery=n.jQuery.noConflict(!0);var r=n.abineMaskmejQuery.prototype.html;n.abineMaskmejQuery.prototype.html=function(){if(arguments.length>0&&"string"==typeof arguments[0]){var e=t(n.document,arguments[0],!0);arguments[0]=e}return r.apply(this,arguments)}}return n.abineMaskmejQuery}function i(e,t){try{var i=null;if(e&&e.jquery)return e;if(t&&t.jquery)return t.find(e);if(t&&(i=(t.ownerDocument||t).defaultView||t),!i&&e&&"string"!=typeof e&&(i=(e.ownerDocument||e).defaultView||e),i&&!i.abineMaskmejQuery&&(i=i.top),i)return i.abineMaskmejQuery||n(i),i.abineMaskmejQuery.apply(i,arguments);to.get=stack.trace}catch(a){if("string"==typeof e){var r="Please use a node/document as context to use jQuery from that window sandbox";throw true&&ABINEMASKME.log.error(r+"\n"+e+"\n"+a.stack),r}throw"Could not get window object from parameters to stub. Node disconnected from DOM?"}}return"undefined"==typeof $?i:$}),ABINEMASKME.define("abine/config",[],function(){var e=ABINEMASKME.config={version:"1.40.367",buildNum:"367.d32f9099fa98a9fe3e4057cc977de37bd3fa1565",appName:"MaskMe",environment:"production",tags:["chromestore"],crypt:!0,silent:!1,payments:!0,browser:"Chrome",serverHost:"mm.abine.com",webHost:"www.abine.com",webappHost:"https://dnt.abine.com",mappingServerHost:"mapping.abine.com",phoneServerHost:"phone.abine.com",licenseServerHost:"license.abine.com",emailServerHost:"emails.abine.com",disposableDomain:"opayq.com",paymentsServerHost:"payments.abine.com",logLevel:"ERROR",pfVersion:".790 Chrome development",mmVersion:"0.0.1 development",features:"export"};return e.protocol="production"===ABINEMASKME.config.environment?"https://":"http://",document.documentElement.hasAttribute("abine_webapp")&&(document.documentElement.setAttribute("maskme",e.mmVersion),document.documentElement.setAttribute("maskme-features",e.features)),e}),ABINEMASKME.require("abine/config"),ABINEMASKME.define("abine/timer",[],function(){var e=function(e,t){var n=Components.classes["@mozilla.org/timer;1"].createInstance(Components.interfaces.nsITimer),i={notify:function(){e(),n.cancel()}};return n.initWithCallback(i,t,Components.interfaces.nsITimer.TYPE_ONE_SHOT),n},t=function(e){try{e.cancel()}catch(t){}},n=function(e,t){var n=Components.classes["@mozilla.org/timer;1"].createInstance(Components.interfaces.nsITimer),i={notify:function(){e()}};return n.initWithCallback(i,t,Components.interfaces.nsITimer.TYPE_REPEATING_SLACK),n},i=function(e){try{e.cancel()}catch(t){}},a={};return a.setTimeout="undefined"!=typeof window&&"function"==typeof window.setTimeout?function(){return ABINEMASKME.log,window.setTimeout.apply(window,arguments)}:e,a.clearTimeout="undefined"!=typeof window&&"function"==typeof window.clearTimeout?function(){window.clearTimeout.apply(window,arguments)}:t,a.setInterval="undefined"!=typeof window&&"function"==typeof window.setInterval?function(){return window.setInterval.apply(window,arguments)}:n,a.clearInterval="undefined"!=typeof window&&"function"==typeof window.clearInterval?function(){window.clearInterval.apply(window,arguments)}:i,a}),ABINEMASKME.define("abine/intl",[],function(){return{getText:function(e,t){var n=null;e=e.replace(/\./g,"_");try{n=chrome.i18n.getMessage(e,t)}catch(i){}return n&&""!=n||(n="***"+e),n}}}),ABINEMASKME.define("abine/eventLogger",["abine/config"],function(e){function t(t){var n={},i=t&&t.split?t.split("#"):[];return 4==i.length?(n.error_tag=i[0],n.module=i[1],n.method=i[2],n.message=i[3]):(n.error_tag=n.module=n.method="not well-formed",n.message=t+""),n.browser=e.browser,n.build=e.buildNum,n.environment=e.environment,n.build_tag=e.tags[0],n.server_host=e.serverHost,n.mapping_server_host=e.mappingServerHost,n.license_server_host=e.licenseServerHost,n.phone_server_host=e.phoneServerHost,n.crypt=e.crypt,n.version=e.version,n.user_agent=ABINEMASKME.userAgent,n}function n(t){var n={error:t},i=ABINEMASKME.user||ABINEMASKME.contentuser||ABINEMASKME.bguser;i&&(n.email_salt=i.getEmailSalt()),ABINEMASKME.require(["abine/ajax"],function(t){t.ajax({type:"POST",url:e.protocol+e.serverHost+"/api/errors",data:n,success:function(){r.debug("error reporting successful")},error:function(){r.debug("error reporting failed")}})})}function i(){if("undefined"!=typeof console)return{finest:function(e){console.debug("[FINEST]["+(new Date).toUTCString()+"]: "+e)},debug:function(e){console.debug("[DEBUG]["+(new Date).toUTCString()+"]: "+e)},info:function(e){console.info("[INFO]["+(new Date).toUTCString()+"]: "+e)},warn:function(e){console.warn("[WARNING]["+(new Date).toUTCString()+"]: "+e)},error:function(e){console.error("[ERROR]["+(new Date).toUTCString()+"]: "+e);var i=ABINEMASKME.user||ABINEMASKME.contentuser||ABINEMASKME.bguser;i&&i.shouldSendErrorReports()&&n(t(e))}};if("undefined"!=typeof Components){var e=Components.classes["@mozilla.org/consoleservice;1"].getService(Components.interfaces.nsIConsoleService);return{finest:function(t){e.logStringMessage("[FINEST]["+(new Date).toUTCString()+"]: "+t),dump("FINEST: "+t+"\n")},debug:function(t){e.logStringMessage("[DEBUG]["+(new Date).toUTCString()+"]: "+t),dump("DEBUG: "+t+"\n")},info:function(t){e.logStringMessage("[INFO]["+(new Date).toUTCString()+"]: "+t),dump("INFO: "+t+"\n")},warn:function(t){e.logStringMessage("[WARNING]["+(new Date).toUTCString()+"]: "+t),dump("WARNING: "+t+"\n")},error:function(i){e.logStringMessage("[ERROR]["+(new Date).toUTCString()+"]: "+i),dump("ERROR: "+i+"\n");var a=ABINEMASKME.user||ABINEMASKME.contentuser||ABINEMASKME.bguser;a&&a.shouldSendErrorReports()&&n(t(i))}}}}var a=function(){},r=i();switch(r.dumpObj=function(e){var t=typeof e;if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,i,a=[],s=e&&e.constructor==Array;for(n in e)i=e[n],t=typeof i,"string"==t?i='"'+i+'"':"object"==t&&null!==i&&(i=r.dumpObj(i)),a.push((s?"":'"'+n+'":')+String(i));return(s?"[":"{")+String(a)+(s?"]":"}")},e.logLevel){case"NONE":r.error=a;case"ERROR":r.warn=a;case"WARN":r.info=a;case"INFO":r.debug=a;case"DEBUG":r.finest=a}return r.info("Log level set to "+e.logLevel),ABINEMASKME.log=r,r}),ABINEMASKME.define(["documentcloud/underscore"],function(){return _}),ABINEMASKME.define("documentcloud/underscore/async",["documentcloud/underscore","abine/timer"],function(e,t){var n=t.setTimeout,i={},a=e,r=e.async;a.async=i,i.noConflict=function(){return a.async=r,i};var s=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;e.length>n;n+=1)t(e[n],n,e)},o=function(e,t){if(e.map)return e.map(t);var n=[];return s(e,function(e,i,a){n.push(t(e,i,a))}),n},c=function(e,t,n){return e.reduce?e.reduce(t,n):(s(e,function(e,i,a){n=t(n,e,i,a)}),n)},l=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};i.nextTick="undefined"!=typeof process&&process.nextTick?process.nextTick:function(e){n(e,0)},i.forEach=function(e,t,n){if(n=n||function(){},!e.length)return n();var i=0;s(e,function(a){t(a,function(t){t?(n(t),n=function(){}):(i+=1,i===e.length&&n(null))})})},i.forEachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var i=0,a=function(){t(e[i],function(t){t?(n(t),n=function(){}):(i+=1,i===e.length?n(null):a())})};a()},i.forEachLimit=function(e,t,n,i){if(i=i||function(){},!e.length||0>=t)return i();var a=0,r=0,s=0;(function o(){if(a===e.length)return i();for(;t>s&&e.length>r;)r+=1,s+=1,n(e[r-1],function(t){t?(i(t),i=function(){}):(a+=1,s-=1,a===e.length?i():o())})})()};var d=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[i.forEach].concat(t))}},u=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[i.forEachSeries].concat(t))}},h=function(e,t,n,i){var a=[];t=o(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n,i){a[e.index]=i,t(n)})},function(e){i(e,a)})};i.map=d(h),i.mapSeries=u(h),i.reduce=function(e,t,n,a){i.forEachSeries(e,function(e,i){n(t,e,function(e,n){t=n,i(e)})},function(e){a(e,t)})},i.inject=i.reduce,i.foldl=i.reduce,i.reduceRight=function(e,t,n,a){var r=o(e,function(e){return e}).reverse();i.reduce(r,t,n,a)},i.foldr=i.reduceRight;var f=function(e,t,n,i){var a=[];t=o(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&a.push(e),t()})},function(){i(o(a.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};i.filter=d(f),i.filterSeries=u(f),i.select=i.filter,i.selectSeries=i.filterSeries;var p=function(e,t,n,i){var a=[];t=o(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||a.push(e),t()})},function(){i(o(a.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};i.reject=d(p),i.rejectSeries=u(p);var m=function(e,t,n,i){e(t,function(e,t){n(e,function(n){n?(i(e),i=function(){}):t()})},function(){i()})};i.detect=d(m),i.detectSeries=u(m),i.some=function(e,t,n){i.forEach(e,function(e,i){t(e,function(e){e&&(n(!0),n=function(){}),i()})},function(){n(!1)})},i.any=i.some,i.every=function(e,t,n){i.forEach(e,function(e,i){t(e,function(e){e||(n(!1),n=function(){}),i()})},function(){n(!0)})},i.all=i.every,i.sortBy=function(e,t,n){i.map(e,function(e,n){t(e,function(t,i){t?n(t):n(null,{value:e,criteria:i})})},function(e,t){if(e)return n(e);var i=function(e,t){var n=e.criteria,i=t.criteria;return i>n?-1:n>i?1:0};n(null,o(t.sort(i),function(e){return e.value}))})},i.auto=function(e,t){t=t||function(){};var n=l(e);if(!n.length)return t(null);var i={},a=[],r=function(e){a.unshift(e)},o=function(e){for(var t=0;a.length>t;t+=1)if(a[t]===e)return a.splice(t,1),void 0},d=function(){s(a.slice(0),function(e){e()})};r(function(){l(i).length===n.length&&(t(null,i),t=function(){})}),s(n,function(n){var a=e[n]instanceof Function?[e[n]]:e[n],s=function(e){if(e)t(e),t=function(){};else{var a=Array.prototype.slice.call(arguments,1);1>=a.length&&(a=a[0]),i[n]=a,d()}},l=a.slice(0,Math.abs(a.length-1))||[],u=function(){return c(l,function(e,t){return e&&i.hasOwnProperty(t)},!0)&&!i.hasOwnProperty(n)};if(u())a[a.length-1](s,i);else{var h=function(){u()&&(o(h),a[a.length-1](s,i))};r(h)}})},i.waterfall=function(e,t){if(t=t||function(){},!e.length)return t();var n=function(e){return function(a){if(a)t(a),t=function(){};else{var r=Array.prototype.slice.call(arguments,1),s=e.next();s?r.push(n(s)):r.push(t),i.nextTick(function(){e.apply(null,r)})}}};n(i.iterator(e))()},i.parallel=function(e,t){if(t=t||function(){},e.constructor===Array)i.map(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);1>=n.length&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};i.forEach(l(e),function(t,i){e[t](function(e){var a=Array.prototype.slice.call(arguments,1);1>=a.length&&(a=a[0]),n[t]=a,i(e)})},function(e){t(e,n)})}},i.series=function(e,t){if(t=t||function(){},e.constructor===Array)i.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);1>=n.length&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};i.forEachSeries(l(e),function(t,i){e[t](function(e){var a=Array.prototype.slice.call(arguments,1);1>=a.length&&(a=a[0]),n[t]=a,i(e)})},function(e){t(e,n)})}},i.iterator=function(e){var t=function(n){var i=function(){return e.length&&e[n].apply(null,arguments),i.next()};return i.next=function(){return e.length-1>n?t(n+1):null},i};return t(0)},i.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var g=function(e,t,n,i){var a=[];e(t,function(e,t){n(e,function(e,n){a=a.concat(n||[]),t(e)})},function(e){i(e,a)})};i.concat=d(g),i.concatSeries=u(g),i.whilst=function(e,t,n){e()?t(function(a){return a?n(a):(i.whilst(e,t,n),void 0)}):n()},i.until=function(e,t,n){e()?n():t(function(a){return a?n(a):(i.until(e,t,n),void 0)})},i.queue=function(e,t){var n=0,a={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,push:function(e,n){e.constructor!==Array&&(e=[e]),s(e,function(e){a.tasks.push({data:e,callback:"function"==typeof n?n:null}),a.saturated&&a.tasks.length==t&&a.saturated(),i.nextTick(a.process)})},process:function(){if(a.concurrency>n&&a.tasks.length){var t=a.tasks.shift();a.empty&&0==a.tasks.length&&a.empty(),n+=1,e(t.data,function(){n-=1,t.callback&&t.callback.apply(t,arguments),a.drain&&0==a.tasks.length+n&&a.drain(),a.process()})}},length:function(){return a.tasks.length},running:function(){return n}};return a};var y=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&s(n,function(t){console[e](t)}))}]))}};return i.log=y("log"),i.dir=y("dir"),i.memoize=function(e,t){var n={},i={};t=t||function(e){return e};var a=function(){var a=Array.prototype.slice.call(arguments),r=a.pop(),s=t.apply(null,a);s in n?r.apply(null,n[s]):s in i?i[s].push(r):(i[s]=[r],e.apply(null,a.concat([function(){n[s]=arguments;var e=i[s];delete i[s];for(var t=0,a=e.length;a>t;t++)e[t].apply(null,arguments)}])))};return a.unmemoized=e,a},i.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},e}),ABINEMASKME.require(["documentcloud/underscore/async"],function(){}),pidCryptUtil={},pidCryptUtil.encodeBase64=function(e,t){e||(e="");var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t="undefined"==typeof t?!1:t;var i,a,r,s,o,c,l,d,u,h,f,p=[],m="";if(h=t?pidCryptUtil.encodeUTF8(e):e,u=h.length%3,u>0)for(;3>u++;)m+="=",h+="\0";for(u=0;h.length>u;u+=3)i=h.charCodeAt(u),a=h.charCodeAt(u+1),r=h.charCodeAt(u+2),s=i<<16|a<<8|r,o=63&s>>18,c=63&s>>12,l=63&s>>6,d=63&s,p[u/3]=n.charAt(o)+n.charAt(c)+n.charAt(l)+n.charAt(d);return f=p.join(""),f=f.slice(0,f.length-m.length)+m},pidCryptUtil.decodeBase64=function(e,t){e||(e="");var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t="undefined"==typeof t?!1:t;var i,a,r,s,o,c,l,d,u,h,f=[];h=t?pidCryptUtil.decodeUTF8(e):e;for(var p=0;h.length>p;p+=4)s=n.indexOf(h.charAt(p)),o=n.indexOf(h.charAt(p+1)),c=n.indexOf(h.charAt(p+2)),l=n.indexOf(h.charAt(p+3)),d=s<<18|o<<12|c<<6|l,i=255&d>>>16,a=255&d>>>8,r=255&d,f[p/4]=String.fromCharCode(i,a,r),64==l&&(f[p/4]=String.fromCharCode(i,a)),64==c&&(f[p/4]=String.fromCharCode(i));return u=f.join(""),u=t?pidCryptUtil.decodeUTF8(u):u},pidCryptUtil.encodeUTF8=function(e){return e||(e=""),e=e.replace(/[\u0080-\u07ff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(192|t>>6,128|63&t)}),e=e.replace(/[\u0800-\uffff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(224|t>>12,128|63&t>>6,128|63&t)})},pidCryptUtil.decodeUTF8=function(e){return e||(e=""),e=e.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var t=(31&e.charCodeAt(0))<<6|63&e.charCodeAt(1);return String.fromCharCode(t)}),e=e.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var t=(15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2);return String.fromCharCode(t)})},pidCryptUtil.convertToHex=function(e){e||(e="");for(var t="",n="",i=0;e.length>i;i++)n=e.charCodeAt(i).toString(16),t+=1==n.length?"0"+n:n;return t},pidCryptUtil.convertFromHex=function(e){e||(e="");for(var t="",n=0;e.length>n;n+=2)t+=String.fromCharCode(parseInt(e.substring(n,n+2),16));return t},pidCryptUtil.stripLineFeeds=function(e){e||(e="");var t="";return t=e.replace(/\n/g,""),t=t.replace(/\r/g,"")},pidCryptUtil.toByteArray=function(e){e||(e="");for(var t=[],n=0;e.length>n;n++)t[n]=e.charCodeAt(n);return t},pidCryptUtil.fragment=function(e,t,n){if(e||(e=""),!t||t>=e.length)return e;n||(n="\n");for(var i="",a=0;e.length>a;a+=t)i+=e.substr(a,t)+n;return i},pidCryptUtil.formatHex=function(e,t){e||(e=""),t||(t=45);for(var n="",i=e.toLowerCase(),a=0;i.length>a;a+=2)n+=i.substr(a,2)+":";return i=this.fragment(n,t)},pidCryptUtil.byteArray2String=function(e){for(var t="",n=0;e.length>n;n++)t+=String.fromCharCode(e[n]);return t},"undefined"!=typeof pidCrypt&&(pidCrypt.SHA1=function(e){function t(e,t){var n=e<<t|e>>>32-t;return n}function n(e){var t,n,i="";for(t=7;t>=0;t--)n=15&e>>>4*t,i+=n.toString(16);return i}var i,a,r,s,o,c,l,d,u,h=new Array(80),f=1732584193,p=4023233417,m=2562383102,g=271733878,y=3285377520,b=e.length,v=new Array;for(a=0;b-3>a;a+=4)r=e.charCodeAt(a)<<24|e.charCodeAt(a+1)<<16|e.charCodeAt(a+2)<<8|e.charCodeAt(a+3),v.push(r);switch(b%4){case 0:a=2147483648;break;case 1:a=8388608|e.charCodeAt(b-1)<<24;break;case 2:a=32768|(e.charCodeAt(b-2)<<24|e.charCodeAt(b-1)<<16);break;case 3:a=128|(e.charCodeAt(b-3)<<24|e.charCodeAt(b-2)<<16|e.charCodeAt(b-1)<<8)}for(v.push(a);14!=v.length%16;)v.push(0);for(v.push(b>>>29),v.push(4294967295&b<<3),i=0;v.length>i;i+=16){for(a=0;16>a;a++)h[a]=v[i+a];for(a=16;79>=a;a++)h[a]=t(h[a-3]^h[a-8]^h[a-14]^h[a-16],1);for(s=f,o=p,c=m,l=g,d=y,a=0;19>=a;a++)u=4294967295&t(s,5)+(o&c|~o&l)+d+h[a]+1518500249,d=l,l=c,c=t(o,30),o=s,s=u;for(a=20;39>=a;a++)u=4294967295&t(s,5)+(o^c^l)+d+h[a]+1859775393,d=l,l=c,c=t(o,30),o=s,s=u;for(a=40;59>=a;a++)u=4294967295&t(s,5)+(o&c|o&l|c&l)+d+h[a]+2400959708,d=l,l=c,c=t(o,30),o=s,s=u;for(a=60;79>=a;a++)u=4294967295&t(s,5)+(o^c^l)+d+h[a]+3395469782,d=l,l=c,c=t(o,30),o=s,s=u;f=4294967295&f+s,p=4294967295&p+o,m=4294967295&m+c,g=4294967295&g+l,y=4294967295&y+d}var u=n(f)+n(p)+n(m)+n(g)+n(y);return u.toLowerCase()}),ABINEMASKME.define("pidcrypt",function(){return pidCrypt}),ABINEMASKME.define("abine/backgroundEventLogger",["abine/config","storage","persistence","documentcloud/underscore"],function(e,t,n,i){function a(t){var n={},i=t?t.split("#"):[];return 4==i.length?(n.error_tag=i[0],n.module=i[1],n.method=i[2],n.message=i[3]):(n.error_tag=n.module=n.method="not well-formed",n.message=t),n.browser=e.browser,n.build=e.buildNum,n.environment=e.environment,n.build_tag=e.tags[0],n.server_host=e.serverHost,n.mapping_server_host=e.mappingServerHost,n.license_server_host=e.licenseServerHost,n.phone_server_host=e.phoneServerHost,n.crypt=e.crypt,n.version=e.version,n.user_agent=ABINEMASKME.userAgent,n}function r(n){var a={error:n},r=function(t){t&&(a.email_salt=t),ABINEMASKME.require(["abine/ajax"],function(t){t.ajax({type:"POST",url:e.protocol+e.serverHost+"/api/errors",data:a,success:function(){c.debug("error reporting successful")},error:function(){c.debug("error reporting failed")}})})};t.Preference?t.Preference.findBy("key","Salt.ShieldedEmail",i.bind(function(e){r(e.value)},this)):r()}function s(){var e=(new Date).toUTCString();if("undefined"!=typeof console)return{finest:function(t){console.debug("[FINEST]["+e+"]: "+t)},debug:function(t){console.debug("[DEBUG]["+e+"]: "+t)},info:function(t){console.info("[INFO]["+e+"]: "+t)},warn:function(t){console.warn("[WARNING]["+e+"]: "+t)},error:function(n){console.error("[ERROR]["+e+"]: "+n),t.Preference&&t.Preference.findBy("key","shouldSendErrorReports",function(e){e.isTrue()&&r(a(n))})}};if("undefined"!=typeof Components){var n=Components.classes["@mozilla.org/consoleservice;1"].getService(Components.interfaces.nsIConsoleService);return{finest:function(t){n.logStringMessage("[FINEST]["+e+"]: "+t),dump("FINEST: "+t+"\n")},debug:function(t){n.logStringMessage("[DEBUG]["+e+"]: "+t),dump("DEBUG: "+t+"\n")},info:function(t){n.logStringMessage("[INFO]["+e+"]: "+t),dump("INFO: "+t+"\n")},warn:function(t){n.logStringMessage("[WARNING]["+e+"]: "+t),dump("WARNING: "+t+"\n")},error:function(i){n.logStringMessage("[ERROR]["+e+"]: "+i),dump("ERROR: "+i+"\n"),t.Preference&&t.Preference.findBy("key","shouldSendErrorReports",function(e){e&&e.isTrue()&&r(a(i))})}}}}var o=function(){},c=s();switch(c.dumpObj=function(e){var t=typeof e;if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,i,a=[],r=e&&e.constructor==Array;for(n in e)i=e[n],t=typeof i,"string"==t?i='"'+i+'"':"object"==t&&null!==i&&(i=c.dumpObj(i)),a.push((r?"":'"'+n+'":')+String(i));return(r?"[":"{")+String(a)+(r?"]":"}")},e.logLevel){case"NONE":c.error=o;case"ERROR":c.warn=o;case"WARN":c.info=o;case"INFO":c.debug=o;case"DEBUG":c.finest=o}return c.info("Log level set to "+e.logLevel),ABINEMASKME.log=c,c}),ABINEMASKME.define("abine/backgroundInit",["abine/storageRouter","abine/storage/registry","abine/formSubmitDetector","abine/saveForms","abine/window","storage","abine/securityManager","abine/stubs","abine/toolbar","abine/timer","abine/ajax","abine/config","abine/pageEvents","abine/tabs","persistence","abine/mappingServer","modules","documentcloud/underscore","abine/browserSyncStorage","abine/core","documentcloud/underscore"],function(e,t,n,i,a,r,s,o,c,l,d,u,h,f,p,m,g,y,b,v,y){function E(n){if(!k){k=!0,y.each(y.values(g),function(e){e.setMessenger&&e.setMessenger(n)}),f.tabHelper.init(n);var i=new e.StorageRouter({messenger:n,noMigrations:!1,ready:function(){A(n)}});t.registerStorageEntities(i),o.start(n),w(n)}}function A(e){P.trigger("storage:initialized"),n.formSubmitDetector.init(e),i.init(e),h.initialize(e),s.load(e),g.criticalProcess.setMessenger(e),S(function(e){e?l.setTimeout(y.bind(function(){g.mappingsModule.startDailyMappingCheck(function(){g.panelsModule.ensureDynamicPanels()})},this),36e5):g.mappingsModule.startDailyMappingCheck(function(){g.panelsModule.ensureDynamicPanels(function(){})})})}function M(e){e=e||T,r.Preference.findOrCreate({key:"installUserAgent",value:ABINEMASKME.userAgent},function(){r.Preference.findOrCreate({key:"installVersion",value:u.version},function(){r.Preference.findOrCreate({key:"installTags",value:u.tags[0]},function(){p.flush(function(){e()})})})})}function _(e){e=e||T;var t="http://";"production"==ABINEMASKME.config.environment&&(t="https://");var n=t+ABINEMASKME.config.webHost+"/maskme/v2/tag.php?currentTag="+u.tags[0];d.ajax({url:n,success:function(t){try{t=JSON.parse(t)}catch(n){e()}t&&""!=t&&t.abineMaskMeTag&&""!=t.abineMaskMeTag?(u.tags.unshift(t.abineMaskMeTag),r.Preference.createOrModify({key:"dynamicTag",value:t.abineMaskMeTag},function(){e()})):e()},error:function(){e()}})}function S(e){e=e||T,r.Preference.findBy("key","autoOpenEditUser",function(t){if(!t||"false"===t.value)return r.Preference.findBy("key","dynamicTag",function(t){t&&u.tags.unshift(t.value),g.licenseModule.startDailyTouch(function(){e()})}),void 0;var n=!0;t.value="false",c.freshInstall(),M(function(){_(function(){b.get("hasRegistered",function(t){var i=t.hasRegistered?"pages/index.html#userLogin":"pages/index.html#userRegistration";t.hasRegistered||g.licenseModule.autoRegister(),g.licenseModule.startDailyTouch(function(){u.silent||a.createTab({localUrl:i}),e(n)})})})})})}function w(e){e.on("window:createTab",function(e){e.panelData&&(ABINEMASKME.lastPanel||(ABINEMASKME.lastPanel={}),ABINEMASKME.lastPanel[e.panelData.action]=e.panelData.type),a.createTab(e)})}var k=!1,T=function(){};ABINEMASKME.bguser={shouldSendErrorReports:function(){var e=r.Preference.getSync("shouldSendErrorReports");return e&&e.isTrue()},getEmailSalt:function(){var e=r.Preference.getSync("Salt.ShieldedEmail");return e&&e.value}};var P={initialize:E};return y.extend(P,v.Events),P}),ABINEMASKME.define("abine/contentManager",["documentcloud/underscore","jquery","abine/core","abine/contentMessenger","abine/window","abine/timer","abine/formAnalyzer","abine/formStrategy","models","abine/config","abine/url","abine/proxies","abine/views/unlockPanel","abine/views/notificationPanel","abine/assets","abine/views/paymentHelperPanel"],function(e,t,n,i,a,r,s,o,c,l,d,u,h,f,p,m){function g(e){var t=0,n=0;if(e.ownerDocument,e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{left:t,top:n}}var y={zIndex:"2147483647",position:"absolute",top:"20px",right:"20px",overflow:"hidden",borderWidth:"0px",background:"transparent",backgroundColor:"transparent"};allowedHostsRegex="development"==l.environment?/(^(.+\.)?abine\.com$)|(^(.+\.)?idme\.dev$)|(^(.+\.)?license-platform\.dev$)|(^(.+\.)?idme-platform\.dev$)|(^localhost(:[0-9]+)?$)/i:/^(.+\.)?abine\.com$/i;var b=n.BaseClass.extend({initialize:function(n){return this.document=n.document,this.href=this.document.location?this.document.location.href:null,this.domain=n.domain||(this.href?d.getTLD(this.href):null),this.document.documentElement.hasAttribute("abine_webapp")&&(this.document.documentElement.setAttribute("maskme",l.mmVersion),this.document.documentElement.setAttribute("maskme-features",l.features)),n.force||this.document.defaultView==this.document.defaultView.top?(this.messenger=new i.ContentMessenger({eventAggregator:n.eventAggregator,document:n.document}),this.document.defaultView&&this.document.defaultView==this.document.defaultView.top&&(this.messenger.on("background:saveForm:notification",e.bind(this.showNotification,this)),this.messenger.on("contentManager:processNewFrame",e.bind(function(e){var t=this.document.getElementById(e);if(t){var n=t.contentWindow||t.contentDocument;n&&(n.document&&(n=n.document),this.setupFormsInFrame(n,t))}},this))),t(this.document).ready(e.bind(this.hookDocumentEventHandlers,this,this.document)),this.messenger.on("background:failedSubmitDetector:recheckForms",e.bind(function(){this.startFormHelpers()},this)),"Firefox"==ABINEMASKME.config.browser?u.connect(null):u.connect(this.messenger),this.lockedCB=e.bind(this.locked,this),this.unlockedCB=e.bind(this.unlocked,this),u.securityManager.on("background:securityManager:locked",this.lockedCB),u.securityManager.on("background:securityManager:unlocked",this.unlockedCB),this._locked=null,u.securityManager.isLocked(e.bind(function(e){this._locked=e},this)),this.domain&&this.messenger.send("contentscript:contextmenu:refresh",{domain:this.domain}),t(this.document).bind("contextmenu",e.bind(this.trackLastElementClicked,this)),this.messenger.on("background:contextmenu:fill",e.bind(this.fillField,this)),this.messenger.on("background:contextmenu:maskcard",e.bind(this.maskCardContextMenu,this)),this.messenger.on("broadcast:preference:reload",e.bind(function(){this.loadUserPreferences()},this)),ABINEMASKME.contentuser={shouldSendErrorReports:e.bind(function(){return this.preferences&&this.preferences.isPrefTrue("shouldSendErrorReports")},this),getEmailSalt:e.bind(function(){return this.preferences?this.preferences.getPref("Salt.ShieldedEmail"):"NULL PREFERENCES"},this),hasRegEmail:e.bind(function(){return this.preferences?this.preferences.hasPref("regEmail"):!1},this),hasRegPassword:e.bind(function(){return this.preferences?this.preferences.hasPref("regPassword"):!1},this),shieldedEmails:new c.ShieldedEmailCollection},ABINEMASKME.contentuser.shieldedEmails.fetchAll(),this.notifyInit(),void 0):(this.messenger={send:function(){}},void 0)},triggerKeyboardEvent:function(e,t){var n=this.document.createEvent("KeyboardEvent");n.initKeyboardEvent?n.initKeyboardEvent(e,!0,!0,null,!1,!1,!1,!1,9,0):n.initKeyEvent&&n.initKeyEvent(e,!0,!0,null,!1,!1,!1,!1,9,0),t.dispatchEvent(n)},maskCardContextMenu:function(){if(this.lastElementClicked){var n={element:this.lastElementClicked,dataType:"/financial/creditcard/number"};this.createPanel({style:{},secured:!0,panelWidth:400,field:n,ready:e.bind(function(i){var a=new m({field:n,formEl:this.lastElementClicked.parentNode,contentManager:this,fromContextMenu:!0,authToken:this.preferences.getPref("authToken"),beginnerMode:this.preferences.getPref("beginnerMode"),hasRegistered:this.preferences.isPrefTrue("hasRegistered"),entitledToPayments:this.preferences.isPrefTrue("entitledToPayments"),hasEnabledPayments:this.preferences.isPrefTrue("hasEnabledPayments"),dynamicPanel:null,dynamicPanelsJSON:"",fields:[n],domain:this.domain,el:t("<div></div>",i).get(0)});t(n.element).one("mm.closepanel",e.bind(a.closePanel,a)),a.bind("remove",function(){t(n.element).unbind("mm.closepanel");try{a.remove()}catch(e){}this.removePanels()},this),a.bind("render resize",function(){this.autoResizePanels()},this),t("body",i).append(a.el)},this)})}},fillField:function(e){var n=e.element||this.lastElementClicked;if(n){"/password"==e.dataType&&(!this.generatedPassword&&e.generatedNow?this.generatedPassword=e.value:this.generatedPassword&&e.generatedNow&&(e.value=this.generatedPassword)),t(n).val(e.value),e.name=n.getAttribute("name"),e.id=n.getAttribute("id"),this.contextForm||(this.contextForm=t("<form maskMeFilled='yes'></form>",this.document));var i=t(n).clone();i.attr("abinedatatype",e.dataType),this.contextForm.append(i),t(this.contextForm.get(0)).data("mmFields",null),this.messenger.send("panel:fill",{fieldData:e,formData:s.getFormData(this.contextForm.get(0),this.domain)})}},trackLastElementClicked:function(e){("input"==e.target.localName||"textarea"==e.target.localName)&&(this.lastElementClicked=e.target)},isLocked:function(){return this._locked},locked:function(){this._locked=!0,this.trigger("locked"),this.domain&&this.messenger.send("contentscript:contextmenu:refresh",{domain:this.domain})},unlocked:function(){this._locked=!1,this.trigger("unlocked"),this.domain&&this.messenger.send("contentscript:contextmenu:refresh",{domain:this.domain})},notifyInit:function(){if(this.href){var e={url:this.href,domain:this.domain};this.messenger.send("contentManager:init",e),this.trigger("contentManager:init",e)}},start:function(t){return t=t||0,null===this._locked?(20>t&&r.setTimeout(e.bind(function(){this.start(t+1)},this),100),void 0):(this.blacklistedSites?this.loadUserPreferences(e.bind(this.startFormHelpers,this)):(this.blacklistedSites=new c.BlacklistedSiteCollection,this.blacklistedSites.loadBlacklistedForDomain(this.domain,e.bind(function(t){this.blacklisted=t,this.loadUserPreferences(e.bind(this.startFormHelpers,this))},this))),void 0)},loadUserPreferences:function(t){t=t||function(){},this.preferences=new c.PreferenceCollection({}),this.preferences.bind("sync:success",e.once(e.bind(function(){t.call(this)},this))),this.preferences.bind("sync:error",e.bind(function(){t.call(this)},this)),this.preferences.fetchAll()},arrayFromNodeList:function(e){return Array.prototype.slice.call(e)},hookForUserIntent:function(){this.userIntent=!0},hookNewFormsOnClick:function(n){if(!this.blacklisted){this.formHelpers=this.formHelpers||[];var i=n.target;
if("input"===i.nodeName.toLowerCase()){var a=i.form||t(i).closest("form").get(0),o=null;a?(o=e(this.formHelpers).find(function(e){return e.formEl==a?!0:void 0}),o&&s.hasFormChanged(a)&&(o.cleanup(),this.formHelpers=e(this.formHelpers).filter(function(e){return e!=o}),o=null,s.clearFormCache(a)),o||this.setupFormHelperForFormEl(a,[],function(){r.setTimeout(function(){t(i).trigger("focus")},50)})):(o=e(this.formHelpers).find(function(e){for(var t=i.parentNode;t&&t!=e.formEl;)t=t.parentNode;return e.formEl==t?!0:void 0}),o?r.setTimeout(function(){t(i).trigger("focus")},50):this.startFormHelpers(function(){o=e(this.formHelpers).find(function(e){for(var t=i.parentNode;t&&t!=e.formEl;)t=t.parentNode;return e.formEl==t?!0:void 0}),r.setTimeout(function(){t(i).trigger("focus")},50)}))}}},setupFormHelperForFormEl:function(t,n,i){var a=null,r=null;if(this.domain&&this.domain.match(allowedHostsRegex)&&t.hasAttribute("datatype-ignore"))return i(),void 0;var l=s.getFormSignature(this.domain,t),d=null;if(this.formMappings&&(d=this.formMappings.find(function(e){return e.get("signature")==l?!0:!1})),r=d?d.get("formType"):s.getFormType(t),r==s.LOGIN_FORM?a=o.LoginHelper:r==s.REGISTRATION_FORM?a=o.RegistrationHelper:r==s.OTHER_FORM?a=o.OtherHelper:r==s.CHANGEPASSWORD_FORM?a=o.ChangePasswordHelper:r==s.LOGIN_REGISTRATION_FORM?a="loginRegisterHelper":r==s.CHECKOUT_FORM&&(a=o.CheckoutHelper),a){var u={};if(t.elements)for(var h=0;t.elements.length>h;h++)t.elements[h].name&&(u[t.elements[h].name]=1);var f=t.hasAttribute("action")?t.getAttribute("action"):"";n.push({url:f,type:r,fields:u});var p,m;if(d&&(m={},e.each(d.fields.models,function(e){m[e.get("signature")]=e.get("dataType")})),"loginRegisterHelper"==a||a==o.LoginHelper){var g=new c.Site({domain:this.domain}),y=e.bind(function(e){e&&true&&ABINEMASKME.log.error("[ERROR CALLBACK]#[abine/common/content_manager]#[setupFormHelperForFormEl]# error while loading accounts for site"),a=e||!g.accounts||0==g.accounts.length?"loginRegisterHelper"==a?o.RegistrationHelper:a:o.LoginHelper,p=new a({el:t,mappedFields:m,contentManager:this,preferences:this.preferences,site:g}),this.formHelpers.push(p),i()},this);this.domain?g.loadAccounts(!1,y):y()}else p=new a({el:t,mappedFields:m,contentManager:this,preferences:this.preferences}),this.formHelpers.push(p),i()}},hookDocumentEventHandlers:function(n){this.userIntentHandler?(t(n).off("keydown",this.userIntentHandler),t(n).off("mousedown",this.userIntentHandler),t(n).off("mousedown",this.hookNewFormsOnClickHandler)):(this.userIntentHandler=e.bind(this.hookForUserIntent,this),this.hookNewFormsOnClickHandler=e.bind(this.hookNewFormsOnClick,this)),t(n).on("keydown",this.userIntentHandler),t(n).on("mousedown",this.userIntentHandler),t(n).on("mousedown",this.hookNewFormsOnClickHandler)},startFormHelpers:function(t){if(this.blacklisted)return t&&t(),void 0;this.hookDocumentEventHandlers(this.document);var n=Date.now();this.formHelpers=this.formHelpers||[],this.innerFrames=this.innerFrames||{};var i=this.arrayFromNodeList(this.document.getElementsByTagName("form")),a=this.arrayFromNodeList(this.document.getElementsByTagName("iframe"));if(e(a).each(function(t){try{var n=t.contentWindow||t.contentDocument;if(n){n.document&&(n=n.document),n.documentElement.mmFormsProcessed=!0;var a=this.arrayFromNodeList(n.getElementsByTagName("form"));if(a.length>0){var r="iframe."+Math.random();this.innerFrames[r]=t,e(a).each(function(e){e.setAttribute("abFrameId",r)}),i=i.concat(a)}}}catch(s){}},this),i=i.concat(s.getFieldGroupsWithoutForm(this.document)),i=e(i).filter(e.bind(function(e){for(var t=0;this.formHelpers.length>t;t++)if(this.formHelpers[t].formEl==e)return!1;return!0},this)),this.formsData=this.formsData||[],0==i.length)return t&&t(),void 0;var r=e.bind(function(){e.async.forEachSeries(i,e.bind(function(e,t){this.setupFormHelperForFormEl(e,this.formsData,t)},this),e.bind(function(e){e&&true&&ABINEMASKME.log.error("[ERROR CALLBACK]#[abine/common/content_manager]#[startFormHandlers]# error event in setupFormHelperForFormEl while doing formElements async.forEach"),this.messenger.send("contentManager:formsInitialized",{forms:this.formsData,domain:this.domain}),this.trigger("contentManager:formsInitialized",{forms:this.formsData,domain:this.domain});{Date.now()-n}t&&t()},this))},this);!this.formMappings&&0!==i.length&&this.domain?(this.formMappings=new c.MappedFormCollection({}),this.formMappings.fetchAllByDomain(this.domain,e.bind(function(){r()},this))):r()},stopFormHelpers:function(){e(this.formHelpers).each(function(e){e.cleanup()}),this.formHelpers=[],this.formData=[],this.innerFrames=[]},setupFormsInFrame:function(n,i){if(n.documentElement&&!n.documentElement.mmFormsProcessed&&!this.blacklisted){this.hookDocumentEventHandlers(n),this.formHelpers=this.formHelpers||[],this.innerFrames=this.innerFrames||{},this.formsData=this.formsData||[];var a=null;!i&&n.defaultView&&n.defaultView.frameElement&&(i=n.defaultView.frameElement),i&&(a="iframe."+Math.random(),this.innerFrames[a]=i),n.documentElement.mmFormsProcessed=!0,t(n).bind("click",e.bind(this.hookNewFormsOnClick,this));var r=this.arrayFromNodeList(n.getElementsByTagName("form"));r=r.concat(s.getFieldGroupsWithoutForm(n));var o=[];e.async.forEachSeries(r,e.bind(function(e,t){a&&e.setAttribute("abFrameId",a),this.setupFormHelperForFormEl(e,o,t)},this),e.bind(function(e){e&&true&&ABINEMASKME.log.error("[ERROR CALLBACK]#[abine/common/content_manager]#[setupFormsInFrame]# error in setupFormHelperForFormEl while doing formElements async.forEach"),this.formsData=this.formsData.concat(o),this.messenger.send("contentManager:formsInitialized",{forms:o,domain:this.domain}),this.trigger("contentManager:formsInitialized",{forms:o,domain:this.domain})},this))}},triggerFocusOnElement:function(e){t(e).trigger("focus")},getPanelForDataType:function(t,n){var i=e.find(t,function(e){return e.field_type==n});return i?i:!1},createPanel:function(t){if(t.style=e.extend({},y,t.style),t.document=this.document,t.field){var n=this.innerFrames;t.ready=e.wrap(t.ready,function(e,i,a){v(i,a.parentElement,t.field.element,n),e(i,a)}),this.closeCurrentPanel(),this._currentPanelField=t.field}return t.secured&&this.isLocked()&&this.createLoginPanel(t),t.panelWidth||(t.panelWidth=350),a.createPanel(t)},/**
       * @license
       * Array Remove Copyright (c) John Resig (MIT Licensed)
       */
removeFromArray:function(e,t,n){var i=e.slice((n||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,i)},showNotification:function(n){if(this.preferences.getPref("showNotifications")&&n){var i=parseInt(this.preferences.getPref("countNotifications"))+1;this.preferences.setPref("countNotifications",i);var a=i>10?3e3:1e4;n.height=n.height?n.height:35,this.createPanel({className:"abineNotificationPanel",panelWidth:n.panelWidth,panelHeight:n.height,style:{borderRadius:"8px",height:n.height+"px",position:"Firefox"==ABINEMASKME.config.browser?"absolute":"fixed"},ready:e.bind(function(i,r){var s=f.NotificationPanelView;"card"==n.type?s=f.CardNotificationPanelView:"post-register"==n.type&&(s=f.PostRegisterNotificationPanelView);var o=new s({notification:n,domain:this.domain,el:t("<div></div>",i).get(0),timeout:a});this.notificationViews||(this.notificationViews=[]),this.notificationViews.unshift(r),o.bind("hide",function(){var t=e.find(this.notificationViews,function(e){return e==r});t&&(t.style.display="none")},this),o.bind("remove",function(){for(var e=0,n=0;this.notificationViews.length>n;n++)this.notificationViews[n]==r&&(e=n);if(this.removeFromArray(this.notificationViews,e),o.remove(),t(r.parentElement).remove(),this.notificationViews.length>0)for(var i=10,n=this.notificationViews.length-1;n>=0;n--)this.notificationViews[n].parentElement.style.top=i+"px",i+=this.notificationViews[n].parentElement.offsetHeight+5},this);var c=10;e.each(this.notificationViews,function(e){e!=r&&(c+=e.parentElement.offsetHeight+5)}),r.parentElement.style.top=c+"px",o.bind("render resize",function(){this.autoResizePanels("abineNotificationPanel")},this),t("body",i).append(o.el)},this)})}},createLoginPanel:function(n){n.contentManager=this,n.ready=e.bind(function(i,a){var r=this.innerFrames,s=n.field.element;v(i,a.parentElement,s,r);var o=new h({field:n.field,contentManager:n.contentManager,preferences:n.contentManager.preferences,el:t("<div></div>",i).get(0),doc:i});o.iframe=a,t(s).one("mm.closepanel",e.bind(o.closePanel,o)),o.bind("remove",function(){t(s).unbind("mm.closepanel"),o.remove(),this.removePanels(a),s.hasAttribute("mmHasFocusRemoved")?(s.removeAttribute("mmHasFocusRemoved"),s.setAttribute("mmHasFocus","yes")):s.removeAttribute("mmIgnoreBlur")},this),o.bind("render resize",function(){this.autoResizePanels()},this),t("body",i).append(o.el)},this)},isPanelShown:function(e){return this._currentPanelField&&this._currentPanelField==e},closeCurrentPanel:function(){this._currentPanelField&&(t(this._currentPanelField.element).trigger("mm.closepanel"),this._currentPanelField=null)},autoResizePanels:function(e){a.autoResizePanels({className:e,document:this.document})},removePanels:function(e){a.removePanels({document:this.document,iframe:e})},destroy:function(){try{u.securityManager.off("background:securityManager:locked",this.lockedCB)}catch(e){}try{u.securityManager.off("background:securityManager:unlocked",this.unlockedCB)}catch(e){}if("Firefox"!=ABINEMASKME.config.browser)try{u.disconnect()}catch(e){}try{this.disableFormHelpers()}catch(e){}if(this.messenger){try{this.messenger.send("contentManager:destroy")}catch(e){}this.messenger.off(),this.messenger.destroy(),delete this.messenger}}}),v=function(e,n,i,a){function r(){var e=null;if(i.form){var n=i.form.getAttribute("abFrameId");n&&n in a&&(e=a[n])}if(!e)try{e=i.ownerDocument.defaultView.frameElement}catch(r){}if(e){var o;try{o=t(e).offset()}catch(r){o=g(e)}s.top+=o.top+1-i.ownerDocument.body.scrollTop,s.left+=o.left-i.ownerDocument.body.scrollLeft}}var s;try{try{s=t(i).offset();try{i.ownerDocument!=n.ownerDocument&&r()}catch(o){}}catch(o){s=g(i),r()}s.top+=t(i,e).outerHeight()}catch(o){s={top:0,left:0}}n.style.top=s.top+"px",n.style.left=s.left+"px"};return{ContentManager:b}}),ABINEMASKME.define("abine/contextHelper",["documentcloud/underscore","abine/window","storage","abine/password","abine/config"],function(e,t,n,i,a){return{onClick:function(r,s,o,c,l){if(s.indexOf("abine_maskme_accountfield_")>=0){var d=s.split("accountfield_")[1];n.AccountField.load(d,e.bind(function(e){this.fillFieldInTab(r,o,{element:l,value:e.value,dataType:e.dataType,origin:e.origin})},this))}else switch(s){case"abine_maskme_email_mask":n.ShieldedEmail.index(null,e.bind(function(t){n.DisposableEmail.createOnServer({sender:o,payload:{targetGuid:t[0].guid,label:c}},e.bind(function(e){this.fillFieldInTab(r,o,{element:l,value:e.getAddress(),dataType:"/contact/email",origin:"disposable",disposableGUID:e.guid})},this))},this));break;case"abine_maskme_email_disclose":n.Preference.findBy("key","regEmail",e.bind(function(i){i?t.createTab({localUrl:"pages/index.html#editUser/email"}):n.ShieldedEmail.index(null,e.bind(function(e){this.fillFieldInTab(r,o,{element:l,value:e[0].email,dataType:"/contact/email",origin:""})},this))},this));break;case"abine_maskme_phone_mask":n.DisposablePhone.index(null,e.bind(function(e){this.fillFieldInTab(r,o,{element:l,value:e[0].getPrettyNumber(),origin:"disposable",disposableGUID:e[0].id,dataType:"/contact/phone"})},this));break;case"abine_maskme_phone_disclose":n.ShieldedPhone.index(null,e.bind(function(e){this.fillFieldInTab(r,o,{element:l,value:e[0].getPrettyNumber(),origin:"",dataType:"/contact/phone"})},this));break;case"abine_maskme_card_mask":this.triggerCreditCardPanelInTab(r,o,{});break;case"abine_maskme_activate_card":t.createTab({localUrl:"pages/index.html#payments"});break;case"abine_maskme_password_mask":this.fillFieldInTab(r,o,{element:l,value:i.generateRandomPassword(),origin:"strong",generatedNow:!0,dataType:"/password"});break;case"abine_maskme_unlock":t.createTab({forceReload:!0,localUrl:"pages/index.html#unlock"});break;case"abine_maskme_setup_phone":var u=function(){t.createTab({forceReload:!0,localUrl:"pages/index.html#userInfo"})};n.Preference.batchFindBy([{by:"key",value:"entitledToPhone"},{by:"key",value:"authToken"},{by:"key",value:"regEmail"},{by:"key",value:"regPassword"}],function(e){var i=e.entitledToPhone,r=e.authToken,s=e.regEmail,o=e.regPassword;!i||i.isFalse()?r&&r.value&&""!=r.value?n.ShieldedEmail.getDefault({},function(e){if(e&&""!=e.email){var n=a.protocol+a.licenseServerHost+"/subscriptions/id_me?auth_token="+r.value+"&email="+e.email+"&feature=phone";s&&o?n+="&notsetup=3":s?n+="&notsetup=1":o&&(n+="&notsetup=2"),t.createTab({force:!0,url:n})}else u()}):u():t.createTab({localUrl:"pages/index.html#editUser/phone"})});break;case"abine_maskme_blacklisted":t.createTab({localUrl:"pages/index.html#blacklist"})}},fillFieldInTab:function(e,t,n){e.send("background:contextmenu:fill",n,t)},triggerCreditCardPanelInTab:function(e,t,n){e.send("background:contextmenu:maskcard",n,t)}}}),ABINEMASKME.define("abine/core",["documentcloud/underscore"],function(e){Events={on:function(e,t,n){var i=this._callbacks||(this._callbacks={}),a=i[e]||(i[e]={}),r=a.tail||(a.tail=a.next={});return r.callback=t,r.context=n,a.tail=r.next={},this},off:function(e,t){var n,i,a;if(e){if(n=this._callbacks)if(t){if(i=n[e])for(;(a=i)&&(i=i.next);)if(i.callback===t){a.next=i.next,i.context=i.callback=null;break}}else n[e]={}}else this._callbacks=null;return this},trigger:function(e){var t,n,i,a,r,s=["all",e];if(!(n=this._callbacks))return this;for(;r=s.pop();)if(t=n[r])for(a="all"==r?arguments:Array.prototype.slice.call(arguments,1);t=t.next;)(i=t.callback)&&i.apply(t.context||this,a);return this},once:function(e,t,n){function i(){return a.off(e,i),t.apply(this,arguments)}var a=this;return this.on(e,i,n)},onceAny:function(){function e(){for(var n=0;t.length>n;n++)this.off.apply(this,[t[n][0],e]),this.off.apply(this,t[n])}for(var t=arguments,n=0;arguments.length>n;n++)this.on.apply(this,arguments[n]),this.on.apply(this,[arguments[n][0],e]);return this}};var t=function(){},n=function(n,i,a){var r;return r=i&&i.hasOwnProperty("constructor")?i.constructor:function(){return n.apply(this,arguments)},e.extend(r,n),t.prototype=n.prototype,r.prototype=new t,i&&e.extend(r.prototype,i),a&&e.extend(r,a),r.prototype.constructor=r,r.__super__=n.prototype,r},i=function(e,t){var i=n(this,e,t);return i.extend=this.extend,i},a=function a(){this.initialize.apply(this,arguments)};return e.extend(a.prototype,Events,{initialize:function(){}}),a.extend=i,{BaseClass:a,Events:Events}}),ABINEMASKME.define("abine/emailServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core"],function(e,t,n,i,a){var r=n.protocol+n.emailServerHost,s=r+"/api/v2/disableDisposable",o=r+"/api/v2/enableDisposable",c=r+"/api/v2/readDisposables",l=r+"/api/v2/readTarget",d=r+"/api/v2/generateDisposable",u=r+"/api/v2/disposableDomains",h=r+"/api/v2/disableAndDeleteDisposable",f=r+"/api/v2/webmail",p=a.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},getInbox:function(e,t){this.server.makeRequest({server:"email",action:"getInbox",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:f,type:"GET"})},getMail:function(e,t){this.server.makeRequest({server:"email",action:"getMail",defaults:{},required:["mid"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:f+"/"+e.mid,type:"GET"})},getDisposableDomains:function(e,t){this.server.makeRequest({server:"email",action:"getDisposableDomains",defaults:{},required:["guid"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:u,type:"GET"})},disableDisposable:function(e,t){this.server.makeRequest({server:"email",action:"disableDisposable",defaults:{},required:["guid"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"PUT"})},disableAndDeleteDisposable:function(e,t){this.server.makeRequest({server:"email",action:"disableAndDeleteDisposable",defaults:{},required:["guid"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:h,type:"DELETE"})},enableDisposable:function(e,t){this.server.makeRequest({server:"email",action:"enableDisposable",defaults:{},required:["guid"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"PUT"})},readDisposables:function(e,t){this.server.makeRequest({server:"email",action:"readDisposables",defaults:{},required:["guid"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:c,type:"GET"})},readTarget:function(e,t){this.server.makeRequest({server:"email",action:"readTarget",defaults:{},required:["target_email"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:l,type:"GET"})},generateDisposable:function(e,t){this.server.makeRequest({server:"email",action:"generateDisposable",defaults:{domain:n.disposableDomain},required:["guid","domain"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:d,type:"POST"})}});return p}),ABINEMASKME.define("abine/failedSubmitDetector",["documentcloud/underscore","abine/core","storage","abine/timer","persistence","abine/url"],function(e,t,n,i,a,r){function s(t,n,i,a){if(u(n),n in b){var r=b[n],s=r.submitData;if(delete b[n],i)return o(r,a),void 0;var c=!1;e.each(t.forms,function(t){if(t.type==s.type&&t.fields){var n=0,i=0;e.each(s.data,function(e){e.name in t.fields?n++:i++}),n>=2&&n>i&&(c=!0)}}),c&&o(r,a),c||E.trigger("background:saveForm:retained",{type:r.type,formType:r.submitData.type,accountId:r.accountId,tabId:n,insuranceSubmit:r.submitData.insuranceSubmit,noPassword:r.submitData.noPassword,accountType:r.accountType})}else E.trigger("background:saveForm:retained",null),a&&a()}function o(t,i){var r=t.submitData,s=function(){E.trigger("background:saveForm:rollback",{accountId:t.accountId}),i&&i()};t.type==h||t.type==p?n.AccountActivity.all().filter("accountId","=",t.accountId).destroyAll(function(){n.Account.load(t.accountId,function(t){var i=function(e){return e.siteId==t.siteId};n.Account.listCached(i,function(i){var r=e.find(i,function(e){return"fill"==e.type&&e.id!=t.id});r?n.AccountField.getLatestForAccountId(r.id,function(e){n.AccountField.getLatestForAccountId(t.id,function(n){for(var i=0;n.length>i;i++){for(var o=!1,c=0;e.length>c;c++)n[i].dataType==e[c].dataType&&(o=!0,n[i].value==e[c].value&&(e[c].origin=n[i].origin));o?a.remove(n[i]):n[i].accountId=r.id}a.remove(t),a.flush(s)})}):(t.type="fill",a.flush(s))})})}):t.type==m?c(t.accountId,r.data,s):t.type!=g&&l(t.accountId,r.data,s)}function c(t,i,r){function s(e){return e.accountId==t&&1==e.latest&&"/password"==e.dataType}n.AccountField.listCached(s,function(i){e.async.forEach(i,function(e,i){n.AccountField.rollbackVersioned({payload:{name:e.name,value:e.value,dataType:e.dataType,accountId:t,modifiedAt:new Date}},function(){i()})},function(i){i&&true&&ABINEMASKME.log.error("[ERROR CALLBACK]#[abine/common/failed_submit_detector]#[rollbackAccountPassword]# error while rolling back password fields"),n.AccountActivity.all().filter("accountId","=",t).list(function(t){var n=null;e(t).each(function(e){n||"update password"!=e.activityType||(n=e)}),a.remove(n),a.flush(r)})})})}function l(t,i,a){var r=0,s=e.size(i),o=function(){r++,r==s&&a()};e.each(i,function(e){n.AccountField.rollbackVersioned({payload:{name:e.name,value:e.value,dataType:e.dataType,accountId:t,modifiedAt:new Date}},o)})}function d(t){u(t),b[t].failureTimer=i.setTimeout(e.bind(function(){t in b&&b[t].failureTimer&&(u(t),E.trigger("submitFailureDetector:recheckForms",t))},this),y)}function u(e){e in b&&b[e].failureTimer&&(i.clearTimeout(b[e].failureTimer),delete b[e].failureTimer)}var h=1,f=2,p=3,m=4,g=5,y=8e3,b={},v=t.BaseClass.extend({saveInProgress:!1,formsInitialized:function(t,n){this.saveInProgress?i.setTimeout(e.bind(function(){this.formsInitialized(t,n)},this),250):s(t,n)},contentManagerInit:function(t,n){this.saveInProgress?i.setTimeout(e.bind(function(){this.contentManagerInit(t,n)},this),250):u(n)},init:function(t){this.backgroundMessenger=t,t.on("contentManager:formsInitialized",this.formsInitialized,this),t.on("contentManager:init",this.contentManagerInit,this),this.on("submitFailureDetector:recheckForms",e.bind(function(e){t.send("background:failedSubmitDetector:recheckForms",{},e)},this)),this.on("background:saveForm:rollback",e.bind(function(){t.send("broadcast:saveForm:rollback")},this)),this.on("background:saveForm:retained",e.bind(function(e){if(e&&e.accountId){var a;if(e.type==h){if("passwordless"==e.accountType)return;e.msg="MaskMe will help you login here in the future.",a=340}else if(e.type==f)e.msg="MaskMe has saved the changes to your account.",a=340;else if(e.type==m)e.msg="MaskMe has updated this account's password",a=340;else if(e.type==g)return;n.Preference.findBy("key","rememberAccounts",function(r){var s=r?r.value:"false";n.Preference.findBy("key","rememberOnlyMaskMe",function(n){var r=n?n.value:"false";("false"!==s&&("true"!==s||"true"!==r)||"loginForm"!==e.formType)&&(e.noPassword||e.insuranceSubmit||i.setTimeout(function(){t.send("background:saveForm:notification",{msg:e.msg,targetUrl:"pages/index.html#sites",panelWidth:a},e.tabId)},2e3))})})}},this))},monitor:function(e,t,n,i,a){var r={fill:p,"new":h,changepass:m,update:f,login:g};n=r[n],b[e]={submitData:t,accountId:i,type:n,accountType:a},d(e)},rollbackPending:function(e,t){s([],e,!0,t)},setTimeout:function(e){y=e}}),E=new v;return E}),ABINEMASKME.define("abine/formAnalyzer",["documentcloud/underscore","jquery","pidcrypt","abine/phoneHeuristics","abine/paymentHeuristics","abine/url"],function(e,t,n,i,a,r){var s="loginForm",o="registrationForm",c="checkoutForm",l="changepasswordForm",d="otherForm",u="loginRegistrationForm",h="emailField",f="passwordField",p="phoneField",m="usernameField",g="paymentField",y={checkbox:1,radio:1,hidden:1,button:1,submit:1,file:1,image:1},b={LOGIN_FORM:s,REGISTRATION_FORM:o,CHECKOUT_FORM:c,CHANGEPASSWORD_FORM:l,OTHER_FORM:d,LOGIN_REGISTRATION_FORM:u,EMAIL_FIELD:h,PASSWORD_FIELD:f,PHONE_FIELD:p,USERNAME_FIELD:m,PAYMENT_FIELD:g,getFormType:function(t){var n=b.getFields(t),i=0,a=0,r=0,u=0,h={},f=0;e(n).each(function(e){"/ignore"!=e.dataType&&("password"==e.fieldType||"/password"==e.dataType||"/passwordold"==e.dataType?(i++,h[e.fieldType]||(h[e.fieldType]=0),h[e.fieldType]++):(e.fieldType in{text:1,email:1,tel:1}&&a++,"/contact/email"==e.dataType?r++:"/nameperson/friendly"==e.dataType&&u++,e.dataType&&e.dataType.indexOf("financial")>=0&&f++))}),h.text&&h.password&&(i-=h.text);var p=d;return 0===i?r>=1?p=o:1===u&&(p=s):1===i?p=a>1?o:s:2===i?p=o:3===i&&(p=l),f>0&&(p=c),p},hasFormChanged:function(e){for(var n=t(e).find("input, textarea").toArray(),i=0;n.length>i;i++)if(!t(n[i]).data("mmProcessed"))return!0;var a=this.getFields(e);for(var i in a)if(!a[i].element.parentNode)return!0;return!1},clearFormCache:function(e){t(e).removeData("mmSignature"),t(e).removeData("mmFields")},getFormSignature:function(e,i){var a,r,s,o={},c=t(i).find("input, textarea").toArray(),l=t(i).data("mmSignature");if(l)return l;l="",l+=e;for(var d=[],u=0;c.length>u;u++)if(s=c[u],!(s.hasAttribute("type")&&s.getAttribute("type").toLowerCase()in y||s.hasAttribute("readonly"))){if(r=s.nodeName.toLowerCase(),a=s.name||s.id||r,o[a]){for(var h=2;o[a+h];)h++;a+=h}d.push(a),o[a]=1}d.sort();for(var u=0;d.length>u;u++)l+=d[u]+"_";return l=n.SHA1(l),t(i).data("mmSignature",l),l},getFields:function(e,n){var r,s,o,c,l,d,u,h,f=[],p=0,m=0,g=t(e).data("mmFields");if(g)return g;g={},t(e).data("mmFields",g);for(var v=t(e).find("input, textarea, select").toArray(),A=b.getLabelMapFor(e),M=0;v.length>M;M++)if(d=v[M],t(d).data("mmProcessed",1),!(d.hasAttribute("type")&&d.getAttribute("type").toLowerCase()in y||d.hasAttribute("readonly"))){if(p+=1,s=d.nodeName.toLowerCase(),r=d.name||d.id||s,g[r]){for(var _=2;g[r+_];)_++;r+=_}l=A[d.id||d.name]?A[d.id||d.name].text:null,null==l&&d.hasAttribute("placeholder")&&(l=d.getAttribute("placeholder")),""==l&&(l=null),"select"==s?u="select":"textarea"==s?u="textarea":"input"==s&&(u=d.getAttribute("type")?d.getAttribute("type").toLowerCase():"text"),"email"==u?c="/contact/email":"tel"==u?c="/contact/phone":(h=d.name||E(d.id)||d.className||"",c=b.getDataTypeByRegExRules(h,l,u,d.innerHTML),"password"!=u||"/passwordold"==c||c&&-1!=c.indexOf("/financial")||(c="/password"),"/password"==c&&(m++,o||(o=r))),n&&n[r]&&(c=n[r]),d.hasAttribute("abinedatatype")&&(c=d.getAttribute("abinedatatype")),g[r]={position:p,element:d,fieldType:u,id:d.id,className:d.className,name:d.name,dataType:c,label:l,signature:r,maxlength:d.hasAttribute("maxlength")?parseInt(d.getAttribute("maxlength")):null,size:d.size?d.size:null},f[p]=g[r],f[p].key=r}return n||(3==m&&(g[o].dataType="/passwordold"),i.apply(g,f),a.apply(g,f)),g},getProtocol:function(e,t){var n=e.getAttribute("action");return n&&0===n.indexOf("http")||(n=t),n.replace(/:.*/,"")},getPageDomain:function(e){return r.getHostname(e)},getFormDomain:function(e,t){var n=e.getAttribute("action");return n?n.match(/(http[s]?:)?\/\//i)?r.getHostname(n):r.getHostname(t):""},getFormData:function(n,i){var a=n.hasAttribute("action")?n.getAttribute("action"):i,r=b.getFields(n),s=b.getFormType(n),o=b.getFormSignature(i,n),c={url:a,type:s,data:[],pageUrl:i,formSignature:o};return"yes"===t(n).attr("maskMeFilled")&&(c.origin="MaskMe"),c.protocol=this.getProtocol(n,i),c.page_domain=this.getPageDomain(i),c.form_domain=this.getFormDomain(n,i),e.each(r,function(e){-1=="submit.image.button".indexOf(e.fieldType)&&(-1=="checkbox.radio".indexOf(e.fieldType)||e.element.checked)&&c.data.push({name:e.name,id:e.id,dataType:e.dataType,value:t(e.element).val()||""})}),c},getFieldType:function(e){var t=e.nodeName.toLowerCase();if("select"==t)return"select";if("textarea"==t)return"textarea";if("input"==t){var n=e.getAttribute("type");return n?n.toLowerCase():"text"}},getLabelMapFor:function(e){var n,i={};return t(e).find("label").each(function(e,a){if(n=a.getAttribute("for"))i[n]||(i[n]={element:a,text:t(a).text()||a.name||a.id});else{var r=a.nextSibling;for(r||(r=a.parentNode.nextSibling);r&&1!=r.nodeType;)r=r.nextSibling;if(r&&!r.form&&r.firstChild)for(r=r.firstChild;r&&1!=r.nodeType;)r=r.nextSibling;r&&r.form&&(r.id||r.name)&&(i[r.id||r.name]={element:a,text:t(a).text()||a.name||a.id})}}),i},getLabelFor:function(e,n){var i=e.id||e.name;return i?t(n).find('label[for="'+i+'"]').get(0):null},getDataTypeByRegExRules:function(t,n,i,a){var r=t&&t.length>0,s=n&&n.length>0,o=r?t.replace(A.nonAlphanumeric,""):null,c=s?n.replace(A.nonAlphanumeric,""):null;o==t&&(alternameName=null),c==n&&(alternameLabel=null);var l=n+t,d=c+o,u=v[i];if(!u)return null;for(var h=[],f=0;u.length>f;f++){var p=u[f],m="undefined"!=typeof p.label,g="undefined"!=typeof p.name;if(!p.negative||!(t&&t.match(p.negative)||n&&n.match(p.negative))){if(s&&!m&&g&&n.match(p.name)||s&&m&&n.match(p.label)||r&&g&&t.match(p.name)||c&&!m&&g&&c.match(p.name)||c&&m&&c.match(p.label)||o&&g&&o.match(p.name)){if(p.options&&a&&!a.match(p.options))continue;h.push(p.data_type);break}if(p.label_name&&s&&r&&(!m&&g&&l.match(p.name)||m&&l.match(p.label)||g&&l.match(p.name)||d&&!m&&g&&d.match(p.name)||d&&m&&d.match(p.label)||d&&g&&d.match(p.name))){h.push(p.data_type);break}if(p.matchByOptions&&p.options&&a&&a.match(p.options)){h.push(p.data_type);break}}}if(1==h.length)return h[0];if(h.length>1){var y=e(h).find(function(e){return"/contact/email"==e?!0:void 0});return y?y:h[0]}return null},getFieldGroupsWithoutForm:function(t){for(var n={text:1,password:1,email:1,tel:1},i=t.getElementsByTagName("input"),a=(e(i).filter(function(e){if(e.form)return!1;var t=e.type?e.type.toLowerCase():"text";return t in n},this)),r=[],s=[],o=[1],c={},l=0;a.length>l;l++){for(var d=a[l].parentNode,u={},h=0,f=!1;d&&3>h;){if(d.id=d.id||"abId"+Math.random(),l>0&&d.id in s[l-1]){o[l]=o[l-1],u=s[l-1],(!(o[l-1]in c)||h>c[o[l-1]].depth)&&(c[o[l-1]]={lca:d,depth:h}),f=!0;break}u[d.id]=1,d=d.parentNode,h++}s.push(u),f||(o[l]=0==l?1:o[l-1]+1,c[o[l]]={lca:a[l].parentNode,depth:0})}var p={};for(var m in c)c[m].lca.id in p||(p[c[m].lca.id]=1,r.push(c[m].lca));return r.length>0,r}},v={text:[{name:/.*captcha.*/i,data_type:"/ignore"},{name:/^q$|find|search|terms/i,data_type:"/ignore"},{name:/hint/i,data_type:"/ignore"},{name:/email|e\-mail/i,label:/windowsliveid|email|e\-mail/i,negative:/search|friend|reference|recipient|reference|receiver/i,data_type:"/contact/email"},{name:/user|userid|alias|login|uname|yahooid|onlineid|session_key|(?:(?:nick|screen|member|usr|user|account|login|display).*(name|id))/i,label:/alias|shortname|login|handle|display.*name|user[\s]*(name|id)/i,negative:/credit|password|full/i,data_type:"/nameperson/friendly"},{name:/(?:title|salutation)/i,data_type:"/nameperson/prefix"},{name:/(?:lname|last|sur).*(?:name)?/i,label:/last.*name/i,data_type:"/nameperson/last",negative:/full/i},{name:/(?:fname|first).*(?:name)?/i,label:/first.*name/i,data_type:"/nameperson/first",negative:/full/i},{name:/(?:.*(?:full|invoice|real|bill|(?:ship.*to)).*name)|(?:^name$)/i,negative:/holder|credit/i,data_type:"/nameperson/full"},{label:/(?:middle|middleinitial)/i,data_type:"/nameperson/middle"},{label:/(?:suffix)/i,data_type:"/nameperson/suffix"},{name:/(?:(?:confirm|new|create|re\-enter)[\s]*)?password(?:(?:confirm|new|create|re\-enter)[\s]*)?/i,label:/(?:(?:confirm|new|create|re\-enter)[\s]*)?password/i,negative:/hint|old|current/i,data_type:"/password"},{name:/(?:old|current)[\s]*(?:pass|pwd)/i,label:/[\s]*(?:(?:current|old)[\s]*)password/i,data_type:"/passwordold"},{label:/.*twitter.*/i,data_type:"/contact/im/twitter"},{label:/.*linkedin.*/i,data_type:"/contact/web/linkedin"},{label:/.*blog.*/i,data_type:"/contact/web/blog"},{label:/.*aim/i,data_type:"/contact/IM/aim"},{label:/.*icq.*/i,data_type:"/contact/IM/icq"},{label:/.*msn(?:m)?/i,data_type:"/contact/IM/msn"},{label:/.*jabber/i,data_type:"/contact/IM/jabber"},{label:/.*skypq/i,data_type:"/contact/IM/skype"},{label:/.*(?:yim|yahoo)/i,data_type:"/contact/IM/yahoo"},{name:/(?:home).*phone.*(?:num|number)/i,label:/even.*phone/,negative:/gift|loyalty/i,data_type:"/contact/phone"},{name:/.*(?:cell|mob(?:ile)?).*/i,data_type:"/contact/phone/mobile"},{name:/.*fax.*/i,data_type:"/contact/phone/fax"},{name:/(?:day|daytime|work|business).*phone/i,label:/(?:day|daytime|work|business).*phone/,data_type:"/contact/phone/work"},{name:/(?:night|nighttime|home).*phone/i,label:/(?:night|nighttime|home).*phone/,data_type:"/contact/phone/home"},{name:/area.*code.*/i,data_type:"/contact/phone/areacode",negative:/zip/i},{name:/(?:phone.*(?:area|1).*)/i,data_type:"/contact/phone/areacode",negative:/zip/i},{name:/(?:phone.*(?:exch|prefix|first|2).*)|(?:exchange)/i,data_type:"/contact/phone/exchange"},{name:/phone.*(?:suffix|end|last|3).*/i,data_type:"/contact/phone/local",negative:/zip/i},{name:/phone.*(?:country|countrycode).*/i,label:/\+1/,data_type:"/contact/phone/countrycode"},{name:/home.*(?:exch|prefix).*/i,data_type:"/contact/phone/exchange"},{name:/home.*area.*/i,data_type:"/contact/phone/areacode",negative:/zip/i},{name:/home.*(?:num|suffix|end).*/i,data_type:"/contact/phone/local"},{name:/home.*(?:country|countrycode).*/i,data_type:"/contact/phone/countrycode"},{name:/area.*code/i,data_type:"/contact/phone/areacode",negative:/zip/i},{name:/exchange/i,data_type:"/contact/phone/exchange"},{name:/local/i,data_type:"/contact/phone/local"},{name:/phone.*(?:ext|extension)/i,data_type:"/contact/phone/extension",negative:/text/i},{name:/extension/i,data_type:"/contact/phone/extension"},{name:/phone/i,label:/phone/i,data_type:"/contact/phone"},{name:/(?:bill|b).*(?:zip|postal|post)(?:.*code)?/i,data_type:"/contact/postalcode/billing"},{name:/.*(?:zip|postal|post)(?:.*code)?/i,data_type:"/contact/postalcode"},{name:/bill.*city/i,data_type:"/contact/city/billing"},{name:/business.*city/i,data_type:"/contact/city/business"},{name:/home.*city/i,data_type:"/contact/city/home"},{name:/city/i,data_type:"/contact/city"},{name:/bill.*country/i,data_type:"/contact/country/billing"},{name:/business.*country/i,data_type:"/contact/country/business"},{name:/home.*country/i,data_type:"/contact/country/home"},{name:/country/i,data_type:"/contact/country"},{name:/bill.*state/i,data_type:"/contact/state/billing"},{name:/business.*state/i,data_type:"/contact/state/business"},{name:/home.*state/i,data_type:"/contact/state/home"},{name:/state/i,data_type:"/contact/state"},{name:/bill.*addr.*2/i,data_type:"/contact/postaladdressAdditional/billing"},{name:/home.*addr.*2/i,data_type:"/contact/postaladdressAdditional/home"},{name:/(?:addr.*2)|(?:(?:ad.*)?line.*2)/i,label:/.*address.*(?:line)?.*2.*/,data_type:"/contact/postaladdressAdditional"},{name:/bill.*addr.*3/i,data_type:"/contact/postaladdress3/billing"},{name:/home.*addr.*3/i,data_type:"/contact/postaladdress3/home"},{name:/(?:addr.*3)|(?:(?:ad.*)?line.*3)/i,label:/.*address.*(?:line)?.*3.*/,data_type:"/contact/postaladdress3"},{name:/bill.*addr/i,data_type:"/contact/postaladdress/billing"},{name:/home.*addr/i,data_type:"/contact/postaladdress/home"},{name:/(?:addr.*1?)|(?:(?:ad.*)?line.*1?)/i,label:/.*address.*(?:line1?)?.*/,negative:/type/i,data_type:"/contact/postaladdress"},{name:/.*(?:comment|message).*/i,data_type:"/message"},{name:/.*(?:(?:(?:cc|card)?.*(?:(?:holder|owner).*)))|(?:name.*on.*card)|(?:issued.*to)|(?:(?:card|cc|payment).*name)/i,label:/(?:issued.*to)|(?:name.*on.*card)|(?:card.*name)|(?:card.*holder)/i,negative:/gift|placeholder|account|acct|first|last|num|cvv/i,data_type:"/financial/creditcard/issuedto"},{name:/.*(?:cc|card|credit.*card)?(?:(?:cvv|cvc|ccv|cv|cid|verify|verif.*(?:code|num)|verification|sec.*code|card.*sec.*num)|cvv).*/i,negative:/gift/i,data_type:"/financial/creditcard/verification"},{name:/.*(?:cc|card|credit.*card|payment).*(?:num|number|no)|ccard/i,label:/card.*number/i,negative:/gift|account|reward|acct|issue/i,data_type:"/financial/creditcard/number"},{name:/.*(?:cc|card|credit.*card).*(?:type|issuer)/i,negative:/gift/i,data_type:"/financial/creditcard/type"},{name:/.*(?:(?:(?:cc|card|billing)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*)))(?:date.*)?(?:[m]{2}|mo|mon|month|mn)/i,negative:/gift|start|valid|birth/i,data_type:"/financial/creditcard/expirymonth"},{name:/.*(?:(?:(?:cc|card|billing)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*)))(?:date.*)?(?:[y]{2,4}|yr|year)/i,negative:/gift|start|valid|birth/i,data_type:"/financial/creditcard/expiryyear"},{name:/.*(?:(?:(?:cc|card|billing)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*))|expiration)/i,negative:/gift|year|yr|mon|mm|yy|start|valid|birth/i,data_type:"/financial/creditcard/expiry"},{name:/(?:birth.*year)|(?:dob[y]+)|(?:(?:dob|date).*year.*)|(?:year.*(?:born|birth))|(?:birthday[y]+r?)/i,negative:/exp/i,data_type:"/birthdate/birthyear"},{name:/(?:birth.*mon(?:th)?)|(?:dob[m]+)|(?:(?:dob|date).*mon(?:th)?.*)|(?:month.*(?:born|birth))|(?:birthday[m]+)/i,negative:/exp/i,data_type:"/birthdate/birthmonth"},{name:/(?:birth.*day)|(?:dob[d]+)|(?:(?:dob|date).*(?:day|date).*)|(?:day.*(?:born|birth))|(?:birthday[d]+)/i,data_type:"/birthdate/birthday"},{name:/(?:b|birth|dob)(?:day|date)/i,data_type:"/birthdate"},{name:/.*(?:co|comp|company|business)(?:name)/i,label:/(?:company|business|organization)(?:\s+name)?/i,data_type:"/company/name"},{name:/.*(?:customer).*(?:company).*/i,data_type:"/company/name"},{name:/^pin$/i,label:/^pin$/i,data_type:"/pin"}],password:[{name:/.*(?:cc|card|credit.*card)?(?:cvv|cvc|ccv|id|verify|verif.*(?:code|num)|verification|security.*code|card.*sec.*num).*/i,negative:/gift|password|pass/i,data_type:"/financial/creditcard/verification"},{name:/pin/i,label:/pin/i,data_type:"/pin"},{name:/(?:(?:confirm|new|create|re\-enter|verify)[\s]*)?password(?:(?:confirm|new|create|re\-enter)[\s]*)?/i,label:/(?:(?:confirm|new|create|re\-enter)[\s]*)?password/i,negative:/hint|old|current/i,data_type:"/password"},{name:/(?:old|current)[\s]*(?:pass|pwd)/i,label:/[\s]*(?:(?:current|old)[\s]*)password/i,data_type:"/passwordold"}],select:[{name:/(?:title|salutation)/i,data_type:"/nameperson/prefix"},{name:/.*(?:cc|card|credit.*card|payment).*(?:type|issuer)/i,negative:/gift/i,data_type:"/financial/creditcard/type",options:/visa|diner|amex|american[^<]*express/i,matchByOptions:!0},{name:/.*(?:(?:(?:cc|card|billing|payment)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*)?)|exp.*)(?:date.*)?(?:[m]{2}|mo|mon|month|mn)/i,negative:/gift|start|valid|birth/i,data_type:"/financial/creditcard/expirymonth",options:/12|jan|feb/i},{name:/.*(?:(?:(?:cc|card|billing|payment)?.*(?:exp.*))|(?:(?:cc|card).*(?:exp.*)?)|exp.*)(?:date.*)?(?:[y]{2,4}|yr|year)/i,negative:/gift|start|valid|birth/i,data_type:"/financial/creditcard/expiryyear",options:/20[0-9]{2}/i},{name:/(?:birth.*year)|(?:dob[y]+)|(?:(?:dob|date).*year.*)|(?:year.*(?:born|birth))|(?:birthday[y]+r?)/i,negative:/exp/i,data_type:"/birthdate/birthyear"},{name:/(?:birth.*mon(?:th)?)|(?:dob[m]+)|(?:(?:dob|date).*mon(?:th)?.*)|(?:month.*(?:born|birth))|(?:birthday[m]+)/i,negative:/exp/i,data_type:"/birthdate/birthmonth"},{name:/(?:birth.*day)|(?:dob[d]+)|(?:(?:dob|date).*(?:day|date).*)|(?:day.*(?:born|birth))|(?:birthday[d]+)/i,data_type:"/birthdate/birthday"},{name:/(?:b|birth|dob)(?:day|date)/i,data_type:"/birthdate"},{name:/gender|sex/i,data_type:"/person/gender"},{name:/phone.*(?:country|countrycode).*/i,data_type:"/contact/phone/countrycode"},{name:/home.*(?:country|countrycode).*/i,data_type:"/contact/phone/home/countrycode"},{name:/bill.*country/i,data_type:"/contact/country/billing"},{name:/business.*country/i,data_type:"/contact/country/business"},{name:/home.*country/i,data_type:"/contact/country/home"},{name:/country/i,data_type:"/contact/country"},{name:/bill.*state/i,data_type:"/contact/state/billing"},{name:/business.*state/i,data_type:"/contact/state/business"},{name:/home.*state/i,data_type:"/contact/state/home"},{name:/state/i,data_type:"/contact/state"}],checkbox:[{name:/agree|tos|terms|service/i,data_type:"/agreetos"},{name:/(?:accept|agree|terms|(?:read)?rules|conditions|privacypolicy).*/i,data_type:"/agreetos"},{name:/.*(?:remember|persistent).*/i,label:/keepmesignedin/i,data_type:"/rememberme"}],radio:[{name:/gender|sex/i,label:/^(?:male|female)$/i,data_type:"/person/gender"}]},E=function(e){var t=e.match(/^user\[(.*)\]$/);return t?t[1]:e},A={nonAlphanumeric:/[^a-z0-9]+/gim,nonAlpha:/[^a-z]+/gim,spaces:/[\s]+/gim,startsWithDot:/^\./,trimSepartor:/(^\|\|)|(\|\|$)/g,textOrSelect:/text|select/i,email:/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~\-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~\-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9\-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i};
return b}),ABINEMASKME.define("abine/formObserver",["documentcloud/underscore","jquery","abine/core","abine/contentMessenger","abine/formAnalyzer","abine/timer"],function(e,t,n,i,a,r){function s(e){return e in c?c[e]:(e=e.substr(0,e.lastIndexOf("/")),e in c?c[e]:null)}function o(e){var t=e.dataType;return t?t in c?!0:(t=t.substr(0,t.lastIndexOf("/")),t in c):!1}var c={"/contact/email":a.EMAIL_FIELD,"/password":a.PASSWORD_FIELD,"/contact/phone":a.PHONE_FIELD,"/contact/phone/countrycode":a.PHONE_FIELD,"/contact/phone/areacode":a.PHONE_FIELD,"/contact/phone/exchange":a.PHONE_FIELD,"/contact/phone/local":a.PHONE_FIELD,"/contact/phone/number":a.PHONE_FIELD,"/contact/phone/extension":a.PHONE_FIELD,"/nameperson/friendly":a.USERNAME_FIELD,"/financial/creditcard/number":a.PAYMENT_FIELD,"/financial/creditcard/number/part1":a.PAYMENT_FIELD,"/financial/creditcard/number/part2":a.PAYMENT_FIELD,"/financial/creditcard/number/part3":a.PAYMENT_FIELD,"/financial/creditcard/number/part4":a.PAYMENT_FIELD,"/financial/creditcard/type":a.PAYMENT_FIELD,"/financial/creditcard/issuedto":a.PAYMENT_FIELD,"/financial/creditcard/expiry":a.PAYMENT_FIELD,"/financial/creditcard/expiryyear":a.PAYMENT_FIELD,"/financial/creditcard/expirymonth":a.PAYMENT_FIELD,"/financial/creditcard/verification":a.PAYMENT_FIELD},l=["focus.mm","click.mm","blur.mm","change.mm"],d=n.BaseClass.extend({initialize:function(t){if(this.id=e.uniqueId(),this.el=t.el,this.mappedFields=t.mappedFields,this.messenger=t.messenger||this,this.contentManager=t.contentManager,this.strategy=t.strategy,!this.el)throw"Error: FormObserver initialized without a form element.";this.triggerFormPresent(),this.bindToFormEvents()},getType:function(){return this.formType||(this.formType=a.getFormType(this.el)),this.formType},getFields:function(){return this.fields||(this.fields=a.getFields(this.el,this.mappedFields)),this.fields},triggerFormPresent:function(){formType=this.getType(),formType==a.LOGIN_FORM?this.trigger("loginFormPresent",{formObserver:this,fields:this.getFields()}):formType==a.REGISTRATION_FORM?this.trigger("registrationFormPresent",{formObserver:this,fields:this.getFields()}):formType==a.CHECKOUT_FORM&&this.trigger("checkoutFormPresent",{formObserver:this,fields:this.getFields()})},bindToFormEvents:function(){var n=l.join(" "),i=this.getFields();e(i).each(function(i){var a=o(i);if(a){if(this.strategy&&this.strategy.fieldTypeDisabled(i.dataType))return;t(i.element).bind(n,e.bind(function(t){if(!this.contentManager||this.contentManager.userIntent){if("focus"==t.type){if(i.element.getAttribute("mmHasFocus"))return;i.element.setAttribute("mmHasFocus","yes")}else if("blur"==t.type)return i.element.removeAttribute("mmHasFocus"),i.element.removeAttribute("mmHasFocusRemoved"),void 0;if(!i.element.getAttribute("mmautofilling")&&!i.element.getAttribute("mmIgnoreBlur")){if("click"==t.type||"focus"==t.type){if(i.element.getAttribute("mmIgnoreClickFocus"))return;i.element.setAttribute("mmIgnoreClickFocus","yes"),r.setTimeout(function(){i.element.removeAttribute("mmIgnoreClickFocus")},750)}var n=s(i.dataType);if(n){var a=u(n,t.type);a&&r.setTimeout(e.bind(function(){this.trigger(a,{formObserver:this,field:i,type:t.type,keyCode:"keydown"===t.type?t.keyCode:0})},this),0)}}}},this))}},this)},unbindFormEvents:function(){var n=l.join(" "),i=this.getFields();e(i).each(function(e){t(e.element).unbind(n)})}}),u=function(e,t){var n;return e==a.EMAIL_FIELD?n="emailField":e==a.PHONE_FIELD?n="phoneField":e==a.PASSWORD_FIELD?n="passwordField":e==a.USERNAME_FIELD?n="usernameField":e==a.PAYMENT_FIELD&&(n="paymentField"),"change"==t?n+="Changed":"focus"==t?n+="Focused":"blur"==t?n+="Blurred":"click"==t?n+="Clicked":"keydown"==t&&(n+="Keydown"),n};return{FormObserver:d,LOGIN_FORM:a.LOGIN_FORM,REGISTRATION_FORM:a.REGISTRATION_FORM,CHECKOUT_FORM:a.CHECKOUT_FORM,OTHER_FORM:a.OTHER_FORM}}),ABINEMASKME.define("abine/formStrategy",["jquery","documentcloud/underscore","abine/core","abine/formObserver","abine/timer","abine/formAnalyzer","abine/views/emailHelperPanel","abine/views/passwordHelperPanel","abine/views/phoneHelperPanel","abine/views/loginHelperPanel","abine/views/paymentHelperPanel","models","abine/config","abine/url"],function(e,t,n,i,a,r,s,o,c,l,d,u,h,f){var p=!1,m={fieldTypeDisabled:function(e){return"/contact/email"==e?this.emailDisabledHere():"/contact/phone"==e?this.phoneDisabledHere():"/password"==e?this.passwordDisabledHere():e.match(/creditcard|state|city|postal|country/)?this.cardDisabledHere():!1},emailDisabledHere:function(){return this.contentManager.preferences&&!this.contentManager.preferences.getPref("suggestProtectedEmail")},passwordDisabledHere:function(){return this.contentManager.preferences&&!this.contentManager.preferences.getPref("suggestStrongPassword")},phoneDisabledHere:function(){return this.contentManager.preferences&&!this.contentManager.preferences.getPref("suggestProtectedPhone")},cardDisabledHere:function(){return this.contentManager.preferences&&!this.contentManager.preferences.getPref("suggestProtectedCard")},disableAutoComplete:function(e){e.hasAttribute("autocomplete")&&!e.hasAttribute("oldautocomplete")?e.setAttribute("oldautocomplete",e.getAttribute("autocomplete")):e.hasAttribute("autocomplete")||e.setAttribute("oldautocomplete","remove"),e.setAttribute("autocomplete","off")},enableAutoComplete:function(e){e.hasAttribute("oldautocomplete")&&("remove"==e.getAttribute("oldautocomplete")?e.removeAttribute("autocomplete"):e.setAttribute("autocomplete",e.getAttribute("oldautocomplete")),e.removeAttribute("oldautocomplete"))},cleanupPanel:function(t,n,i){try{t.remove()}catch(a){}e(n).unbind("mm.closepanel"),this.contentManager.removePanels(t.iframe),i&&this.enableAutoComplete(n),n.hasAttribute("mmHasFocusRemoved")?(n.removeAttribute("mmHasFocusRemoved"),n.setAttribute("mmHasFocus","yes")):n.removeAttribute("mmIgnoreBlur")},canShowMaskMeHelper:function(e,t){var n=e.field.element,i=e.type;if("click"==i&&"register"==t&&p){if(n.hasAttribute("mmHasFocus"))return this.contentManager.isPanelShown(e.field)?!0:(n.removeAttribute("mmHasFocus"),n.setAttribute("mmHasFocusRemoved","yes"),this.disableAutoComplete(n),!1);n.removeAttribute("mmHasFocusRemoved"),n.setAttribute("mmHasFocus","yes")}return!0},bindFieldChangeObserver:function(){this.formObserver=this.formObserver||new i.FormObserver({el:this.formEl,mappedFields:this.mappedFields,contentManager:this.contentManager,strategy:this}),this.formObserver.on("emailFieldChanged",this.onFieldChanged,this),this.formObserver.on("usernameFieldChanged",this.onFieldChanged,this),this.formObserver.on("passwordFieldChanged",this.onFieldChanged,this),this.formObserver.on("phoneFieldChanged",this.onFieldChanged,this),this.formObserver.on("paymentFieldChanged",this.onFieldChanged,this)},onFieldChanged:function(e){var t=e.field;t.origin="change";var n={name:t.name,origin:t.origin,dataType:t.dataType,value:t.value};this.contentManager.messenger.send("contentManager:formFieldChanged",{fieldData:n,formData:r.getFormData(this.formEl,this.contentManager.href)})}},g={bindFormObserver:function(){this.formObserver=this.formObserver||new i.FormObserver({el:this.formEl,mappedFields:this.mappedFields,contentManager:this.contentManager,strategy:this}),this.formObserver.on("emailFieldFocused",this.onEmailFieldActivity,this),this.formObserver.on("emailFieldClicked",this.onEmailFieldActivity,this),this.formObserver.on("passwordFieldFocused",this.onPasswordFieldActivity,this),this.formObserver.on("passwordFieldClicked",this.onPasswordFieldActivity,this),this.formObserver.on("phoneFieldFocused",this.onPhoneFieldActivity,this),this.formObserver.on("phoneFieldClicked",this.onPhoneFieldActivity,this),this.formObserver.on("paymentFieldFocused",this.onPaymentFieldActivity,this),this.formObserver.on("paymentFieldClicked",this.onPaymentFieldActivity,this)},cleanup:function(){this.formObserver&&(this.formObserver.unbindFormEvents(),this.formObserver.off())},processDynamicPanelForField:function(e){var t=this.contentManager.preferences.getPref("dynamicPanels"),n=t?JSON.parse(t):"",i=!1;if(n&&n.panels&&(i=this.contentManager.getPanelForDataType(n.panels,e))){parseInt(i.masked_emails)>0&&(i.dontShow=!0);var a=parseFloat(i.show_rate),r=Math.random();r>a&&(i.dontShow=!0)}return{json:n,dynamicPanel:i}},onEmailFieldActivity:function(n){if(!this.emailDisabledHere()&&this.canShowMaskMeHelper(n,"register")){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;if(!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("authToken")){var i=this.formObserver,a=n.field.element;if(this.disableAutoComplete(a),!a.hasAttribute("mmautofilling")&&!a.hasAttribute("mmclosedfield")){var r=this.processDynamicPanelForField("/contact/email");if(r.dynamicPanel&&r.dynamicPanel.dontShow&&!this.contentManager.preferences.isPrefTrue("hasRegistered"))return!1;this.contentManager.createPanel({style:{},secured:!0,field:n.field,ready:t.bind(function(o,c){var l=new s({field:n.field,formEl:this.formEl,contentManager:this.contentManager,fields:i.getFields(),dynamicPanel:r.dynamicPanel,dynamicPanelsJSON:r.json,hasRegistered:this.contentManager.preferences.isPrefTrue("hasRegistered"),domain:this.contentManager.domain,el:e("<div></div>",o).get(0)});l.iframe=c,e(a).one("mm.closepanel",t.bind(l.closePanel,l)),l.bind("remove",function(){this.cleanupPanel(l,a,p)},this),l.bind("render resize",function(){this.contentManager.autoResizePanels()},this),e("body",o).append(l.el)},this)})}}}},onPasswordFieldActivity:function(n){if(!this.passwordDisabledHere()&&this.canShowMaskMeHelper(n,"register")){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;if(!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("authToken")){var i=n.field.element;if("text"!=i.getAttribute("type")&&(!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("suggestStrongPassword"))){var a=this.formObserver;if(this.disableAutoComplete(i),!i.hasAttribute("mmautofilling")&&!i.hasAttribute("mmclosedfield")){var r=this.processDynamicPanelForField("/password");if(r.dynamicPanel&&r.dynamicPanel.dontShow&&!this.contentManager.preferences.isPrefTrue("hasRegistered"))return!1;this.contentManager.createPanel({style:{},secured:!0,field:n.field,ready:t.bind(function(s,c){var l=new o({field:n.field,formEl:this.formEl,contentManager:this.contentManager,fields:a.getFields(),dynamicPanel:r.dynamicPanel,dynamicPanelsJSON:r.json,hasRegistered:this.contentManager.preferences.isPrefTrue("hasRegistered"),domain:this.contentManager.domain,el:e("<div></div>",s).get(0)});l.iframe=c,e(i).one("mm.closepanel",t.bind(l.closePanel,l)),l.bind("remove",function(){this.cleanupPanel(l,i,p)},this),l.bind("render resize",function(){this.contentManager.autoResizePanels()},this),e("body",s).append(l.el)},this)})}}}}},onPhoneFieldActivity:function(n){if(!this.phoneDisabledHere()&&this.canShowMaskMeHelper(n,"register")){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;if(!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("authToken")){var i=this.formObserver,a=n.field.element;if(this.disableAutoComplete(a),!a.hasAttribute("mmautofilling")&&!a.hasAttribute("mmclosedfield")){var r=this.processDynamicPanelForField("/contact/phone");if(r.dynamicPanel&&r.dynamicPanel.dontShow&&!this.contentManager.preferences.isPrefTrue("entitledToPhone"))return!1;this.contentManager.createPanel({style:{},secured:!0,field:n.field,ready:t.bind(function(s,o){var l=new c({field:n.field,formEl:this.formEl,contentManager:this.contentManager,dynamicPanel:r.dynamicPanel,dynamicPanelsJSON:r.json,entitledToPhone:this.contentManager.preferences.isPrefTrue("entitledToPhone"),hasRegistered:this.contentManager.preferences.isPrefTrue("hasRegistered"),fields:i.getFields(),domain:this.contentManager.domain,el:e("<div></div>",s).get(0)});l.iframe=o,e(a).one("mm.closepanel",t.bind(l.closePanel,l)),l.bind("remove",function(){this.cleanupPanel(l,a,p)},this),l.bind("render resize",function(){this.contentManager.autoResizePanels()},this),e("body",s).append(l.el)},this)})}}}},onPaymentFieldActivity:function(n){if("select"!=n.field.fieldType&&!this.cardDisabledHere()&&this.canShowMaskMeHelper(n,"register")){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;if(this.contentManager.preferences.getPref("suggestProtectedCard")&&(!this.contentManager.preferences.getPref("hasRegistered")||this.contentManager.preferences.getPref("authToken"))){var i=this.formObserver,a=n.field.element;if(this.disableAutoComplete(a),!n.field.element.hasAttribute("mmautofilling")&&!n.field.element.hasAttribute("mmclosedfield")){var r=this.processDynamicPanelForField("/creditcard");if(r.dynamicPanel&&r.dynamicPanel.dontShow&&!this.contentManager.preferences.isPrefTrue("hasEnabledPayments"))return!1;this.contentManager.createPanel({style:{},secured:!0,panelWidth:400,field:n.field,ready:t.bind(function(s,o){var c=new d({field:n.field,formEl:this.formEl,contentManager:this.contentManager,authToken:this.contentManager.preferences.getPref("authToken"),beginnerMode:this.contentManager.preferences.getPref("beginnerMode"),hasRegistered:this.contentManager.preferences.isPrefTrue("hasRegistered"),entitledToPayments:this.contentManager.preferences.isPrefTrue("entitledToPayments"),hasEnabledPayments:this.contentManager.preferences.isPrefTrue("hasEnabledPayments"),dynamicPanel:r.dynamicPanel,dynamicPanelsJSON:r.json,fields:i.getFields(),domain:this.contentManager.domain,el:e("<div></div>",s).get(0)});c.iframe=o,e(a).one("mm.closepanel",t.bind(c.closePanel,c)),c.bind("remove",function(){this.cleanupPanel(c,a,p)},this),c.bind("render resize",function(){this.contentManager.autoResizePanels()},this),this.contentManager.notificationViews&&t.each(this.contentManager.notificationViews,function(e){e.style.display="block"}),e("body",s).append(c.el)},this)})}}}}},y=n.BaseClass.extend({initialize:function(e){if(!e.el)throw"RegistrationFormHelper expects a form element";this.formEl=e.el,this.contentManager=e.contentManager,this.preferences=e.preferences,this.mappedFields=e.mappedFields,this.bindFormObserver(),this.bindFieldChangeObserver()},bindFieldChangeObserver:function(){},bindFormObserver:function(){}});t.extend(y.prototype,g,m);var b=n.BaseClass.extend({initialize:function(e){if(!e.el)throw"ChangePasswordHelper expects a form element";this.formEl=e.el,this.contentManager=e.contentManager,this.preferences=e.preferences,this.bindFormObserver(),this.bindFieldChangeObserver(),this.tryToAutoFillOldPassword()},bindFieldChangeObserver:function(){},bindFormObserver:function(){},tryToAutoFillOldPassword:function(){if(this.contentManager.domain){var n=this.formObserver.getFields(),i=new u.Site({domain:this.contentManager.domain});i.loadAccounts(!1,t.bind(function(a){if(!a&&i.accounts&&i.accounts.length>0){var r=t.filter(n,function(e){return e.dataType&&"/passwordold"==e.dataType?!0:!1}),s=i.accounts.at(0),o=s.accountFields.find(function(e){return e.has("dataType")&&"/password"==e.get("dataType")?!0:!1});t.each(r,function(t){o&&e(t.element).focus().val(o.get("value")).blur()})}},this))}}});t.extend(b.prototype,g,m);var v=n.BaseClass.extend({initialize:function(e){if(!e.el)throw"LoginHelper expects a form element";this.formEl=e.el,this.contentManager=e.contentManager,this.preferences=e.preferences,this.mappedFields=e.mappedFields,this.site=e.site,this.bindFieldChangeObserver(),this.formObserver.on("passwordFieldFocused",this.onPasswordFieldActivity,this),this.formObserver.on("passwordFieldBlurred",this.onPasswordFieldActivity,this),this.contentManager.preferences.getPref("helpMeLogin")&&this.tryToAutoFillLogins()},cleanup:function(){this.formObserver&&(this.formObserver.unbindFormEvents(),this.formObserver.off())},bindFieldChangeObserver:function(){},onPasswordFieldActivity:function(){this.autofilled&&this.autofilled--},onEmailFieldActivity:function(n){if(this.autofilled)return this.autofilled--,void 0;if(!this.emailDisabledHere()&&this.canShowMaskMeHelper(n,"login")){if(this.contentManager.isPanelShown(n.field))return this.contentManager.closeCurrentPanel(),void 0;var i=this.formObserver,a=n.field.element;this.disableAutoComplete(a),a.hasAttribute("mmautofilling")||a.hasAttribute("mmclosedfield")||this.contentManager.createPanel({style:{},field:n.field,ready:t.bind(function(s,o){var c=new l({field:n.field,formEl:this.formEl,protocol:r.getProtocol(this.formEl,this.contentManager.href),page_domain:r.getPageDomain(this.contentManager.href),form_domain:r.getFormDomain(this.formEl,this.contentManager.href),fields:i.getFields(),contentManager:this.contentManager,domain:this.contentManager.domain,el:e("<div></div>",s).get(0)});c.iframe=o,e(a).one("mm.closepanel",t.bind(c.closePanel,c)),c.bind("remove",function(){this.cleanupPanel(c,a,p)},this),c.bind("render resize",function(){this.contentManager.autoResizePanels()},this),e("body",s).append(c.el)},this)})}},tryToAutoFillLogins:function(){var n=this.formObserver.getFields();if(this.contentManager.domain&&!this.contentManager.isLocked()){var i=this.site;if(i.accounts&&i.accounts.length>0){if(!this.contentManager.preferences.getPref("helpMeLogin")){var s=[];i.accounts.forEach(function(e){"login"==e.get("type")&&s.push(e)}),i.accounts.remove(s)}var o=t.find(i.accounts.models,function(e){return e.getLoginForAccount()?!0:void 0});o&&(this.contentManager.userIntent&&(this.autofilled=2),this.formObserver.on("emailFieldFocused",this.onEmailFieldActivity,this),this.formObserver.on("emailFieldClicked",this.onEmailFieldActivity,this),this.formObserver.on("usernameFieldClicked",this.onEmailFieldActivity,this),this.formObserver.on("usernameFieldFocused",this.onEmailFieldActivity,this),t.each(n,t.bind(function(e){e.dataType&&e.dataType.match(/email|nameperson/)&&this.disableAutoComplete(e.element)},this)));var c={};t.each(n,t.bind(function(e){e.dataType&&(c[e.dataType]=e)},this));var l=null,d=r.getProtocol(this.formEl,this.contentManager.href),u=r.getFormDomain(this.formEl,this.contentManager.href),h=r.getPageDomain(this.contentManager.href),p=u==h||f.getTLD(u)==f.getTLD(h)||""==u;if(i.accounts.forEach(t.bind(function(e){if(!l){if(e.get("protocol")&&""!=e.get("protocol")){if("https"==e.get("protocol")&&"https"!=d||e.get("form_domain")!=u||f.getTLD(e.get("page_domain"))!=f.getTLD(h))return!1}else if(!p||-1==this.contentManager.document.location.protocol.indexOf("https")||"https"!=d)return!1;l=e}},this)),l){var m={};l.accountFields.each(function(e){e.has("dataType")&&(m[e.get("dataType")]=e.get("value"))}),t.each(t.keys(c),t.bind(function(n){var i=c[n].element;i.setAttribute("mmautofilling","now"),n in m?"/password"===n&&"text"===i.type?(e(i).focus(),a.setTimeout(t.bind(function(){e("[type='password']",this.formEl).val(m[n]).blur()},this),100)):i.value=m[n]:("/contact/email"==n&&"/nameperson/friendly"in m&&(i.value=m["/nameperson/friendly"]),"/nameperson/friendly"==n&&"/contact/email"in m&&(i.value=m["/contact/email"])),this.contentManager.triggerKeyboardEvent("keydown",i),this.contentManager.triggerKeyboardEvent("keyup",i),this.contentManager.triggerKeyboardEvent("keypress",i),i.removeAttribute("mmautofilling")},this))}}}}});t.extend(v.prototype,m);var E=n.BaseClass.extend({initialize:function(e){if(!e.el)throw"OtherHelper expects a form element";this.formEl=e.el,this.contentManager=e.contentManager,this.preferences=e.preferences,this.mappedFields=e.mappedFields,this.bindFieldChangeObserver(),this.bindFormObserver()},bindFormObserver:function(){},bindFieldChangeObserver:function(){}});t.extend(E.prototype,g,m);var A=n.BaseClass.extend({initialize:function(e){if(!e.el)throw"CheckoutHelper expects a form element";this.formEl=e.el,this.contentManager=e.contentManager,this.preferences=e.preferences,this.mappedFields=e.mappedFields,this.bindFieldChangeObserver(),this.bindFormObserver()},bindFormObserver:function(){},bindFieldChangeObserver:function(){}});return t.extend(A.prototype,g,m),{RegistrationHelper:y,LoginHelper:v,OtherHelper:E,CheckoutHelper:A,ChangePasswordHelper:b}}),ABINEMASKME.define("abine/licenseServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core","abine/responseCodes"],function(e,t,n,i,a){var r=n.protocol+n.licenseServerHost,s=r+"/api/v2/reset_password_email",o=r+"/api/v2/users",c=r+"/api/v2/sessions",l=r+"/api/v2/touches",d=r+"/api/v2/activated_cards",u=r+"/api/v2/completed_postinstall",h=r+"/api/v2/uninstall",f=r+"/api/v2/billing_info",p=r+"/api/v2/feedback_email",m="/api/v2/send_unlock_email",g=r+"/api/v2/referral",y=r+"/api/v2/panel_data",b=a.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},resendUnlockEmail:function(e,t){this.server.makeRequest({server:"license",action:"resendUnlockEmail",defaults:{},required:["email"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:m,type:"POST"})},sendPanelActivity:function(e,t){this.server.makeRequest({server:"license",action:"sendPanelActivity",defaults:{},required:["panel_data"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:y,type:"POST"})},register:function(e,t){this.server.makeRequest({server:"license",action:"register",defaults:{},required:["user","application"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"POST"})},signIn:function(e,t){this.server.makeRequest({server:"license",action:"signIn",defaults:{},required:["user_login","application"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:c,type:"POST"})},refreshEntitlements:function(e,t){this.server.makeRequest({server:"license",action:"refreshEntitlements",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"GET"})},referralCode:function(e,t){this.server.makeRequest({server:"license",action:"referralCode",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:g,type:"GET"})},changePassword:function(e,t){this.server.makeRequest({server:"license",action:"changePassword",defaults:{},required:["user"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"PUT"})},changeEmail:function(e,t){this.server.makeRequest({server:"license",action:"changeEmail",defaults:{},required:["user"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"PUT"})},changeEmailPassword:function(e,t){this.server.makeRequest({server:"license",action:"changeEmailPassword",defaults:{},required:["user"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"PUT"})},deleteUser:function(e,t){this.server.makeRequest({server:"license",action:"deleteUser",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"DELETE"})},makeDailyTouch:function(e,t){this.server.makeRequest({server:"license",action:"makeDailyTouch",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:l,type:"POST"})},sendResetPasswordEmail:function(e,t){this.server.makeRequest({server:"license",action:"sendResetPasswordEmail",defaults:{},required:["email"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"POST"})},sendFeedbackEmail:function(e,t){this.server.makeRequest({server:"license",action:"sendFeedbackEmail",defaults:{browserUserAgent:ABINEMASKME.userAgent},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:p,type:"POST"})},billingInfo:function(e,t){this.server.makeRequest({server:"license",action:"billingInfo",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:f,type:"GET"})},saveActivatedCardsDate:function(e,t){this.server.makeRequest({server:"license",action:"saveActivatedCardsDate",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:d,type:"PUT"})},savePostInstallCompletedDate:function(e,t){this.server.makeRequest({server:"license",action:"savePostInstallCompletedDate",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:u,type:"PUT"})},uninstall:function(e,t){this.server.makeRequest({server:"license",action:"uninstall",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:h,type:"PUT"})}});return b}),ABINEMASKME.define("abine/lruCache",[],function(){var e=function(e){var t={},n=e,e=0,i=null,a=null;this.add=function(r,s){var o={id:r,data:s,previous:null,next:i};if(t[r]=o,i&&(i.previous=o),i=o,e===n){var c=a;a=a.previous,a.next=null,delete t[c.id],delete c}else 0===e&&(a=o),e++},this.fetch=function(n){var r=t[n];if(r){if(e>1){var s=r.previous,o=r.next;a==r?a=s:i!=r&&(s.next=o,o.previous=s),r.previous=null,r.next=i,i.previous=r,i=r}return r.data}return null}};return e}),ABINEMASKME.define("abine/mappingServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core"],function(e,t,n,i,a){var r=n.protocol+n.mappingServerHost,s=r+"/api/v2/mappings/manifest",o=r+"/api/v2/mappings/latest",c=r+"/api/v2/mappings/masked",l=r+"/api/v2/panels",d=a.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},sendPanelActivity:function(e,t){this.server.makeRequest({server:"mapping",action:"getMappingManifest",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"POST"})},sendFormData:function(e,t){this.server.makeRequest({server:"mapping",action:"sendFormData",defaults:{},required:["updates"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:c,type:"POST"})},getMappingManifest:function(e,t){this.server.makeRequest({server:"mapping",action:"getMappingManifest",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"POST"})},getFormMappings:function(e,t){this.server.makeRequest({server:"mapping",action:"getFormMappings",defaults:{},required:["signatures"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"POST"})},getPanels:function(e,t){this.server.makeRequest({server:"mapping",action:"getPanels",defaults:{},required:["browser","tag","user_state"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:l,type:"GET"})}});return d}),ABINEMASKME.define("abine/pageEvents",["abine/core","abine/securityManager","abine/config","storage","abine/timer","persistence","abine/modules/license","abine/window"],function(e,t,n,i,a,r,s,o){var c=null,l=null,d=function(){};l="development"==n.environment?/.*/i:/^(.+\.)?abine\.com$/i;var u=e.BaseClass.extend({initialize:function(){},processAction:function(e,t){if(t=t||d,e.host.match(l))switch(e.action){case"reloadAdminPage":this.reloadAdminPage(e.params,t);break;case"enableEntitlements":this.enableEntitlements(e.params,t);break;case"openAdminPage":this.openAdminPage(e.params,t);break;case"resetPasswordSuccess":this.resetPasswordSuccess(e.params,t);break;case"updateDisposable":this.updateDisposable(e.params,t);break;case"refreshLastFourCardDigits":this.refreshLastFourCardDigits(e.params,t);break;case"getVersion":t({version:ABINEMASKME.config.version,tag:ABINEMASKME.config.tags[0]});break;default:t()}else t()},reloadAdminPage:function(e,t){o.createTab({localUrl:"pages/index.html"},t)},enableEntitlements:function(e,t){s.enableEntitlements(e,t)},openAdminPage:function(e,t){var n=e&&e.page?"#"+e.page:"";o.createTab({localUrl:"pages/index.html"+n},t)},resetPasswordSuccess:function(e,n){i.purgeDatabase(function(){i.Preference.setDefaults(function(){i.Preference.batchCreateOrModify([{key:"resetPasswordInProgress",value:"true"},{key:"autoOpenEditUser",value:"false"}],function(){t.on("background:securityManager:initialized",function(){a.setTimeout(function(){o.createTab({localUrl:"pages/index.html#userLogin"},n)},4e3)}),t.load(c,!0)})})})},updateDisposable:function(e,t){i.DisposableEmail.indexFromServer(null,function(){t()})},refreshLastFourCardDigits:function(e,t){s.refreshLastFourCardDigits(e,t)}});return new u({})}),ABINEMASKME.define("abine/views/panelBase",["documentcloud/underscore","jquery","duckbone/core","abine/timer","models","abine/window","abine/contentMessenger","abine/formAnalyzer","abine/timer","abine/config","abine/proxies"],function(e,t,n,i,a,r,s,o,c,l,d){var u=300,h=13,f=38,p=40,m=8,g=46,y={"short":"jan,feb,mar,apr,may,jun,jul,aug,sep,oct,nov,dec".split(","),"long":"january,february,march,april,may,june,july,august,september,october,november,december".split(",")},b=n.View.extend({render:function(){return this.model?(this.renderTemplate(),c.setTimeout(e.bind(function(){this.trigger("render")},this),50),this):this},autoResize:function(){c.setTimeout(e.bind(function(){this.trigger("resize")},this),50)},triggerRender:function(){c.setTimeout(e.bind(function(){this.trigger("render")},this),50)},ignoreBlur:function(e){return"undefined"==typeof e?this.field.element.getAttribute("mmIgnoreBlur"):(e===!1?this.field.element.removeAttribute("mmIgnoreBlur"):this.field.element.setAttribute("mmIgnoreBlur","true"),void 0)},bindHeaderClose:function(){t(this.el).bind("mousedown",e.bind(function(t){this.ignoreBlur(!0);var n=t.target.className.split(" ");e.contains(n,"close-header")?this.closeHeader():("close-icon"==t.target.className||"close-dd"==t.target.className)&&this.closePanel()},this))},bindFieldBlur:function(){t(this.field.element).unbind("blur.mmpanel").bind("blur.mmpanel",e.bind(function(){this.ignoreBlur()?i.setTimeout(e.bind(function(){t(this.field.element).focus(),this.ignoreBlur(!1)},this),1):this.closePanel()},this))},bindKeyDown:function(){t(this.field.element).unbind("keydown.mmpanel").bind("keydown.mmpanel",e.bind(function(e){return e.keyCode===h?(e.preventDefault(),e.stopPropagation(),!1):void 0}))},bindKeyUp:function(){t(this.field.element).unbind("keyup.mmpanel").bind("keyup.mmpanel",e.bind(function(e){if(e.keyCode===f)this.highlightOption(this.selectedField||0===this.selectedField?this.selectedField-1:-1);else if(e.keyCode===p)this.highlightOption(this.selectedField||0===this.selectedField?this.selectedField+1:0);else{if(e.keyCode===h&&(this.selectedField||0===this.selectedField))return e.selectedField=this.selectedField,this.trigger("enter"+this.selectedField,e,this.selectedField),!1;String.fromCharCode(e.keyCode).match(/\w/)&&e.currentTarget.value.length>=5&&!this.doNotCloseOnTyping&&(this.closePanel(),delete this.selectedField)}},this))},cleanupPanel:function(){},bindPanelTextInput:function(n){t(this.field.element).add(n).unbind("blur.mmpanel").bind("blur.mmpanel",e.bind(function(i){this.ignoreBlur()?(this.ignoreBlur(!1),i.target.element!==this.field.element&&c.setTimeout(e.bind(function(){t(n).focus()},this),1)):this.closePanel()},this))},bindBaseEvents:function(){this.bindHeaderClose(),this.bindFieldBlur(),this.bindKeyDown(),this.bindKeyUp()},highlightOption:function(n){var i=e(t(this.el).find(".mmKeyOption")).filter(function(e){return t(e).hasClass("mmKeyOption")&&"none"!==t(e).css("display")&&t(e).is("a")&&!t(e).hasClass("disabled")});n=(n+i.length)%i.length,(this.selectedField||0===this.selectedField)&&t(i[this.selectedField].children[0]).removeClass("hover"),t(i[n].children[0]).addClass("hover"),this.selectedField=n},applyFadingStyle:function(){var e=u/1e3+"s",t="opacity ease "+e+", margin-top ease "+e;
this.el.style.transition=this.el.style.WebkitTransition=this.el.style.MozTransition=this.el.style.OTransition=this.el.style.MsTransition=t},fadeIn:function(){this.el.style.opacity="0.0",this.el.style.marginTop="50px",i.setTimeout(e.bind(function(){this.el.style.opacity="1.0",this.el.style.marginTop="0px"},this),100)},fadeOut:function(){try{this.el.style.opacity="1.0",this.el.style.marginTop="0px"}catch(t){}i.setTimeout(e.bind(function(){try{this.el.style.opacity="0.0",this.el.style.marginTop="50px"}catch(e){}},this),100);try{delete this.contentManager._currentPanelField}catch(t){}i.setTimeout(e.bind(function(){this.trigger("remove")},this),100+u)},triggerPanelFillEvent:function(e){this.messenger=this.messenger||new s.ContentMessenger,e.field.origin=e.origin;var n={disposableGUID:e.field.disposableGUID,name:e.field.name,origin:e.field.origin,dataType:e.field.dataType,value:e.field.value};t(this.options.formEl).attr("maskMeFilled","yes"),this.messenger.send("panel:fill",{fieldData:n,formData:o.getFormData(this.options.formEl,e.domain)})},fillPhoneFieldsWith:function(e,t,n){var i,a,r,s,o;return 1===parseInt(t)?(a=n.substr(0,3),s=n.substr(3,3),o=n.substr(6,4),i="("+a+") "+s+"-"+o,r=s+"-"+o):(i="+"+t+n,r="+"+t+n),this.fillFieldsByType(e,"/contact/phone",i),this.fillFieldsByType(e,"/contact/phone/number",r),this.fillFieldsByType(e,"/contact/phone/countrycode",t),this.fillFieldsByType(e,"/contact/phone/areacode",a),this.fillFieldsByType(e,"/contact/phone/exchange",s),this.fillFieldsByType(e,"/contact/phone/local",o),i},isVisible:function(e){return t(e).is(":visible")&&"hidden"!=t(e).css("visibility")},fillPaymentFieldsWith:function(e,t,n,i,a,r,s){function o(t,n){for(var i=0;n.length>i&&!c.fillFieldsByType(e,t,n[i]);i++);}var c=this,l=[n];-1!=n.toLowerCase().indexOf("master")&&(l=["master","master card","mastercard"]),o("/financial/creditcard/type",l),this.fillFieldsByType(e,"/financial/creditcard/number",t),this.fillFieldsByType(e,"/financial/creditcard/number/part1",t.substr(0,4)),this.fillFieldsByType(e,"/financial/creditcard/number/part2",t.substr(4,4)),this.fillFieldsByType(e,"/financial/creditcard/number/part3",t.substr(8,4)),this.fillFieldsByType(e,"/financial/creditcard/number/part4",t.substr(12,4)),this.fillFieldsByType(e,"/financial/creditcard/issuedto",i),this.fillFieldsByType(e,"/financial/creditcard/verification",s),this.fillFieldsByType(e,"/financial/creditcard/expiry",a+"/"+r);var d=[a];return d.push(parseInt(a)),d.push(y.short[parseInt(a)-1]),d.push(y.long[parseInt(a)-1]),o("/financial/creditcard/expirymonth",d),o("/financial/creditcard/expiryyear",[r,parseInt(r)%100]),t},fillFieldsByType:function(n,a,r,s){var o=!1,c=!1,l=this,d=e(n).filter(function(e){return e.dataType==a&&l.isVisible(e.element)});e(d).each(e.bind(function(e){t(e.element).val(""),e.element.setAttribute("mmautofilling","now")},this));var l=this;return e(d).each(e.bind(function(d){function u(e){if(l.options.contentManager&&l.options.contentManager.triggerKeyboardEvent&&(l.options.contentManager.triggerKeyboardEvent("keydown",t(e.element)[0]),l.options.contentManager.triggerKeyboardEvent("keyup",t(e.element)[0]),l.options.contentManager.triggerKeyboardEvent("keypress",t(e.element)[0])),c)try{t(e.element).change()}catch(n){}s&&(e.disposableGUID=s.disposableGUID,l.triggerPanelFillEvent({domain:s.domain,origin:s.origin,field:e}))}if("/password"==a&&"text"==d.element.type){try{t(d.element).focus()}catch(h){}var f=d.element.form;i.setTimeout(e.bind(function(){var i=t("[type='password']",f);if(i.length>0){var a=e(n).find(function(e){return e.element==i[0]});i.focus().val(r).css({color:"#0000aa","background-color":"#ffffee"}),u(a)}},this),100)}else{r+="";try{t(d.element).focus().val(r)}catch(h){t(d.element).val(r)}if(t(d.element).val()==r){if(o=!0,c="select"==d.fieldType,"select"==d.fieldType&&a.match(/month/i)){var p=d.element.selectedIndex,m=d.element.options[d.element.options.length-1].value;11==parseInt(m)&&(d.element.selectedIndex=p-1)}}else if(d.element.options){r=r.toLowerCase();for(var g=d.element.options,y=0;g.length>y;y++){var b=g[y].text.toLowerCase(),v=g[y].value;if(v&&v.toLowerCase()==r||b==r||-1!=b.indexOf(r)){g[y].selected=!0,c="select"==d.fieldType,o=!0;break}}}this.markFieldFilled(d),u(d)}},this)),e(d).each(e.bind(function(e){e.element.removeAttribute("mmautofilling")},this)),o},markFieldFilled:function(e){t(e.element).css({color:"#0000aa","background-color":"#ffffee"})},hidePanel:function(){this.trigger("hide")},closePanel:function(e){e&&e.preventDefault(),this.cleanupPanel(),this.field&&(t(this.field.element).unbind("blur.mmpanel"),this.ignoreBlur(!1),t(this.field.element).unbind("keydown.mmpanel"),t(this.field.element).unbind("keyup.mmpanel"),t(this.field.element).bind("keyup.mmpanel",function(e){e.keyCode!==m&&e.keyCode!==g||0!==e.currentTarget.value.length||e.target.click()})),this.fadeOut()},clickedInsideOfTarget:function(e,t){for(;t.parentNode&&t.id!=e;)t=t.parentNode;return t.id==e?!0:!1},performActions:function(t){this.messenger=this.messenger||new s.ContentMessenger,e.each(this.panelSectionActionMap[t.currentTarget.id],e.bind(function(n){(n.target_id&&""!=n.target_id&&this.clickedInsideOfTarget(n.target_id,t.target)||n.target_id&&""==n.target_id||!n.target_id)&&("open_registration_page"==n.name?this.getStarted(t,{type:this.options.dynamicPanel.field_type,action:n.name}):"open_page"==n.name?d.securityManager.openPage(n.extra,!1):"trigger_click"==n.name?this.messenger.send("update:panelActivity:click",{panelId:this.options.dynamicPanel.id}):"trigger_conversion"==n.name?this.messenger.send("update:panelActivity:conversion",{panelId:this.options.dynamicPanel.id}):"dismiss_panel"==n.name?this.closePanel():"change_show_rate"==n.name?(e.each(this.options.dynamicPanelsJSON.panels,e.bind(function(e){e.field_type==this.options.dynamicPanel.field_type&&(e.show_rate=n.extra)},this)),this.contentManager.preferences.setPref("dynamicPanels",JSON.stringify(this.options.dynamicPanelsJSON))):"no_action"==n.name||("open_plans_page"==n.name?this.openPlansPage(null,{type:this.options.dynamicPanel.field_type,action:n.name}):"open_activate_cards_page"==n.name&&this.openActivateCardsPage(null,{type:this.options.dynamicPanel.field_type,action:n.name})))},this))},setupDynamicPanel:function(){this.panelPositions=this.options.dynamicPanel.panel_positions,this.panelSections=[],this.panelSectionActionMap={},e.each(this.panelPositions,e.bind(function(t){var n=t.panel_section;n.has_action=t.panel_actions.length>0,this.panelSectionActionMap[n.id]=[],e.each(t.panel_actions,e.bind(function(e){this.panelSectionActionMap[n.id].push(e)},this)),this.panelSections.push(n)},this))},closeHeader:function(e){e&&e.preventDefault(),this.ignoreExplicitClose||t(this.field.element).attr("mmclosedfield",!0),this.closePanel(e)},getStarted:function(e,t){this.messenger=this.messenger||new s.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#userRegistration",panelData:t}),this.closePanel()},openSetupEmailPage:function(){this.messenger=this.messenger||new s.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#editUser/email"}),this.closePanel()},openActivateCardsPage:function(e,t){this.messenger=this.messenger||new s.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#payments",panelData:t}),this.closePanel()},openPlansPage:function(e,t){var n=this.contentManager.preferences.getPref("authToken");if(n&&""!=n&&ABINEMASKME.contentuser.shieldedEmails.length>0){var i=l.protocol+l.licenseServerHost+"/subscriptions/id_me?auth_token="+n+"&email="+ABINEMASKME.contentuser.shieldedEmails.at(0).get("email");d.securityManager.openPage(i,!1,t)}},openLoginPage:function(){this.messenger=this.messenger||new s.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#userLogin"}),this.closePanel()},getStartedWithPhone:function(e){e&&e.preventDefault();var t=function(){r.createTab({forceReload:!0,localUrl:"pages/index.html#userInfo"})};if(this.contentManager.preferences.isPrefTrue("entitledToPhone"))d.securityManager.openPage("editUser/phone",!0);else{var n=this.contentManager.preferences.getPref("authToken");if(n&&""!=n)if(ABINEMASKME.contentuser.shieldedEmails.length>0){var i=l.protocol+l.licenseServerHost+"/subscriptions/id_me?auth_token="+n+"&email="+ABINEMASKME.contentuser.shieldedEmails.at(0).get("email")+"&feature=phone";this.contentManager.preferences.hasPref("regEmail")&&this.contentManager.preferences.hasPref("regPassword")?i+="&notsetup=3":this.contentManager.preferences.hasPref("regEmail")?i+="&notsetup=1":this.contentManager.preferences.hasPref("regPassword")&&(i+="&notsetup=2"),d.securityManager.openPage(i,!1)}else t();else t()}this.closePanel(e)},getStartedWithPayments:function(e){e&&e.preventDefault();var t=function(){r.createTab({forceReload:!0,localUrl:"pages/index.html#userInfo"})};if(this.contentManager.preferences.isPrefTrue("entitledToPayments"))d.securityManager.openPage("payments",!0);else{var n=this.contentManager.preferences.getPref("authToken");if(n&&""!=n)if(ABINEMASKME.contentuser.shieldedEmails.length>0){var i=l.protocol+l.licenseServerHost+"/subscriptions/id_me?auth_token="+n+"&email="+ABINEMASKME.contentuser.shieldedEmails.at(0).get("email")+"&feature=cards";this.contentManager.preferences.hasPref("regEmail")&&this.contentManager.preferences.hasPref("regPassword")?i+="&notsetup=3":this.contentManager.preferences.hasPref("regEmail")?i+="&notsetup=1":this.contentManager.preferences.hasPref("regPassword")&&(i+="&notsetup=2"),d.securityManager.openPage(i,!1)}else t();else t()}this.closePanel(e)},setupPhone:function(e){this.messenger=this.messenger||new s.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#userInfo"}),this.closePanel(e)}});return b}),ABINEMASKME.define("abine/password",[],function(){var e="ABCDEFGHJKLMNOPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",t=10,n=1,i=2,a=4,r=8,s={generateRandomPassword:function(s,o,c){s=s||e,(!o||1>o)&&(o=t);var l="",d=s.length;c=c||n|i|r;var u="ABCDEFGHJKLMNOPQRSTUVWXYZ".charAt(Math.floor(26*Math.random()))+"ABCDEFGHJKLMNOPQRSTUVWXYZ".charAt(Math.floor(26*Math.random())),h="0123456789".charAt(Math.floor(10*Math.random()))+"0123456789".charAt(Math.floor(10*Math.random())),f="`~!@#$%^&*()_-+={}|[]\\:\";'<>?,/".charAt(Math.floor(32*Math.random()));c&n||(u=""),c&i||(h=""),c&a||(f=""),c&r&&(f=".");for(var p=Math.floor(Math.random()*(o-(u.length+f.length+h.length))),m=p+u.length+f.length+h.length-1,g=0;o>g;g++)if(p>g||g>m)l+=s.charAt(Math.floor(Math.random()*d));else{if(g!=p)continue;l+=u+f+h}return l},generateSpecialCharsPassword:function(){return this.generateRandomPassword(null,null,n|i|a)},generateNoSpecialCharsPassword:function(){return this.generateRandomPassword(null,null,n|i)},generateNoDigitsPassword:function(){return this.generateRandomPassword(null,null,n)}};return s}),ABINEMASKME.define("abine/passwordScore",["abine/intl"],function(e){var t=100,n=75,i=50,a=25,r={scoreComp8SpecialHelper:function(e){if(!e)return 0;var t=0;return e.length>2?t+=29:e.length>1?t+=25:e.length>0&&(t+=17),t},scoreComp8:function(e){var t=0,n=e.length;t+=4*n,t+=this.scoreComp8SpecialHelper(e.match(/[A-Z]/g)),t+=this.scoreComp8SpecialHelper(e.match(/[0-9]/g)),t+=this.scoreComp8SpecialHelper(e.match(/\W/g));var i=e.match(/[a-z]/g);return n>3&&!i&&(t-=17),t},scoreBasic16:function(e){var t=0,n=e.length;return t+=n>8?8*(n-8)+32:4*n},scorePassword:function(e){return Math.min(Math.max(this.scoreComp8(e),this.scoreBasic16(e))/2,100)},calculateScore:function(e){return this.scorePassword(e)},calculateStrengthForTitle:function(r){var s="",o="",c="";return r===t?(o="Excellent",c="green"):r>=n?(o="Strong",c="green"):r>=i?(o="Good",c="green"):r>=a?(o="Ok",c="gold"):(o="Weak",c="red"),s="<span style='color:"+c+";'>"+e.getText("mm_user_registration_password"+o)+"</span>"},calculateProgressForContent:function(e){var r="",s="";e===t?r="progress-striped active":e>=n&&(r="progress-striped"),s=e>=i?"bar-success":e>=a?"bar-warning":"bar-danger";var o="<div class='password_strength progress "+r+"'><div class='bar "+s+"' style='width: "+e+"%;'></div></div></div>";return o}};return r}),ABINEMASKME.define("abine/paymentHeuristics",["documentcloud/underscore","jquery"],function(e){function t(e,t,n,i){i=i||0,len=e.length;for(var a=i;len>a;a++)if(obj=e[a],obj&&obj[t]===n)return a;return null}var n={apply:function(e,t){var n=!1;for(var i in e)if(e[i].dataType&&0==e[i].dataType.indexOf("/financial")){n=!0;break}n&&(this.fixMissingPaymentFields(e,t),this.fixOrphanedPaymentFields(e,t),this.fixDuplicatePaymentFields(e,t))},fixMissingPaymentFields:function(n,i){var a="/financial/creditcard/number",r=e(n).filter(function(e){return e.dataType&&e.dataType===a});if(0==r.length)for(var s=t(i,"dataType","/financial/creditcard/expirymonth",0),o=s-1;o>=0;o--)if("undefined"!=typeof i[o]&&!i[o].dataType){var c=i[o].name+":"+i[o].id;if(i[o].element.getAttribute("maxlength")>=16||c&&c.match(/num|card/i)&&!c.match(/cvs|cv|code|sec/i)){i[o].dataType="/financial/creditcard/number",r.push(i[o]);break}}if(0==r.length){for(var l=-1,d=0,o=0;i.length>o;o++)if("undefined"!=typeof i[o]&&!i[o].dataType)if(4==i[o].element.getAttribute("maxlength")){if(-1==l&&(l=o),d++,4==d)break}else 4>d&&(l=-1,d=0);if(4==d){for(var o=l;l+4>o;o++)i[o].dataType="/financial/creditcard/number/part"+(o-l+1),r.push(i[o]);a="/financial/creditcard/number/part4"}}if(r.length>0){var u=e(n).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/expiry")});if(2>u.length){var h=e(n).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/expirymonth")});if(0==h.length)for(var f=t(i,"dataType",a,0),o=f+1,p=0;i.length>o&&4>p;o++)if("select"==i[o].fieldType&&p++,i[o].element&&i[o].element.innerHTML.match(/jan|feb|dec|\b12\b|\b11\b/i)){i[o].dataType="/financial/creditcard/expirymonth",h.push(i[o]);break}var m=e(n).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/expiryyear")});if(0==m.length)for(var f=t(i,"dataType",a,0),o=f+1,p=0;i.length>o&&5>p;o++)if("select"==i[o].fieldType&&p++,i[o].element&&i[o].element.innerHTML.match(/20[0-9]{2}|year/i)){i[o].dataType="/financial/creditcard/expiryyear",m.push(i[o]);break}}var g=e(n).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/verification")});if(0==g.length)for(var f=t(i,"dataType",a,0),o=f+1;i.length>o&&f+5>o;o++)if(i[o].name&&i[o].name.match(/cvv|cid|cvs/i)||i[o].id&&i[o].id.match(/cvv|cid|cvs/i)){i[o].dataType="/financial/creditcard/verification";break}}},fixDuplicatePaymentFields:function(e,n){var i=!1,a=0,r={};for(var s in e){var o=e[s].dataType;if(o&&0==o.indexOf("/financial")){if(o in r){i=!0;break}r[o]=1}}for(;i;){i=!1;var c=t(n,"dataType","/financial/creditcard/number",a);if(null==c)break;var l=t(n,"dataType","/financial/creditcard/verification",c+1),d=t(n,"dataType","/financial/creditcard/expirymonth",c+1),u=t(n,"dataType","/financial/creditcard/expiryyear",c+1),h=t(n,"dataType","/financial/creditcard/number",c+1);if(null!==h){if(i=!0,!(h>u||h>d)){for(var s=1;h>s;s++)n[s].dataType&&0==n[s].dataType.indexOf("/financial")&&-1==n[s].dataType.indexOf("/issuedto")&&-1==n[s].dataType.indexOf("/type")&&(n[s].dataType=null);a=c;continue}n[h].dataType=null}var f=t(n,"dataType","/financial/creditcard/verification",l+1);null!==f&&(i=!0,n[f].dataType=null);var p=t(n,"dataType","/financial/creditcard/expirymonth",d+1);null!==p&&(i=!0,n[p].dataType=null);var m=t(n,"dataType","/financial/creditcard/expiryyear",u+1);null!==m&&(i=!0,n[m].dataType=null)}},fixOrphanedPaymentFields:function(t){var n=e(t).filter(function(e){return e.dataType&&"/financial/creditcard/verification"===e.dataType}),i=e(t).filter(function(e){return e.dataType&&"/financial/creditcard/type"===e.dataType}),a=e(t).filter(function(e){return e.dataType&&("/financial/creditcard/number"===e.dataType||"/financial/creditcard/number/part4"===e.dataType)}),r=e(t).filter(function(e){return e.dataType&&"/financial/creditcard/issuedto"===e.dataType}),s=e(t).filter(function(e){return e.dataType&&0==e.dataType.indexOf("/financial/creditcard/expiry")});n.length>0&&0==a.length&&e(n).each(function(e){e.dataType=null}),r.length>0&&0==a.length&&e(r).each(function(e){e.dataType=null}),i.length>0&&0==a.length&&e(i).each(function(e){e.dataType=null}),s.length>0&&0==a.length&&e(s).each(function(e){e.dataType=null}),a.length>0&&0==s.length&&e(a).each(function(e){e.dataType=null})}};return n}),ABINEMASKME.define("abine/paymentsServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core"],function(e,t,n,i,a){var r=n.protocol+n.paymentsServerHost,s=r+"/api/v2/payment",o=r+"/api/v2/cards",c=r+"/api/v2/cards/guids",l=r+"/api/v2/cardStates",d=r+"/api/v2/authorizations",u=r+"/api/v2/resendGiftCardEmail",h=r+"/api/v2/smartTransactions",f=a.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},getAuthorizations:function(e,t){this.server.makeRequest({server:"payments",action:"getAuthorizations",defaults:{card_id:""},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:d,type:"GET"})},getSmartTransactions:function(e,t){this.server.makeRequest({server:"payments",action:"getSmartTransactions",defaults:{card_id:"",card_number:""},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:h,type:"GET"})},getCardStatesForGuids:function(e,t){this.server.makeRequest({server:"payments",action:"getCardStatesForGuids",defaults:{guids:""},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:l,type:"GET"})},getCardsForGuids:function(e,t){this.server.makeRequest({server:"payments",action:"getCardsForGuids",defaults:{guids:""},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:c,type:"GET"})},getCardsForClient:function(e,t){this.server.makeRequest({server:"payments",action:"getCardsForClient",defaults:{},required:[],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"GET"})},deactivateCard:function(e,t){this.server.makeRequest({server:"payments",action:"deactivateCard",defaults:{},required:["request_id","card_id"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"PUT"})},resendGiftCardEmail:function(e,t){this.server.makeRequest({server:"payments",action:"resendGiftCardEmail",defaults:{},required:["card_guid","recipient_email","sender_name"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:u,type:"GET"})},createCard:function(e,t){this.server.makeRequest({server:"payments",action:"createCard",defaults:{},required:["request_id","amount","domain"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"POST"})}});return f}),ABINEMASKME.define("abine/phoneHeuristics",["documentcloud/underscore","jquery"],function(e){function t(e,t,n,i){i=i||0,len=e.length;for(var a=i;len>a;a++)if(obj=e[a],obj&&obj[t]===n)return obj;return null}var n={apply:function(e,t){var n=!1;for(var i in e)if(e[i].dataType&&e[i].dataType.indexOf("contact/phone")>0){n=!0;break}this.fixUnknownPhoneFieldsWithMaxLengths(e,t),this.fixUnknownPhoneFieldsWithSizes(e,t),n&&(this.fixUnknownPhoneFieldsWithAreaCode(e,t),this.fixThreePhoneFieldsInnaRow(e,t),this.fixOrphanedPaymentFields(e,t),this.normalizeAllPhoneFields(e))},fixUnknownPhoneFieldsWithAreaCode:function(e,n,i){var i=i||1,a=t(n,"dataType","/contact/phone/areacode",i);if(!a)return e;var r=n[a.position+1]?n[a.position+1].key:null,s=n[a.position+2]?n[a.position+2].key:null;return r&&s?(null==e[r].dataType&&null==e[s].dataType&&(e[r].dataType="/contact/phone/exchange",e[s].dataType="/contact/phone/local"),this.fixUnknownPhoneFieldsWithAreaCode(e,n,i+3)):e},fixUnknownPhoneFieldsWithMaxLengths:function(e,n,i){i=i||1;var a=t(n,"maxlength",3,i);if(!a)return e;var r=n[a.position+1]?n[a.position+1].key:null,s=n[a.position+2]?n[a.position+2].key:null;return r&&s?(3===e[r].maxlength&&4===e[s].maxlength&&(e[a.key].dataType="/contact/phone/areacode",e[r].dataType="/contact/phone/exchange",e[s].dataType="/contact/phone/local"),this.fixUnknownPhoneFieldsWithMaxLengths(e,n,i+3)):e},fixUnknownPhoneFieldsWithSizes:function(e,n,i){i=i||1;var a=t(n,"size",3,i);if(!a)return e;var r=n[a.position+1]?n[a.position+1].key:null,s=n[a.position+2]?n[a.position+2].key:null;return r&&s?(3===e[r].size&&4===e[s].size&&(e[a.key].dataType="/contact/phone/areacode",e[r].dataType="/contact/phone/exchange",e[s].dataType="/contact/phone/local"),this.fixUnknownPhoneFieldsWithSizes(e,n,i+3)):e},fixThreePhoneFieldsInnaRow:function(t,n){var i=e(n).filter(function(e){return e?e.dataType&&e.dataType.indexOf("contact/phone")>0:!1});return e(i).each(function(e){if(!(e.dataType&&"/contact/phone/exchange"===e.dataType||e.dataType&&"/contact/phone/local"===e.dataType)){var i=n[e.position+1]?n[e.position+1].key:null,a=n[e.position+2]?n[e.position+2].key:null;if(i&&a){var r=t[i],s=t[a];r.dataType===e.dataType&&s.dataType===e.dataType&&null==r.label&&null==s.label&&(t[e.key].dataType="/contact/phone/areacode",t[i].dataType="/contact/phone/exchange",t[a].dataType="/contact/phone/local")}}}),t},normalizeAllPhoneFields:function(t){var n,i=["/contact/phone/mobile","/contact/phone/home","/contact/phone/work"];for(var a in t)n=t[a],e(i).include(n.dataType)&&(n.dataType="/contact/phone")},fixOrphanedPaymentFields:function(t){var n=e(t).filter(function(e){return e.dataType&&"/contact/phone/areacode"===e.dataType}),i=e(t).filter(function(e){return e.dataType&&"/contact/phone/exchange"===e.dataType}),a=e(t).filter(function(e){return e.dataType&&"/contact/phone/local"===e.dataType});(0===n.length||0===i.length||0===a.length)&&(e(i).each(function(e){e.dataType="/contact/phone"}),e(a).each(function(e){e.dataType="/contact/phone"}));var r=e(t).filter(function(e){return e.dataType&&"/contact/phone"===e.dataType});n.length>0&&r.length>0&&e(r).each(function(e){e.dataType="/contact/phone/number"})}};return n}),ABINEMASKME.define("abine/phoneServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core"],function(e,t,n,i,a){var r=n.protocol+n.phoneServerHost,s=r+"/api/v2/shieldedphones",o=r+"/api/v2/shieldedphones/verify",c=r+"/api/v2/call_log/update",l=r+"/api/v2/call_log",d=r+"/api/v2/migrate",u=a.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},createPhone:function(e,t){this.server.makeRequest({server:"phone",action:"createPhone",defaults:{},required:["country_code","number","verification_method"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"POST"})},verifySecret:function(e,t){this.server.makeRequest({server:"phone",action:"verifySecret",defaults:{},required:["id","secret"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:o,type:"POST"})},updatePhoneLog:function(e,t){this.server.makeRequest({server:"phone",action:"updatePhoneLog",defaults:{},required:["id","is_allowed","caller","phone_auth_token"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:c,type:"POST"})},getPhoneLog:function(e,t){this.server.makeRequest({server:"phone",action:"getPhoneLog",defaults:{},required:["id","phone_auth_token"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:l,type:"POST"})},migratePhone:function(e,t){this.server.makeRequest({server:"phone",action:"migratePhone",defaults:{},required:["phone_auth_token"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:d,type:"PUT"})}});return u}),ABINEMASKME.define("abine/pluralizer",[],function(){var e=function(e,t){return 1==e?t:t+"s"},t={};return t.pluralize=e,t}),ABINEMASKME.define("abine/proxies",["documentcloud/underscore","abine/core","abine/contentMessenger","abine/timer"],function(e,t,n,i){function a(t){s||(s=t||new n.ContentMessenger({eventAggregator:ABINEMASKME.eventAggregator||window.eventAggregator}),e.each(o,function(e){e.connect()}))}function r(){s&&(e.each(o,function(e){e.disconnect()}),s=null)}var s,o=[],c=t.BaseClass.extend({initialize:function(t){var n=this;e.each(t.methods,function(e){n.addMethod(e)}),e.each(t.asyncMethods,function(e){n.addAsyncMethod(e)}),this._require=t.require,this._events=t.events,o.push(this),s&&this.connect()},connect:function(){var e=""+Math.random();this._proxyId=e,this._connected=!1;var t=this;s.on("background:stub:events:"+e,function(e){return"stub:connected"==e.name?(t._connected=!0,void 0):(t.trigger(e.name,e.payload),void 0)}),s.send("contentManager:proxy:connect",{proxyId:e,require:this._require,events:this._events})},disconnect:function(){s.send("contentManager:proxy:disconnect",{proxyId:this._proxyId}),this._connected=!1},addMethod:function(e){this[e]=function(){var t=function(){},n=arguments;arguments.length>0&&"function"==typeof arguments[arguments.length-1]?(t=arguments[arguments.length-1],n=Array.prototype.slice.call(arguments,0,-1)):n=Array.prototype.slice.call(arguments,0),this.call({method:e,params:n},t)}},addAsyncMethod:function(e){this[e]=function(){var t=function(){},n=arguments;arguments.length>0&&"function"==typeof arguments[arguments.length-1]?(t=arguments[arguments.length-1],n=Array.prototype.slice.call(arguments,0,-1)):n=Array.prototype.slice.call(arguments,0),this.callAsync({method:e,params:n},t)}},call:function(e,t){var n=""+Math.random();e.proxyId=this._proxyId,e.callId=n,e.require=this._require,t&&s.once("background:stub:response:"+n,function(e){t(e)});var a=this,r=100,o=function(){return r--,!a._connected&&r>0?(i.setTimeout(o,50),void 0):(s.send("contentManager:proxy:call",e),void 0)};o()},callAsync:function(e,t){var n=""+Math.random();e.proxyId=this._proxyId,e.callId=n,e.require=this._require,t&&s.once("background:stub:response:"+n,function(e){t(e.err,e.data)});var a=this,r=100,o=function(){return r--,!a._connected&&r>0?(i.setTimeout(o,50),void 0):(s.send("contentManager:proxy:callAsync",e),void 0)};o()}}),l=new c({require:"abine/securityManager",methods:["isLocked","hasPassword","lock","setPassword","isInitialized","sync","hasRegisteredSync","recheckPassword","openWindow","needsToChangePassword","emailEntered","authenticate","reloadPreference","enableEntitlements","refreshEntitlements","openPage"],asyncMethods:["unlock","passwordValidationRequired","clearAutoUnlockPassword","setAutoUnlockPassword"],events:["background:securityManager:unlocked","background:securityManager:locked","background:securityManager:passwordChanged","background:securityManager:showDecrypting","background:securityManager:invalidPassword","background:securityManager:sync","background:securityManager:serverAuthSuccess","background:securityManager:serverAuthFailed","background:securityManager:entitlementsRefreshed","background:securityManager:entitlementsRefreshError","background:securityManager:fakelocked"]}),d=new c({require:"abine/modules/license",methods:[],asyncMethods:["register","signIn","changePassword","changeEmail","deleteUser","activatedCards","sendResetPasswordEmail","refreshLastFourCardDigits","sendFeedbackEmail","refreshEntitlements","resendUnlockEmail","autoRegister","sendResetPasswordEmail","changeEmailPassword","postInstallCompleted","referralCode"],events:[]}),u=new c({require:"abine/modules/sync",methods:[],asyncMethods:["sync"],events:[]}),h=new c({require:"abine/modules/phone",methods:[],asyncMethods:["clearPhoneData"],events:[]}),f=new c({require:"abine/preregister",methods:[],asyncMethods:["checkForRegistration"],events:[]}),p=new c({require:"abine/pageEvents",asyncMethods:["processAction"],methods:[],events:[]}),m=new c({require:"abine/modules/payments",asyncMethods:["resendGiftCardEmail","retrieveDisposableCardBalance"],methods:[],events:[]});return{Proxy:c,connect:a,disconnect:r,securityManager:l,licenseModule:d,syncModule:u,phoneModule:h,preregModule:f,pageEventsModule:p,paymentsModule:m}}),ABINEMASKME.define("abine/responseCodes",[],function(){return{UNKNOWN_ERROR:"unknown error",SUCCESS:"successful",ERROR:"error",MISSING_PARAMETERS:"missing parameters",UNAUTHORIZED:"unauthorized bad token",NO_ACCESS_FOR_FEATURE:"no access to requested feature",INVALID_PASSWORD:"invalid password",ACCOUNT_ALREADY_EXISTS:"account already exists for that email",SAVE_NEW_USER_ERROR:"error saving new user",FAILED_CREATING_TARGET_EMAIL:"failed to create target email",FAILED_TO_UPDATE_USER:"error updating user",NO_ACCOUNT_FOUND_FOR_EMAIL:"no account found for email",ACCOUNT_MARKED_FOR_DELETION:"account has been marked for deletion",ACCOUNT_HAS_BEEN_LOCKED:"account has been locked",WRONG_PASSWORD:"wrong password",INVALID_EMAIL_ADDRESS:"invalid email address",NO_RECURLY_ACCOUNT_FOUND:"no recurly account found",VERSION_NOT_ALLOWED:"version not allowed",DOWNGRADE_SCHEMA_NOT_ALLOWED:"downgrade of schema_version is not allowed",SAVE_CLIENT_DATA_ERROR:"errors saving client data",DESTROY_CLIENT_DATA_ERROR:"errors destroying client data",NO_CLIENT_DATA_FOUND:"no client data found",USER_EXISTS_FOR_CLIENT_DATA_DELETION:"cannot destroy client data when user exists",UPGRADE_REQUIRED:"upgrade required",PHONE_NOT_FOUND:"phone not found",NO_DISPOSABLE_PHONE:"no disposable phone",FAILED_TO_SAVE_PHONE:"failed to save phone",PHONE_ALREADY_VALIDATED:"phone already validated",NO_NUMBERS_AVAILABLE:"no numbers available",FAILED_TO_SEND_VERIFICATION_CODE:"failed to send verification code",WRONG_VERIFICATION_CODE:"wrong verification code",OLD_PHONE_NOT_FOUND:"old phone not found",COUNTRY_NOT_SUPPORTED:"country not supported",COUNTRY_CHANGE_NOT_SUPPORTED:"country change not supported",ERROR_CREATING_DISPOSABLE:"error creating disposable",MISSING_USER_PARAMS_ERROR_CODE:"missing user params",NO_BILLING_ACCOUNT_FOR_USER_ERROR_CODE:"no billing account for user",REQUEST_ALREADY_EXISTS_ERROR_CODE:"request already exists",NO_CARDS_AVAILABLE_ERROR_CODE:"no cards available",REQUESTED_AMOUNT_OVER_LIMIT_ERROR_CODE:"requested amount over limit",REQUESTED_AMOUNT_BELOW_MINIMUM_ERROR_CODE:"requested amount below minimum",REQUESTED_AMOUNT_INVALID_ERROR_CODE:"requested amount invalid",BILLING_FAILED_ERROR_CODE:"billing failed",BILLING_DECLINED_ERROR_CODE:"billing declined",NO_CARD_FOUND_ERROR_CODE:"no card found",NO_BILLING_TRANSACTION_FOUND_ERROR_CODE:"no billing transaction found",FRAUD_SOFT_LIMIT_REACHED:"fraud soft limit",REFUND_FAILED_ERROR_CODE:"refund failed",PROVIDER_CANCEL_FAILED_ERROR_CODE:"provider cancel failed",PROVIDER_READ_FAILED_ERROR_CODE:"provider read failed",PROVIDER_CARD_CREATION_FAILED_ERROR_CODE:"provider card creation failed",FRAUD_HARD_LIMIT_REACHED:"fraud hard limit reached",CARD_ALREADY_DEACTIVATED_ERROR_CODE:"card already deactivated",FRAUD_VERIFIED_SOFT_LIMIT_REACHED:"fraud verified soft limit",FRAUD_PLATFORM_UNAVAILABLE:"fraud verification unavailable",FRAUD_HIGH_RISK_COUNTRY_ERROR_CODE:"high risk country ban",BILLING_IN_NON_US_ERROR_CODE:"billing in non us",GREY_LISTED_ERROR_CODE:"grey listed user",GLOBAL_SOFT_LIMIT_REACHED:"global soft limit",DUPLICATE_CARD_ERROR_CODE:"duplicate card used ban",TOO_MANY_REJECTS:"target mail has been rejected too many times"}}),ABINEMASKME.define("abine/saveForms",["documentcloud/underscore","abine/formSubmitDetector","abine/core","abine/formAnalyzer","storage","persistence","abine/url","abine/failedSubmitDetector","abine/securityManager"],function(e,t,n,i,a,r,s,o,c){function l(e){if(c.isLocked())return H.trigger("background:saveField:locked",{}),void 0;var t=s.getTLD(e.formData.pageUrl||e.formData.url);a.Site.findBy("domain",t,function(t){var n=t?1===t.blacklisted:!1;a.Preference.findBy("key","rememberAccounts",function(t){a.Preference.findBy("key","rememberOnlyMaskMe",function(i){return!t||!i||t.isFalse()||n||i.isTrue()&&"MaskMe"!==e.formData.origin?(H.trigger("background:saveField:aborted",{}),void 0):(p(e),void 0)})})})}function d(e){return c.isLocked()?(H.trigger("background:saveForm:locked",{}),void 0):(a.Preference.findBy("key","rememberAccounts",function(t){a.Preference.findBy("key","rememberOnlyMaskMe",function(n){return!t||!n||t.isFalse()||n.isTrue()&&"MaskMe"!==e.data.origin?(H.trigger("background:saveForm:aborted",{}),void 0):(e.fakeSubmit=!0,m(e),void 0)
})}),void 0)}function u(e){return c.isLocked()?(H.trigger("background:saveForm:locked",{}),void 0):(a.Preference.findBy("key","rememberAccounts",function(t){a.Preference.findBy("key","rememberOnlyMaskMe",function(n){return!t||!n||t.isFalse()||n.isTrue()&&"MaskMe"!==e.data.origin?(H.trigger("background:saveForm:aborted",{}),void 0):(e.data.insuranceSubmit=!0,m(e),void 0)})}),void 0)}function h(e){if(R.saveInProgress=!0,c.isLocked())return H.trigger("background:saveForm:locked",{}),void 0;var t=s.getTLD(e.data.pageUrl||e.data.url);a.Site.findBy("domain",t,function(t){var n=t?1===t.blacklisted:!1;a.Preference.findBy("key","rememberAccounts",function(t){a.Preference.findBy("key","rememberOnlyMaskMe",function(i){return!t||!i||t.isFalse()||n||i.isTrue()&&"MaskMe"!==e.data.origin?(H.trigger("background:saveForm:aborted",{}),void 0):(R.rollbackPending(e.tabId,function(){m(e)}),void 0)})})})}function f(e,t,n){"/contact/email"==e.dataType?a.DisposableEmail.listCached("guid",e.disposableGUID,function(e){e.length>0&&(e[0].accountId=t.id,r.flush(function(){n()}))}):"/contact/phone"==e.dataType&&a.DisposablePhone.load(e.disposableGUID,function(e){e&&(e.accountId=t.id,r.flush(function(){n()}))})}function p(t){var n=t.formData,i=t.fieldData,r=[],o={},c={};if(e.each(n.data,function(t){t.dataType&&""!=t.dataType||(t.dataType="/unknown"),t.origin=t.name==i.name||t.id==i.id?i.origin:"",""!=t.value&&r.push(t),("/contact/email"==t.dataType||"/nameperson/friendly"==t.dataType)&&(t.dataType=t.value.match(/.+\@.+\..+/i)?"/contact/email":"/nameperson/friendly"),o[t.dataType]||(o[t.dataType]=[]),o[t.dataType].push(t),""!=t.value&&(c[t.dataType]?e.isString(c[t.dataType])?(c[t.dataType]=[c[t.dataType]],c[t.dataType].push(t.value)):c[t.dataType].push(t.value):c[t.dataType]=t.value)}),o["/contact/phone"]||"/contact/phone"!=i.dataType||(r.push(i),o["/contact/phone"]=[i],c["/contact/phone"]=i.value),e.all(e.keys(O),function(e){return!(e in o)}))return H.trigger("background:saveField:missing1",null),void 0;if(!t.fromFill&&o["/password"]&&e.all(o["/password"],function(e){return""==e.value}))return H.trigger("background:saveField:missing2",null),void 0;var l=s.getTLD(n.pageUrl||n.url);L[t.tabId]={accountId:void 0,domain:l,type:n.type,protocol:n.protocol,page_domain:n.page_domain,form_domain:n.form_domain},a.Site.findOrCreate({payload:{domain:l,name:s.getSiteName(l)}},function(s){function o(e){return e.siteId==s.id&&"fill"==e.type}a.Account.listCached(o,function(o){if(o&&0!=o.length){var d=o[0];d&&(i.disposableGUID&&f(i,d,function(){}),e.async.forEach(r,function(e,t){a.AccountField.createVersioned({payload:{name:e.name,value:e.value,dataType:e.dataType,accountId:d.id,origin:e.origin,modifiedAt:new Date}},function(){t()})},function(e){e&&true&&ABINEMASKME.log.error("[ERROR CALLBACK]#[abine/common/save_forms]#[saveFields]# error while saving most recent fill account fields"),B[t.tabId]={accountId:d.id,domain:l,type:n.type,protocol:n.protocol,page_domain:n.page_domain,form_domain:n.form_domain},t.fromFill&&H.trigger("background:saveField:saved",null)}))}else I(s,c,"fill",n,function(s){i.disposableGUID&&f(i,s,function(){}),e.async.forEach(r,function(e,t){a.AccountField.createVersioned({payload:{name:e.name,value:e.value,dataType:e.dataType,accountId:s.id,origin:e.origin,modifiedAt:new Date}},function(){t()})},function(e){e&&true&&ABINEMASKME.log.error("[ERROR CALLBACK]#[abine/common/save_forms]#[saveField]# error while creating account fields async.forEach"),B[t.tabId]={accountId:s.id,domain:l,type:n.type,protocol:n.protocol,page_domain:n.page_domain,form_domain:n.form_domain},t.fromFill&&H.trigger("background:saveField:saved",null)})})})})}function m(t){var n=t.data;n.tabId=t.tabId,n.fixture=t.fixture,L[t.tabId]&&delete L[t.tabId],B[t.tabId]&&delete B[t.tabId];for(var o={dataType:"/contact/phone",value:"",origin:"",name:"dynamic"},c=g(n),l=c.fieldsWithData,d=c.dataTypeMap,u=c.typeValueMap,h=c.fieldsWithDataTypeMap,f=s.getTLD(n.pageUrl||n.url),p=0;n.data.length>p;p++){var m=n.data[p].value||"";""!=m&&(m=(m+"").replace(/[A-Z]/g,"A").replace(/[a-z]/g,"a").replace(/\d/g,"D").replace(/\s/g,"S").replace(/[^a-zA-Z0-9.@]/g,"C")),r.add(new a.FormData({dataType:n.data[p].dataType,origin:n.data[p].origin,value:m,formType:n.type,field_signature:n.data[p].name,form_signature:n.formSignature,domain:f,createdAt:new Date,latest:1}))}return r.flush(),u["/contact/phone"]||(u["/contact/phone/countrycode"],u["/contact/phone/areacode"]&&(o.value+="("+w(u,"/contact/phone/areacode")+") "),u["/contact/phone/exchange"]&&u["/contact/phone/local"]?o.value+=w(u,"/contact/phone/exchange")+"-"+w(u,"/contact/phone/local"):u["/contact/phone/number"]&&(o.value+=w(u,"/contact/phone/number")),u["/contact/phone/extension"]&&(o.value+=" x"+w(u,"contact/phone/extension")),""!=o.value&&(u["/contact/phone"]=o.value,l.push(o),h["/contact/phone"]=1,d["/contact/phone"]=[o])),d["/password"]||(n.noPassword="yes"),e.all(e.keys(O),function(e){return!(e in h)})?(H.trigger("background:saveForm:missing",null),void 0):(a.Site.findOrCreate({payload:{domain:f,name:s.getSiteName(f)}},function(e){A(e.id,function(a){_(a,l,u),n.type==i.CHANGEPASSWORD_FORM?E(e.id,d,function(e){e&&a.cleanRemove(function(){v(e,d["/password"][0],function(){R.monitor(t.tabId,n,"changepass",e.id)})})}):k(e.id,u,function(t){t?b(a.id,t.id,function(){a.cleanRemove(function(){C(t,l,function(e,i){y(t,e,i,n)})})}):M(e.id,u,function(t){t?b(a.id,t.id,function(){a.cleanRemove(function(){C(t,l,function(e,i){y(t,e,i,n)})})}):I(e,u,n.type,n,function(e){b(a.id,e.id,function(){a.cleanRemove(function(){C(e,l,function(t,i){y(e,t,i,n,!0)})})})})})})})}),void 0)}function g(t){var n=[],i={},a={},r={};return e.each(t.data,function(t){t.dataType&&""!=t.dataType||(t.dataType="/unknown"),t.origin=t.origin?t.origin:"",""!=t.value&&(n.push(t),i[t.dataType]=1),("/contact/email"==t.dataType||"/nameperson/friendly"==t.dataType)&&(t.dataType=t.value.match(/.+\@.+\..+/i)?"/contact/email":"/nameperson/friendly"),a[t.dataType]||(a[t.dataType]=[]),a[t.dataType].push(t),""!=t.value&&(r[t.dataType]?e.isString(r[t.dataType])?(r[t.dataType]=[r[t.dataType]],r[t.dataType].push(t.value)):r[t.dataType].push(t.value):r[t.dataType]=t.value)}),{fieldsWithData:n,dataTypeMap:a,typeValueMap:r,fieldsWithDataTypeMap:i}}function y(t,n,a,r,s){var o=e.find(n,function(e){return"/password"==e.dataType?!0:void 0}),c=[];e.async.forEach(a,function(e,n){P(t,e,function(e){e&&c.push(e),n()})},function(n){n&&true&&ABINEMASKME.log.error("[ERROR CALLBACK]#[abine/common/save_forms]#[postProcessAccountUpdate]# error while processing fields for activity"),t.updateInfo(r.type,function(){var n=r.type===i.LOGIN_FORM?"login":"register",l=s?"new":"update";if(s)o||(t.type="passwordless"),H.trigger("background:saveForm:new",{account:t,subActivities:c,activityType:"new "+n});else if(0==a.length)l="login",H.trigger("background:saveForm:login",{account:t,activityType:"login"});else{var d=e.find(a,function(e){return"/password"===e.dataType});d?("passwordless"==t.type&&(t.type=n),l="changepass",H.trigger("background:saveForm:update",{account:t,accountField:d,activityType:"update password"})):H.trigger("background:saveForm:update",{account:t,activityType:"update"})}r.fixture||R.monitor(r.tabId,r,l,t.id,t.type)})})}function b(t,n,i){return-1==t?(i(),void 0):(a.DisposableEmail.listCached("accountId",t,function(s){e(s).each(function(e){e.accountId=n}),a.DisposablePhone.listCached("accountId",t,function(t){e(t).each(function(e){e.accountId=n}),r.flush(function(e,t){i(t)})})}),void 0)}function v(t,n,i){function r(e){return e.accountId==t.id&&1==e.latest&&"/password"==e.dataType}var s=null;a.AccountField.listCached(r,function(r){e.async.forEach(r,function(e,i){a.AccountField.createVersioned({payload:{name:e.name,value:n.value,dataType:e.dataType,accountId:t.id,origin:e.origin,modifiedAt:new Date}},function(e){s||(s=e),i()})},function(e){e&&true&&ABINEMASKME.log.error("[ERROR CALLBACK]#[abine/common/save_forms]#[doPasswordChange]# error while doing password field changes"),H.trigger("background:saveForm:update",{account:t,accountField:s,activityType:"update password"}),i()})})}function E(t,n,i){function r(e){return e.siteId==t}a.Account.listCached(r,function(t){e.async.filter(t,function(t,i){function r(e){return e.accountId==t.id&&1==e.latest&&"/password"==e.dataType}a.AccountField.listCached(r,function(t){var a=e(t).find(function(e){return e.value==n["/passwordold"][0].value?!0:!1});a?i(!0):i(!1)})},function(t){if(t&&0!=t.length){var n=t[0];e(t).each(function(e){e.modifiedAt>n.modifiedAt&&(n=e)}),i(n)}else i(null)})})}function A(e,t){a.Account.all().filter("siteId","=",e).filter("type","=",a.Account.encryptedQueryValue("fill")).order("createdAt",!1).one(function(e){e?t(e):t({id:-1,cleanRemove:function(e){e&&e()}})})}function M(t,n,i){function r(e){return e.siteId==t&&"fill"!=e.type}var s=e.intersection(e.keys(O),e.keys(n));(N in n||x in n)&&(s.push(N),s.push(x));var o={};e.each(s,function(e){o[e]=w(n,e)}),a.Account.listCached(r,function(t){e.async.filter(t,function(e,t){function n(t){return t.accountId==e.id&&1==t.latest&&t.dataType in o&&!("/password"==t.dataType&&t.value==o[t.dataType])}a.AccountField.listCached(n,function(e){t(0===e.length)})},function(t){var n=null;e.each(t,function(e){(!n||e.createdAt>n.createdAt)&&(n=e)}),i(n)})})}function _(t,n,i){t&&-1!=t.id&&a.AccountField.getLatestForAccountId(t.id,function(t){var a=[];e.each(t,function(t){var i=!1;e.each(n,function(e){e.dataType==t.dataType&&e.name==t.name&&(e.origin=t.origin),e.dataType==t.dataType&&""!=e.value&&(i=!0)}),i||a.push(t)}),e.each(a,function(t){n.push({name:t.name,value:t.value,dataType:t.dataType,origin:t.origin}),i[t.dataType]?e.isString(i[t.dataType])?(i[t.dataType]=[i[t.dataType]],i[t.dataType].push(t.value)):i[t.dataType].push(t.value):i[t.dataType]=t.value})})}function S(t,n,i){return e.isString(t[n])?t[n].toLowerCase()===i.toLowerCase():e.isArray(t[n])?e.any(t[n],function(e){return e.toLowerCase()===i.toLowerCase()}):!1}function w(t,n){return t[n]?e.isString(t[n])?t[n]:e.isArray(t[n])?e.find(t[n],function(e){return""!=e.value?!0:void 0}):void 0:null}function k(t,n,i){function r(e){return e.siteId==t&&"fill"!=e.type}var s=[];if((N in n||x in n)&&(s.push(N),s.push(x)),0==s.length)return i(null),void 0;var o={};e.each(s,function(e){o[e]=1}),a.Account.listCached(r,function(t){function r(e){return e.accountId in s&&1==e.latest&&e.dataType in o}var s={};e.each(t,function(e){s[e.id]=e}),a.AccountField.listCached(r,function(t){var a=e.find(t,function(e){return S(n,N,e.value)||S(n,x,e.value)});a?i(s[a.accountId]):i(null)})})}function T(e){var t=null;return x in e?t=w(e,x):N in e&&(t=w(e,N)),t}function P(e,t,n){var i=t.origin?t.origin:"",r=t.dataType?t.dataType:"",s=null,o={"/contact/email":"email","/contact/phone":"phone","/password":"password"},c={disposable:1,primary:1,strong:1};"/contact/email"===r&&t.value.indexOf("opayq.com")>=0&&(i="disposable"),"/password"===r?t.passwordReuseCount(function(i){s=1==i?new a.AccountActivity({accountId:e.id,accountFieldId:t.id,activityType:"strong password",createdAt:new Date,modifiedAt:new Date}):new a.AccountActivity({accountId:e.id,accountFieldId:t.id,activityType:"reused password",createdAt:new Date,modifiedAt:new Date}),n(s)}):(i in c&&r in o&&(s=new a.AccountActivity({accountId:e.id,accountFieldId:t.id,activityType:i+" "+o[r],createdAt:new Date,modifiedAt:new Date})),n(s))}function C(t,n,i){var s=0,o=[],c=n.length,l=[],d=function(n,a){s++,l.push(n),(a||"fill"==t.type)&&n.dataType in O&&o.push(n),s==c&&(0==o.length?(e.each(l,function(e){e.version--}),r.flush(function(){i(l,o)})):r.flush(function(){i(l,o)}))};e.each(n,function(e){a.AccountField.createVersioned({payload:{name:e.name,value:e.value,dataType:e.dataType,accountId:t.id,origin:e.origin,modifiedAt:new Date}},d)})}function I(e,t,n,s,o){var c=T(t);c||(c="password account");var l=n;"fill"!==n&&(l=n===i.LOGIN_FORM?"login":"register");var d="fill"==l?"":e.name+" "+l+" account",u=new a.Account({name:c,description:d,siteId:e.id,active:1,createdAt:new Date,modifiedAt:new Date,type:l,protocol:s.protocol?s.protocol:null,page_domain:s.page_domain?s.page_domain:null,form_domain:s.form_domain?s.form_domain:null});r.add(u),r.flush(function(){o(u)})}var x="/nameperson/friendly",N="/contact/email",F="/password",D="/contact/phone",O={};O[x]=1,O[N]=1,O[F]=1,O[D]=1;var R=o,B={},L={},K=n.BaseClass.extend({init:function(t,n,i){this.messenger=t,R=n||o,R.init(t,this),R.on("background:saveForm:rollback",function(e){H.trigger("background:saveForm:rollback",e)}),this.messenger.on("contentManager:init",function(t,n){if(B[n]){var i={data:{data:[],type:B[n].type,pageUrl:B[n].domain,protocol:B[n].protocol,page_domain:B[n].page_domain,form_domain:B[n].form_domain},tabId:n};a.AccountField.getLatestForAccountId(B[n].accountId,function(t){e.each(t,function(e){i.data.data.push({name:e.name,value:e.value,dataType:e.dataType,origin:e.origin})}),m(i)}),delete B[n]}else if(L[n]){var i={data:{data:[],type:L[n].type,pageUrl:L[n].domain,protocol:L[n].protocol,page_domain:L[n].page_domain,form_domain:L[n].form_domain},tabId:n};m(i),delete L[n]}else{var i={data:{data:[],type:"unknown",pageUrl:t.domain},tabId:0};m(i)}}),this.messenger.on("contentManager:filledAccount",function(e,n){a.Account.load(e.accountId,function(e){e.modifiedAt=new Date,r.flush(function(){B[n]?a.Account.load(B[n].accountId,function(e){e.cleanRemove(function(){delete B[n],t.send("broadcast:filledAccount:rolledback",null,n)})}):t.send("broadcast:filledAccount:rolledback",null,n)})})}),R.on("background:saveForm:fakeSubmit",d),R.on("background:saveForm:insuranceSubmit",u),c=i||c}}),H=new K;H.fillAccountTabIdMap=B,H.noFillAccountTabIdMap=L;var U=function(e){R.saveInProgress=!1,H.trigger("background:saveForm:finished",e)};return H.on("all",function(e){}),H.on("background:saveForm:locked",function(e){e=e||{},e.eventName="background:saveForm:locked",U(e)}),H.on("background:saveForm:aborted",function(e){e=e||{},e.eventName="background:saveForm:aborted",U(e)}),H.on("background:saveForm:missing",function(e){e=e||{},e.eventName="background:saveForm:missing",U(e)}),H.on("background:saveForm:new",function(t){t=t||{},t.eventName="background:saveForm:new";var n=new a.AccountActivity({accountId:t.account.id,activityType:t.activityType,createdAt:new Date,modifiedAt:new Date}),i=t.subActivities||[],s=e.map(i,function(e){return e.activityType});s=e.uniq(s),"new login"==t.activityType&&s.push("life easier"),n.extraActivityTypes=s.join(","),t.account.computeFullyProtected(!0,function(e){n.protectionLevel=e,r.add(n),r.flush(function(){U(t),H.messenger.broadcast("broadcast:saveForm:new"),H.messenger.broadcast("broadcast:accountActivity:new",n)})})}),H.on("background:saveForm:update",function(e){e=e||{},e.eventName="background:saveForm:update";var t=new a.AccountActivity({accountId:e.account.id,activityType:e.activityType,accountFieldId:e.accountField?e.accountField.id:null,createdAt:new Date,modifiedAt:new Date});e.account.computeFullyProtected(!0,function(n){t.protectionLevel=n,r.add(t),r.flush(function(){U(e),H.messenger.broadcast("broadcast:saveForm:update"),H.messenger.broadcast("broadcast:accountActivity:new",t)})})}),H.on("background:saveForm:login",function(e){e=e||{},e.eventName="background:saveForm:login";var t=new a.AccountActivity({accountId:e.account.id,activityType:e.activityType,createdAt:new Date,modifiedAt:new Date});e.account.computeFullyProtected(!0,function(n){t.protectionLevel=n,r.add(t),r.flush(function(){U(e),H.messenger.broadcast("broadcast:saveForm:login")})})}),H.on("background:saveField:saved",function(){H.messenger.broadcast("broadcast:saveForm:new")}),t.formSubmitDetector.on("background:formSubmit",h),t.formSubmitDetector.on("background:formFieldChanged",l),t.formSubmitDetector.on("background:fixtureSubmit",m),H}),ABINEMASKME.define("abine/securityManager",["documentcloud/underscore","abine/core","abine/crypto","storage","persistence","abine/timer","abine/config","abine/window","abine/responseCodes"],function(e,t,n,i,a,r,s,o,c){function l(e){var t=n.createKeyAndIV(e,e);return n.sha256(n.encrypt(t,e))}function d(e,t){var i=n.createKeyAndIV(t,t);return n.encrypt(i,e)}function u(e,t){var i=n.createKeyAndIV(t,t);return n.decrypt(i,e)}function h(){C={length:0}}function f(e,t,i){var a;if(e){var r=i+":"+t;r in C||(C[r]=n.createKeyAndIV(i,t),C.length++,C.length>P&&p()),a=C[r],a._accessTime=Date.now()}else a=n.createKeyAndIV(i,t);return a}function p(){r.clearTimeout(I),I=r.setTimeout(function(){var e=-1,t=null;for(var n in C)"length"!=n&&(e>C[n]._accessTime||-1==e)&&(e=C[n]._accessTime,t=n);t&&(delete C[t],C.length--,C.length>P&&p())},1e3)}function m(t,n,r){n=n||x(),a.flush(function(){e.async.parallel([i.AccountField.migrateToAccountIdSalt,i.Preference.encryptAuthToken],function(){n(null,t),r||F.trigger("background:securityManager:unlocked",t)})})}function g(t){function n(e){return 0===e.key.indexOf("Salt.")}i.Preference.listCached(n,function(n){var r={};e.each(n,function(e){r[e.key.substr(5)]=e.value});for(var s in i){var o=i[s];if(o.meta&&o.meta.secured){var c=!1;s in r||(r[s]=F.salt(),a.add(new i.Preference({key:"Salt."+s,value:r[s]})),c=!0),o.meta.salt=r[s],c&&o.encryptAll()}}a.flush(t)})}var y=null,b=null,v=!0,E=!1,A=!1,M=!1,_=!1,S=!1,w=null,k=!1,T=12e4,P=1e3,C={length:0},I=null,x=function(){},N=t.BaseClass.extend({initialize:function(){this.useEncryption=s.crypt},getServerPassword:function(e){return l(l(e))},load:function(e,t){e&&(this.messenger=e);var r=function(){h(),g(function(){S=!0,i.Preference.findBy("key","requirePasswordToShowPassword",function(e){k=!e||e.isTrue(),i.Preference.findBy("key","hasRegisteredSync",function(e){M=e&&e.isTrue();var n=function(){F.trigger("background:securityManager:initialized")};v?n():E?m({serverPassword:l(y)},n,t):m(null,n,t)})})})};i.Preference.findBy("key","hasPassword",function(e){!e||e.isFalse()?(v=!1,E=!1,i.Preference.findBy("key","defaultPassword",function(e){e?(y=e.value,r()):(y=n.sha256(""+Math.random()),a.add(new i.Preference({key:"defaultPassword",value:y})),a.flush(function(){F.encryptAll(),r()}))})):(E=!0,i.Preference.findBy("key","autoUnlockPassword",function(e){e?i.Preference.findBy("key","password",function(t){v=!1,y=u(e.value,t.value),w=Date.now(),a.clean(),r()}):(v=!0,y=null,r())}))})},refreshEntitlements:function(){F.trigger("background:securityManager:refreshEntitlements")},enableEntitlements:function(e){F.trigger("background:securityManager:enableEntitlements",e)},openPage:function(e,t,n){n&&(ABINEMASKME.lastPanel||(ABINEMASKME.lastPanel={}),ABINEMASKME.lastPanel[n.action]=n.type),t?o.createTab({localUrl:"pages/index.html#"+e}):o.createTab({url:e,force:!0})},openWindow:function(e,t,n){o.openWindow(e,t,n)},isLocked:function(){return v},hasPassword:function(){return E},hasRegisteredSync:function(){return M},needsToChangePassword:function(){return _},passwordValidationRequired:function(t){t=t||x,i.Preference.findBy("key","regPassword",e.bind(function(e){return this.hasPassword()&&k&&!e?T>=Date.now()-w?(w=Date.now(),t(!1),void 0):(t(!0),void 0):(t(!1),void 0)},this))},emailEntered:function(e){F.trigger("background:securityManager:emailEntered",{email:e})},serverAuthSuccess:function(){M=!0,_=!1,F.trigger("background:securityManager:serverAuthSuccess")},serverAuthFailed:function(){F.trigger("background:securityManager:serverAuthFailed")},authenticate:function(e){var t=l(e),n=l(t);F.trigger("background:securityManager:authenticate",{serverPassword:n})},unlock:function(e,t,r){return r=r||x,i.Preference.createOrModify({key:"autoLockOnRestart",value:t?"true":"false"},function(t){i.Preference.findBy("key","password",function(s){var o=l(e),u=l(o);s&&s.value==n.sha256(o)?(h(),y=o,w=Date.now(),v=!1,a.clean(),t.isFalse()&&a.add(new i.Preference({key:"autoUnlockPassword",value:d(l(e),n.sha256(l(e)))})),a.flush(function(){m({serverPassword:u},r)})):r({errorCode:c.INVALID_PASSWORD})})}),!0},lock:function(e){return e=e||x,!v&&E?(i.Preference.findBy("key","regPassword",function(t){t?(F.trigger("background:securityManager:fakelocked"),e()):(y=null,h(),v=!0,a.clean(),i.Preference.findBy("key","autoUnlockPassword",function(t){t?(a.remove(t),a.flush(function(){e(),F.trigger("background:securityManager:locked")})):(e(),F.trigger("background:securityManager:locked"))}))}),!0):(e(),!1)},setAutoUnlockPassword:function(e,t){t=t||x,i.Preference.createOrModify({key:"autoUnlockPassword",value:d(l(e),n.sha256(l(e)))},t)},clearAutoUnlockPassword:function(e){i.Preference.findBy("key","autoUnlockPassword",function(t){t?(a.remove(t),a.flush(function(){e()})):e()})},sync:function(){return!v&&E?(F.trigger("background:securityManager:sync"),!0):!1},refreshLastFourCardDigits:function(){F.trigger("background:securityManager:refreshLastFourCardDigits")},recheckPassword:function(e){return!v&&E&&l(e)==y?(w=Date.now(),!0):!1},setPassword:function(t,r){if(r=r||function(){},v||!t||""==t)return r(),void 0;var s=l(t);i.Preference.findOrCreate({key:"autoLockOnRestart",value:"false"},function(o){i.Preference.all().filter("key","in",["password","hasPassword","autoUnlockPassword"]).list(function(c){e.each(c,function(e){a.remove(e)}),a.add(new i.Preference({key:"hasPassword",value:"true"})),a.add(new i.Preference({key:"password",value:n.sha256(s)})),o.isFalse()&&a.add(new i.Preference({key:"autoUnlockPassword",value:d(s,n.sha256(s))})),a.flush(function(){A=!0,h(),b=s,F.encryptAll(function(){h(),A=!1,y=s,b=null,E=!0;var e=l(s);F.trigger("background:securityManager:passwordChanged",{password:t,serverPassword:e}),r()})})})})},salt:function(){return n.salt()},encrypt:function(e,t,i){if(!y||!this.useEncryption)return t;var a=f(i,e,b||y);return n.encrypt(a,t)},decrypt:function(e,t,i){if(!y||!this.useEncryption)return t;var a=f(i,e,y);return n.decrypt(a,t)},isInitialized:function(){return S},reloadPreference:function(){i.Preference.findOrCreate({key:"autoLockOnRestart",value:"true"},function(e){e.isFalse()?i.Preference.createOrModify({key:"autoUnlockPassword",value:d(y,n.sha256(y))},function(){}):i.Preference.findBy("key","autoUnlockPassword",function(e){e&&(a.remove(e),a.flush())})}),i.Preference.findBy("key","requirePasswordToShowPassword",function(e){k=!e||e.isTrue()})},encryptAll:function(t){if(!S)return this.once("background:securityManager:initialized",e.bind(this.encryptAll,this,t)),void 0;var n=null,a=0;t&&(n=function(){a--,0>=a&&t()});for(var r in i){var s=i[r];s.meta&&s.meta.secured&&(a++,s.encryptAll(n))}}}),F=new N;return F}),ABINEMASKME.define("abine/server",["documentcloud/underscore","abine/ajax","abine/config","storage","abine/core","abine/responseCodes","abine/window","persistence","abine/timer","abine/securityManager"],function(e,t,n,i,a,r,s,o){var c=function(){},l=function(e,t){i.Preference.findBy("key","authToken",function(n){i.Preference.findBy("key","installAuthToken",function(i){var a=!n||n.isEmpty()||n.isEncrypted()?null:n.value,r=!i||i.isEmpty()?null:i.value;a&&(e.data.auth_token=a),r&&(e.data.install_auth_token=r),t.call(this,e)})})},d=function(e,t){e.data.client_application.version=n.version,e.data.client_application.environment=n.environment,e.data.client_application.tag=n.tags[0],e.data.client_application.browser=n.browser,e.data.client_application.build_num=n.buildNum,e.data.client_application.user_agent=ABINEMASKME.userAgent,e.data.client_application.product="MaskMe",e.data.client_application.device="Extension",t.call(this,e)},u=a.BaseClass.extend({makeRequest:function(n){n.defaults=n.defaults||{},n.required=n.required||[],n.data=e.defaults(n.data||{},n.defaults),n.type=n.type||"POST",n.dataType=n.dataType||"json";var a=n.success||c,s=n.error||c;return n.data.client_application||(n.data.client_application={}),n.success=e.bind(function(e,t,n){var i=n.status,r=e.data;a(r,i)},this),n.error=e.bind(function(t){var a=t.status,c={error_code:r.UNKNOWN_ERROR};try{c=JSON.parse(t.responseText)}catch(l){}var d=c.error_code;500==a&&(d=r.UNKNOWN_ERROR),d==r.UNAUTHORIZED&&i.Preference.findBy("key","authToken",e.bind(function(e){e&&!e.isEncrypted()&&(e.value="",o.flush(),"refreshEntitlements"!=n.action&&"signIn"!=n.action&&this.openLoginPage())},this)),s(a,d,c)},this),this.hasRequiredParams(n.required,n.data)?(l(n,function(e){d(e,function(e){t.ajax(e)})}),void 0):(true&&ABINEMASKME.log.error("[ERROR HANDLER]#["+n.server+"]#["+n.action+"]# client missing required parameters"),s(422,r.MISSING_PARAMETERS,{}),void 0)},openLoginPage:e.debounce(function(){s.createTab({doNotOpenNewTab:!0,localUrl:"pages/index.html#userLogin"})},3500,!0),hasRequiredParams:function(t,n){var i=!0;return e.each(t,e.bind(function(t){(!e.has(n,t)||this.isEmpty(n[t]))&&(i=!1)},this)),i},isEmpty:function(e){return null===e||void 0===e||0/0===e||""===e}}),h=u.extend({makeRequest:function(e){if(!e.url)throw"server calls must have a url";e.data=e.data||{},e.type=e.type||"POST",e.dataType=e.dataType||"json";var t=e.success||c,n=e.error||c;e.success=function(e,n,i){var a=i.status,r=e.data;t(r,a,this)},e.error=function(e){var t=e.status,i={error_code:r.UNKNOWN_ERROR};try{i=JSON.parse(e.responseText)}catch(a){}var s=i.error_code;500==t&&(s=r.UNKNOWN_ERROR),n(t,s,i)},e.data.client_application||(e.data.client_application={}),this.lastRequest=e,this.tokenSet=!1;var i=this;l(e,function(e){d(e,function(){i.tokenSet=!0,i.waitingRequest&&(i.waitingRequest(),delete i.waitingRequest)})}),this.trigger("request:made")},respondWithSuccess:function(t,n,i){return this.tokenSet?(this.lastRequest.success.call(this.lastRequest,t,n,i),delete this.lastRequest,void 0):(this.waitingRequest=e.bind(this.respondWithSuccess,this,t,n,i),void 0)},respondWithError:function(t,n,i){return this.tokenSet?(this.lastRequest.error=!0,this.lastRequest.error.call(this.lastRequest,t,n,i),delete this.lastRequest,void 0):(this.waitingRequest=e.bind(this.respondWithError,this,t,n,i),void 0)}});return{server:u,mock:h}}),ABINEMASKME.define("abine/storageMixins",["documentcloud/underscore","persistence"],function(e,t){var n={index:function(e,n){var i=this;if(i.meta.cached&&i.cached){var a=t.getCachedEntities(i);i.respondWithEntities(a,e,n)}else if(i.cachingQueryInProgress)i.waitingCallbacks.push({req:e,cb:n});else{i.cachingQueryInProgress=!0,i.waitingCallbacks=[];try{this.all().list(null,function(a){i.meta.cached&&(i.cached=!0);var r=i.waitingCallbacks;delete i.cachingQueryInProgress,delete i.waitingCallbacks;try{i.respondWithEntities(a,e,n)}catch(s){true&&ABINEMASKME.log.error(s)}for(var o=0;r.length>o;o++)try{a=t.getCachedEntities(i),i.respondWithEntities(a,r[o].req,r[o].cb)}catch(s){true&&ABINEMASKME.log.error(s)}})}catch(r){true&&ABINEMASKME.log.error(r);var s=i.waitingCallbacks;delete i.cachingQueryInProgress,delete i.waitingCallbacks;for(var o=0;s.length>o;o++)try{i.respondWithEntities([],s[o].req,s[o].cb)}catch(r){true&&ABINEMASKME.log.error(r)}}}},isCached:function(){return this.meta.cached&&this.cached},show:function(e,t){var n=e.params[0];this.load(n,function(n){t?t.call(this,n):e.returnEntities&&e.returnEntities(n)})},create:function(e,n){var i=this;e.payload.createdAt=new Date,e.payload.modifiedAt=new Date;var a=new i(e.payload);t.add(a),t.flush(null,function(){n?n.call(this,a):e.returnEntities&&e.returnEntities(a)})},update:function(n,i){var a=n.params[0];n.payload.modifiedAt=new Date,this.load(a,function(a){e.extend(a,n.payload),t.flush(null,function(){i?i.call(this,a):n.returnEntities&&n.returnEntities(a)})})},destroy:function(e,n){var i=e.params[0];this.load(i,function(i){t.remove(i),t.flush(null,function(){n?n.call():e.returnStatus&&e.returnStatus("ok")})})},respondWithEntities:function(e,t,n){n?n.call(this,e):t&&t.returnEntities&&t.returnEntities(e)},respondWithJSON:function(e,t,n){n?n.call(null,e):t.returnJSON&&t.returnJSON(e)},listCached:function(t,n,i,a){if(!this.meta.cached)throw"listCached cannot be used with entities that do not have caching enabled.";"function"==typeof t?(i=t,a=n,t=null):a||(a=i,i=null),this.index(null,function(r){var s=[];e.each(r,function(e){t&&e[t]!=n||i&&!i(e)||s.push(e)}),a&&a(s)})},initCache:function(e){this.meta.cached&&!this.cached?this.index(null,function(){e()}):e()},updatePushVersion:function(t,n){this.meta.cached?this.listCached("pushVersion",0,function(i){e.each(i,function(e){e.pushVersion=t}),n()}):this.all().filter("pushVersion","=",0).list(function(i){e.each(i,function(e){e.pushVersion=t}),n()})}};return{DefaultActions:n}}),ABINEMASKME.define("abine/storageRouter",["documentcloud/underscore","persistence","abine/core","abine/fixtures","abine/backgroundMessenger"],function(e,t,n,i,a){var r={dbName:"idme_data",dbDescription:"Storage for the idme extension",dbSizeInBytes:5242880},s=/:([\w\d]+)/g,o=/\*([\w\d]+)/g,c=/[-[\]{}()+?.,\\^$|#\s]/g,l=n.BaseClass.extend({initialize:function(t){t=t||{};var n=this,i=t.ready||function(){};this.routes=[],this.storage={},e.defaults(t,r),this.messenger=t.messenger||new a.BackgroundMessenger,l.initialized?(n.startListener(),i.call()):(t.ready=function(){n.startListener(),i.call()},l.initializeWebSQLStorage(t))},initializeMemoryStorage:function(e){t.store.memory.config(t),e.call(this)},startListener:function(){this.messenger.on("all",this.messageHandler,this)},registerEntity:function(t,n){this.storage[n]=t,e(t.routes).each(function(t,i){if(!t||!i)throw"Bad routes on entity "+n;if(e.isRegExp(i)||(i=i.replace(c,"\\$&").replace(s,"([^/]*)").replace(o,"(.*?)"),i=new RegExp("^"+i+"$","i")),!i)throw"Bad route for "+t;this.routes.push([i,n,t])},this)},messageHandler:function(t,n,i){var a=t.split(":")[0];if(e(["create","read","update","delete"]).include(a)){var r=t.replace(/\:/g,"/");r=r.replace(/\/\//g,":");var s=e(this.routes).find(function(e){return r.match(e[0])}),o=this.storage[s[1]],c=s[2],l=s[0].exec(r).slice(1),u=new d({entityName:s[1],route:t,payload:n,sender:i,params:l,messenger:this.messenger});return o[c].call(o,u),u}},send:function(){return this.messageHandler.apply(this,arguments)}});l.initializeWebSQLStorage=function(e){var n=e.ready||function(){};if(l.initialized)return n(),void 0;if(t.store.websql.config(t,e.dbName,e.dbDescription,e.dbSizeInBytes),e.noMigrations)e.fixtures?i.createFixtures(function(){n()}):n();else{var a=(Date.now(),function(){n()});t.migrations.init(function(){t.migrate(function(){e.fixtures?i.createFixtures(a):a()})})}l.initialized=!0};var d=n.BaseClass.extend({initialize:function(e){e=e||{},this.route=e.route,this.params=e.params,this.entityName=e.entityName,this.sender=e.sender||"background",this.messenger=e.messenger,this.payload=e.payload},getReturnRoute:function(){var e=this.route.split(":");return e[0]="response",e.join(":")},getReturnErrorRoute:function(){var e=this.route.split(":");return e[0]="error",e.join(":")},returnErrObj:function(e){return e=e||{},this.messenger.send(this.getReturnErrorRoute(this.route),e,this.sender),!0},returnError:function(e,t){t=t||500,e=e||"Server error";var n={error:!0,message:e,status:t};return this.messenger.send(this.getReturnErrorRoute(this.route),n,this.sender),!0},returnStatus:function(e){var t={status:e};return this.messenger.send(this.getReturnRoute(this.route),t,this.sender),!0},returnEntities:function(t){var n;t&&0!=t.length?e.isArray(t)&&1==t.length?n=t[0].toJSON():e.isArray(t)&&t.length>1?n=e(t).map(function(e){return e.toJSON()}):e.isObject(t)&&(n=t.toJSON()):n=[],this.messenger.send(this.getReturnRoute(this.route),n,this.sender)},returnJSON:function(e){this.messenger.send(this.getReturnRoute(this.route),e,this.sender)}});return{StorageRouter:l,StorageRequest:d}}),ABINEMASKME.define("abine/stubs",["documentcloud/underscore","abine/core"],function(e,t){function n(e,t){ABINEMASKME.require([e.require],function(n){t in c&&e.require in c[t]?c[t][e.require].addProxy(e.proxyId):(c[t]||(c[t]={}),c[t][e.require]||(c[t][e.require]=new d(n,e,t)),l++),o.send("background:stub:events:"+e.proxyId,{name:"stub:connected",payload:null},t)})}function i(t,n){n in c&&(e.each(e.keys(c[n]),function(e){l--,c[n][e].cleanup(),delete c[n][e]}),delete c[n])}function a(e){o=e,e.on("contentManager:proxy:connect",n),e.on("contentManager:proxy:disconnect",i),e.on("contentManager:proxy:call",function(e,t){t in c&&e.require in c[t]&&c[t][e.require].call(e,t)}),e.on("contentManager:proxy:callAsync",function(e,t){t in c&&e.require in c[t]&&c[t][e.require].callAsync(e,t)})}function r(e){i(null,e)}function s(){o&&(o.off("contentManager:proxy:connect"),o.off("contentManager:proxy:disconnect"),o.off("contentManager:proxy:call"),o.off("contentManager:proxy:callAsync"),o=null);for(var e in c)c[e].cleanup();c={}}var o,c={},l=0,d=t.BaseClass.extend({initialize:function(t,n,i){this.realObj=t,this._proxyIds=[n.proxyId],this._events={};var a=this;e.each(n.events,function(n){a._events[n]=function(t){e.each(a._proxyIds,function(e){o.send("background:stub:events:"+e,{name:n,payload:t},i)})},t.on(n,a._events[n])
})},addProxy:function(e){this._proxyIds.push(e)},call:function(e,t){var n=e.callId,i=this.realObj[e.method].apply(this.realObj,e.params);o.send("background:stub:response:"+n,i,t)},callAsync:function(e,t){var n=e.callId,i=function(e,i){o.send("background:stub:response:"+n,{err:e,data:i},t)};e.params=e.params||[],e.params.push(i),this.realObj[e.method].apply(this.realObj,e.params)},cleanup:function(){var t=this.realObj;e.each(this._events,function(e,n){t.off(n,e)})}});return{tabClosed:r,start:a,stop:s}}),ABINEMASKME.define("abine/syncMerge",["documentcloud/underscore","abine/core","storage","persistence","abine/sync/preference","abine/sync/site","abine/sync/shielded_email","abine/sync/shielded_phone","abine/sync/account","abine/sync/disposableEmail","abine/sync/disposablePhone","abine/sync/disposableCard","abine/sync/shieldedCard"],function(e,t,n,i,a,r,s,o,c,l,d,u,h){var f=t.BaseClass.extend({initialize:function(){},migrateServerData:function(e,t){if(ABINEMASKME.schemaVersion>e){for(var n=i.migrations.Migrator.migrations,a=[],r=e+1;ABINEMASKME.schemaVersion>=r;r++)a.unshift(n[r]);for(;a.length>0;){var s=a.pop();s.body.upForSync&&s.body.upForSync(t)}}},mergeClientData:function(t,f,p,m){this.migrateServerData(p,t),e.defer(function(){n.Preference.findBy("key","lastSync",function(e){var p=0;e&&e.value&&(p=parseInt(e.value)),p=new Date(p),n.Preference.findBy("key","lastDataVersion",function(e){var n=0;e&&e.value&&(n=parseInt(e.value)),i.flush(function(){i.clean(),new a(t,p,n,f).merge(function(){new r(t,p,n,f).merge(function(){new h(t,p,n,f).merge(function(){new s(t,p,n,f).merge(function(){new o(t,p,n,f).merge(function(){new c(t,p,n,f).merge(function(){new u(t,p,n,f).merge(function(){new l(t,p,n,f).mergeSpareEmails(function(){new d(t,p,n,f).mergeSparePhones(function(){i.flush(function(){m.call()})})})})})})})})})})})})})})}});return{SyncMerge:f}}),ABINEMASKME.define("abine/syncServer",["documentcloud/underscore","abine/ajax","abine/config","abine/server","abine/core"],function(e,t,n,i,a){var r=n.protocol+n.serverHost,s=r+"/api/v2/client_data",o=a.BaseClass.extend({initialize:function(e){this.options=this.options||e||{},this.server=this.options.server||new i.server},getClientDataHeaderFromServer:function(e,t){this.server.makeRequest({server:"sync",action:"getClientDataHeaderFromServer",defaults:{},required:["schema_version"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"GET"})},getClientDataFromServer:function(e,t){this.server.makeRequest({server:"sync",action:"getClientDataFromServer",defaults:{},required:["id"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s+"/"+e.id,type:"GET"})},pushClientDataToServer:function(e,t){this.server.makeRequest({server:"sync",action:"pushClientDataToServer",defaults:{},required:["client_data"],success:function(e){t.call(this,null,e)},error:function(e,n,i){t.call(this,{status:e,errorCode:n,responseJSON:i})},data:e,url:s,type:"POST"})}});return o}),ABINEMASKME.define("abine/url",function(){function e(e){return e?e.toLowerCase().replace(/\w+/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)}):e}function t(e){var t=e.match(s);return t&&t.length>1?t[1].toString():e}function n(e){var n=t(e);if(n.match(o)||n.match(c))return n;var i=n.split(".");if(2>i.length)return null;var s=i.pop(),l=i.pop(),d=l+"."+s;if(a.test(d)&&i.length>0&&(s=d,l=i.pop(),d=l+"."+s),r.test(d)&&i.length>0){var u=i.pop();d=u+"."+d}return d}function i(t){if(t=n(t),t.match(o))return t;var i=t.split(".");if(i.length>2){var s=i.pop(),c=i.pop(),t=c+"."+s;if(a.test(t)&&i.length>0&&(s=t,c=i.pop(),t=c+"."+s),r.test(t)&&i.length>0){var l=i.pop();return e(c+" "+l)}return e(c)}return e(i[0])}var a=/^(((co|ac|go|ed|ga|mn|nj|nc|or|ne|in|gr|ca|on|pa|qc|bc|sh|at|va|us|il|tv|me|lg|at|ny|gv|com|edu|org|net|gov|mil|biz)\...)|(163\.com)|(kiev\.ua)|(gob\.pe)|(gen\.tr)|(waw.pl)|(jus.br))$/,r=/^(((go|typepad|tumblr|blogspot|squarespace|wordpress|myshopify|blogfa|blog|blogs|blinkweb|ning|posterous|over-blog|mihanblog|appspot|webs|weebly|onsugar|ucoz|uk|pch|ecwid)(\.com|\.in))|(nic\.in)|((ucoz|spb|narod)\.ru)|(blog\.163\.com)|((gouv|free)\.fr)|(uol\.com\.br)|(web\.id)|(gob\.mx)|(blogg\.se)|(home.pl))$/,s=/^(?:http(?:s)?\:)?\/\/([^/]+)/im,o=/^[0-9\.]+(:[0-9]+)?$/,c=/^localhost(:[0-9]+)?$/;return{getHostname:t,getTLD:n,getSiteName:i}}),ABINEMASKME.define("abine/window",["documentcloud/underscore","abine/timer","jquery"],function(e,t,n){APPLICATION_CSS="pages/application.css";var i=function(){},a=function(e,n){e.documentElement?e.documentElement.appendChild(n):t.setTimeout(function(){a(e,n)},100)},r=function(e){var t,i=e.getElementsByTagName("head")[0];i&&(t=e.createElement("link"),t.setAttribute("rel","stylesheet"),t.setAttribute("href",chrome.extension.getURL(APPLICATION_CSS)),i.appendChild(t)),n("body",e).css("backgroundColor","transparent")};return{createTab:function(e,t){function n(i){return 1>i.length&&-1==r.indexOf("?")?(r+="?",chrome.tabs.query({url:r},n),void 0):(1>i.length&&!e.doNotOpenNewTab?(chrome.tabs.create({active:!0,url:a}),t()):(chrome.tabs.update(i[0].id,{active:!0,url:a}),chrome.windows.get(i[0].windowId,function(e){"minimized"==e.state&&chrome.windows.update(e.id,{state:"normal"}),chrome.windows.update(e.id,{focused:!0}),t()})),void 0)}t=t||i;var a=e.localUrl?chrome.extension.getURL(e.localUrl):e.url;if(e.force)return chrome.tabs.create({active:!0,url:a}),t(),void 0;var r=a.split("#")[0];chrome.tabs.query({url:r},n)},createPanel:function(t){var n=t.localUrl?chrome.extension.getURL(t.localUrl):t.url,i=t.document||document||window.document,s=t.panelWidth?t.panelWidth:368;if(!i)throw"Error. abine/window createPanel called without a document context.";var o=i.createElement("div");o.className=t.className||"abineContentPanel",e.extend(o.style,{background:"transparent"},t.style);var c=i.createElement("iframe");return e.extend(c,{className:"abineContentFrame",width:s+"px",allowTransparency:"true",frameborder:0,height:t.panelHeight+"px",scrolling:"no",src:n?n:""}),e.extend(c.style,{background:"transparent",borderWidth:"0px",opacity:1,margin:"0",padding:"0",height:t.panelHeight+"px",width:s+"px"}),o.appendChild(c),c.onload=function(){r(c.contentDocument),t.ready&&t.ready.call(c,c.contentDocument,c)},a(i,o,c),c},openWindow:function(e,t,n){chrome.windows.create({url:e,width:t,height:n,focused:!0,type:"popup"})},autoResizePanels:function(t){var i=t.document||document||window.document;i.getElementsByTagName("body")[0];var a=i.getElementsByClassName(t.className||"abineContentPanel");e(a).each(function(e){var t=n("iframe",e)[0];t.scrolling="no";var i=t.contentDocument.body.offsetHeight,a=n(t).width();n(t).height(i),e.style.width=a+"px",e.style.height=i+"px";try{var r=parseInt(e.style.left),s=r+e.offsetWidth,o=e.ownerDocument.defaultView.innerWidth,c=e.ownerDocument.documentElement.scrollLeft+o;if(s>c){var l=s-c;if(r-l>0)e.style.left=r-l+"px";else if(e.style.left="0px",s-r>o){var d=Math.round(100*(o/(s-r)));d-=1,80>d&&(d=80),t.style.zoom=d+"%",t.contentDocument.body.style.zoom=d+"%"}}}catch(u){}})},removePanels:function(t){var n=t.document||document||window.document;if(t.iframe){var i=t.iframe.parentNode;return i&&i.parentNode&&i.parentNode.removeChild(i),void 0}var a=n.getElementsByClassName("abineContentPanel");e(a).each(function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})}}}),ABINEMASKME.define("abine/contentMessenger",["documentcloud/underscore","abine/core"],function(e,t){var n=function n(e){this.trigger(e.eventName,e.payload)},i=function(){throw"Error. Attempt to call destroyed ContentMessenger."},a=t.BaseClass.extend({initialize:function(){this.listener=e.bind(n,this),chrome.extension.onRequest.addListener(this.listener)},send:function(e,t){this.trigger(e,t),chrome&&chrome.extension&&chrome.extension.sendRequest({eventName:e,payload:"undefined"==typeof t?{}:t})},destroy:function(){this.off(),chrome.extension.onRequest.removeListener(n),this.on=this.off=this.trigger=i}});return{ContentMessenger:a}}),ABINEMASKME.define("abine/formSubmitDetector",["documentcloud/underscore","jquery","abine/formAnalyzer","abine/core","abine/eventLogger"],function(e,t,n,i,a){var r=i.BaseClass.extend({init:function(e,t){var n=this,i={};e.on("contentManager:formSubmit",function(e,t){"clear"===e?t in i&&delete i[t]:i[t]=e}),e.on("contentManager:formFieldChanged",function(e,t){n.trigger("background:formFieldChanged",{formData:e.formData,fieldData:e.fieldData,tabId:t})}),e.on("panel:fill",function(e,t){n.trigger("background:formFieldChanged",{fromFill:!0,formData:e.formData,fieldData:e.fieldData,tabId:t})}),t=t||chrome.webRequest.onBeforeRequest,t.addListener(function(e){var t=e.tabId;if(t in i){var a=i[t],r=e.url;if(a.url&&""!=a.url&&(0===a.url.indexOf(r)||0===r.indexOf(a.url)))return n.trigger("background:formSubmit",{data:a,tabId:t}),delete i[t],void 0;a.url=r,n.trigger("background:formSubmit",{data:a,tabId:t}),delete i[t]}},{urls:["<all_urls>"],types:["main_frame","sub_frame","xmlhttprequest","script"]},[])}}),s=i.BaseClass.extend({initialize:function(e,t){function i(i){var a=i.target;"FORM"===a.nodeName&&e.send("contentManager:formSubmit",n.getFormData(a,t.location.href))}t=t||window,t.addEventListener("submit",i),t.addEventListener("abinemaskmesubmit",i),e.send("contentManager:formSubmit","clear")}});return{formSubmitDetector:new r,FormSubmitContentHelper:s}}),ABINEMASKME.define("abine/pageEventsImpl",["abine/core","abine/proxies"],function(e,t){function n(e){var n=e.target,i=n.ownerDocument,a=n.getAttribute("action"),s=n.getAttribute("params");if(s)try{s=JSON.parse(s)}catch(o){s={}}else s={};if("mm_ping"==a){var c=i.createEvent("Event");c.initEvent("mm_pong",!0,!0),i.dispatchEvent(c)}else{var l=i.createEvent("Event");l.initEvent("received:"+a,!0,!0),i.dispatchEvent(l)}r.processedEvent=r.processedEvent||{};var d=r.processedEvent[a]||0,u=(new Date).getTime();u-15e3>d?(r.processedEvent[a]=u,t.pageEventsModule.processAction({action:a,host:i.location.host,params:s},function(e){e&&(n.textContent=JSON.stringify(e)),$(n).click(),n.parentNode&&n.parentNode.removeChild(n)})):n.parentNode&&n.parentNode.removeChild(n)}var i,a=e.BaseClass.extend({startup:function(e,t){i=e,t.addEventListener("MMPageEvent",n,!0)},shutdown:function(e){e.removeEventListener("MMPageEvent",n,!0)}}),r=new a;return r}),ABINEMASKME.define("abine/assets",["wycats/handlebars"],function(e){function t(e){return chrome.extension.getURL(e)}return e.registerHelper("assetUrl",t),{assetUrl:t}}),ABINEMASKME.define("abine/browserSyncStorage",["documentcloud/underscore","abine/core"],function(e,t){var n;n=chrome&&chrome.storage&&chrome.storage.sync?t.BaseClass.extend({initialize:function(){},set:function(e,t){chrome.storage.sync.set(e,t)},remove:function(e,t){chrome.storage.sync.remove(e,t)},get:function(e,t){chrome.storage.sync.get(e,t)},clear:function(e){chrome.storage.sync.clear(e)}}):t.BaseClass.extend({initialize:function(){this.storage={}},set:function(t,n){e.extend(this.storage,t),n&&n()},remove:function(t,n){t="string"==typeof t?[t]:t,e.each(t,e.bind(function(e){delete this.storage[e]},this)),n&&n()},get:function(t,n){t="string"==typeof t?[t]:t,n&&n(e.pick(this.storage,t))},clear:function(e){this.storage={},e&&e()}});var i=new n({});return i}),ABINEMASKME.define("documentcloud/backbone",["documentcloud/underscore","jquery"],function(){return Backbone}),ABINEMASKME.define("wycats/handlebars",[],function(){var e={};e.VERSION="1.0.beta.6",e.helpers={},e.partials={},e.registerHelper=function(e,t,n){n&&(t.not=n),this.helpers[e]=t},e.registerPartial=function(e,t){this.partials[e]=t},e.registerHelper("helperMissing",function(e){if(2===arguments.length)return void 0;throw new Error("Could not find property '"+e+"'")});var t=Object.prototype.toString,n="[object Function]";return e.registerHelper("blockHelperMissing",function(e,i){var a=i.inverse||function(){},r=i.fn,s="",o=t.call(e);if(o===n&&(e=e.call(this)),e===!0)return r(this);if(e===!1||null==e)return a(this);if("[object Array]"===o){if(e.length>0)for(var c=0,l=e.length;l>c;c++)s+=r(e[c]);else s=a(this);return s}return r(e)}),e.registerHelper("each",function(e,t){var n=t.fn,i=t.inverse,a="";if(e&&e.length>0)for(var r=0,s=e.length;s>r;r++)a+=n(e[r]);else a=i(this);return a}),e.registerHelper("if",function(i,a){var r=t.call(i);return r===n&&(i=i.call(this)),!i||e.Utils.isEmpty(i)?a.inverse(this):a.fn(this)}),e.registerHelper("unless",function(t,n){var i=n.fn,a=n.inverse;return n.fn=a,n.inverse=i,e.helpers["if"].call(this,t,n)}),e.registerHelper("with",function(e,t){return t.fn(e)}),e.registerHelper("log",function(t){e.log(t)}),e.Exception=function(){var e=Error.prototype.constructor.apply(this,arguments);for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.message=e.message},e.Exception.prototype=new Error,e.SafeString=function(e){this.string=e},e.SafeString.prototype.toString=function(){return this.string.toString()},function(){var t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=/&(?!\w+;)|[<>"'`]/g,i=/[&<>"'`]/,a=function(e){return t[e]||"&amp;"};e.Utils={escapeExpression:function(t){return t instanceof e.SafeString?t.toString():null==t||t===!1?"":i.test(t)?t.replace(n,a):t},isEmpty:function(e){return"undefined"==typeof e?!0:null===e?!0:e===!1?!0:"[object Array]"===Object.prototype.toString.call(e)&&0===e.length?!0:!1}}}(),e.VM={template:function(t){var n={escapeExpression:e.Utils.escapeExpression,invokePartial:e.VM.invokePartial,programs:[],program:function(t,n,i){var a=this.programs[t];return i?e.VM.program(n,i):a?a:a=this.programs[t]=e.VM.program(n)},programWithDepth:e.VM.programWithDepth,noop:e.VM.noop};return function(i,a){return a=a||{},t.call(n,e,i,a.helpers,a.partials,a.data)}},programWithDepth:function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(i,a){return a=a||{},e.apply(this,[i,a.data||t].concat(n))}},program:function(e,t){return function(n,i){return i=i||{},e(n,i.data||t)}},noop:function(){return""},invokePartial:function(t,n,i,a,r,s){if(options={helpers:a,partials:r,data:s},void 0===t)throw new e.Exception("The partial "+n+" could not be found");if(t instanceof Function)return t(i,options);if(e.compile)return r[n]=e.compile(t),r[n](i,options);throw new e.Exception("The partial "+n+" could not be compiled when running in runtime-only mode")}},e.template=e.VM.template,e}),ABINEMASKME.define("duckbone/core",["documentcloud/underscore","documentcloud/backbone","wycats/handlebars"],function(e,t){var n={};return n.helpers=n.helpers||{},n.forms=n.forms||{},n.TemplatesData=n.TemplatesData||{},n.PartialsData=n.PartialsData||{},e.extend(n,t.Events),e.extend(n,{serverError:function(t){e.log("500 Server Error"),t&&e.log(t)},fileNotFound:function(t){e.log("404 File Not Found"),t&&e.log(t)},register:function(t,i){i=i||!1;var a=e.uniqueId("regfunc");return e.isUndefined(n.registeredFunctions)&&(n.registeredFunctions={}),i&&(t=e.wrap(t,function(e){e(arguments),delete n.registeredFunctions[a]})),n.registeredFunctions[a]=t,"Duckbone.registeredFunctions."+a},wrapMethods:function(t,n){var i=Array.prototype.slice.call(arguments,2);e.isArray(i[0])&&(i=i[0]),e.each(i,function(e){var i=t[e];t[e]=function(){var e=[i].concat(Array.prototype.slice.call(arguments));return n.apply(t,e)}})},log:function(e){window.console&&console.log&&console.log(e)},include:function(t){if("undefined"==typeof t)throw"Attempt to include into undefined object.";return e.each(e.toArray(arguments).slice(1),function(e){if("undefined"==typeof e)throw"Attempt to include undefined object.";for(var n in e)"included"!=n&&void 0!==e[n]&&(t.hasOwnProperty(n)||(t[n]=e[n]));"function"==typeof e.included&&e.included.call(t)}),t}}),e.extend(n.helpers,{dateToPrettyTimeAgo:function(e){var t=Math.floor(((new Date).getTime()-e.getTime())/6e4);0>t&&(t=0);var n,i,a,r=t||0;return 0===r?"just now":(r>=1440?(i=Math.floor(r/1440),r-=1440*i,n=i,n+=i>1?" days":" day"):r>=60?(a=Math.floor(r/60),r-=60*a,n=a,n+=a>1?" hours":" hour"):r>0&&(n=r,n+=r>1?" minutes":" minute"),n+" ago")}}),e.mixin({log:n.log}),n}),ABINEMASKME.define("duckbone/model",["documentcloud/underscore","documentcloud/backbone","wycats/handlebars","duckbone/core","abine/eventLogger"],function(e,t,n,i,a){function r(n,i,r,s){var c=l("set_"+i),d=l(i),u=function(e,i){if(e instanceof t.Model){if(e===n[d])return e;n[d]&&(n.trigger("remove:"+d),s&&(n[d][s]=null)),n[d]=e,s&&o(n,n[d],s,i),n.trigger("add:"+d)}else if(e)if(n[d]){var a=function(){n.trigger("change:"+d)};n[d].on("change",a),n[d].set(e),n[d].off("change",a)}else n[d]=new r(e),s&&o(n,n[d],s,i),n.trigger("add:"+d);else n[d]&&(n.trigger("remove:"+d),s&&(n[d][s]=null)),n[d]=null;return e};try{u.call(n,n.get(i),!0)}catch(h){a.error("Error creating association for "+i+":\n"+h)}delete n.attributes[i],n[c]=e.bind(u,n)}function s(e,t,n,i){try{var r=l(t),s=e.get(t),c=e[r]=new n(s);delete e.attributes[t],i&&(c[i]=e,c.each(function(t){o(e,t,i)}),c.on("add",function(t){o(e,t,i)}),c.on("remove",function(e){e[i]=null}),c.on("reset",function(t){t.each(function(t){o(e,t,i)})}))}catch(d){a.error("Error creating association for "+t+":\n"+d)}}function o(e,t,n,i){var r="set"+n.slice(0,1).toUpperCase()+n.slice(1);"function"==typeof t[r]?t[r].call(t,e,i):i?t[n]=e:a.error("To use belongsTo, model must define hasOne for "+n)}function c(n,i){var a={};return n instanceof t.Model||!this._associations?a=n:e(n).each(function(e,t){var n=this._associations[t];if("hasOne"==n){var i=l("set_"+t);this[i](e)}else if("hasMany"==n){var r=l(t);"function"==typeof this[r].freshen?this[r].freshen(e):this[r].reset(e)}else a[t]=e},this),this.setWithoutAssociations.call(this,a,i)}function l(e){return e.replace(/(\_[a-z])/g,function(e){return e.toUpperCase().replace("_","")})}function d(e){return e.replace(/^\w/,function(e){return e.toUpperCase()})}i.AssociableModel={isAssociableModel:!0,included:function(){this.setWithoutAssociations||(this.setWithoutAssociations=this.set,this.set=c)},hasOne:function(t){e.each(t,function(e,t){this._associations=this._associations||{},this._associations[t]="hasOne",r(this,t,e.model,e.belongsTo)},this)},hasMany:function(t){e.each(t,function(e,t){this._associations=this._associations||{},this._associations[t]="hasMany",s(this,t,e.collection,e.belongsTo)},this)}},i.ModelHelpers={simpleSave:function(e){var t={};this.id&&(e.id=this.id),this.paramRoot?t[this.paramRoot]=e:t=e;var n=JSON.stringify(t);return this.save({},{contentType:"application/json",data:n})},url:function(){var e="function"==typeof this.urlRoot?this.urlRoot():this.urlRoot,t=u(this.collection)||e||urlError();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},setOne:function(e,t,n){var i={};return i[e]=t,this.set(i,n)},createGetters:function(){var t=this,n=arguments,i={};e.each(n,function(e){getterFuncName=l(e),getterFuncName="get"+d(getterFuncName),t[getterFuncName]||(i[getterFuncName]=function(){return this.get(e)})}),e.extend(this,i)},isValidAttribute:function(t){return!e.isNaN(t)&&!e.isUndefined(t)}};var u=function(t){return t&&t.url?e.isFunction(t.url)?t.url():t.url:null}}),ABINEMASKME.define("duckbone/syncable",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){function r(t){return t&&t.url?e.isFunction(t.url)?t.url():t.url:null}function s(){throw new Error("A 'url' property or function must be specified")}function o(e){var t,n,i,a,r,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="",c="",l="",d=0;do t=e.charCodeAt(d++),n=e.charCodeAt(d++),c=e.charCodeAt(d++),i=t>>2,a=(3&t)<<4|n>>4,r=(15&n)<<2|c>>6,l=63&c,isNaN(n)?r=l=64:isNaN(c)&&(l=64),o=o+s.charAt(i)+s.charAt(a)+s.charAt(r)+s.charAt(l),t=n=c="",i=a=r=l="";while(e.length>d);return o}a.Syncable={isSyncable:!0,sync:function(n,i,d){var u,h=l[n],f=i.defaultSyncOptions||{},p=e.extend({type:h,dataType:"json",beforeSend:function(e){var n=t('meta[name="csrf-token"]').attr("content");n&&e.setRequestHeader("X-CSRF-Token",n)}},f,d);if(t.browser.msie&&(p.cache=!1),p.url||(p.url=r(i)||s()),!p.data&&i&&("create"==n||"update"==n)){p.contentType="application/json";var m={};i.paramRoot?m[i.paramRoot]=i.toJSON():m=i.toJSON(),p.data=JSON.stringify(m)}return"GET"!==p.type&&(p.processData=!1),c.username&&(p.username=c.username,p.password=c.password,p.headers=p.headers||{},p.headers.Authorization="Basic "+o(p.username+":"+p.password)),u=t.ajax(p),u.params=p,i.trigger("sync:"+n.toLowerCase()),u.complete(function(){i.trigger("sync:complete",u)}),u.success(function(){delete i.errors,i.trigger("sync:success",u)}),u.error(function(e){e.status>=400&&a.trigger("sync:"+e.status,u)}),u.error(function(e){if(422==e.status){var t=JSON.parse(e.responseText);i.errors=t.errors?t.errors:t,i.trigger("sync:invalid",u)}else i.trigger("sync:error",u)}),u}},a.setAuthenticatedUser=function(e,t){c.username=e,c.password=t},a.removeAuthenticatedUser=function(){delete c.username,delete c.password};var c={},l={create:"POST",update:"PUT","delete":"DELETE",read:"GET"}}),ABINEMASKME.define("duckbone/collection",["documentcloud/underscore","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i){i.CollectionHelpers={hasDuckboneCollectionHelpers:!0,slice:function(){return this.models.slice(arguments)},toSelectOptions:function(e,t){var n={};return e=e||"title",t&&(n[" "]=" "),this.each(function(t){n[t.id]=t.get(e)}),n},freshen:function(t){var n;this.each(function(e){e._remove=!0}),e(t).each(function(e){n=this.get(e.id),n?(n.set(e),delete n._remove):this.add(e)},this);var i=this.filter(function(e){return e._remove});e(i).each(function(e){this.remove(e)},this),this.trigger("freshen",this)},fetch:function(e){e||(e={});var n=this,i=e.success;e.success=function(t,a,r){n[e.add?"add":e.freshen?"freshen":"reset"](n.parse(t,r),e),n.trigger("sync"),i&&i(n,t)};var a=e.error;return e.error=function(t){a?a(n,t,e):n.trigger("error",n,t,e)},(this.sync||t.sync).call(this,"read",this,e)}}}),ABINEMASKME.define("duckbone/routeable_application",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.RouteableApplication={isRouteableApplication:!0,setContainer:function(e){this.mainContainer=e},mapRoutes:function(t){e.each(e.keys(t),function(n){try{var i=t[n].routeName||t[n].prototype.templateName;if(!i)throw"Missing or bad routeName for "+n;if("function"!=typeof t[n].routeAction)throw"Missing or bad routeAction for "+n;this.route(n,i,t[n].routeAction),this.route(n+"?*params",i,function(){var i=e.toArray(arguments),a=i.pop(),r=e(a.split("&")).reduce(function(e,t){return e[t.split("=")[0]]=t.split("=")[1],e},{});return t[n].routeAction.apply(this,i.concat(r))})}catch(a){throw e.log(a),"Bad route for "+n}},this)},loadView:function(e,n){return void 0===n&&(n={}),this._removableFlashes&&(this._removableFlashes.remove(),delete this._removableFlashes),this.mainView&&this.mainView.remove(),n.application=this,this.mainView=new e(n),t(this.mainView.el).appendTo(this.mainContainer),this.mainView},navigate:function(e,t){this.isFlashableView&&(this._removableFlashes=this.activeFlashes()),n.history.navigate(e,t)},bindNavigationBars:function(){this.on("all",function(e){if("route"==e.split(":")[0]){var n=e.split(":")[1];t("nav ul li").removeClass("active"),t("nav ul li."+n).addClass("active")}})}}}),ABINEMASKME.define("duckbone/view_lifecycle_extensions",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.ViewLifecycleExtensions={hasViewLifecycleExtensions:!0,initialize:function(){this.application=this.options.application,this.isEditableView&&(r(this,"beforeClone"),this.cloneModelForEditing(),r(this,"afterClone")),this.render(),this.isStylizeableView&&this.applyStyles(),this.isBindableView&&this.bindAttributes(),this.isEditableView&&(this.bindModelSyncEvents(),this.createForm(),r(this,"afterCreateForm")),r(this,"afterInitialize")},render:function(){return this.isTemplateableView&&this.renderTemplate(),this.isStylizeableView&&this.applyStyles(),this},remove:function(){return this.isEditableView&&this.expireClone(),r(this,"beforeRemove"),this.removeWeakBindings(),this.isNestableView&&this.removeNestedViews(),n.View.prototype.remove.call(this),r(this,"afterRemove"),this},weakBindToModel:function(e,t,n){this.weakBindTo(this.model,e,t,n)},weakBindTo:function(t,n,i){this._weakBindings=this._weakBindings||[],this._weakBindings.push([t,n,i]),t.bind.apply(t,e.toArray(arguments).slice(1))},removeWeakBindings:function(){e.each(this._weakBindings,function(e){e[0].unbind(e[1],e[2])}),delete this._weakBindings,this.isBindableView&&this.unbindLiveTimestamps()}};var r=function(e,t){e[t]&&e[t].call(e)}}),ABINEMASKME.define("duckbone/handlebars_extensions",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){ABINEMASKME.Duckbone=a,a.Handlebars=i,i.getAttr=function(e,t){return/^[0-9]+$/.test(t)?e[parseInt(t)]:void 0!=e[t]?"function"==typeof e[t]?e[t].call(e):e[t]:e.get?e.get(t):void 0}}),ABINEMASKME.define("duckbone/idme_template_registry",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){function r(t){t.templatesCompiled||(e.each(e.keys(ABINEMASKME.CompiledTemplates),function(e){var n=e.replace("views/","").replace("/","_");t.compiledTemplates[n]=ABINEMASKME.CompiledTemplates[e]}),t.templatesCompiled=!0)}a.TemplateRegistry=function(e){e=e||{},this.compiledTemplates={},this.templatesCompiled=!1,this.partialsCompiled=!1},e.extend(a.TemplateRegistry.prototype,{refresh:function(){},compile:function(){r(this)},get:function(e){return r(this),this.compiledTemplates[e]}})}),ABINEMASKME.define("duckbone/nestable_view",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.NestableView={isNestableView:!0,setupNestedViews:function(){this.createChildren&&(this.children=this.createChildren())},removeNestedViews:function(){this.children&&(e.each(this.children,function(e){e.remove()}),delete this.children)}}}),ABINEMASKME.define("duckbone/templateable_view",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core","abine/eventLogger"],function(e,t,n,i,a,r){var s=new a.TemplateRegistry;i&&(i.helpers.oldIf=i.helpers["if"],i.registerHelper("if",function(e,t,n){var a="function"==typeof e?e.call(this):e;return i.helpers.oldIf.call(this,a,t,n)}),i.registerHelper("attr",function(e){return new i.SafeString('<span data-bind="attr_'+i.Utils.escapeExpression(e)+'">'+i.Utils.escapeExpression(this.get(e))+"</span>")}),i.registerHelper("child",function(t,n){return n=e.isObject(n)?"div":n,new i.SafeString("<"+n+' data-child-view="'+i.Utils.escapeExpression(t)+'"></'+n+">")}),i.helpers.oldEach=i.helpers.each,i.registerHelper("each",function(e,t,n){return e.models&&(e=e.models),i.helpers.oldEach.call(this,e,t,n)})),a.TemplateableView={isTemplateableView:!0,included:function(){this.hasViewLifecycleExtensions||a.include(this,a.ViewLifecycleExtensions),this.isNestableView||a.include(this,a.NestableView)},templateRegistry:s,getTemplate:function(e,t){if(this.templateData=this.options.templateData||this.templateData||null,this.templateData)throw r.error("Cannot compile template."),"Cannot compile template";return e=e||this.options.templateName||this.templateName||"",this.template=this.templateRegistry.get(e),this.template||t||(this.template=a.Handlebars.compile('<div>Missing Template "'+e+'"</div>')),this.template},renderTemplate:function(i){var i=i||this.model||{};if(e.isFunction(this.options.template)?this.template=this.options.template:this.template||this.getTemplate(),!this.template)throw"renderTemplate called without a template.";this.removeNestedViews(),this.isBindableView&&this.unbindAttributes();try{t(this.el).empty().html(this.template(i))}catch(a){r.error("Handlebars threw an exception rendering your template:"),r.error(a.message),r.error("Context:"),r.error(i),t(this.el).html('<div class="duckbone_error">Handlebars exception: '+a.message+"</div>")}return this.isBindableView&&i instanceof n.Model&&t(this.el).find("span[data-bind]").each(e.bind(function(e,n){var a=t(n).attr("data-bind").slice(5),r='span[data-bind="attr_'+a+'"]';this.bindAttribute(i,a,r)},this)),this.setupNestedViews(),t(this.el).find("*[data-child-view]").each(e.bind(function(e,i){var a=t(i).attr("data-child-view"),s=this.children[a];s instanceof n.View?(t(i).replaceWith(s.el),t(s.el).attr({"data-child-view":a}),s.delegateEvents()):r.error("Unknown child view "+a)},this)),this.options.templateName||this.templateName,this.templateName&&t(this.el).addClass(this.templateName),this.templateRendered=!0,this},renderTemplateOnce:function(e){return this.templateRendered||this.renderTemplate(e),this}}}),ABINEMASKME.define("duckbone/stylizeable_view",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.StylizeableView={isStylizeableView:!0,included:function(){this.hasViewLifecycleExtensions||a.include(this,a.ViewLifecycleExtensions)},applyStyles:function(e){e=e||this.styles||{};var n,i;for(var a in e)n=a.split(".")[0],i=a.split(".")[1],"el"==a?t(this.el).css(e.el):"el"==n&&i&&t(this.el).hasClass(i)?t(this.el).css(e[a]):t(this.el).find(a).css(e[a])}}}),ABINEMASKME.define("duckbone/pageable_view",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.PageableView={isPageableView:!0,included:function(){this.isTemplateableView||a.include(this,a.TemplateableView)},getTemplate:function(e){a.TemplateableView.getTemplate.call(this,e,!0),this.template=this.template||a.Handlebars.compile('{{child "list"}}{{child "pager"}}')},createChildren:function(){var t=this.createListView(),n=this.createPagerView();return this.application=this.options.application||this.application,this.application&&this.collection.on("pageChange",function(t,n){var i=window.location.hash.split("?")[0]+"?",a=e(e.keys(n)).map(function(e){return e+"="+n[e]}).join("&");i+=a,this.application.navigate(i,!1)},this),{list:t,pager:n}},createListView:function(){return new a.ListView({viewClass:this.viewClass,pageableView:this,tagName:"ul",className:"listable_view",collection:this.collection})},createPagerView:function(){var e=this.options.pagerClass||this.pagerClass||Pager;return new e({collection:this.collection,pageableView:this})},showPage:function(e){e=parseInt(e)||1,this.collection.setPage(e)},showNextPage:function(){this.showPage(this.collection.currentPage+1)},showPreviousPage:function(){this.showPage(this.collection.currentPage-1)},scrollToTopOfList:function(){var e=t(this.children.list.el).offset().top-20;t("html body").animate({scrollTop:e},400,"swing")}};var r='<div class="pager">&nbsp;<br/>    {{#if showPrevious}}      <a href="#" class="previous_link">&laquo;&nbsp;Previous</a>&nbsp;    {{else}}      <span class="inactive">&laquo;&nbsp;Previous</span>&nbsp;    {{/if}}    {{#each pages}}      {{#if currentPage}}        <span class="current">{{title}}</span>&nbsp;      {{else}}        <a href="#" class="page_link" data-page="{{id}}">{{title}}</a>&nbsp;      {{/if}}    {{/each}}    {{#if showNext}}      <a href="#" class="next_link">Next&nbsp;&raquo;</a>    {{else}}      <span class="inactive">Next&nbsp;&raquo;</span>    {{/if}}  </div>';Pager=n.View.extend({el:'<div class="pager_view"></div>',templateData:r,events:{"click a.previous_link":"showPreviousPage","click a.next_link":"showNextPage","click a.page_link":"showPage"},initialize:function(){this.render(),this.collection.on("all",this.render,this)},render:function(){return this.collection.numPages&&this.renderTemplate(this.paginationData()),this.collection.numPages>1?t(this.el).show():t(this.el).hide(),this},paginationData:function(){var t=this.collection.numPages,n={showPrevious:this.collection.currentPage>1,numPages:t,showNext:this.collection.currentPage<this.collection.numPages,pages:e(e.range(1,t+1)).map(function(e){return{id:e,title:""+e,currentPage:e==this.collection.currentPage}},this)};return n},showPage:function(e){e.preventDefault();var n=parseInt(t(e.target).data("page"));return this.options.pageableView.showPage(n),this.options.pageableView.scrollToTopOfList(),!1},showPreviousPage:function(e){return e.preventDefault(),this.options.pageableView.showPreviousPage(),this.options.pageableView.scrollToTopOfList(),!1},showNextPage:function(e){return e.preventDefault(),this.options.pageableView.showNextPage(),this.options.pageableView.scrollToTopOfList(),!1}}),a.include(Pager.prototype,a.TemplateableView)}),ABINEMASKME.define("duckbone/pageable_collection",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){function r(e,t){t=t||{};
var n="function"==typeof e.url?e.url():e.url;0>n.indexOf("?")&&(n+="?");for(var i in t)n+=i+"="+t[i]+"&";return n}a.PageableCollection={isPageableCollection:!0,parse:function(e){return this.numPages=e.num_pages,this.limitValue=e.limit_value,this.currentPage=e.current_page,this.totalCount=e.total_count,e.records},fetch:function(){this.fetchPage(1)},fetchPage:function(t,i){return t=t||1,i=i||e.clone(this.params)||{},n.Collection.prototype.fetch.call(this,{url:r(this,e.extend(i,{page:t})),success:function(e){e.trigger("pageChange",e.currentPage,i)}})},setParam:function(e,t){this.params=this.params||{},this.params[e]=t},setPage:function(e){return e!=this.currentPage&&e>0&&this.numPages>=e?this.fetchPage(e):void 0},nextPage:function(){return this.fetchPage(this.currentPage+1)},prevPage:function(){return this.fetchPage(this.currentPage-1)},updateTotalCountOnCollectionEvents:function(){this.on("add",function(){this.totalCount&&(this.totalCount+=1)},this),this.on("remove",function(){this.totalCount&&(this.totalCount-=1)},this)}}}),ABINEMASKME.define("duckbone/bindable_view",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.BindableView={isBindableView:!0,included:function(){this.hasViewLifecycleExtensions||a.include(this,a.ViewLifecycleExtensions)},bindAttributes:function(e){if(this.attributeChanges){e=e||this.model||new n.Model;for(var t in this.attributeChanges)this.bindAttribute(e,t,this.attributeChanges[t])}},bindAttribute:function(e,a,r){e=e||this.model||new n.Model;var s,o=i.Utils.escapeExpression(e.get(a));"function"==typeof r?(r.call(this,o),s=function(){r.call(this,i.Utils.escapeExpression(e.get(a)))}):"string"==typeof r&&(t(this.el).find(r).html(o),s=function(){t(this.el).find(r).html(i.Utils.escapeExpression(e.get(a)))}),this._attributeBindings=this._attributeBindings||[];var c="change:"+a;this._attributeBindings.push([e,c,s]),this.weakBindTo(e,c,s,this)},unbindAttributes:function(){this._attributeBindings&&(e(this._attributeBindings).each(function(e){e[0].unbind(e[1],e[2])}),delete this._attributeBindings)},bindLiveTimestamps:function(e){return},unbindLiveTimestamps:function(){}},i&&i.registerHelper("live_timestamp",function(e){var t=a.Handlebars.getAttr(this,e);if(!t)return"";var n=new Date(t);return n?new i.SafeString('<span data-live-timestamp="'+n.getTime()+'">'+a.helpers.dateToPrettyTimeAgo(n)+"</span>"):""})}),ABINEMASKME.define("duckbone/listable_view",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){function r(e){e.viewClass=e.options.viewClass||e.viewClass||new n.View}function s(e){e.collection=e.options.collection||e.collection||new n.Collection}a.ListableView={isListableView:!0,tagName:"ul",className:"listable_view",included:function(){this.hasViewLifecycleExtensions||a.include(this,a.ViewLifecycleExtensions),this.isBindableView||a.include(this,a.BindableView),this.isNestableView||a.include(this,a.NestableView)},render:function(e){return(!this._viewsRendered||e)&&(this.renderItems(),this.collectionEventsBound||(this.bindCollectionEvents(),this.collectionEventsBound=!0),this._viewsRendered=!0),this},createChildren:function(){return e.reduce(this.collection.models,function(e,t){return e[t.cid]=new this.viewClass({model:t,doc:this.doc}),e},{},this)},renderItems:function(){r(this),s(this),this.setupNestedViews();var t=document.createDocumentFragment();e.each(this.children,function(e){t.appendChild(e.el)}),this.el.appendChild(t)},bindCollectionEvents:function(e){var t;s(this),e=e||this.collectionEvents||o;for(var n in e){if(t=e[n],"string"==typeof t&&(t=this[t]),"function"!=typeof t)throw"Duckbone.ListableView.bindCollectionEvents() called with bad handler for "+n;this.weakBindTo(this.collection,n,t,this)}},refresh:function(e){e=e||{},this.empty(),this.collection.fetch()},getViewByModel:function(e){return this.children[e.cid]},collectionReset:function(){this.removeNestedViews(),this.render(!0)},collectionAdd:function(n){var i=new this.viewClass({model:n,doc:this.doc});this.children[n.cid]=i;var a=e(this.collection.models).indexOf(n);if(0==a)t(this.el).prepend(i.el);else{var r=t(this.el).children().eq(a-1);t(r).after(i.el)}},collectionRemove:function(e){this.children[e.cid].remove(),delete this.children[e.cid]}};var o={reset:"collectionReset",add:"collectionAdd",remove:"collectionRemove"}}),ABINEMASKME.define("duckbone/flashable_view",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.FlashableView={isFlashableView:!0,configureFlash:function(t){if(!t.container)throw"configureFlash called without a container";var n={noticeDuration:1e4,fadeDuration:300};this.flashOptions=e.extend(n,t),r.fadeDuration=this.flashOptions.fadeDuration,t.noticeTemplate&&"string"==typeof t.noticeTemplate?o.prototype.templateData=t.noticeTemplate:"function"==typeof t.noticeTemplate&&(o.prototype.template=t.noticeTemplate),t.errorTemplate&&"string"==typeof t.errorTemplate?FlashErrorView.prototype.templateData=t.errorTemplate:"function"==typeof t.errorTemplate&&(FlashErrorView.prototype.template=t.errorTemplate)},flashNotice:function(e,n){n=n||1e4;var i=new o({model:{message:e},duration:n});return t(this.flashOptions.container).append(i.el),t(i.el).hide().slideDown(300),i},flashAlert:function(e){var n=new c({model:{message:e}});return t(this.flashOptions.container).append(n.el),t(n.el).hide().slideDown(300),n},activeFlashes:function(){return t(this.flashOptions.container).find("div.flash_notice, div.flash_alert")},clearFlashes:function(e){if(this.flashOptions){var t=this.activeFlashes();e?t.remove():t.fadeOut(this.flashOptions.fadeDuration)}}};var r=n.View.extend({events:{"click a.close":"dismiss"},fadeDuration:300,dismiss:function(n){return n&&n.preventDefault(),t(this.el).fadeOut(this.fadeDuration),e.delay(e.bind(this.remove,this),this.fadeDuration),!1}});a.include(r.prototype,a.TemplateableView);var s='<div class="message">{{{message}}}</div>     <div class="close"><a href="#" class="close">X</a></div>',o=r.extend({className:"flash_notice",templateData:s,afterInitialize:function(){this.options.duration&&e.delay(e.bind(this.dismiss,this),this.options.duration)}}),c=r.extend({className:"flash_alert",templateData:s})}),ABINEMASKME.define("duckbone/bindable_field",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){function r(e,t,n,i){i=i||!1,"undefined"==typeof n&&(n=null),a.ModelHelpers.setOne.call(e,t,n,{silent:i})}a.BindableField={isBindableField:!0,get:function(){var e=this.domToModelTransform(t(this.el).val());return this.stripWhitespace&&this.options.stripWhitespace!==!1&&(e=e.replace(/^\s+|\s+$/g,"")),e},set:function(e){t(this.el).val(this.modelToDomTransform(e))},modelToDomTransform:function(e){return void 0!==e||0/0!==e?e:""},domToModelTransform:function(e){return e},bindToModel:function(e){if(e=e||this.options.modelAttribute||this.modelAttribute||this.options.name||this.name,!e)throw"Duckbone.BindableField.bindToModel() called without a modelAttribute";this.modelAttribute=e;var t=this,n=this.model,i="change:"+e;t.form.view.weakBindToModel(i,function(){var i=n.get(e);i!==t.get()&&a.ModelHelpers.isValidAttribute(i)&&t.set(i)}),t.set(n.get(e))},bindToDOM:function(e,n,i){if(e=e||this.options.modelAttribute||this.modelAttribute||this.options.name||this.name,!e)throw"Duckbone.BindableField.bindToDOM() called without a modelAttribute";this.modelAttribute=e;var n=this.options.changeEvent||this.changeEvent||"change";i=i||this.el;var a=this,s=this.model;t(i).bind(n,function(){r(s,e,a.get())}),r(s,e,a.get())}}}),ABINEMASKME.define("duckbone/validateable_field",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.ValidateableField={isValidateableField:!0,bindValidation:function(e,n){var i=this.options.validate||this.options.required;if(i){var a=this;e=e||this.options.validateEvent||"change",n=n||this.el;var r=t(window),s=null,o=function(){s=new Date},c=function(){r.unbind("mouseup",c),a.validate()};this.form.view&&this.form.view.isBindableView?this.form.view.weakBindTo(r,"mousedown",o):r.bind("mousedown",o),t(n).bind(e,function(){s&&10>new Date-s?r.bind("mouseup",c):a.validate()})}},validate:function(e,t){if(t=t||!1,t||this.clearErrors(),this.valid=!0,!this.options.validate&&this.options.required&&(this.options.validate="required",this.options.invalidMessage=this.options.invalidMessage||"Required"),e=e||this.options.validate,"string"==typeof e&&(e=a.forms.validators[e]),!e)return!0;var n=this.options.invalidMessage||"Invalid";if(0==e.call(this,this.get())&&(this.valid=!1),this.valid||t){var i=this.get();a.ModelHelpers.isValidAttribute(i)&&this.set(i)}else this.addError(n);return this.valid},addError:function(e){if(!this.errorList){this.errorList=t("<ul>").addClass("error");var n=t(this.el).parents("form").find("div."+this.name+"_errors").get(0);n?t(n).append(this.errorList):t(this.el).after(this.errorList)}this.errorList.append(t("<li>").html(e))},clearErrors:function(){this.errorList&&(this.errorList.remove(),this.errorList=null)}}}),ABINEMASKME.define("duckbone/form_fields",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core","abine/intl"],function(e,t,n,i,a,r){i.registerHelper("form",function(e,t){var n=e;return n=n.replace(/^(new_)(.*)/,"$2").replace(/^(edit_)(.*)/,"$2"),n!=e&&(n+=" "+e),'<form action="#" name="'+e+'" class="'+n+'">\n'+t(this)+"\n</form>"}),i.registerHelper("form_error_banner",function(e){return e="string"==typeof e?e:"mm_duckbone_default_form_error",e=r.getText(e),new i.SafeString('<div class="error_banner alert alert-error" style="display: none">'+i.Utils.escapeExpression(e)+"</div>")}),i.registerHelper("form_error",function(e){return new i.SafeString('<div class="'+i.Utils.escapeExpression(e)+'_errors"></div>')}),i.registerHelper("form_label",function(e,t){var n;return"object"==typeof t?(n=e,n=n.replace(/^(.)/,function(e){return e.toUpperCase()}),n=n.replace(/(\_[a-z])/g,function(e){return e.toUpperCase().replace("_"," ")})):n="function"==typeof t?new i.SafeString(t(this)):r.getText(t),new i.SafeString('<label data-field-name="'+i.Utils.escapeExpression(e)+'">'+i.Utils.escapeExpression(n)+"</label>")}),i.registerHelper("form_text",function(e){return new i.SafeString('<input class="form_text" type="text" name="'+i.Utils.escapeExpression(e)+'"/>')}),i.registerHelper("form_select",function(e){return new i.SafeString('<select class="form_select" name="'+i.Utils.escapeExpression(e)+'"></select>')}),i.registerHelper("form_radio_set",function(e){return new i.SafeString('<div class="form_radio_set" name="'+i.Utils.escapeExpression(e)+'"></div>')}),i.registerHelper("form_checkbox",function(e){return new i.SafeString('<input class="form_checkbox" type="checkbox" name="'+i.Utils.escapeExpression(e)+'"/>')}),i.registerHelper("form_textarea",function(e){return new i.SafeString('<textarea class="form_textarea" name="'+i.Utils.escapeExpression(e)+'"></textarea>')}),i.registerHelper("form_password",function(e){return new i.SafeString('<input class="form_password" type="password" name="'+i.Utils.escapeExpression(e)+'"></input>')}),i.registerHelper("form_submit",function(e,t){return"undefined"==typeof t&&(t="mm_duckbone_default_form_submit_text"),"object"==typeof t&&(t="mm_duckbone_default_form_submit_text"),t=r.getText(t),new i.SafeString('<button class="form_submit" name="'+i.Utils.escapeExpression(e)+'">'+i.Utils.escapeExpression(t)+"</button>")}),i.registerHelper("form_submit_with_spinner",function(e,t,n){n="object"==typeof n?"/pages/images/ajax_loader.gif":n,"undefined"==typeof t&&(t="mm_duckbone_default_form_submit_text"),"object"==typeof t&&(t="mm_duckbone_default_form_submit_text"),t=r.getText(t);var a='<button class="form_submit" name="'+i.Utils.escapeExpression(e)+'">'+i.Utils.escapeExpression(t)+"</button>";return a+='<img src="'+i.Utils.escapeExpression(n)+'" class="ajax_loading '+i.Utils.escapeExpression(e)+'_loading" style="display: none"/>',new i.SafeString(a)}),a.FormFieldBase=n.View.extend(),e.extend(a.FormFieldBase.prototype,a.BindableField,a.ValidateableField,{initialize:function(e){this.name=this.options.name||t(this.el).attr("name"),this.form=this.options.form,e.elAttributes&&t(this.el).attr(e.elAttributes),this.afterInitialize(e),this.createChildren(),this.bindToModel(),this.bindToDOM(),this.bindValidation()},afterInitialize:function(){},createChildren:function(){}}),a.TextFormField=a.FormFieldBase.extend({type:"text",stripWhitespace:!0}),a.SelectFormField=a.FormFieldBase.extend({type:"select",createChildren:function(){var e=this.options.selectOptions,n="function"==typeof e?e.call(this):e;for(var a in n){var r=t("<option></option>").attr({value:a});r.html(i.Utils.escapeExpression(n[a])),t(this.el).append(r)}}}),a.RadioSetFormField=a.FormFieldBase.extend({type:"radio_set",createChildren:function(){var e=this.options.selectOptions,n="function"==typeof e?e.call(this):e;for(var a in n){var r=this.form.name+"_"+this.name+"_"+a,s=t('<div><input type="radio"/><label for="'+r+'" class="radio_label"></label></div>');t(s).find("input").attr({id:r,name:this.name,value:a}),t(s).find("label").html(i.Utils.escapeExpression(this.options.selectOptions[a])),t(this.el).append(s)}var o=this.el;t(this.el).find("input").bind("change",function(){t(o).trigger("change")})},get:function(){return t(this.el).find("input:checked").attr("value")},set:function(e){var n=t(this.el).find("input:checked").get(0);n&&(n.checked=!1);var i=t(this.el).find('input[value="'+e+'"]').get(0);i&&(i.checked=!0)}}),a.CheckboxFormField=a.FormFieldBase.extend({type:"checkbox",get:function(){return t(this.el).is(":checked")},set:function(e){t(this.el).attr({checked:e})}}),a.TextAreaFormField=a.FormFieldBase.extend({type:"textarea",stripWhitespace:!0}),a.PasswordFormField=a.FormFieldBase.extend({type:"password"}),a.SubmitFormField=n.View.extend(),e.extend(a.SubmitFormField.prototype,a.BindableField,{type:"submit",initialize:function(n){this.form=n.form,this.name=n.name,this.spinnerEl=t(this.el).next("img.ajax_loading"),t(this.el).bind("click",e.bind(this.bindDisableAndSpin,this)),this.submitForm="undefined"==typeof n.submitForm?!0:n.submitForm},bindDisableAndSpin:function(e){e.preventDefault(),this.form.model.off("sync:create",this.disableAndSpin),this.form.model.off("sync:update",this.disableAndSpin),this.form.model.on("sync:create",this.disableAndSpin,this),this.form.model.on("sync:update",this.disableAndSpin,this),this.submitForm&&this.form.submit()},disableAndSpin:function(){this.form.model.off("sync:create",this.disableAndSpin),this.form.model.off("sync:update",this.disableAndSpin),this.spinnerEl&&t(this.spinnerEl).fadeIn(),t(this.el).addClass("loading"),t(this.el).unbind("click"),t(this.el).bind("click",this.stealClick),this.form.model.on("sync:complete",this.syncComplete,this)},stealClick:function(e){return e.preventDefault(),!1},syncComplete:function(){t(this.el).unbind("click"),t(this.el).removeClass("loading"),this.spinnerEl&&t(this.spinnerEl).fadeOut(),t(this.el).bind("click",e.bind(this.bindDisableAndSpin,this))}}),a.forms.fieldTypes={text:a.TextFormField,select:a.SelectFormField,radio_set:a.RadioSetFormField,checkbox:a.CheckboxFormField,textarea:a.TextAreaFormField,password:a.PasswordFormField,submit:a.SubmitFormField}}),ABINEMASKME.define("duckbone/editable_view",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){function r(e,t){for(var n in t){var i=e[t[n]];"function"==typeof i&&e.weakBindToModel(n,i,e)}}function s(e,t){return e.name+"_"+t.name}function o(e){return"[name="+e+"]"}function c(e){var n=/^form_(.*)/.exec(t(e).attr("class"))[1];return a.forms.fieldTypes[n]}function l(e){var n=t(e).offset().top;n=n>p?n-p:0,t("html body").animate({scrollTop:n},h,f)}a.EditableView={isEditableView:!0,included:function(){this.hasViewLifecycleExtensions||a.include(this,a.ViewLifecycleExtensions)},createForm:function(e){e=e||{};var i=e.el||t(this.el).find("form").get(0)||t(this.el).get(0),r=e.fields||this.options.fields||this.fields,s=e.model||this.model,o=new a.FormManager({el:i,fields:r,model:s||new n.Model,view:this});return this.form=this.form||o,o},bindModelSyncEvents:function(){r(this,u),this.modelSyncEvents&&r(this,this.modelSyncEvents)},cloneModelForEditing:function(){if(!this.model)throw"Found not, has your model been. Cloned, it can not be.";this.originalModel=this.model,this.model=this.originalModel.clone(),this.weakBindToModel("sync:success",function(){var t=e.clone(this.model.attributes);e(this.form.fields).each(function(e){e.options.temporary&&delete t[e.modelAttribute]}),this.originalModel.set(t),d.call(this)},this)},expireClone:function(){if(this.originalModel){this.model.clear({silent:!0});var e=function(){throw"Attempted get/set on expired clone from Duckbone.EditableView. Use original model instead."};this.model.set=e,this.model.get=e,this.model=this.originalModel,delete this.originalModel}},resetModel:function(){if(!this.originalModel)throw"Cloned not, has your model been. Reset, we can not do.";this.model.set(this.originalModel.attributes)},defaultModelSyncSavingHandler:function(){t(this.el).find("div.error_banner").hide(),e.each(this.form.fields,function(e){e.isValidateableField&&e.clearErrors()},this)},defaultModelSyncInvalidHandler:function(){t(this.el).find("div.error_banner").show(),e.each(this.model.errors,function(t,n){var i=this.form.getFieldForModelAttribute(n);e.each(this.model.errors[n],function(t){i&&i.isValidateableField?i.addError(t):e.log("Cannot add error for field "+n+": "+t)},this)},this),t(this.el).find("div.error_banner").show(),l(this.el)},defaultModelSyncSuccessHandler:function(){},defaultModelSyncErrorHandler:function(){},defaultModelSyncCompleteHandler:function(){}},a.FormManager=function(i){this.el=i.el||t('<form action="#"></form>').get(0),this.fieldOptions=e.clone(i.fields)||{},this.model=i.model||new n.Model({}),this.view=i.view,this.name=t(this.el).attr("name")||"untitled_form",this.createFields()},e.extend(a.FormManager.prototype,n.Events),e.extend(a.FormManager.prototype,{createFields:function(){var e,n,i=this;for(n in this.fieldOptions)e=this.createField(n,this.fieldOptions[n]);t(this.el).find("button.form_submit").each(function(){n=t(this).attr("name"),i.fields[n]||(e=new a.forms.fieldTypes.submit({name:n,el:this,form:i}),i.fields[e.name]=e)}),t(this.el).find("label").each(function(){var e=t(this).attr("data-field-name");e&&i.fields[e]&&t(this).attr("for",s(i,i.fields[e]))})},createField:function(n,i){this.fields=this.fields||{};var r,l,d;if(r=t(this.el).find(o(n)).get(0),!r)throw"Form field "+n+" defined in view, missing in template";if(l=i.type?a.forms.fieldTypes[i.type]:c(r),!l)throw"Bad form field type "+n;return d=new l(e.extend(i,{el:r,model:this.model,form:this,name:n})),d.name=n,t(d.el).attr("id",s(this,d)),this.fields[n]=d,d},getField:function(e){return this.fields[e]},getFieldForModelAttribute:function(t){return e.detect(this.fields,function(e){return e.modelAttribute==t},this)},validate:function(){this.isValid=!0;var e;for(var t in this.fields)e=this.fields[t].validate?this.fields[t].validate():!0,e||(this.isValid=!1);return this.isValid},submit:function(n){this.validate()?(n=e.clone(n)||{},e.each(["success","error"],function(t){if("function"==typeof n[t]){var i=n[t];n[t]=function(t,n){e.defer(e.bind(i,t,t,n))}}},this),this.model.save(null,n)):(e.log("Form is invalid."),t(this.el).find("div.error_banner").show(),l(this.el))}});var d=function(){var t=this.options.afterSaveDestination||this.afterSaveDestination;t&&(t instanceof Array||(t=[t]),e.each(t,function(e){if(e.collection)e.collection.add(this.originalModel);else{var t="set"+e.association.slice(0,1).toUpperCase()+e.association.slice(1);e.model[t].call(e.model,this.originalModel)}},this))},u={"sync:create":"defaultModelSyncSavingHandler","sync:update":"defaultModelSyncSavingHandler","sync:success":"defaultModelSyncSuccessHandler","sync:invalid":"defaultModelSyncInvalidHandler","sync:error":"defaultModelSyncErrorHandler","sync:complete":"defaultModelSyncCompleteHandler"},h=400,f="swing",p=100}),ABINEMASKME.define("duckbone/form_validations",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.forms=a.forms||{},a.forms.validators=a.forms.validators||{},e.extend(a.forms.validators,{required:function(e){return!(void 0==e||null==e||""==e)},USPhone:function(e){return/^\(?(\d{3})\)?[\- ]?\d{3}[\- ]?\d{4}$/.test(e)},date:function(e){return/^(?:0?[1-9]|1[0-2])\/(?:0?[1-9]|[12][0-9]|3[01])\/\d{2}?\d{2}$/.test(e)},email:function(e){return/^([A-Za-z0-9\._%\+\-]+)@([A-Za-z0-9\-]+\.)+([A-Za-z]{2,})$/.test(e)},numeric:function(e){return 0/0!=parseFloat(e)}})}),ABINEMASKME.define("duckbone/remoteable_view",["documentcloud/underscore","jquery","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i,a){a.RemoteableView={debounceRequest:500,initialize:function(){this.render=e.debounce(e.bind(this.serverSideRender,this),this.debounceRequest),this.model&&this.model.on("change",this.render),this.render()},serverSideRender:function(){if(!this.url)throw"Set url property on RemoteView to enable server-side rendering.";return"string"==typeof this.loading&&t(this.el).html(this.loading),t.ajax({url:this.url,dataType:"html",context:this,success:function(e){t(this.el).empty(),t(this.el).html(e)},error:function(){t(this.el).html("Error rendering from "+this.url)}}),this}}}),ABINEMASKME.define("duckbone/simple_queue",["documentcloud/underscore","documentcloud/backbone","wycats/handlebars","duckbone/core"],function(e,t,n,i){i.SimpleQueue=function(e){this.interval=e.interval||400,this.elements=[],this.callback=e.callback,this.running=!1},e.extend(i.SimpleQueue.prototype,{push:function(t){this.elements.push(t),this.comparator&&e(this.elements).sortBy(this.comparator),this.running||(this.running=!0,this.timer=setInterval(e.bind(this.shift,this),this.interval))},shift:function(){if(0==this.elements.length)this.running=!1,clearInterval(this.timer);else{var e=this.elements.shift();this.callback.call(e,e,this)}}})}),ABINEMASKME.define("duckbone/base_classes",["documentcloud/underscore","documentcloud/backbone","wycats/handlebars","duckbone/core","duckbone/security"],function(e,t,n,i){i.Model=t.Model.extend(),i.include(i.Model.prototype,i.AssociableModel,i.ModelHelpers,i.Syncable),i.Collection=t.Collection.extend(),i.include(i.Collection.prototype,i.CollectionHelpers,i.Syncable),i.View=t.View.extend(),i.include(i.View.prototype,i.TemplateableView,i.BindableView),i.FormView=i.View.extend(),i.include(i.FormView.prototype,i.EditableView),i.ListView=t.View.extend(),i.include(i.ListView.prototype,i.ListableView,i.BindableView),i.Application=t.Router.extend(),i.include(i.Application.prototype,i.RouteableApplication,i.FlashableView)}),ABINEMASKME.define("duckbone/security",["documentcloud/underscore","jquery","duckbone/core"],function(e,t,n){function i(e,t,n){if(!e._unlockHooked){e._unlockHooked=!0;var i=function(){a(e,t,n)};ABINEMASKME.App.on("unlocked",i),t.prototype._oldBeforeRemove=t.prototype.beforeRemove,t.prototype.beforeRemove=function(){t.prototype.beforeRemove=t.prototype._oldBeforeRemove,t.prototype.beforeRemove&&t.prototype.beforeRemove.apply(e,arguments),e._unlockHooked=!1,ABINEMASKME.App.off("unlocked",i)}}}function a(e,t,n){return ABINEMASKME.App.isLocked()?(i(e,t,n),e):(t.prototype._oldRender.apply(e,n),void 0)}function r(e,t){ABINEMASKME.App.isLocked()?ABINEMASKME.App.renderPage():e._oldRouteAction.apply(e,t)}n.Security={showBlankWhenLocked:function(e){e.prototype._oldRender=e.prototype.render,e.prototype.render=function(){a(this,e,arguments)}},showLoginWhenLocked:function(e){e._oldRouteAction=e.routeAction,e.routeAction=function(){r(e,arguments)}}}}),ABINEMASKME.requireDuckbone=function(e){ABINEMASKME.require(["duckbone/core","duckbone/model","duckbone/syncable","duckbone/collection","duckbone/routeable_application","duckbone/view_lifecycle_extensions","duckbone/handlebars_extensions","duckbone/idme_template_registry","duckbone/nestable_view","duckbone/templateable_view","duckbone/stylizeable_view","duckbone/pageable_view","duckbone/pageable_collection","duckbone/bindable_view","duckbone/listable_view","duckbone/flashable_view","duckbone/bindable_field","duckbone/validateable_field","duckbone/form_fields","duckbone/editable_view","duckbone/form_validations","duckbone/remoteable_view","duckbone/simple_queue","duckbone/base_classes"],function(){e()})},ABINEMASKME.define("abine/models/account",["models","documentcloud/underscore"],function(e,t){var n=e.BaseModel.extend({storageEntity:"account",initialize:function(){this.hasMany({accountFields:{collection:e.AccountFieldCollection,belongsTo:"account"},accountActivity:{collection:e.AccountActivityCollection,belongsTo:"account"},disposableEmails:{collection:e.DisposableEmailCollection,belongsTo:"account"},disposablePhones:{collection:e.DisposablePhoneCollection,belongsTo:"account"}}),this.hasOne({site:{model:e.Site}})},deleteExceptEmail:function(e){var t="delete:account:exceptEmail:"+this.getId();this.sync(t,this,{eventName:t,success:e.success,error:e.error})},getDomain:function(){return this.site.get("domain")},getId:function(){return this.get("id")},addAccountFieldValue:function(t,n){var i=new e.AccountField({accountId:this.getId(),dataType:t,value:n});i.save(),this.accountFields.add(i)},getAccountFieldValue:function(e){if(!this.accountFields||0==this.accountFields.length)return"";var t="";return this.accountFields.forEach(function(n){n.has("dataType")&&n.get("dataType")==e&&(t=n.get("value"))}),t},getEmail:function(){return this.getAccountFieldValue("/contact/email")},getUsername:function(){return this.getAccountFieldValue("/nameperson/friendly")},getPhone:function(){return this.getAccountFieldValue("/contact/phone")},getPassword:function(){return this.getAccountFieldValue("/password")},getLoginForAccount:function(){if(!this.accountFields||0===this.accountFields.length)return null;var e=null;return this.accountFields.forEach(function(t){!t.has("dataType")||"/contact/email"!=t.get("dataType")&&"/nameperson/friendly"!=t.get("dataType")||(e=t.get("value"))}),e},getAccountID:function(){return this.get("id")},prettyDateCreated:function(){return new Date(this.get("createdAt")).toString()},markDeleted:function(){this.save({deleted:1})},isFullyProtected:function(){var e=this,t=null;return t=e.accountFields.find(function(e){return e.isAnExposedEmail()||e.isAnExposedPhone()}),!t},isLoginAccount:function(){return"register"==this.attributes.type||"login"==this.attributes.type},isEmptyAccount:function(){return!this.accountFields||0==this.accountFields.length},isIncompleteAccount:function(){return this.accountFields.length>0&&4>this.accountFields.length},emailExposed:function(){var e=this,t=null;return t=e.accountFields.find(function(e){return e.isAnExposedEmail()})},phoneExposed:function(){var e=this,t=null;return t=e.accountFields.find(function(e){return e.isAnExposedPhone()})},passwordReused:function(){var e=this;t.async.detect(e.accountFields.models,function(t){t.has("dataType")&&"/password"===t.get("dataType")&&e.sync("read",e,{eventName:"read:account:passwords:"+t.get("id"),success:function(t){e.hasAReusedPassword=t.timesReused,e.totalPasswordUses=t.timesReused+1},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/account]#[passwordReused]# error event in model.sync eventName: read:account:passwords:id")}})},function(e){return"undefined"!=typeof e})},fieldIsAnExposedEmail:function(e){return e.isAnExposedEmail()},fieldIsAnExposedPhone:function(e){return e.isAnExposedPhone()}}),i=e.BaseCollection.extend({model:n,fetchAllForPrinting:function(e){e=e||function(){},this.fetch({reset:!0,eventName:"read:account:all:login,register,fill",success:t.bind(function(t){for(var n=[],i=0;this.length>i;i++)(this.models[i].isTrue("deleted")||this.models[i].site.isTrue("blacklisted"))&&n.push(t[i]);this.remove(n),e()},this),error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/account]#[fetchAllForPrinting]# error event in model.fetch eventName: read:account:all:login,register"),e()}})},comparator:function(e){return-1*new Date(e.get("modifiedAt")).getTime()}});return e.Account=n,e.AccountCollection=i,{Account:n,AccountCollection:i}}),ABINEMASKME.define("abine/models/accountActivity",["documentcloud/underscore","models"],function(e,t){var n=t.BaseModel.extend({storageEntity:"accountActivity",highlighted:!1,initialize:function(){this.hasOne({account:{model:t.Account}}),this.hasOne({accountField:{model:t.AccountField}})},getDomain:function(){return this.account.site.get("domain")},getId:function(){return this.get("id")},getLogin:function(){return this.account.getLoginForAccount()||"this account"},getSiteId:function(){return this.account.site.get("id")},getIcon:function(){var e={"new login":"icon-user","new register":"icon-user",login:"icon-home","disposable email":"icon-envelope","disposable phone":"icon-bell","primary email":"icon-envelope","primary phone":"icon-bell","strong password":"icon-lock","update password":"icon-lock",update:"icon-ok","reused password":"icon-lock"};return e[this.get("activityType")]},getDescriptionForType:function(e){var t="";return"new login"==e?t+="MaskMe stored your account.":"new register"==e?t+="MaskMe stored your registration.":"login"==e?t+="Logged in.":"disposable email"==e?t+="Good! You masked your email.":"disposable phone"==e?t+="Good! You masked your phone.":"primary email"==e?t+="You disclosed your real email address.":"primary phone"==e?t+="You disclosed your real phone number.":"strong password"==e?t+="Good! You used a unique password.":"update password"==e?t+="MaskMe updated the stored password for this account.":"update"==e?t+="MaskMe updated the stored information for this account.":"life easier"==e?t+="Next time you login, we'll make your life easier!":"reused password"==e&&(t+="You have reused this password on other sites"),t},getHighlightedClass:function(){return this.get("highlighted")?"highlighted":""},getProtectedClass:function(){var e=this.get("protectionLevel");return 2==e?"fullyProtected":1==e?"partlyProtected":"notProtected"},getExtraActivities:function(){var e=this.get("extraActivityTypes");if(e){for(var t=[],n=e.split(","),i=0;n.length>i;i++)t.push(this.getDescriptionForType(n[i]));return t}return[]},getPrettyDescription:function(){var e=this.get("activityType");return this.getDescriptionForType(e)}}),i=t.BaseCollection.extend({model:n,initialize:function(){this.cid=e.uniqueId();var t=this;this.debouncedRefetcher=e.debounce(function(){t.fetchAll()},500),this.messenger=this.getMessenger()},bindBroadcasts:function(){this.messenger.on("broadcast:accountActivity:new",this.debouncedRefetcher,this)},unbindBroadcasts:function(){this.messenger.off("broadcast:accountActivity:new",this.debouncedRefetcher)},comparator:function(e){return new Date-new Date(e.get("createdAt"))}});return t.AccountActivity=n,t.AccountActivityCollection=i,{AccountActivity:n,AccountActivityCollection:i}}),ABINEMASKME.define("abine/models/accountField",["documentcloud/underscore","models"],function(e,t){var n={"/nameperson/friendly":{title:"Username",icon:"icon-user"},"/contact/email":{title:"Email address",icon:"icon-envelope"},"/contact/phone":{title:"Phone number",icon:"icon-bell"},"/password":{title:"Password",icon:"icon-lock"}},i=t.BaseModel.extend({storageEntity:"accountField",initialize:function(){this.hasOne({account:{model:t.Account}})},markDeleted:function(){this.save({deleted:1})},numReused:function(){return this.attributes.reuse?this.attributes.reuse.length:1},getDomain:function(){return this.attributes.site&&this.attributes.site.domain?this.attributes.site.domain:"Unknown"},getId:function(){return this.get("id")},deleteAccount:function(e){e=e||{},this.sync("delete",this,{eventName:"delete:accountField:account:"+this.attributes.accountId,success:e.success,error:e.error})},deleteVersioned:function(e){e=e||{},this.sync("delete",this,{eventName:"delete:accountField:version:"+this.getId(),success:e.success,error:e.error})},prettyFieldName:function(){var e=this.get("dataType");return e&&n[e]?n[e].title:"Unknown field"},getIcon:function(){var e=this.get("dataType");return e&&n[e]?n[e].icon:"icon-question-sign"},getProtectionClass:function(){var e=this.get("dataType");return this.exposed="/password"===e?this.account.hasAReusedPassword?"field-exposed":"field-protected":"/contact/email"===e?"disposable"!==this.get("origin")?"field-exposed":"field-protected":"/contact/phone"===e?"disposable"!==this.get("origin")?"field-exposed":"field-protected":"field-neutral",this.exposed
},isAnExposedEmail:function(){return"/contact/email"===this.get("dataType")&&"disposable"!==this.get("origin")},isAnExposedPhone:function(){return"/contact/phone"===this.get("dataType")&&"disposable"!==this.get("origin")},isUnique:function(){return this.attributes.reuse?1==this.attributes.reuse.length?!0:!1:!0},getExposedTip:function(){return"Use protection to gain control over your personal info!"},getReuseTip:function(){return this.attributes.reuse?this.attributes.reuse.join("<br/>"):void 0},getProtectionTip:function(){var e=this.getProtectionClass(),t=this.get("dataType");return"/password"===t?"field-exposed"===e?"This password is not unique. You have used it "+this.account.totalPasswordUses+" times.":"This password is unique!":"/contact/email"===t?"field-exposed"===e?this.account.site.get("name")+" may share your email with third parties. We suggest changing your account's contact email to a masked email.":"This email is masked!":"/contact/phone"===t?"field-exposed"===e?this.account.site.get("name")+" may share your phone with third parties. We suggest changing your account's contact phone to a masked phone.":"This phone is masked!":""},safeFieldValue:function(){return"/password"!==this.get("dataType")||this.shownPassword?this.get("value"):"&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;"},canBeDeleted:function(){return 1!==this.get("latest")||this.attributes.accountType in{fill:1,passwordless:1}}}),a=t.BaseCollection.extend({model:i,sanitizeForAccountView:function(){this.removeRedundantPasswords(),this.removeRedundantEmails(),this.removeUnwantedFields()},removeRedundantPasswords:function(){var e=!1,t=this.filter(function(t){if("/password"===t.get("dataType")){if(e)return!0;e=!0}return!1});this.remove(t)},removeRedundantEmails:function(){var e={},t=this.filter(function(t){if("/contact/email"===t.get("dataType")){var n=t.get("value");if(e[n])return!0;e[n]=n}return!1});this.remove(t)},removeUnwantedFields:function(){var e=this.filter(function(e){return!n[e.get("dataType")]});this.remove(e)},comparator:function(e){return"/nameperson/friendly"==e.get("dataType")?1:"/contact/email"==e.get("dataType")?2:"/password"==e.get("dataType")?3:"/contact/phone"==e.get("dataType")?4:5}});return t.AccountField=i,t.AccountFieldCollection=a,{AccountField:i,AccountFieldCollection:a}}),ABINEMASKME.define("abine/models/base",["abine/contentMessenger","documentcloud/backbone","duckbone/core","models"],function(e,t,n,i){var a,r=function(){return a=a||new e.ContentMessenger({eventAggregator:ABINEMASKME.eventAggregator||window.eventAggregator})},s=function(e,t,n){r();var i,s,o,c={};!t||"create"!=e&&"update"!=e||(c=t.toJSON()),n.eventName?i=n.eventName:(i=t.model?e+":"+t.model.storageEntity:e+":"+t.storageEntity,"create"!=e&&(i+=":"+t.id)),s="response:"+i.split(":").slice(1).join(":"),o="error:"+i.split(":").slice(1).join(":");var l=function(e){a.off(s,l),a.off(o,d),delete t.errors,n.success.call(t,e,200,null),t.trigger("sync:success",e)},d=function(e){a.off(o,d),a.off(s,l),delete t.errors,n.error.call(t,e,500,null),t.trigger("sync:error",e)};a.on(s,l,t),a.on(o,d,t),t.trigger("sync:"+e.toLowerCase()),a.send(i,c)},o=function(e){var t=this.get(e);return"1"===t||"true"===t||t===!0||1===t?!0:!1},c=function(e){return!o(e)},l=t.Model.extend({sync:s,getMessenger:r,isTrue:o,isFalse:c});n.include(l.prototype,n.AssociableModel,n.ModelHelpers);var d=t.Collection.extend({sync:s,getMessenger:r,fetchAll:function(e){e=e||{},e.eventName=["read",this.model.prototype.storageEntity,"all"].join(":"),this.fetch(e)}});return n.include(d.prototype,n.CollectionHelpers),i.BaseModel=l,i.BaseCollection=d,{BaseModel:l,BaseCollection:d}}),ABINEMASKME.define("abine/models/disposableCard",["models","abine/eventLogger"],function(e,t){var n=e.BaseModel.extend({storageEntity:"disposableCard",initialize:function(){},deactivateCard:function(e){e.eventName="update:disposableCard:deactivate:"+this.get("id"),this.sync("update",this,e)},isGift:function(){return this.isTrue("gift")},getRecipientEmail:function(){return this.get("recipient_email")},isActive:function(){return this.isTrue("active")},isRefunded:function(){return this.isTrue("refunded")},getID:function(){return this.id},getGUID:function(){return this.get("guid")},getAmountRefunded:function(){return"$"+(this.get("amount_refunded")/100).toFixed(2)},getOriginalValue:function(){return"$"+(this.get("original_amount")/100).toFixed(2)},getCardDetails:function(){return this.getCardNumber()+" - "+this.getExpiry()},getLastFour:function(){return this.get("number").substr(this.get("number").length-4)},getCardNumber:function(){return this.get("number")},getSeparatedCardNumber:function(){var e=this.get("number");return 16==e.length?e.substring(0,4)+" "+e.substring(4,8)+" "+e.substring(8,12)+" "+e.substring(12,16):e},getType:function(){return this.get("type").toLowerCase()},getPrettyNumber:function(){for(var e="",t=0;this.get("number").length>t;t++)e+=this.get("number").charAt(t),3==t%4&&(e+="  ");return e},getCVC:function(){return this.get("cvc")},getExpiry:function(){var e=parseInt(this.get("expiry_month"));return 10>e&&(e="0"+e),e+"/"+this.get("expiry_year")},getLabel:function(){var e=this.get("label");return e&&e.length>15&&(e=e.substr(0,12)+"..."),e},getProtectedNumber:function(){var e=this.get("number")+"";return e.substr(0,e.length-12).replace(/./g,"x")+e.substr(e.length-4)},getProtectedVerification:function(){var e=this.get("verification")+"";return e.substr(0,e.length-1).replace(/./g,"x")+e.substr(e.length-1)},toggleDisposable:function(){this.save({active:1===this.get("active")?0:1})}});n.convertStringToCents=function(e){return parseFloat(e).toFixed(2).toString().replace(".","")};var i=e.BaseCollection.extend({model:n,fetchAllLocal:function(e){e=e||{},"undefined"==typeof e.reset&&(e.reset=!0),e.eventName=["read",this.model.prototype.storageEntity,"allLocal"].join(":"),this.fetch(e)},fetchAllBySite:function(e){this.sync("read",this,{eventName:"read:disposableCard:site:"+e,success:function(e){this.reset(e)},error:function(){t.error("[ERROR HANDLER][abine/models/disposableCard][fetchAllBySite]: error event in model.sync event: read:disposableCard:site:id")}})},fetchAllFromServer:function(e){this.sync("read",this,{eventName:"read:disposableCard:server",success:function(t){this.reset(t),e.success(t)},error:function(){e.error(),true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/disposableCard]#[fetchAllFromServer]# error event in model.sync eventName: read:disposableCard:server")}})},fetchAllByDomain:function(e,t){e&&(e=e.replace(":","::")),this.sync("read",this,{eventName:"read:disposableCard:domain:"+e,success:function(e){this.reset(e),t()},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/disposableCard]#[fetchAllByDomain]# error event in model.sync eventName: read:disposableCard:domain:domain")}})},comparator:function(e){return new Date-new Date(e.get("createdAt"))}});return e.DisposableCard=n,e.DisposableCardCollection=i,{DisposableCard:n,DisposableCardCollection:i}}),ABINEMASKME.define("abine/models/disposableEmail",["models","documentcloud/underscore"],function(e,t){var n=e.BaseModel.extend({storageEntity:"disposableEmail",highlighted:!1,initialize:function(){this.hasOne({account:{model:e.Account}})},getId:function(){return this.get("id")},hasWebmail:function(){return this.has("webmails")&&this.get("webmails").length>0?!0:!1},getWebmailCount:function(){return this.hasWebmail()?this.get("webmails").length:0},hasAccount:function(){return this.has("accountId")&&""!=this.get("accountId")&&this.account?t.any(this.account.accountFields.models,function(e){return e.get("value")==this.getAddress()},this):!1},getAddress:function(){return this.get("user")+"@"+this.get("domain")},getHighlightedClass:function(){return this.get("highlighted")?"highlighted":""},noConnectionError:function(){return!this.get("err")},isActive:function(){return 1==this.get("active")},toggleDisposable:function(e){this.save({active:1==this.get("active")?0:1},e)},needsTruncation:function(){var e=this.getDomain();return e.length>20},getTruncatedDomain:function(){var e=this.getDomain();return e.substring(0,20)+"..."},getDomain:function(){return this.attributes.label?this.attributes.label:"Unknown"}}),i=e.BaseCollection.extend({model:n,interestedBroadcasts:/broadcast:saveForm:(new|update)/i,initialize:function(){this.messenger=this.getMessenger()},totalWebmails:function(){return t.reduce(this.models,function(e,t){return e+t.getWebmailCount()},0)},fetchAllLocal:function(e){e=e||{},"undefined"==typeof e.reset&&(e.reset=!0),e.eventName=["read",this.model.prototype.storageEntity,"allLocal"].join(":"),this.fetch(e)},fetchAllBySite:function(e){this.sync("read",this,{eventName:"read:disposableEmail:site:"+e,success:function(e){this.reset(e)},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/disposableEmail]#[fetchAllBySite]# error event in model.sync eventName: read:disposableEmail:site:id")}})},fetchAllFromServer:function(e){this.sync("read",this,{eventName:"read:disposableEmail:server",success:function(t){this.reset(t),e()},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/disposableEmail]#[fetchAllFromServer]# error event in model.sync eventName: read:disposableEmail:server")}})},fetchAllByDomain:function(e,t){e&&(e=e.replace(":","::")),this.sync("read",this,{eventName:"read:disposableEmail:domain:"+e,success:function(e){this.reset(e),t()},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/disposableEmail]#[fetchAllByDomain]# error event in model.sync eventName: read:disposableEmail:domain:domain")}})},comparator:function(e){return new Date-new Date(e.get("createdAt"))}});return e.DisposableEmail=n,e.DisposableEmailCollection=i,{DisposableEmail:n,DisposableEmailCollection:i}}),ABINEMASKME.define("abine/models/disposablePhone",["models"],function(e){var t=e.BaseModel.extend({storageEntity:"disposablePhone",initialize:function(){this.hasOne({account:{model:e.Account}})},getCountryCode:function(){return this.get("country_code")||"1"},getAreaCode:function(){return this.get("number").substr(0,3)},getExchange:function(){return this.get("number").substr(3,3)},getLocal:function(){return this.get("number").substr(6,4)},getPrettyNumber:function(){return this.isNorthAmericaFormat()?"("+this.getAreaCode()+") "+this.getExchange()+"-"+this.getLocal():this.get("number")},getFullPrettyNumber:function(){return this.isNorthAmericaFormat()?"+"+this.getCountryCode()+" ("+this.getAreaCode()+") "+this.getExchange()+"-"+this.getLocal():"+"+this.getCountryCode()+" "+this.get("number")},isNorthAmericaFormat:function(){return"1"==this.getCountryCode()},isSuspended:function(){return"true"==this.get("isSuspended")},toggleDisposable:function(){this.save({active:1===this.get("active")?0:1})}}),n=e.BaseCollection.extend({model:t,fetchAllBySite:function(e){this.sync("read",this,{eventName:"read:disposablePhone:site:"+e,success:function(e){this.reset(e)},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/disposablePhone]#[fetchAllBySite]# error event in model.sync event: read:disposablePhone:site:id")}})}});return e.DisposablePhone=t,e.DisposablePhoneCollection=n,{DisposablePhone:t,DisposablePhoneCollection:n}}),ABINEMASKME.define("abine/models/phoneLog",["documentcloud/underscore","models","jquery"],function(e,t){var n=t.BaseModel.extend({storageEntity:"phoneLog",initialize:function(){var e=this.attributes.updated_at,t=e.split("T"),n=t[0].split("-"),i=t[1].split("Z")[0].split(":"),a=n[0],r=parseInt(n[1],10),s=parseInt(n[2],10),o=parseInt(i[0],10),c=parseInt(i[1],10),l=parseInt(i[2],10),d=Date.UTC(a,r-1,s,o,c,l,0);this.attributes.updated_at=new Date(d)},isAllowed:function(){return"true"==this.get("is_allowed")||1==this.get("is_allowed")},toggleActive:function(e){this.save({is_allowed:!this.isAllowed()},e)},setLabel:function(e){this.save({label:e})}}),i=t.BaseCollection.extend({model:n,initialize:function(){}});return t.PhoneLog=n,t.PhoneLogCollection=i,{PhoneLog:n,PhoneLogCollection:i}}),ABINEMASKME.define("abine/models/preference",["documentcloud/underscore","models"],function(e,t){var n=t.BaseModel.extend({storageEntity:"preference",initialize:function(){},forPreferencesPage:function(){return this.get("description")},isBlacklist:function(){return"rememberAccounts"===this.get("key")},parse:function(e){return"true"==e.value?e.value=!0:"false"==e.value&&(e.value=!1),e},toJSON:function(){var t=e.clone(this.attributes);return t.value===!0?t.value="true":t.value===!1&&(t.value="false"),t}}),i=t.BaseCollection.extend({model:n,interestedBroadcasts:/broadcast:preference:reload/i,parse:function(t){return e(t).map(function(e){return"true"==e.value?e.value=!0:"false"==e.value&&(e.value=!1),e})},restoreDefaults:function(t){this.sync("update",this,{eventName:"update:preference:restore",success:e.bind(function(e){this.reset(this.parse(e)),t()},this),error:function(e){t(e)}})},getPrefFromStorage:function(t,i){this.sync("read",this,{eventName:"read:preference:name:"+t,success:function(t){e.isArray(t)&&0===t.length?i(null):e.isObject(t)?i(new n(t)):i(null)},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/preference]#[getPrefFromStorage]# error event in model.sync eventName: read:preference:name:key"),i(null)}})},isPrefTrue:function(t){var n=e(this.models).find(function(e){return e.get("key")===t});return n?n.isTrue("value"):!1},getPref:function(t){var n=e(this.models).find(function(e){return e.get("key")===t});return n?n.get("value"):null},setPref:function(t,n){var i=e(this.models).find(function(e){return e.get("key")===t});i.save({value:n})},hasPref:function(t){var n=e(this.models).find(function(e){return e.get("key")===t});return!!n},fetchAllForPreferencesPage:function(e){e=e||function(){},this.sync("read",this,{eventName:"read:preference:prefspage",success:function(t){this.reset(this.parse(t)),e.call(this)},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/preference]#[fetchAllForPreferencesPage]# error event in model.sync eventName: read:preference:prefspage"),e.call(null)}})}});return t.Preference=n,t.PreferenceCollection=i,{Preference:n,PreferenceCollection:i}}),ABINEMASKME.define("abine/models/formData",["documentcloud/underscore","models"],function(e,t){var n=t.BaseModel.extend({storageEntity:"formData",initialize:function(){}}),i=t.BaseCollection.extend({model:n,initialize:function(){}});return t.FormData=n,t.FormDataCollection=i,{FormData:n,FormDataCollection:i}}),ABINEMASKME.define("abine/models/mappedForm",["documentcloud/underscore","models"],function(e,t){var n=t.BaseModel.extend({storageEntity:"mappedForm",initialize:function(){this.hasMany({fields:{collection:t.MappedFieldCollection}})},searchSignature:function(t){this.sync("read",this,{eventName:"read:mappedForm:signature:"+this.get("signature"),success:e.bind(function(e){e?(this.set(e),t()):t(!0)},this),error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/mappedForm]#[searchSignature]# error event in searchSignature"),t(!0)}})}}),i=t.BaseCollection.extend({model:n,initialize:function(){},fetchAllByDomain:function(e,t){e&&(e=e.replace(":","::")),this.sync("read",this,{eventName:"read:mappedForm:site:"+e,success:function(e){this.reset(e),t()},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/mappedForm]#[fetchAllByDomain]# error event in read:mappedForm:site:domain"),t(!0)}})}});return t.MappedForm=n,t.MappedFormCollection=i,{MappedForm:n,MappedFormCollection:i}}),ABINEMASKME.define("abine/models/mappedField",["documentcloud/underscore","models"],function(e,t){var n=t.BaseModel.extend({storageEntity:"mappedField",initialize:function(){}}),i=t.BaseCollection.extend({model:n,initialize:function(){}});return t.MappedField=n,t.MappedFieldCollection=i,{MappedField:n,MappedFieldCollection:i}}),ABINEMASKME.define("abine/models/shieldedCard",["models","documentcloud/underscore","abine/eventLogger"],function(e){var t=e.BaseModel.extend({storageEntity:"shieldedCard",interestedBroadcasts:/broadcast:billinginfo:updated/i,generateDisposable:function(){return new e.DisposableCard({shielded_card_id:this.get("id")})},getName:function(){return this.get("first_name")+" "+this.get("last_name")},getExpiry:function(){return parseInt(this.get("month"))+" / "+parseInt(this.get("year"))},getFirstName:function(){return this.get("first_name").toUpperCase()},getLastName:function(){return this.get("last_name").toUpperCase()},getLastFour:function(){return this.get("last_four")},getProtectedNumber:function(){if(!this.get("number"))return"---";var e=this.get("number")+"";return e.substr(0,e.length-4).replace(/./g,"x")+e.substr(e.length-4)},getProtectedVerification:function(){if(!this.get("number"))return"---";var e=this.get("verification")+"";return e.substr(0,e.length-1).replace(/./g,"x")+e.substr(e.length-1)}}),n=e.BaseCollection.extend({model:t,getPrimaryCardName:function(){return this.models.length>0?this.models[0].getFirstName+" "+this.models[0].getLastName():""},getPrimaryCardLastFour:function(){return this.models.length>0?this.models[0].getLastFour():""},getPrimaryCardExpiry:function(){return this.models.length>0?this.models[0].get:""}});return e.ShieldedCard=t,e.ShieldedCardCollection=n,{ShieldedCard:t,ShieldedCardCollection:n}}),ABINEMASKME.define("abine/models/shieldedEmail",["models"],function(e){var t=e.BaseModel.extend({storageEntity:"shieldedEmail",generateDisposable:function(t){return new e.DisposableEmail({targetGuid:this.get("guid"),label:t})},getAddress:function(){return this.get("email")},isValidated:function(){return 1==this.get("active")},resendValidationEmail:function(e){this.sync("update",this,{eventName:"update:shieldedEmail:resendValidationEmail:"+this.get("id"),success:function(t){e(t)},error:function(t){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/shieldedEmail]#[resendValidationEmail]# error event in model.sync eventName: update:shieldedEmail:resendValidationEmail:id"),e(t)}})}}),n=e.BaseCollection.extend({model:t,interestedBroadcasts:/broadcast:register:success/i});return e.ShieldedEmail=t,e.ShieldedEmailCollection=n,{ShieldedEmail:t,ShieldedEmailCollection:n}}),ABINEMASKME.define("abine/models/shieldedPhone",["models","documentcloud/underscore"],function(e){var t=e.BaseModel.extend({storageEntity:"shieldedPhone",generateDisposable:function(){return new e.DisposablePhone({shielded_phone_id:this.get("id")})},hasNumber:function(){return this.has("number")&&""!=this.get("number")?!0:!1},registerNumber:function(e){this.sync("create",this,{eventName:"create:shieldedPhone",success:e.success,error:e.error})},verifySecret:function(e){this.sync("update",this,{eventName:"update:shieldedPhone:secret",success:e.success,error:e.error})},getCountryCode:function(){return this.get("country_code")||"1"},getAreaCode:function(){return this.get("number").substr(0,3)},getExchange:function(){return this.get("number").substr(3,3)},getLocal:function(){return this.get("number").substr(6,4)},getPrettyNumber:function(){return this.isNorthAmericaFormat()?"("+this.getAreaCode()+") "+this.getExchange()+"-"+this.getLocal():this.get("number")},getFullPrettyNumber:function(){return this.isNorthAmericaFormat()?"+"+this.getCountryCode()+" ("+this.getAreaCode()+") "+this.getExchange()+"-"+this.getLocal():"+"+this.getCountryCode()+" "+this.get("number")},isNorthAmericaFormat:function(){return"1"==this.getCountryCode()},isTextAllowed:function(){return this.getCountryCode()in{1:1,44:1}},isValidated:function(){return"true"==this.get("is_validated")}}),n=e.BaseCollection.extend({model:t});return e.ShieldedPhone=t,e.ShieldedPhoneCollection=n,{ShieldedPhone:t,ShieldedPhoneCollection:n}}),ABINEMASKME.define("abine/models/site",["documentcloud/underscore","models"],function(e,t){var n=t.BaseModel.extend({storageEntity:"site",initialize:function(){this.hasMany({accounts:{collection:t.AccountCollection,belongsTo:"site"}}),this.messenger=this.getMessenger()},getHistory:function(e){this.sync("read",this,{eventName:"read:site:history:"+this.get("id"),success:function(t){e(t)},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/site]#[getHistory]# error event in model.sync eventName: read:site:history:id"),e(null)}})},filledAccountForSite:function(t,n){this.messenger.on("broadcast:filledAccount:rolledback",e.bind(function(){this.messenger.off("broadcast:filledAccount:rolledback"),n()},this)),this.messenger.send("contentManager:filledAccount",{accountId:t})},getDomain:function(){return this.get("domain")},getId:function(){return this.get("id")},blacklist:function(e){var t=this.get("domain");t&&(t=t.replace(":","::"));var n="update:site:blacklist:domain:"+t;this.sync(n,this,{eventName:n,success:e.success,error:e.error})},loadAccounts:function(e,t){var n=this,i=e?"create":"read",a=this.get("domain");a&&(a=a.replace(":","::"));var r=i+":site:domain:"+a;this.sync(i,this,{eventName:r,success:function(e){n.set(e),t(null)},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/site]#[loadAccounts]# error event in model.sync eventName: create/read:site:domain:domain"),n.accounts.reset([]),t("No site, so no accounts")}})},getExposedTip:function(){return"Use protection to gain control over your personal info!"},hasNothingExposed:function(){var e=this.attributes.privacyStatus;return e?0===e.badEmails.length&&0===e.badPhones.length:null},hasNothingProtected:function(){var e=this.attributes.privacyStatus;return e?0===e.goodEmails.length&&0===e.goodPhones.length:null},hasGoodEmail:function(){var e=this.attributes.privacyStatus;return e?e.goodEmails.length>0:null},hasGoodPhone:function(){var e=this.attributes.privacyStatus;return e?e.goodPhones.length>0:null},hasReusedPassword:function(){var t=this.attributes.privacyStatus;return t?e(t.passwords).find(function(e){return e.reuse.length>1}):null},isFullyProtected:function(){var e=this.accounts.find(function(e){return!e.isFullyProtected()});return!e},emailExposed:function(){var e=this.accounts.find(function(e){return e.emailExposed()});return e},phoneExposed:function(){var e=this.accounts.find(function(e){return e.phoneExposed()});return e},anyLogins:function(){return this.accounts.find(function(e){return"login"===e.get("type")})},hasAccounts:function(){return this.accounts&&this.accounts.length>0}}),i=t.BaseCollection.extend({model:n,initialize:function(){this.messenger=this.getMessenger()}}),a=t.BaseCollection.extend({model:n,initialize:function(){this.messenger=this.getMessenger()},fetchAllForBlacklistedPage:function(e){e=e||function(){},this.sync("read",this,{eventName:"read:site:blacklisted",success:function(t){this.reset(this.parse(t)),e.call(this)},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/site]#[fetchAllForBlacklistedPage]# error event in model.sync eventName: read:site:blacklisted"),e.call(null)}})},fetchForIsBlacklisted:function(e){e=e||function(){},this.sync("read",this,{eventName:"read:site:blacklisted",success:function(t){this.reset(this.parse(t)),e.call(this)},error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/site]#[fetchForIsBlacklisted]# error event in model.sync eventName: read:site:blacklisted"),e.call(null)}})},loadBlacklistedForDomain:function(t,n){this.fetchForIsBlacklisted(function(){var i=e.any(this.models,function(e){return e.get("domain")===t})||!1;n(i)})}}),r={protectedPhones:"totalPhones",protectedEmails:"totalEmails",uniquePasswords:"totalPasswords"},s=t.BaseModel.extend({defaults:{protectedPhones:0,protectedEmails:0,uniquePasswords:0,totalPhones:0,totalEmails:0,totalPasswords:0},initialize:function(e){this.sites=e.sites,this.sites.bind("sync:success",function(){this.computeStats()},this)},computeStats:function(){var e={protectedPhones:0,protectedEmails:0,uniquePasswords:0,totalPhones:0,totalEmails:0,totalPasswords:0};this.sites.forEach(function(t){var n=t.get("protections");n&&(e.protectedPhones+=n.totalPhones&&n.phone?1:0,e.protectedEmails+=n.totalEmails&&n.email?1:0,e.uniquePasswords+=n.totalPasswords&&n.password?1:0,e.totalPhones+=n.totalPhones,e.totalEmails+=n.totalEmails,e.totalPasswords+=n.totalPasswords)}),this.set(e)},getProtectionRatio:function(e){var t=r[e];return this.get(t)?this.get(e)/this.get(t):1}});return t.Site=n,t.SiteCollection=i,t.BlacklistedSiteCollection=a,t.SiteStatistics=s,{Site:n,SiteCollection:i,SiteStatistics:s}}),ABINEMASKME.define("abine/models/user",["documentcloud/underscore","models","abine/config","abine/proxies","abine/responseCodes","abine/intl"],function(e,t,n,i,a,r){function s(){}var o=t.BaseModel.extend({initialize:function(){this.messenger=this.getMessenger(),this.hasMany({preferences:{collection:t.PreferenceCollection},shieldedEmails:{collection:t.ShieldedEmailCollection},shieldedPhones:{collection:t.ShieldedPhoneCollection},shieldedCards:{collection:t.ShieldedCardCollection},disposableCards:{collection:t.DisposableCardCollection},disposableEmails:{collection:t.DisposableEmailCollection},disposablePhones:{collection:t.DisposablePhoneCollection},sites:{collection:t.SiteCollection}}),this.hasOne({shieldedEmail:{model:t.ShieldedEmail},shieldedPhone:{model:t.ShieldedPhone},shieldedCard:{model:t.ShieldedCard},disposablePhone:{model:t.DisposablePhone}}),this.shieldedEmails.bind("sync:success",e.bind(function(){var e=this.shieldedEmails.at(0);this.setShieldedEmail(e?e.attributes:null)},this)),this.bindBroadcasts()},handleBroadcastMessages:function(e){for(var t in this._associations)this[t]&&this[t].interestedBroadcasts&&this[t].interestedBroadcasts.test(e)&&("hasMany"==this._associations[t]?this[t].fetchAll():this[t].fetch())},hookBroadcastEvent:function(t){var n=this;this.messenger.on(t,e.debounce(function(){n.handleBroadcastMessages(t)},1e3))},bindBroadcasts:function(){this.hookBroadcastEvent("broadcast:preference:reload"),this.hookBroadcastEvent("broadcast:saveForm:new"),this.hookBroadcastEvent("broadcast:saveForm:login"),this.hookBroadcastEvent("broadcast:saveForm:update"),this.hookBroadcastEvent("broadcast:saveForm:rollback"),this.hookBroadcastEvent("broadcast:billinginfo:updated"),this.hookBroadcastEvent("broadcast:register:success"),this.hookBroadcastEvent("response:create:account"),this.hookBroadcastEvent("response:update:account"),this.hookBroadcastEvent("response:delete:account"),this.hookBroadcastEvent("response:create:site"),this.hookBroadcastEvent("response:update:site"),this.hookBroadcastEvent("response:delete:site")},loadAll:function(t){t=t||s;var n=this;e.async.parallel([function(e){n.loadPreferences(e)},function(e){n.loadShieldedEmails(e)},function(e){n.loadShieldedPhones(e)},function(e){n.loadShieldedCards(e)},function(e){n.loadDisposablePhones(e)},function(e){n.detectPrivacySuite(e)},function(e){n.loadDisposableCards(e)},function(e){n.loadDisposableEmails(e)}],e.bind(function(){n.hasRegistered()&&!n.isUninstalled()?n.refreshEntitlements(function(){t()}):t()},this))},loadMin:function(t){t=t||s;var n=this;i.securityManager.isLocked(function(i){var a=[function(e){n.loadPreferences(e)}];i||(a=a.concat([function(e){n.loadShieldedEmails(e)},function(e){n.loadShieldedPhones(e)},function(e){n.loadShieldedCards(e)},function(e){n.loadDisposablePhones(e)},function(e){n.loadDisposableCards(e,!0)},function(e){n.loadDisposableEmails(e,!0)}])),a.push(function(e){n.detectPrivacySuite(e)}),e.async.parallel(a,e.bind(function(){t(),i||n.hasRegistered()&&!n.isUninstalled()&&n.refreshEntitlements(function(){})},this))})},sendPasswordResetEmail:function(t){i.licenseModule.sendResetPasswordEmail({email:t},e.bind(function(e){if(e){var t=e.errorCode;t==a.UNKNOWN_ERROR?this.trigger("resetPasswordEmailFailed"):t==a.MISSING_PARAMETERS?this.trigger("resetPasswordBadEmail"):t==a.NO_ACCOUNT_FOUND_FOR_EMAIL?this.trigger("resetPasswordBadEmail"):this.trigger("resetPasswordEmailFailed")}else this.trigger("resetPasswordEmailSent")},this))},getEmailAddress:function(){return this.shieldedEmail.get("email")},getUpgradeLink:function(e){var t=n.protocol+n.licenseServerHost+"/subscriptions/id_me?auth_token="+this.getAuthToken()+"&email="+this.getEmailAddress();return e&&e.feature&&(t+="&feature="+e.feature),this.hasRegEmail()&&this.hasRegPassword()?t+="&notsetup=3":this.hasRegEmail()?t+="&notsetup=1":this.hasRegPassword()&&(t+="&notsetup=2"),t},getPremiumLink:function(){var e=n.protocol+n.licenseServerHost+"/subscriptions/id_me/new?subscription_type=premium&auth_token="+this.getAuthToken()+"&email="+this.getEmailAddress();return e},getManageLink:function(){return n.protocol+n.licenseServerHost+"/subscriptions/billing?auth_token="+this.getAuthToken()+"&email="+this.getEmailAddress()},getSubscriptionLink:function(){return this.isEntitledToPhone()?this.getManageLink():this.getUpgradeLink()},getSubscriptionText:function(){return this.isEntitledToPhone()?r.getText("mm_user_show_subscriptionPremium"):this.isEntitledToSync()?r.getText("mm_user_show_subscriptionOnline"):r.getText("mm_user_show_subscriptionFree")},getUpdateCardLink:function(){return n.protocol+n.licenseServerHost+"/subscriptions/billing_info/edit?auth_token="+this.getAuthToken()+"&email="+this.getEmailAddress()},getDisposablePhoneNumber:function(){return this.hasShieldedPhone()&&this.hasDisposablePhone()?this.disposablePhone.getFullPrettyNumber():"It's time to get your Masked Phone number set up. "},getShieldedPhoneNumber:function(){return this.hasShieldedPhone()&&this.hasDisposablePhone()?this.shieldedPhone.getFullPrettyNumber():"It's time to get your Masked Phone number set up. "},getShieldedCardLastFour:function(){return this.shieldedCard?this.shieldedCard.getLastFour():""},getPhoneButtonTxt:function(){return this.hasShieldedPhone()?"Change":"Setup"},loadShieldedEmails:function(t){t=t||s,this.shieldedEmails.fetchAll({success:e.bind(function(){t()},this),error:e.bind(function(){t()},this)})},loadShieldedCards:function(n){n=n||s,this.shieldedCards.fetchAll({success:e.bind(function(){var e=this.shieldedCards.length>0?this.shieldedCards.at(0):new t.ShieldedCard;this.setShieldedCard(e.attributes),n()},this),error:e.bind(function(){n()},this)})},loadShieldedPhones:function(t){t=t||s,this.shieldedPhones.fetchAll({success:e.bind(function(){var e=this.shieldedPhones.find(function(e){return e.isTrue("is_validated")});this.setShieldedPhone(e?e.attributes:null),t()},this),error:e.bind(function(){t()},this)})},loadDisposablePhones:function(t){t=t||s,this.disposablePhones.fetchAll({success:e.bind(function(){var e=this.disposablePhones.at(0);this.setDisposablePhone(e?e.attributes:null),t()},this),error:e.bind(function(){t()},this)})},loadDisposableEmails:function(t,n){t=t||s,this.disposableEmails[n?"fetchAllLocal":"fetchAll"]({success:e.bind(function(){t()},this),error:e.bind(function(){t()},this)})},loadDisposableCards:function(t,n){t=t||s,this.disposableCards[n?"fetchAllLocal":"fetchAll"]({localOnly:n,success:e.bind(function(){t()},this),error:e.bind(function(){t()},this)})},loadPreferences:function(t){t=t||s,this.preferences.fetchAll({success:e.bind(function(){t()},this),error:e.bind(function(){t()})})},loadSites:function(t){t=t||s,this.sites.fetchAll({success:e.bind(function(){t()},this),error:e.bind(function(){t()})})},refreshEntitlements:function(t){t=t||s,i.licenseModule.refreshEntitlements(e.bind(function(){this.preferences.fetchAll({success:function(){t()},error:function(){t()}})},this))},getRegEmail:function(){return this.hasRegEmail()?this.preferences.getPref("regEmail"):""},getRegPassword:function(){return this.hasRegPassword()?this.preferences.getPref("regPassword"):""},hasRegEmail:function(){return 0==this.preferences.length?null:this.preferences.hasPref("regEmail")},hasRegPassword:function(){return 0==this.preferences.length?null:this.preferences.hasPref("regPassword")},isEntitledToSync:function(){return 0==this.preferences.length?null:this.preferences.isPrefTrue("entitledToSync")},isEntitledToPayments:function(){return 0==this.preferences.length?null:this.preferences.isPrefTrue("entitledToPayments")},isEntitledToPhone:function(){return 0==this.preferences.length?null:this.preferences.isPrefTrue("entitledToPhone")},isUninstalled:function(){return 0==this.preferences.length?null:this.preferences.isPrefTrue("uninstalled")},getPasswordHint:function(){return 0==this.preferences.length||this.preferences.getPref("passwordHint")&&(0==this.preferences.getPref("passwordHint").length||"null"===this.preferences.getPref("passwordHint").toLowerCase())?null:this.preferences.getPref("passwordHint")},hasTimelineEnabled:function(){return this.preferences.isPrefTrue("enablePrivacyTimeline")},hasSyncEnabled:function(){return this.preferences.isPrefTrue("enableSyncButton")},hasEnabledPayments:function(){return this.preferences.isPrefTrue("hasEnabledPayments")
},hasRegistered:function(){return this.preferences.isPrefTrue("hasRegistered")},hasPostinstallFlowNotCompleted:function(){return this.preferences.isPrefTrue("postinstallFlowNotCompleted")},registerInProgress:function(){return this.preferences.isPrefTrue("registerInProgress")},resetPasswordInProgress:function(){return this.preferences.isPrefTrue("resetPasswordInProgress")},isSyncDirty:function(){return 0==this.preferences.length?!1:this.hasLastSync()&&this.hasLastLocalModifiedAt()?this.getLastSync()<this.getLastLocalModifiedAt():!1},hasLastSync:function(){return 0==this.preferences.length?!1:this.preferences.getPref("lastSync")?!0:!1},hasLastLocalModifiedAt:function(){return 0==this.preferences.length?!1:this.preferences.getPref("lastLocalModifiedAt")?!0:!1},getLastLocalModifiedAt:function(){return Math.floor(this.preferences.getPref("lastLocalModifiedAt"))},getLastSync:function(){return Math.floor(this.preferences.getPref("lastSync"))},hasRegisteredForSync:function(){return 0==this.preferences.length?null:this.preferences.isPrefTrue("hasRegisteredSync")},isAuthenticated:function(){if(0==this.preferences.length)return null;var e=this.preferences.getPref("authToken");return e&&e.length>0},getAuthToken:function(){if(0==this.preferences.length)return null;var e=this.preferences.getPref("authToken");return e},setAccountSortPref:function(e){if(this.preferences.hasPref("accountsSortOrder"))this.preferences.setPref("accountsSortOrder",e);else{var n=new t.Preference({key:"accountsSortOrder",value:e});this.preferences.add(n),n.save()}},getAccountSortPref:function(e){return this.preferences.hasPref("accountsSortOrder")?this.preferences.getPref("accountsSortOrder"):e},rememberOnlyMaskMe:function(){this.preferences.length>0&&this.preferences.setPref("rememberOnlyMaskMe",!0)},hasPassword:function(){return 0==this.preferences.length?null:this.preferences.isPrefTrue("hasPassword")},hasShieldedEmail:function(){return this.shieldedEmail&&this.shieldedEmail.get("active")},hasShieldedPhone:function(){return this.shieldedPhone&&"true"==this.shieldedPhone.get("is_validated")},hasDisposablePhone:function(){return this.disposablePhone},shouldSendErrorReports:function(){return 0==this.preferences.length?null:this.preferences.isPrefTrue("shouldSendErrorReports")},getEmailSalt:function(){return 0==this.preferences.length?null:this.preferences.getPref("Salt.ShieldedEmail")},getGUIDs:function(){var e={};return this.isEntitledToPhone()&&this.shieldedPhone&&(e.disposable_phone_id=this.disposablePhone.get("rails_id"),e.shielded_phone_id=this.shieldedPhone.get("rails_id")),e.shielded_email_guid=this.shieldedEmail.get("guid"),e},isPremium:function(){return this.isEntitledToPhone()},detectPrivacySuite:function(e){if(e=e||s,this._privacySuiteCheckDone)e();else if(this._privacySuiteCheckDone=!0,this._hasPrivacySuite=!1,this._privacySuiteAddonName="","undefined"!=typeof Components)try{var t={},n=this;Components.utils["import"]("resource://abine/modules/global.js",t),Components.utils["import"]("resource://gre/modules/AddonManager.jsm",t),t.AddonManager.getAddonByID(t.Abine.ExtensionID,function(t){t&&(n._hasPrivacySuite=!0,n._privacySuiteAddonName=t.name),e()})}catch(i){e()}else e()},canImportFromPrivacySuite:function(){return this._hasPrivacySuite},getPrivacySuiteAddonName:function(){return this._privacySuiteAddonName},clone:function(){var e=new this.constructor(this);return e}});return t.User=o,o}),ABINEMASKME.define("abine/models/userInfo",["documentcloud/underscore","documentcloud/backbone","models","abine/proxies"],function(e,t,n,i){var a=t.Model.extend({initialize:function(){},load:function(t){t=t||{};var a=new n.ShieldedEmailCollection;a.fetchAll({success:e.bind(function(){a.length>0?(this.shieldedEmailModel=a.at(0),this.attributes.shieldedEmail=this.shieldedEmailModel.getAddress()):(this.shieldedEmailModel=new n.ShieldedEmail,this.attributes.shieldedEmail=null),this.checkLoaded(t)},this),error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/userInfo]#[load]# error event in shieldedEmails.fetchAll")}});var r=new n.ShieldedPhoneCollection;r.fetchAll({success:e.bind(function(){r.length>0?(this.shieldedPhoneModel=r.at(0),this.attributes.shieldedPhone=this.shieldedPhoneModel.getPrettyNumber()):(this.shieldedPhoneModel=new n.ShieldedPhone,this.attributes.shieldedPhone=null),this.checkLoaded(t)},this),error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/userInfo]#[load]# error event in shieldedPhones.fetchAll")}}),i.securityManager.hasPassword(e.bind(function(e){this.set({hasPassword:e}),this.checkLoaded(t)},this)),i.securityManager.hasRegisteredSync(e.bind(function(e){this.set({hasRegisteredSync:e}),this.checkLoaded(t)},this)),i.securityManager.needsToChangePassword(e.bind(function(e){this.set({needsToChangePassword:e}),this.checkLoaded(t)},this)),t.loadDisposablePhone&&this.loadDisposablePhone(e.bind(function(){this.checkLoaded(t)},this))},loadDisposablePhone:function(t){var i=new n.DisposablePhoneCollection;i.fetchAll({success:e.bind(function(){i.length>0?(this.disposablePhoneModel=i.at(0),this.attributes.disposablePhone=this.disposablePhoneModel.getPrettyNumber()):(this.disposablePhoneModel=new n.DisposablePhone,this.attributes.disposablePhone=null),this.trigger("disposablePhoneLoaded"),t()},this),error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/userInfo]#[load]# error event in disposablePhones.fetchAll")}})},checkLoaded:function(e){this.isLoaded(e)&&this.trigger("loaded",this)},isLoaded:function(e){var t=this.attributes.hasOwnProperty("hasPassword")&&this.attributes.hasOwnProperty("shieldedEmail")&&this.attributes.hasOwnProperty("shieldedPhone")&&this.attributes.hasOwnProperty("hasRegisteredSync");return e.loadDisposablePhone&&!this.attributes.hasOwnProperty("disposablePhone")&&(t=!1),t},showPhoneValidationMsg:function(){return this.shieldedPhoneModel?0==this.shieldedPhoneModel.get("active"):!1},showEmailValidationMsg:function(){return this.shieldedEmailModel?0==this.shieldedEmailModel.get("active"):!1},isSetup:function(){return!!this.get("shieldedEmail")&&!!this.shieldedEmailModel.get("active")},clone:function(){var e=new this.constructor(this);return e.namePreference=this.namePreference,e.shieldedEmailModel=this.shieldedEmailModel,e.shieldedPhoneModel=this.shieldedPhoneModel,e}});return n.UserInfo=a,{UserInfo:a}}),ABINEMASKME.define("abine/models/userPhone",["documentcloud/underscore","models","abine/intl"],function(e,t,n){var i=t.BaseModel.extend({initialize:function(){this.messenger=this.getMessenger()},save:function(){var e=this;this.attributes,this.messenger.on("serverResponse:users:changePhone",function(t){e.messenger.off("serverResponse:users:changePhone"),200==t.status||201==t.status?(e.trigger("sync:success",t),e.trigger("changePhoneComplete")):401==t.status||(e.errorMessage=n.getText("mm_ServerError"),e.trigger("sync:error",t)),e.trigger("sync:complete")}),this.messenger.send("server:users:changePhone",this.attributes),this.trigger("sync:update")}});return t.UserPhone=i,i}),ABINEMASKME.define("abine/models/feedback",["documentcloud/underscore","documentcloud/backbone","models"],function(e,t,n){var i=n.BaseModel.extend({initialize:function(){},getSuccessLeadMsg:function(){return this.attributes.leadMsg},getSuccessMsg:function(){return this.attributes.successMsg},clone:function(){var e=new this.constructor(this);return e.user=this.user,e}});return n.Feedback=i,{Feedback:i}}),ABINEMASKME.define("abine/models/cardTransaction",["documentcloud/underscore","models","jquery"],function(e,t){var n=t.BaseModel.extend({storageEntity:"cardTransaction",initialize:function(){},getDate:function(){var e=new Date(this.get("date"));return e.toDateString()}}),i=t.BaseCollection.extend({model:n,initialize:function(){},fetchAllByCardId:function(t,n){this.sync("read",this,{eventName:"read:cardTransaction:card:"+t,success:e.bind(function(e){this.reset(e),n.success(e)},this),error:function(){true&&ABINEMASKME.log.error("[ERROR HANDLER]#[abine/models/cardTransaction]#[fetchAllByCardId]# error event in model.sync eventName: read:transactions:card:id"),n.error()}})}});return t.CardTransaction=n,t.CardTransactionCollection=i,{CardTransaction:n,CardTransactionCollection:i}}),ABINEMASKME.define("abine/models/privacysuite",["documentcloud/underscore","models","abine/config","abine/proxies"],function(e,t){var n=t.BaseModel.extend({}),i=t.BaseCollection.extend({model:n}),a=t.BaseModel.extend({initialize:function(){this.hasMany({fields:{collection:i}})}}),r=t.BaseCollection.extend({model:a}),s=t.BaseModel.extend({initialize:function(){this.hasMany({accounts:{collection:r}})},numAccounts:function(){return this.accounts.length}}),o=t.BaseCollection.extend({model:s}),c=t.BaseModel.extend({initialize:function(){this.loaded=!1,this.messenger=this.getMessenger(),this.hasMany({sites:{collection:o}}),this.hasOne({})},load:function(e){var t={};Components.utils["import"]("resource://abine/modules/global.js",t),this._loginRequired=t.Abine.SecurityManager.isLoginRequired("master")?!0:!1,this._loginRequired||this.loadPrivacySuiteSites(t.Abine),e&&e()},loadPrivacySuiteSites:function(e){var t=e.Model.Site.doSelect("where id in (select site_id from info_card where type = 'login') order by name_order"),n=e.Model.InfoCard.doSelect("where type = 'login'"),i=e.Model.InfoCardField.doSelect("where info_card_id in (select id from info_card where type = 'login')"),r=0;this.sites.reset();for(var o=0;t.length>o;o++){for(var c=t[o],l=new s({id:c.id(),name:c.name(),domain:c.domain()}),d=0;n.length>d;d++){var u=n[d];if(u.site_id()==c.id()){for(var h=new a({id:u.id(),name:u.name(),domain:c.domain()}),f=0;i.length>f;f++){var p=i[f];p.info_card_id()==u.id()&&h.fields.add({id:p.id(),name:p.name(),value:p.value(),type:p.type(),data_type:p.data_type()})}r++,l.accounts.add(h)}}this.sites.add(l)}this._totalAccounts=r},getTotalAccounts:function(){return this._totalAccounts},getPrivacySuiteAddonName:function(){return ABINEMASKME.user.getPrivacySuiteAddonName()},canImportAccounts:function(){return!this._loginRequired&&this._totalAccounts>0},isLoginRequired:function(){return this._loginRequired},clone:function(){var e=new this.constructor(this);return e}});return t.PrivacySuite=c,c}),ABINEMASKME.define("abine/models/webmail",["models","documentcloud/underscore"],function(e,t){var n=e.BaseModel.extend({storageEntity:"webmail",initialize:function(){},getFrom:function(){var e="Unknown";if(this.has("from"))if(this.get("from").indexOf("@")>=0){var t=this.get("from").split("@");e=t.length>1&&t[0].length>12?t[0].substring(0,12)+"..."+"@"+t[1]:this.get("from")}else e=this.get("from");return e},fetchMail:function(e){this.cachedMail?e.success(this.cachedMail):this.sync("read",this,{eventName:"read:webmail:"+this.get("mid"),success:t.bind(function(t){this.cachedMail=t,e.success(t)},this),error:e.error})},receivedMS:function(){return 1e3*parseInt(this.get("received"))}}),i=e.BaseCollection.extend({model:n,initialize:function(){this.messenger=this.getMessenger()}});return e.Webmail=n,e.WebmailCollection=i,{Webmail:n,WebmailCollection:i}}),ABINEMASKME.define("abine/models/export",["documentcloud/underscore","models","jquery"],function(e,t){var n=t.BaseModel.extend({storageEntity:"export",initialize:function(){}});return t.Export=n,{Export:n}}),ABINEMASKME.define("models",[],function(){return{}}),ABINEMASKME.requireModels=function(e){ABINEMASKME.require(["abine/models/base","abine/models/account","abine/models/accountActivity","abine/models/accountField","abine/models/disposableCard","abine/models/disposableEmail","abine/models/disposablePhone","abine/models/phoneLog","abine/models/preference","abine/models/mappedForm","abine/models/mappedField","abine/models/shieldedCard","abine/models/shieldedEmail","abine/models/shieldedPhone","abine/models/site","abine/models/user","abine/models/userInfo","abine/models/userPhone","abine/models/feedback","abine/models/cardTransaction","abine/models/privacysuite","abine/models/webmail","abine/models/export"],function(){e()})},ABINEMASKME.CompiledTemplates=ABINEMASKME.CompiledTemplates||{},ABINEMASKME.define("abine/views/commonhelpers",["wycats/handlebars","abine/config","abine/intl"],function(e,t,n){var i="http://g.etfv.co/http://";e.registerHelper("configVar",function(n){return e.Utils.escapeExpression(t[n])}),e.registerHelper("favicon",function(t){return e.Utils.escapeExpression(i+t)}),e.registerHelper("idMeAppName",function(){return e.Utils.escapeExpression(t.appName)}),e.registerHelper("isChrome",function(){return"Chrome"===t.browser}),e.registerHelper("isFirefox",function(){return"Firefox"===t.browser}),e.registerHelper("ifUser",function(e,t){return"function"==typeof ABINEMASKME.user[e]&&ABINEMASKME.user[e]()?t.fn(this):t.inverse(this)}),e.registerHelper("ifContentUser",function(e,t){return"function"==typeof ABINEMASKME.contentuser[e]&&ABINEMASKME.contentuser[e]()?t.fn(this):t.inverse(this)}),e.registerHelper("ifUser",function(e,t){return"function"==typeof ABINEMASKME.user[e]&&ABINEMASKME.user[e]()?t.fn(this):t.inverse(this)}),e.registerHelper("user",function(e){return"function"==typeof ABINEMASKME.user[e]?ABINEMASKME.user[e]():""}),e.registerHelper("phoneCountryOptions",function(t){for(var n=[{code:"1",name:"United States"},{code:"43",name:"Austria"},{code:"32",name:"Belgium"},{code:"45",name:"Denmark"},{code:"358",name:"Finland"},{code:"33",name:"France"},{code:"353",name:"Ireland"},{code:"39",name:"Italy"},{code:"31",name:"The Netherlands"},{code:"48",name:"Poland"},{code:"351",name:"Portugal"},{code:"34",name:"Spain"},{code:"46",name:"Sweden"},{code:"44",name:"United Kingdom"}],i="",a=0;n.length>a;a++){var r=n[a],s="";"undefined"!=typeof t&&r.code===t&&(s="selected"),i+="<option "+s+" value='"+r.code+"'>"+r.name+" (+"+r.code+") </option>"}return new e.SafeString(i)}),e.registerHelper("intl",function(e,t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments,1)),n.getText(e,t)}),e.registerHelper("date",function(e){return new Date(e).toLocaleDateString()}),e.registerHelper("helpLink",function(t,i){var a="";return i=e.Utils.escapeExpression(i),0==t.length?a='<a href="https://www.abine.com/maskme/faq/#'+i+'" target="_blank"><i class="icon-question-sign"></i></a>':"panel"==t?a='<a href="https://www.abine.com/maskme/faq/#'+i+'" class="panel-help" target="_blank"><span class="panel-help-wrapper">?</span></a>':(t=e.Utils.escapeExpression(n.getText(t)),a='<span class="question-text">',a+='<a href="https://www.abine.com/maskme/faq/#'+i+'" target="_blank"> <em>'+t+"</em> </a>",a+="</span>"),a})}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/loading_display/loading_display"]=e.template(function(e,t,n){n=n||e.helpers;var i,a,r,s="",o="function",c=n.helperMissing,l=void 0,d=this.escapeExpression;return s+='<div class="loading-display">\n  <div class="progress progress-striped active">\n    <div class="bar bar-info" style="width: 100%;"></div>\n  </div>\n  <div class="loading-message">\n    ',i="mm_loading_display_Loading",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+'\n  </div>\n</div>\n<div class="refreshing-display" style="display:none;">\n    <img src="',i="/pages/images/ajax_loader.gif",r=n.assetUrl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"assetUrl",i,{hash:{}}):a,s+=d(i)+'" />\n</div>\n'}),ABINEMASKME.CompiledTemplates["views/loading_display/loading_display"]}),ABINEMASKME.define("abine/views/loading_display",["documentcloud/underscore","jquery","duckbone/core","abine/timer","abine/intl"],function(e,t,n,i,a){var r=n.View.extend({templateName:"loading_display_loading_display",afterInitialize:function(){this.options.customMessages||(this.options.customMessages=["mm_loading_display_LotOfAccounts","mm_loading_display_StillWorking","mm_loading_display_HangOn","mm_loading_display_Sorry"]);var n=0;this.changeMessage=i.setInterval(e.bind(function(){n>=this.options.customMessages.length?i.clearInterval(this.changeMessage):(t(this.el).find(".loading-message").html(a.getText(this.options.customMessages[n],"loading_"+this.options.pageName)),n++)},this),5e3)},reset:function(){i.clearInterval(this.changeMessage),t(this.el).find(".loading-message").html(""),this.afterInitialize()},hide:function(){i.clearInterval(this.changeMessage),t(this.el).find(".loading-display").hide(),t(this.el).find(".refreshing-display").hide()},startRefreshing:function(){t(this.el).find(".refreshing-display").show()}});return r}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/unlock/fakeunlock"]=e.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\n        <div style="position:absolute;bottom:5px;right:5px;font-size:12px;" class="sign-in">',t="mm_user_registration_haveAccount",c=n.intl,i=c||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===h?i.call(e,t,{hash:{}}):i===p?f.call(e,"intl",t,{hash:{}}):i,a+=m(t)+' <a href="#userLogin/fakeunlock">',t="mm_user_registration_login",c=n.intl,i=c||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===h?i.call(e,t,{hash:{}}):i===p?f.call(e,"intl",t,{hash:{}}):i,a+=m(t)+"</a></div>\n    "}n=n||e.helpers;var s,o,c,l,d="",u=this,h="function",f=n.helperMissing,p=void 0,m=this.escapeExpression,g=n.blockHelperMissing;return d+='<div style="text-align:center;margin-top:75px;padding:20px;position:relative;" class="well">\n    <div class="lock-image" style="float:left;">\n        <img src="',s="pages/images/lock.png",c=n.assetUrl,o=c||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),s=typeof o===h?o.call(t,s,{hash:{}}):o===p?f.call(t,"assetUrl",s,{hash:{}}):o,d+=m(s)+'" />\n    </div>\n    <div style="float:left;margin-left:25px;margin-top:20px;text-align:left;">\n        <h4>',s="mm_unlock_lockAllows",c=n.intl,o=c||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),s=typeof o===h?o.call(t,s,{hash:{}}):o===p?f.call(t,"intl",s,{hash:{}}):o,d+=m(s)+"</h4>\n        <div>\n            ",s="mm_unlock_itIsPerfect",c=n.intl,o=c||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),s=typeof o===h?o.call(t,s,{hash:{}}):o===p?f.call(t,"intl",s,{hash:{}}):o,d+=m(s)+"\n        </div>\n        <div>\n            ",s="mm_unlock_toUseLock",c=n.intl,o=c||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),s=typeof o===h?o.call(t,s,{hash:{}}):o===p?f.call(t,"intl",s,{hash:{}}):o,(s||0===s)&&(d+=s),d+='\n        </div>\n    </div>\n    <br style="clear: both;"/>\n    ',s="hasRegEmail",c=n.ifUser,o=c||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"ifUser"),l=u.program(1,r,a),l.hash={},l.fn=l,l.inverse=u.noop,s=c&&typeof o===h?o.call(t,s,l):g.call(t,o,s,l),(s||0===s)&&(d+=s),d+="\n</div>\n"}),ABINEMASKME.CompiledTemplates["views/unlock/fakeunlock"]}),ABINEMASKME.define("abine/views/fakeunlock",["documentcloud/underscore","jquery","models","duckbone/core","wycats/handlebars","abine/assets","abine/proxies","abine/eventLogger","abine/intl"],function(e,t,n,i){var a=i.View.extend({tagName:"div",className:"clearfix",templateName:"unlock_fakeunlock",events:{"click #fakeUnlock":"goToHome","click #changePassword":"goToChangePassword"},afterInitialize:function(){},goToHome:function(){ABINEMASKME.App.renderPage("home")},goToChangePassword:function(){ABINEMASKME.App.renderPage("editUser/password")}},{routeAction:function(){ABINEMASKME.App.loadView(a)}});return a}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/unlock/panel"]=e.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\n         <div class="control-group">\n           <i class="icon-lock"></i>\n          ',t="mm_unlock_panel_LockedEnterPass",c=n.intl,i=c||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===h?i.call(e,t,{hash:{}}):i===p?f.call(e,"intl",t,{hash:{}}):i,a+=m(t)+'<br/>\n          <span class="pad">',t="password",c=n.form_password,i=c||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"form_password"),t=typeof i===h?i.call(e,t,{hash:{}}):i===p?f.call(e,"form_password",t,{hash:{}}):i,a+=m(t)+'</span>\n          <button id="unlockButton" class="unlockButton btn btn-mini btn-success">',t="mm_unlock_panel_Unlock",c=n.intl,i=c||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===h?i.call(e,t,{hash:{}}):i===p?f.call(e,"intl",t,{hash:{}}):i,a+=m(t)+'</button>\n          <span class="errorText" style="display:none;">',t="mm_unlock_panel_WrongPass",c=n.intl,i=c||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===h?i.call(e,t,{hash:{}}):i===p?f.call(e,"intl",t,{hash:{}}):i,a+=m(t)+'</span>\n         </div>\n         <div style="margin-left:15px;" id="autoUnlockOption">\n            <input type="checkbox" id="autoUnlockPref" /> <span id="prefLabel" style="display:inline;vertical-align:middle;font-size:11px;" for="autoUnlockPref">',t="mm_unlock_AutoLockPref",c=n.intl,i=c||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===h?i.call(e,t,{hash:{}}):i===p?f.call(e,"intl",t,{hash:{}}):i,(t||0===t)&&(a+=t),a+='</span>\n         </div><div style="height:8px;">&nbsp;</div>\n    '}n=n||e.helpers;var s,o,c,l,d="",u=this,h="function",f=n.helperMissing,p=void 0,m=this.escapeExpression,g=n.blockHelperMissing;return d+='<div class="panel">\n\n    <!-- Logo and Panel Buttons -->\n    <div class="header">\n        <img class="panel-icon" src="',s="/pages/images/manage/maskme_logo_short_green.png",c=n.assetUrl,o=c||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),s=typeof o===h?o.call(t,s,{hash:{}}):o===p?f.call(t,"assetUrl",s,{hash:{}}):o,d+=m(s)+'"/>\n        <div class="buttons-panel close-dd close-header">\n            <span class="close-icon close-header" id="paneHover"></span>\n        </div>\n    </div>\n\n    ',s="unlock",c=n.form,o=c||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"form"),l=u.program(1,r,a),l.hash={},l.fn=l,l.inverse=u.noop,s=c&&typeof o===h?o.call(t,s,l):g.call(t,o,s,l),(s||0===s)&&(d+=s),d+="\n</div>\n\n"}),ABINEMASKME.CompiledTemplates["views/unlock/panel"]}),ABINEMASKME.define("abine/views/unlockPanel",["documentcloud/underscore","jquery","duckbone/core","models","abine/views/panelBase","abine/proxies","abine/timer","abine/eventLogger"],function(e,t,n,i,a,r,s){var o=a.extend({templateName:"unlock_panel",events:{"submit .unlock":"verifyPassword","click #prefLabel":"checkBox"},checkBox:function(){"checked"==t(this.el).find("#autoUnlockPref").attr("checked")?t(this.el).find("#autoUnlockPref").removeAttr("checked"):t(this.el).find("#autoUnlockPref").attr("checked","checked")},afterInitialize:function(){this.unlockHook=e.bind(this.unlocked,this),r.securityManager.on("background:securityManager:unlocked",this.unlockHook),this.field=this.options.field,this.previousClick=this.field.id,this.applyFadingStyle(),this.fadeIn(),this.model={password:""},this.render(),this.contentManager=this.options.contentManager,this.passwordField=t(".form_password",this.el),this.options.preferences.getPrefFromStorage("autoLockOnRestart",e.bind(function(e){e&&"true"!=e.get("value")?t(this.el).find("#autoUnlockPref").removeAttr("checked"):t(this.el).find("#autoUnlockPref").attr("checked","checked")},this)),this.bindBlurClose()},bindBlurClose:function(){this.field=this.field||this.options.field,this.bindPanelTextInput(this.passwordField),t(this.el).bind("mousedown",e.bind(function(t){var n=t.target.className.split(" ");e.contains(n,"close-header")?this.closeHeader():("close-icon"==t.target.className||"close-dd"==t.target.className)&&this.closePanel(),this.ignoreBlur(!0)},this)),t(this.field.element).bind("keydown.mmpanel",e.bind(function(){this.closePanel()},this))},cleanupPanel:function(){r.securityManager.off("background:securityManager:unlocked",this.unlockHook)},verifyPassword:function(n){n.preventDefault(),t(this.el).find(".unlockButton").attr("disabled","disabled");var i=this.passwordField.val(),a=t(this.el).find("#autoUnlockPref").is(":checked");r.securityManager.unlock(i,a,e.bind(function(e){e?this.invalidPassword():this.unlocked()},this))},invalidPassword:function(){t(this.el).find(".unlockButton").removeAttr("disabled"),this.passwordField.parent().addClass("error"),t(this.el).find(".errorText").show(),this.passwordField.focus(),this.ignoreBlur(!1)},unlocked:function(){this.closePanel();var e=this.options.field;s.setTimeout(function(){t(e.element)[0].focus()},1e3)}});return o}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/unlock/password"]=e.template(function(e,t,n){n=n||e.helpers;var i,a,r,s="",o="function",c=n.helperMissing,l=void 0,d=this.escapeExpression;return s+='<form>\n  <div class="lock-image">\n    <img src="',i="pages/images/lock.png",r=n.assetUrl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"assetUrl",i,{hash:{}}):a,s+=d(i)+'" />\n  </div>\n  \n  <div class="control-group lock-fields">\n    <p>\n        <b>',i="mm_unlock_password_LockedNoOneCan",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+"</b><br/>\n        ",i="mm_unlock_password_ToUnlock",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+"\n    </p>\n\n    ",i="password",r=n.form_password,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"form_password"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"form_password",i,{hash:{}}):a,s+=d(i)+'\n    <button class="unlockButton btn btn-success">',i="mm_unlock_panel_Unlock",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+' </button>&nbsp;<a class="showHint btn btn-info">',i="mm_unlock_password_Hint",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+'</a>\n    <div class="help-block"></div>\n    <div id="decrypting" style="display:none;">\n        ',i="mm_unlock_password_Decrypting",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+'\n        <img src="',i="/pages/images/ajax_loader.gif",r=n.assetUrl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"assetUrl",i,{hash:{}}):a,s+=d(i)+'" />\n    </div>\n  </div>\n  <br style="clear:both;"/>\n</form>\n\n<div class="please-wait" style="display:none;">\n  <p>',i="mm_unlock_password_SomethingWrong",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+'</p>\n</div>\n\n<div style="float:right;width:75%;">\n    <input type="checkbox" id="autoUnlockPref" /> <label style="vertical-align:middle;display:inline;font-size:12px;padding-right:20px;" for="autoUnlockPref">',i="mm_unlock_AutoLockPref",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,(i||0===i)&&(s+=i),s+="</label>\n    ",i="mm_user_login_forgotPassword",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,(i||0===i)&&(s+=i),s+='\n</div>\n<br style="clear:both;"/>\n'}),ABINEMASKME.CompiledTemplates["views/unlock/password"]}),ABINEMASKME.define("abine/views/unlock",["documentcloud/underscore","jquery","models","duckbone/core","wycats/handlebars","abine/assets","abine/proxies","abine/eventLogger","abine/intl"],function(e,t,n,i,a,r,s,o,c){var l=i.View.extend({tagName:"div",templateName:"unlock_password",className:"well clearfix",events:{"submit .unlock":"verifyPassword","click .unlockButton":"verifyPassword","click .showHint":"showHint"},afterInitialize:function(){ABINEMASKME.user.preferences.getPrefFromStorage("autoLockOnRestart",e.bind(function(e){e&&"true"!=e.get("value")&&1!=e.get("value")?t(this.el).find("#autoUnlockPref").removeAttr("checked"):t(this.el).find("#autoUnlockPref").attr("checked","checked")},this))},render:function(){this.renderTemplate();var e=t(this.el).find('input[name="password"]').get(0);return setTimeout(function(){t(e).focus()},100),this},showDecrypting:function(){t(this.el).find("#decrypting").show()},hideDecrypting:function(){t(this.el).find("#decrypting").hide()},invalidPassword:function(){t(this.el).find(".form_password").parent().addClass("error"),t(this.el).find(".help-block").html(c.getText("mm_unlock_InvalidPassword"))},clearErrors:function(){t(this.el).find(".form_password").parent().removeClass("error"),t(this.el).find(".help-block").html("")},verifyPassword:function(n){n.preventDefault();var i=t(this.el).find("#autoUnlockPref").is(":checked"),a=t(this.el).find(".form_password").val();this.clearErrors(),this.showDecrypting(),s.securityManager.unlock(a,i,e.bind(function(t){this.hideDecrypting(),t?this.invalidPassword():(ABINEMASKME.App._locked=!1,ABINEMASKME.user.loadMin(e.bind(function(){ABINEMASKME.App.renderPage("home")},this)))},this))},showHint:function(){t(this.el).find(".form_password").parent().removeClass("error"),null!=ABINEMASKME.user.getPasswordHint()?t(this.el).find(".help-block").html(c.getText("mm_unlock_Hint")+" "+ABINEMASKME.user.getPasswordHint()):t(this.el).find(".help-block").html(c.getText("mm_unlock_HintNull"))}},{routeAction:function(){ABINEMASKME.App.loadView(l)}});return l}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/email_helper/panel"]=e.template(function(e,t,n,i,a){function r(e,t){var i,a,r="";return r+='\n        <div class="header">\n            <div class="buttons-panel close-header-margin">\n                <span class="close-icon close-header" id="paneHover"></span>\n            </div>\n            <div class="buttons-panel question-header-margin">\n                <a href="https://www.abine.com/maskme/faq/#aliasemail" target="_blank"><span class="question-icon" id="paneHover"></span></a>\n            </div>\n            <img class="panel-icon" src="',i="/pages/images/manage/maskme_logo_short_green.png",b=n.assetUrl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"assetUrl",i,{hash:{}}):a,r+=w(i)+'"/>\n        </div>\n        <div id="error" style="display:none;"></div>\n        ',b=n.autoRegisterEmail,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"autoRegisterEmail"),a=n["if"],v=A.program(2,s,t),v.hash={},v.fn=v,v.inverse=A.program(4,o,t),i=a.call(e,i,v),(i||0===i)&&(r+=i),r+="\n    "}function s(e){var t,i,a="";return a+='\n            <!-- new email register flow -->\n            <div class="progress-section" style="display:none">\n                <div class="progress progress-striped active">\n                    <div class="bar bar-info" style="width: 100%;"></div>\n                </div>\n                <div class="loading-message"></div>\n            </div>\n\n            <div class="info">',t="mm_email_helper_enter_email",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+'</div>\n            <a href="#" class="mmKeyOption registerEmail"><div class="element" id="mask">\n                <span class="panelLeft">\n                    <img class="iconPos" src="',t="/pages/images/maskmail-icon.png",b=n.assetUrl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"assetUrl",t,{hash:{}}):i,a+=w(t)+'"/>\n                  ',t="mm_email_helper_maskMyEmail",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+'\n                </span>\n            </div></a>\n            <a href="#" class="mmKeyOption noPrimaryEmail"><div class="element" id="disclose">\n            <span class="panelLeft">\n                <img class="iconPos" src="',t="/pages/images/disclosemail-icon.png",b=n.assetUrl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"assetUrl",t,{hash:{}}):i,a+=w(t)+'"/>\n              ',t="mm_email_helper_discloseEmail",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+"\n            </span>\n            </div></a>\n        "
}function o(e,t){var i,a,r="";return r+='\n          <!--Mask My Email-->\n          <a href="#" class="mmKeyOption disposableEmail"><div class="element" id="mask">\n              <span class="panelLeft">\n                  <img class="iconPos" src="',i="/pages/images/maskmail-icon.png",b=n.assetUrl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"assetUrl",i,{hash:{}}):a,r+=w(i)+'"/>\n                  ',i="mm_email_helper_maskMyEmail",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,r+=w(i)+'\n              </span>\n              <span class="panelRight">\n                  <img class="loading" style="display:none;" src="',i="/pages/images/ajax_loader.gif",b=n.assetUrl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"assetUrl",i,{hash:{}}):a,r+=w(i)+'"/>\n\n              </span>\n          </div></a>\n\n          <!--Server Down Error Handling-->\n          <span class="errorBtn disabled errorReportLink" style="display:none;cursor:pointer;"><div class="element">\n                ',i="mm_email_helper_serverIsDown",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,(i||0===i)&&(r+=i),r+='\n          </div></span>\n\n          <!--Account disabled Error Handling-->\n          <div class="accountDisabledBtn element" style="display:none">\n              <span class="message">',i="mm_email_helper_accountDisabled",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,r+=w(i)+'</span>\n              <a href=# class="enableAccount">',i="mm_email_helper_accountEnableLink",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,r+=w(i)+"</a>\n          </div>\n\n          <!--Disclose My Email-->\n          ",i="hasRegEmail",b=n.ifContentUser,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"ifContentUser"),v=A.program(5,c,t),v.hash={},v.fn=v,v.inverse=A.program(7,l,t),i=b&&typeof a===M?a.call(e,i,v):k.call(e,a,i,v),(i||0===i)&&(r+=i),r+="\n\n           <!-- If Masked Emails already exist for this domain -->\n           ",b=n.disposableEmails,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"disposableEmails"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"length"),a=n["if"],v=A.program(9,d,t),v.hash={},v.fn=v,v.inverse=A.noop,i=a.call(e,i,v),(i||0===i)&&(r+=i),r+="\n           ",b=n.disposableEmails,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"disposableEmails"),a=n.each,v=A.program(11,u,t),v.hash={},v.fn=v,v.inverse=A.noop,i=a.call(e,i,v),(i||0===i)&&(r+=i),r+="\n         "}function c(e){var t,i,a="";return a+='\n              <a href="#" class="mmKeyOption primaryEmail"><div class="element" id="disclose">\n                  <span class="panelLeft">\n                      <img class="iconPos" src="',t="/pages/images/disclosemail-icon.png",b=n.assetUrl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"assetUrl",t,{hash:{}}):i,a+=w(t)+'"/>\n                      ',t="mm_email_helper_discloseEmail",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+"\n                  </span>\n              </div></a>\n          "}function l(e){var t,i,a="";return a+='\n              <a href="#" class="mmKeyOption primaryEmail"><div class="element" id="disclose">\n                  <span class="panelLeft">\n                      <img class="iconPos" src="',t="/pages/images/disclosemail-icon.png",b=n.assetUrl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"assetUrl",t,{hash:{}}):i,a+=w(t)+'"/>\n                      ',t="mm_email_helper_discloseEmail",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+'\n                  </span>\n                  <span class="panelRight">\n                      <span class="overflowText">',b=n.primaryEmail,t=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"primaryEmail"),t=null===t||void 0===t||t===!1?t:ABINEMASKME.Duckbone.Handlebars.getAttr(t,"email"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"primaryEmail.email",{hash:{}})),a+=w(t)+"</span>\n                  </span>\n              </div></a>\n          "}function d(e){var t,i,a="";return a+='\n              <div class="sep"><p style="text-align:center;">',t="mm_email_helper_or",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+"</p></div>\n           "}function u(e){var t,i,a="";return a+='\n              <a href="#" data-aliasaddress="',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"getAddress"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.getAddress",{hash:{}})),a+=w(t)+'" class="mmKeyOption usedEmail"><div class="element" id="mask">\n                  <span class="panelLeft">\n                      <img class="iconPos" src="',t="/pages/images/maskmail-icon.png",b=n.assetUrl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"assetUrl",t,{hash:{}}):i,a+=w(t)+'"/>\n                      ',t="mm_email_helper_use",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+" ",t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"getAddress"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.getAddress",{hash:{}})),a+=w(t)+'\n                  </span>\n                  <span class="panelRight">\n                      <span class="overflowText">',t="mm_email_helper_created",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+" ",t="createdAt",b=n.live_timestamp,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"live_timestamp"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"live_timestamp",t,{hash:{}}):i,a+=w(t)+"</span>\n                  </span>\n              </div></a>\n           "}function h(e,t){var i,a,r="";return r+="\n        ",b=n.dynamicPanel,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"dynamicPanel"),a=n["if"],v=A.program(14,f,t),v.hash={},v.fn=v,v.inverse=A.program(17,m,t),i=a.call(e,i,v),(i||0===i)&&(r+=i),r+="\n    "}function f(e,t){var i,a,r="";return r+="\n            ",b=n.panelSections,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"panelSections"),a=n.each,v=A.program(15,p,t),v.hash={},v.fn=v,v.inverse=A.noop,i=a.call(e,i,v),(i||0===i)&&(r+=i),r+="\n        "}function p(e){var t,n="";return n+='\n                <div id="',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"id"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.id",{hash:{}})),n+=w(t)+'" style="height:',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"height"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.height",{hash:{}})),n+=w(t)+'" class="panelSection ',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"class_name"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.class_name",{hash:{}})),n+=w(t)+'">\n                    ',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"body"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.body",{hash:{}})),(t||0===t)&&(n+=t),n+="\n                </div>\n            "}function m(e){var t,i,a="";return a+='\n            <div class="header">\n                <div class="buttons-panel close-header-margin">\n                    <span class="close-icon close-header" id="paneHover"></span>\n                </div>\n                <div class="buttons-panel question-header-margin">\n                    <a href="https://www.abine.com/maskme/faq/#aliasemail" target="_blank"><span class="question-icon" id="paneHover"></span></a>\n                </div>\n                <img class="panel-icon" src="',t="/pages/images/manage/maskme_logo_short_green.png",b=n.assetUrl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"assetUrl",t,{hash:{}}):i,a+=w(t)+'"/>\n            </div>\n            <a href="javascript:void(0);" class="getStarted">\n                <div class="element" id="mask">\n                <span class="panelLeft">\n                    ',t="mm_helper_installed",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+"\n                </span>\n                </div>\n            </a>\n        "}n=n||e.helpers;var g,y,b,v,E="",A=this,M="function",_=n.helperMissing,S=void 0,w=this.escapeExpression,k=n.blockHelperMissing;return E+='<div class="panel">\n    ',b=n.hasRegistered,g=b||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"hasRegistered"),y=n["if"],v=A.program(1,r,a),v.hash={},v.fn=v,v.inverse=A.program(13,h,a),g=y.call(t,g,v),(g||0===g)&&(E+=g),E+="\n</div>\n"}),ABINEMASKME.CompiledTemplates["views/email_helper/panel"]}),ABINEMASKME.define("abine/views/emailHelperPanel",["documentcloud/underscore","jquery","duckbone/core","models","abine/views/panelBase","abine/timer","abine/contentMessenger","abine/proxies","abine/responseCodes","abine/intl"],function(e,t,n,i,a,r,s,o,c,l){var d=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i,u=a.extend({templateName:"email_helper_panel",events:{"click a.registerEmail":"changeEmail","click a.noPrimaryEmail":"noPrimaryEmail","click a.primaryEmail":"fillWithPrimaryEmail","click a.disposableEmail":"fillWithDisposableEmail","click a.usedEmail":"fillWithUsedEmail","click a.getStarted":"getStarted","click a.disabled":"closePanel","click .panelSection":"performActions","click a.enableAccount":"enableAccount","click .errorBtn span":"makeErrorReport","click .close-header":"logClose"},logClose:function(){this.contentManager.messenger.send("update:panelActivity:closed",{panelId:this.panelId})},makeErrorReport:function(){this.messenger=this.messenger||new s.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#errorReport"}),this.closePanel()},afterInitialize:function(){this.field=this.options.field,this.numMenuOptions=3,this.bindBaseEvents(),this.applyFadingStyle(),this.fadeIn(),this.contentManager=this.options.contentManager,this.model={primaryEmail:!1,hasRegistered:this.options.hasRegistered,dynamicPanel:this.options.dynamicPanel},this.options.dynamicPanel&&(this.setupDynamicPanel(),this.model.panelSections=this.panelSections),this.model.shieldedEmails=new i.ShieldedEmailCollection,this.model.shieldedEmails.fetchAll({success:e.bind(function(){this.model.shieldedEmails.length>0&&(this.model.primaryEmail=this.model.shieldedEmails.at(0)),this.model.primaryEmail?ABINEMASKME.contentuser.hasRegEmail()&&ABINEMASKME.contentuser.hasRegPassword()?(this.model.autoRegisterEmail=!0,this.doNotCloseOnTyping=!0,this.panelId=5000001,this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.panelId}),this.bind("enter0",this.changeEmail,this),this.bind("enter1",this.noPrimaryEmail,this),this.render()):(this.panelId=1000001,this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.panelId}),this.model.disposableEmails=new i.DisposableEmailCollection,this.model.disposableEmails.fetchAllByDomain(this.options.domain,e.bind(function(){this.bind("enter0",function(e){this.fillWithDisposableEmail(e)}),this.bind("enter1",function(e){this.fillWithPrimaryEmail(e)}),this.numMenuOptions=this.model.disposableEmails.length+2;for(var e=2;this.numMenuOptions>e;e++)this.bind("enter"+e,function(e,t){this.fillWithUsedEmail(e,t)});this.render()},this))):(this.model.dynamicPanel?this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.model.dynamicPanel.id}):this.bind("enter0",function(e){this.getStarted(e)},this),this.render())},this)})},noPrimaryEmail:function(e){e&&e.preventDefault(),this.changeEmail(e,!0)},retryEmail:function(e){e&&e.preventDefault(),this.$("#error, .progress-section").hide(),this.$(".info, .registerEmail, .noPrimaryEmail").show(),this.$(".mmKeyOption .hover").removeClass("hover"),this.triggerRender(),delete this.selectedField},changeEmail:function(n,i){function a(e,n){try{h.get(0).ownerDocument&&(i?t(".loading-message",h).text(l.getText("mm_loading_display_register_use"+Math.floor(e/5))):t(".loading-message",h).text(l.getText("mm_loading_display_register"+Math.floor(e/5))),n>e&&(f=r.setTimeout(function(){a(e+1,n)},500)))}catch(s){}}if(!n||(n.preventDefault(),!this.$(n.target).hasClass("whatIsThisLink"))){i=i||!1;var s=this.field.element.value;this.$(".info").hide();var c=this.$("#error");if(c.hide(),!s.match(d))return c.text(l.getText("mm_email_helper_invalid_email")).show(),this.autoResize(),void 0;var u={email:s,current_password:this.contentManager.preferences.getPref("regPassword"),silent:!0},h=this.$(".progress-section"),f=null;a(0,20),h.show(),this.$(".registerEmail, .noPrimaryEmail").hide(),o.licenseModule.changeEmail(u,e.bind(function(t,a){this.processChangeEmail(t,a,u,e.bind(function(e){e?(r.clearTimeout(f),h.hide()):i?this.fillWithPrimaryEmail(n,!0):this.fillWithDisposableEmail(n,!0)},this))},this)),this.autoResize()}},processChangeEmail:function(t,n,i,a){if(t){var r=l.getText("mm_email_helper_register_error"),s=t.responseJSON&&t.responseJSON.data?t.responseJSON.data.errors:null;"invalid email address"==t.responseJSON.error_code?r=l.getText("mm_email_helper_invalid_email_server_error"):s&&s.email&&"has already been taken"==s.email[0]&&(r=l.getText("mm_email_helper_duplicate_email",[i.email])),this.$("#error").html(r).show(),this.$("#error #loginButton").click(e.bind(this.openLoginPage,this)),this.$("#error #retryEmail").click(e.bind(this.retryEmail,this)),this.$("#error #reportError").click(e.bind(this.makeErrorReport,this)),this.autoResize(),a(r)}else this.contentManager.preferences.fetchAll(),this.model.shieldedEmails.fetchAll({success:e.bind(function(){this.model.shieldedEmails.length>0&&(this.model.primaryEmail=this.model.shieldedEmails.at(0)),a()},this)})},fillWithPrimaryEmail:function(t,n){if(t&&t.preventDefault(),n=n||!1,this.contentManager.messenger.send("update:panelActivity:disclosed",{panelId:this.panelId}),n)this.field&&this.fillFieldsByType(this.options.fields,"/contact/email",this.model.primaryEmail.getAddress(),{domain:this.options.domain,origin:"primary"}),r.setTimeout(e.bind(function(){var e={msg:l.getText("mm_email_helper_nextDisclose"),targetUrl:"https://www.abine.com/maskme/faq/#aliasemail"};e.neverFade=!0,this.options.contentManager.showNotification(e)},this),1e3);else if(this.field&&this.model.primaryEmail&&!ABINEMASKME.contentuser.hasRegEmail())this.fillFieldsByType(this.options.fields,"/contact/email",this.model.primaryEmail.getAddress(),{domain:this.options.domain,origin:"primary"});else if(ABINEMASKME.contentuser.hasRegEmail())return this.openSetupEmailPage(),void 0;this.closePanel()},fillWithDisposableEmail:function(n,i){if(n&&n.preventDefault(),this.contentManager.messenger.send("update:panelActivity:masked",{panelId:this.panelId}),!this.field.element.hasAttribute("generatingDisposable")){var a=this.field.element.value;a.match(d)&&this.model.primaryEmail.get("email")!=a?-1!=a.indexOf("@"+ABINEMASKME.config.disposableDomain)&&(a=null):a=null,a&&(this.ignoreBlur(!0),this.doNotCloseOnTyping=!0,t(this.field.element).unbind("blur")),this.field.element.setAttribute("generatingDisposable","true"),this.$(".loading").show();var s=this.model.primaryEmail.generateDisposable(this.options.domain);s.save({},{success:e.bind(function(){this.field.disposableGUID=s.get("guid"),this.fillFieldsByType(this.options.fields,"/contact/email",s.getAddress(),{domain:this.options.domain,origin:"disposable",disposableGUID:s.get("guid")}),r.setTimeout(e.bind(function(){var e={msg:l.getText("mm_email_helper_controlMasked"),targetUrl:"pages/index.html#home/emails/",targetId:s.get("guid")};i&&(e.type="post-register",e.neverFade=!0),this.options.contentManager.showNotification(e)},this),1e3),a?(this.$("#error").html(l.getText("mm_email_helper_change_email_message",[this.model.primaryEmail.get("email"),a])).show(),this.$("#error #changeSetting").click(e.bind(this.openSetupEmailPage,this)),this.$(".mmKeyOption, .sep, .errorBtn").hide(),this.field.element.focus(),delete this.doNotCloseOnTyping,this.bindFieldBlur(),this.autoResize()):this.closePanel(),this.field.element.removeAttribute("generatingDisposable"),o.licenseModule.postInstallCompleted({silent:!0})},this),error:e.bind(function(e,t){this.field.element.removeAttribute("generatingDisposable"),this.$(".disposableEmail").hide(),t&&t.message&&t.message.errorCode==c.TOO_MANY_REJECTS?this.$(".accountDisabledBtn").show():this.$(".errorBtn").show(),this.autoResize()},this)})}},enableAccount:function(e){this.messenger=this.messenger||new s.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#emailDisabled"}),this.closePanel(e)},fillWithUsedEmail:function(n,i){n&&n.preventDefault(),this.contentManager.messenger.send("update:panelActivity:masked",{panelId:this.panelId});var a;if(i||0==i){var r=e(this.el.children[0].children).filter(function(e){return t(e).is("a")&&!t(e).hasClass("disabled")});a=t(r[i]).data("aliasaddress")}else a=t(n.target).closest("a").data("aliasaddress");this.fillFieldsByType(this.options.fields,"/contact/email",a,{domain:this.options.domain,origin:"disposable"}),this.closePanel()}});return u}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/login_helper/panel"]=e.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\n    <!-- Login Accounts -->\n    <a href="#" class="mmKeyOption account acctIDLevel" data-acctid="',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"getAccountID"),typeof t===h?t=t.call(e,{hash:{}}):t===p&&(t=f.call(e,"this.getAccountID",{hash:{}})),a+=m(t)+'"><div class="element" id="mask">\n        <span class="panelLeft">\n            <img class="iconPos" src="',t="/pages/images/user-icon.png",c=n.assetUrl,i=c||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===h?i.call(e,t,{hash:{}}):i===p?f.call(e,"assetUrl",t,{hash:{}}):i,a+=m(t)+'"/>\n            ',t="mm_login_helper_loginAs",c=n.intl,i=c||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===h?i.call(e,t,{hash:{}}):i===p?f.call(e,"intl",t,{hash:{}}):i,a+=m(t)+'\n        </span>\n        <span class="panelRight">\n          <span class="largeOverflowText">',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"getLoginForAccount"),typeof t===h?t=t.call(e,{hash:{}}):t===p&&(t=f.call(e,"this.getLoginForAccount",{hash:{}})),a+=m(t)+"</span>\n        </span>\n    </div></a>\n    "}n=n||e.helpers;var s,o,c,l,d="",u=this,h="function",f=n.helperMissing,p=void 0,m=this.escapeExpression;return d+='<div class="panel">\n\n    <!-- Logo and Panel Buttons -->\n    <div class="header">\n        <div class="buttons-panel close-header">\n            <span class="close-icon close-header" id="paneHover"></span>\n        </div>\n        <img class="panel-icon" src="',s="/pages/images/manage/maskme_logo_short_green.png",c=n.assetUrl,o=c||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),s=typeof o===h?o.call(t,s,{hash:{}}):o===p?f.call(t,"assetUrl",s,{hash:{}}):o,d+=m(s)+'"/>\n    </div>\n\n    ',c=n.accounts,s=c||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"accounts"),o=n.each,l=u.program(1,r,a),l.hash={},l.fn=l,l.inverse=u.noop,s=o.call(t,s,l),(s||0===s)&&(d+=s),d+="\n</div>\n"}),ABINEMASKME.CompiledTemplates["views/login_helper/panel"]}),ABINEMASKME.define("abine/views/loginHelperPanel",["documentcloud/underscore","jquery","duckbone/core","models","abine/views/panelBase"],function(e,t,n,i,a){var r=a.extend({templateName:"login_helper_panel",events:{"click a.account":"fillWithAccount"},afterInitialize:function(){this.field=this.options.field,this.bindBaseEvents(),this.applyFadingStyle(),this.fadeIn(),this.contentManager=this.options.contentManager,this.model=new i.Site({domain:this.options.domain}),this.model.loadAccounts(!1,e.bind(function(){if(0===this.model.accounts.length)this.closePanel();else{this.numMenuOptions=this.model.accounts.length;for(var e=0;this.model.accounts.length>e;e++)this.bind("enter"+e,function(e,t){this.fillWithAccount(e,t)});this.render()}},this))},fillWithAccount:function(n,i){if(n&&n.preventDefault(),this.model&&this.model.accounts.length>0){var a;if(i||0==i){var r=e(this.el.children[0].children).filter(function(e){return t(e).is("a")&&!t(e).hasClass("disabled")});a=t(r[i]).data("acctid")}else a=t(n.target).closest("a").data("acctid");var s=this.model.accounts.find(function(e){return e.get("id")==a});s.save({protocol:this.options.protocol,page_domain:this.options.page_domain,form_domain:this.options.form_domain});var o={};e.each(this.options.fields,function(e){e.dataType&&(o[e.dataType]=e)});var c={};s.accountFields.each(function(e){e.has("dataType")&&(c[e.get("dataType")]=e.get("value"))}),e.each(e.keys(o),e.bind(function(e){e in c?this.fillFieldsByType(this.options.fields,e,c[e]):("/contact/email"==e&&"/nameperson/friendly"in c&&(this.fillFieldsByType(this.options.fields,e,c["/nameperson/friendly"]),o[e].element.value=c["/nameperson/friendly"]),"/nameperson/friendly"==e&&"/contact/email"in c&&this.fillFieldsByType(this.options.fields,e,c["/contact/email"]))},this)),this.model.filledAccountForSite(a,e.bind(function(){var e=this.options.contentManager.document.createEvent("Events");e.initEvent("abinemaskmesubmit",!0,!1),this.options.formEl.dispatchEvent(e),t(this.options.formEl).submit()},this))}}});return r}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/notification_helper/card_notification"]=e.template(function(e,t,n){n=n||e.helpers;var i,a,r,s="",o="function",c=n.helperMissing,l=void 0,d=this.escapeExpression;return s+='<div class="close-notification">\n    <span class="notf-close-icon"><img class="close-image" src="',i="/pages/images/manage/dd_close_icon.png",r=n.assetUrl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"assetUrl",i,{hash:{}}):a,s+=d(i)+'"/></span>\n</div>\n<div class="body-notification outerCard">\n    <div id="maskedCard" class="creditcardfont" style="color:rgb(80,80,80);height:181px;width:336px;">\n        <div style="border-radius:8px;padding:10px;padding-top:0px;background-repeat:no-repeat;width:336px;height:181px;background-image:url(\'',i="/pages/images/maskedcard.png",r=n.assetUrl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"assetUrl",i,{hash:{}}):a,s+=d(i)+'\');">\n             <br style="clear:both;"/>\n             <div style="text-align:center;margin-top:10px;">\n                <h3 id="cardNumber">',r=n.maskedCard,i=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"maskedCard"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"getSeparatedCardNumber"),typeof i===o?i=i.call(t,{hash:{}}):i===l&&(i=c.call(t,"maskedCard.getSeparatedCardNumber",{hash:{}})),s+=d(i)+'</h3>\n             </div>\n             <div style="font-size:15px;">\n                  <span style="float:left;">',i="mm_payment_helper_expDate",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+' <span id="expiration">',r=n.maskedCard,i=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"maskedCard"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"getExpiry"),typeof i===o?i=i.call(t,{hash:{}}):i===l&&(i=c.call(t,"maskedCard.getExpiry",{hash:{}})),s+=d(i)+'</span></span> <span style="float:right;margin-right:25px;"> ',i="mm_payment_helper_cvc",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+' <span id="cvc">',r=n.maskedCard,i=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"maskedCard"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"getCVC"),typeof i===o?i=i.call(t,{hash:{}}):i===l&&(i=c.call(t,"maskedCard.getCVC",{hash:{}})),s+=d(i)+'</span></span>\n                  <br style="clear:both;"/>\n                  <div style="margin-left:60px;font-size:16px;letter-spacing:2px;">\n                     ',i="mm_notification_helper_anyName",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+'\n                  </div>\n                  <span id="street" style="margin-left: 100px;">280 SUMMER STREET</span><br><span id="cityStateZip" style="margin-left: 106px;">BOSTON MA 02210</span>\n              </div>\n        </div>\n    </div>\n</div>\n<div style="text-align:center;padding-bottom:5px;">\n<input type="button" class="btn btn-primary" id="chatNow" style="width:90%;text-align:center;" value="',i="mm_notification_helper_chatNow",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+'"/>\n</div>\n'}),ABINEMASKME.CompiledTemplates["views/notification_helper/card_notification"]}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/notification_helper/panel"]=e.template(function(e,t,n){n=n||e.helpers;var i,a,r,s="",o="function",c=n.helperMissing,l=void 0,d=this.escapeExpression;return s+='<div class="close-notification">\n    <span class="notf-close-icon" id="paneHover"><img class="close-image" src="',i="/pages/images/manage/dd_close_icon.png",r=n.assetUrl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"assetUrl",i,{hash:{}}):a,s+=d(i)+'"/></span>\n</div>\n<div class="body-notification"><img src="',i="/images/Icon.png",r=n.assetUrl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"assetUrl",i,{hash:{}}):a,s+=d(i)+'"/>',r=n.msg,i=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"msg"),typeof i===o?i=i.call(t,{hash:{}}):i===l&&(i=c.call(t,"msg",{hash:{}})),(i||0===i)&&(s+=i),s+="</div>\n\n"}),ABINEMASKME.CompiledTemplates["views/notification_helper/panel"]}),ABINEMASKME.define("abine/views/notificationPanel",["documentcloud/underscore","jquery","duckbone/core","abine/views/panelBase","abine/timer","abine/contentMessenger","abine/assets","abine/proxies"],function(e,t,n,i,a,r,s,o){var c=i.extend({templateName:"notification_helper_panel",events:{mouseover:"onHover",mouseout:"onHoverEnd",click:"clicked"},afterInitialize:function(){this.targetId=this.options.notification.targetId?this.options.notification.targetId:"",this.targetUrl=this.options.notification.targetUrl?this.options.notification.targetUrl:"pages/index.html#home",this.targetUrl+=this.targetId,this.applyFadingStyle(),this.fadeIn(),this.model={get:e.bind(function(e){return this.options.notification[e]},this)},this.render(),this.startFadeOut()},clicked:function(e){return"close-notification"==e.target.className||"notf-close-icon"==e.target.className||"close-image"==e.target.className?(this.stopFadeOut(),this.closePanel(),void 0):(this.messenger=this.messenger||new r.ContentMessenger,0===this.targetUrl.indexOf("http")?this.messenger.send("window:createTab",{url:this.targetUrl}):this.messenger.send("window:createTab",{localUrl:this.targetUrl}),this.stopFadeOut(),this.closePanel(),void 0)},onHoverEnd:function(){t(this.el).css("border","2px solid #99cb33"),this.startFadeOut()},onHover:function(){t(this.el).css("border","2px solid #d8d8d8"),t(this.el).find("div.close-notification").show(),this.stopFadeOut()},startFadeOut:function(){this.options.notification.neverFade||(this.stopFadeOut(),this.fadeOutTimer=a.setTimeout(e.bind(function(){this.fadeOutTimer&&this.fadeOut()},this),this.options.timeout))},stopFadeOut:function(){this.fadeOutTimer&&(a.clearTimeout(this.fadeOutTimer),this.fadeOutTimer=null)}}),l=c.extend({templateName:"notification_helper_card_notification",afterInitialize:function(){this.applyFadingStyle(),this.fadeIn(),this.model=this.options.notification.model,this.render(),this.startFadeOut()},clicked:function(e){"chatNow"==e.target.id?o.securityManager.openWindow("https://a3.websitealive.com/623/rRouter.asp?infocapture_ids=259,260&infocapture_values=|&groupid=623&wsa_custom0=&wsa_custom1=&websiteid=0&departmentid=755&dl=maskedcard",400,400):("close-notification"==e.target.className||"notf-close-icon"==e.target.className||"close-image"==e.target.className)&&(this.stopFadeOut(),this.hidePanel())}}),d=c.extend({templateName:"notification_helper_post_register",afterInitialize:function(){this.applyFadingStyle(),this.fadeIn(),this.model={get:e.bind(function(e){return this.options.notification[e]},this)},this.render()},clicked:function(e){return e.target.className.match(/close-notification|notf-close-icon|close-image|done/i)?(this.hidePanel(),void 0):e.target.className.match(/learn-more/)?(o.securityManager.openPage("https://www.abine.com/maskme/faq/#aliasemail"),this.hidePanel(),void 0):void 0}});return{NotificationPanelView:c,CardNotificationPanelView:l,PostRegisterNotificationPanelView:d}}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/notification_helper/post_register"]=e.template(function(e,t,n){n=n||e.helpers;var i,a,r,s="",o="function",c=n.helperMissing,l=void 0,d=this.escapeExpression;return s+='<div class="close-notification">\n    <span class="notf-close-icon"><img class="close-image" src="',i="/pages/images/manage/dd_close_icon.png",r=n.assetUrl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"assetUrl",i,{hash:{}}):a,s+=d(i)+'"/></span>\n</div>\n<div class="body-notification"><img src="',i="/images/Icon.png",r=n.assetUrl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"assetUrl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"assetUrl",i,{hash:{}}):a,s+=d(i)+'"/>\n  ',i="mm_notification_helper_post_register",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+'\n</div>\n<div style="text-align:center;padding-bottom:5px;">\n    <input type="button" class="btn btn-success done" style="width:25%;text-align:center;" value="',i="mm_notification_helper_done",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+'" />\n    <input type="button" class="btn btn-info learn-more" style="width:25%;text-align:center;" value="',i="mm_notification_helper_learn_more",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+'" />\n</div>\n<div class="new-tab">(',i="mm_notification_helper_opens_new_tab",r=n.intl,a=r||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"intl"),i=typeof a===o?a.call(t,i,{hash:{}}):a===l?c.call(t,"intl",i,{hash:{}}):a,s+=d(i)+")</div>\n"}),ABINEMASKME.CompiledTemplates["views/notification_helper/post_register"]}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/password_helper/panel"]=e.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\n    <div class="header">\n        <div class="buttons-panel close-header-margin">\n          <span class="close-icon close-header" id="paneHover"></span>\n        </div>\n        <div class="buttons-panel question-header-margin">\n           <a href="https://www.abine.com/maskme/faq/#strongpassword" target="_blank"><span class="question-icon" id="paneHover"></span></a>\n        </div>\n        <img class="panel-icon" src="',t="/pages/images/manage/maskme_logo_short_green.png",h=n.assetUrl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"assetUrl",t,{hash:{}}):i,a+=v(t)+'"/>\n      </div>\n    <!-- Generate Password -->\n    <a href="#" class="mmKeyOption password strongPassword lessOptions"><div class="element" id="pass">\n      <span class="panelLeft">\n        <img class="iconPos" src="',t="/pages/images/password-icon.png",h=n.assetUrl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"assetUrl",t,{hash:{}}):i,a+=v(t)+'"/>\n        ',t="mm_password_helper_generateStrong",h=n.intl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"intl",t,{hash:{}}):i,a+=v(t)+'\n      </span>\n      <span class="panelRight"></span>\n    </div></a>\n    <a href="#" class="mmKeyOption password lessOptions"><div class="element" id="options">\n      <span class="panelLeft">\n        <i class="iconPos icon-arrow-right"></i>\n        ',t="mm_password_helper_moreOptions",h=n.intl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"intl",t,{hash:{}}):i,a+=v(t)+'\n      </span>\n      <span class="panelRight"></span>\n    </div></a>\n    <!-- more options -->\n    <a href="#" class="mmKeyOption password moreOptions" style="display:none"><div class="element" id="differentSpecialChars">\n      <span>\n        <img class="iconPos" src="',t="/pages/images/password-icon.png",h=n.assetUrl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"assetUrl",t,{hash:{}}):i,a+=v(t)+'"/>\n        ',t="mm_password_helper_differentSpecialChars",h=n.intl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"intl",t,{hash:{}}):i,a+=v(t)+'\n      </span>\n    </div></a>\n    <a href="#" class="mmKeyOption password moreOptions" style="display:none"><div class="element" id="noSpecialChars">\n      <span>\n        <img class="iconPos" src="',t="/pages/images/password-icon.png",h=n.assetUrl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"assetUrl",t,{hash:{}}):i,a+=v(t)+'"/>\n        ',t="mm_password_helper_noSpecialChars",h=n.intl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"intl",t,{hash:{}}):i,a+=v(t)+'\n      </span>\n    </div></a>\n    <a href="#" class="mmKeyOption password moreOptions" style="display:none"><div class="element" id="noNumbers">\n      <span>\n        <img class="iconPos" src="',t="/pages/images/password-icon.png",h=n.assetUrl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"assetUrl",t,{hash:{}}):i,a+=v(t)+'"/>\n        ',t="mm_password_helper_noNumbers",h=n.intl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"intl",t,{hash:{}}):i,a+=v(t)+'\n      </span>\n    </div></a>\n    <div class="moreOptions clearfix" style="display:none;"><div style="text-align:center;">\n      ',t="mm_password_helper_or",h=n.intl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"intl",t,{hash:{}}):i,a+=v(t)+" <br/>\n      ",t="mm_password_helper_typePassword",h=n.intl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"intl",t,{hash:{}}):i,a+=v(t)+"\n    </div></div>\n  "
}function s(e,t){var i,a,r="";return r+="\n    ",h=n.dynamicPanel,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"dynamicPanel"),a=n["if"],f=m.program(4,o,t),f.hash={},f.fn=f,f.inverse=m.program(7,l,t),i=a.call(e,i,f),(i||0===i)&&(r+=i),r+="\n  "}function o(e,t){var i,a,r="";return r+="\n        ",h=n.panelSections,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"panelSections"),a=n.each,f=m.program(5,c,t),f.hash={},f.fn=f,f.inverse=m.noop,i=a.call(e,i,f),(i||0===i)&&(r+=i),r+="\n    "}function c(e){var t,n="";return n+='\n            <div id="',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"id"),typeof t===g?t=t.call(e,{hash:{}}):t===b&&(t=y.call(e,"this.id",{hash:{}})),n+=v(t)+'" style="height:',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"height"),typeof t===g?t=t.call(e,{hash:{}}):t===b&&(t=y.call(e,"this.height",{hash:{}})),n+=v(t)+'" class="panelSection ',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"class_name"),typeof t===g?t=t.call(e,{hash:{}}):t===b&&(t=y.call(e,"this.class_name",{hash:{}})),n+=v(t)+'">\n                ',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"body"),typeof t===g?t=t.call(e,{hash:{}}):t===b&&(t=y.call(e,"this.body",{hash:{}})),(t||0===t)&&(n+=t),n+="\n            </div>\n        "}function l(e){var t,i,a="";return a+='\n        <div class="header">\n            <div class="buttons-panel close-header-margin">\n                <span class="close-icon close-header" id="paneHover"></span>\n            </div>\n            <div class="buttons-panel question-header-margin">\n                <a href="https://www.abine.com/maskme/faq/#strongpassword" target="_blank"><span class="question-icon" id="paneHover"></span></a>\n            </div>\n            <img class="panel-icon" src="',t="/pages/images/manage/maskme_logo_short_green.png",h=n.assetUrl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"assetUrl",t,{hash:{}}):i,a+=v(t)+'"/>\n        </div>\n\n        <!-- Get Started -->\n        <a href="#" class="mmKeyOption getStarted"><div class="element" id="mask">\n          <span class="panelLeft">\n            ',t="mm_helper_installed",h=n.intl,i=h||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===g?i.call(e,t,{hash:{}}):i===b?y.call(e,"intl",t,{hash:{}}):i,a+=v(t)+"\n          </span>\n        </div></a>\n    "}n=n||e.helpers;var d,u,h,f,p="",m=this,g="function",y=n.helperMissing,b=void 0,v=this.escapeExpression;return p+='<div class="panel">\n  ',h=n.hasRegistered,d=h||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"hasRegistered"),u=n["if"],f=m.program(1,r,a),f.hash={},f.fn=f,f.inverse=m.program(3,s,a),d=u.call(t,d,f),(d||0===d)&&(p+=d),p+="\n</div>\n\n"}),ABINEMASKME.CompiledTemplates["views/password_helper/panel"]}),ABINEMASKME.define("abine/views/passwordHelperPanel",["documentcloud/underscore","jquery","duckbone/core","abine/views/panelBase","abine/password","abine/timer"],function(e,t,n,i,a,r){var s=i.extend({templateName:"password_helper_panel",events:{"click .panelSection":"performActions","click #options":"showOptions","click a.strongPassword":"fillWithStrongPassword","click #differentSpecialChars":"fillWithDifferentSpecialChars","click #noSpecialChars":"fillWithNoSpecialChars","click #noNumbers":"fillWithNoNumbers","click a.getStarted":"getStarted","click .close-header":"logClose"},logClose:function(){this.contentManager.messenger.send("update:panelActivity:closed",{panelId:2000001})},afterInitialize:function(){this.field=this.options.field,this.contentManager=this.options.contentManager,this.numMenuOptions=1,this.bindBaseEvents(),this.applyFadingStyle(),this.fadeIn(),this.model={hasRegistered:this.options.hasRegistered,dynamicPanel:this.options.dynamicPanel},this.options.dynamicPanel&&(this.setupDynamicPanel(),this.model.panelSections=this.panelSections),this.contentManager.loadUserPreferences(e.bind(function(){this.model.hasRegistered=this.contentManager.preferences.getPref("hasRegistered")?!0:!1,this.model.hasRegistered?(this.contentManager.messenger.send("update:panelActivity:impression",{panelId:2000001}),this.bind("enter0",function(e){this.fillWithStrongPassword(e)})):this.model.dynamicPanel?this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.model.dynamicPanel.id}):this.bind("enter0",function(e){this.getStarted(e)},this),this.render()},this))},showOptions:function(e){e&&e.preventDefault(),t(".moreOptions",this.el).show(),t(".lessOptions",this.el).hide(),this.trigger("render")},fillPassword:function(t,n){t&&t.preventDefault(),this.contentManager.messenger.send("update:panelActivity:masked",{panelId:2000001}),this.fillFieldsByType(this.options.fields,"/password",n,{domain:this.options.domain,origin:"strong"}),r.setTimeout(e.bind(function(){this.options.contentManager.showNotification({msg:"Click here to view your password.",targetUrl:"pages/index.html#home/passwords/",targetId:"newest"})},this),1e3),this.closePanel()},fillWithStrongPassword:function(e){this.fillPassword(e,a.generateRandomPassword())},fillWithDifferentSpecialChars:function(e){this.fillPassword(e,a.generateSpecialCharsPassword())},fillWithNoSpecialChars:function(e){this.fillPassword(e,a.generateNoSpecialCharsPassword())},fillWithNoNumbers:function(e){this.fillPassword(e,a.generateNoDigitsPassword())}});return s}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/payment_helper/panel"]=e.template(function(e,t,n,i,a){function r(e,t){var i,a,r="";return r+="\n        ",b=n.primaryCard,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"primaryCard"),a=n["if"],v=A.program(2,s,t),v.hash={},v.fn=v,v.inverse=A.program(7,l,t),i=a.call(e,i,v),(i||0===i)&&(r+=i),r+="\n    "}function s(e,t){var i,a,r,s="";return s+='\n            <div class="header">\n                <div class="buttons-panel close-header-margin">\n                    <span class="close-icon close-header" id="paneHover"></span>\n                </div>\n                <div class="buttons-panel question-header-margin">\n                  <a href="#" id="faqLink"><span class="question-icon" id="paneHover"></span></a>\n                </div>\n                <img class="panel-icon" src="',i="/pages/images/manage/maskme_logo_short_green.png",b=n.assetUrl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"assetUrl",i,{hash:{}}):a,s+=w(i)+'"/>\n            </div>\n            <span id="panelOptions">\n            <!--Mask My Card-->\n                <a href="#" class="mmKeyOption disposableCard">\n                    <div class="element" id="mask">\n                        <span class="panelLeft">\n                          <img class="iconPos" src="',i="/pages/images/maskcard-icon.png",b=n.assetUrl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"assetUrl",i,{hash:{}}):a,s+=w(i)+'"/>\n                          ',i="mm_payment_helper_maskCard",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'\n                        </span>\n                        <span class="panelRight">\n                          <img class="loading" style="display:none;" src="',i="/pages/images/ajax_loader.gif",b=n.assetUrl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"assetUrl",i,{hash:{}}):a,s+=w(i)+'"/>\n                          <span class="overflowText">',i="mm_payment_helper_usesCard",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+"</span>\n                        </span>\n                    </div>\n                </a>\n\n            <!-- If Masked Cards already exist for this domain -->\n                ",b=n.disposableCards,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"disposableCards"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"length"),a=n["if"],v=A.program(3,o,t),v.hash={},v.fn=v,v.inverse=A.noop,i=a.call(e,i,v),(i||0===i)&&(s+=i),s+="\n                ",b=n.disposableCards,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"disposableCards"),a=n.each,v=A.program(5,c,t),v.hash={},v.fn=v,v.inverse=A.noop,i=a.call(e,i,v),(i||0===i)&&(s+=i),s+='\n            </span>\n            <span id="newMaskedCard" style="display:none;">\n                <div style="height:auto;margin-left:15px;">\n                    <div class="row">\n                        <div class="span5">\n                            <p style="font-size=110%;font-weight:bold;text-align:center;"><img class="iconPos" src="',i="/pages/images/maskcard-icon.png",b=n.assetUrl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"assetUrl",i,{hash:{}}):a,s+=w(i)+'"/> ',i="mm_payment_helper_maskIt",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'</p>\n                        </div>\n                    </div>\n                    <div class="row" id="regularCardAmountRow">\n                        <div class="span3">\n                            <span class="input-prepend">\n                              <span class="add-on" style="font-size:38px;line-height:40px;height:40px;">$</span>\n                              <input maxlength="6" class="span2" id="cardAmount" type="text" style="font-size:38px;line-height:40px;height:50px;" placeholder="0.00">\n                            </span>\n                            <br/>\n                            <span id="amountError" style="line-height:11px;font-size:10px;color:red;"></span>\n                        </div>\n\n                        <div class="span2">\n                            <p style="margin-left:15px;font-size:14px;line-height:16px;">',i="mm_payment_helper_pleaseEnter",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'</p>\n                        </div>\n                    </div>\n\n                    <div class="row" id="subscriptionCardAmountRow" style="display:none;">\n                        <div class="span3">\n                            <div style="padding:5px;">',i="mm_payment_helper_monthlyPrice",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'</div>\n                            <div style="padding:5px;margin-top:10px;">',i="mm_payment_helper_numberOfMonths",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'</div>\n                        </div>\n                        <div class="span2">\n                            <span class="input-prepend">\n                              <span class="add-on" style="font-size:18px;line-height:20px;height:20px;">$</span>\n                              <input maxlength="6" id="subscriptionAmount" type="text" style="width:100px;font-size:18px;line-height:20px;height:30px;" placeholder="0.00">\n                            </span>\n                            <br/>\n\n                            <input maxlength="2" class="span2" id="subscriptionMonths" type="text" style="margin-top:10px;font-size:18px;line-height:20px;height:30px;" placeholder="0" />\n                        </div>\n                    </div>\n\n                    <div class="row" id="subscriptionErrorRow" style="display:none;">\n                        <div class="offset1 span4" style="text-align:right;margin-bottom:5px;">\n                            <span id="subscriptionError" style="line-height:13px;font-size:11px;color:red;"></span>\n                        </div>\n                    </div>\n\n                    <div class="row">\n                        <div class="span2">\n                            <p style="font-size:10px;line-height:12px;margin-top:5px;">',i="mm_payment_helper_chargeWillBe",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+" <strong>",b=n.primaryCard,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"primaryCard"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"getLastFour"),typeof i===M?i=i.call(e,{hash:{}}):i===S&&(i=_.call(e,"primaryCard.getLastFour",{hash:{}})),s+=w(i)+'</strong></p>\n                        </div>\n\n                        <div class="span3">\n                            <input type="button" id="createCard" style="margin-left:95px;font-size:16px;" value="&nbsp;&nbsp;&nbsp;&nbsp;',i="mm_payment_helper_next",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'&nbsp;&nbsp;&nbsp;&nbsp;" class="btn btn-primary" />\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="offset2 span3 subscription-option">\n                            <input type="checkbox" id="subscriptionCard" /> <label style="display:inline-block;vertical-align:sub;" for="subscriptionCard">',i="mm_payment_helper_isThisFor",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'</label>\n                        </div>\n                    </div>\n                </div>\n            </span>\n            <span id="confirmAmountView" style="display:none;">\n              <div style="padding:5px;padding-left:15px;">\n                  <h5 id="confirmRegularMsg">\n                    ',b=n.primaryCard,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"primaryCard"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"getLastFour"),a="mm_payment_helper_greatThey",b=n.intl,r=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof r===M?r.call(e,a,i,{hash:{}}):r===S?_.call(e,"intl",a,i,{hash:{}}):r,(i||0===i)&&(s+=i),s+='\n                  </h5>\n                  <h5 id="confirmSubscriptionMsg" style="display:none;">\n                    ',b=n.primaryCard,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"primaryCard"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"getLastFour"),a="mm_payment_helper_confirmSub",b=n.intl,r=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof r===M?r.call(e,a,i,{hash:{}}):r===S?_.call(e,"intl",a,i,{hash:{}}):r,(i||0===i)&&(s+=i),s+='\n                  </h5>\n                  <div style="text-align:center;">\n                    <input type="button" value="Nevermind" id="cancelCardCreate" class="btn" />\n                    <input type="button" value="Yes, Create Card" id="confirmCardCreate" class="btn btn-primary" />\n                  </div>\n                  <div style="text-align:center;margin-top:20px;margin-left:-60px;">\n                    <label for="dontShowCardConfirm">\n                        <input type="checkbox" id="dontShowCardConfirm" style="margin-top:-2px;"/> ',i="mm_payment_helper_dontAsk",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'\n                    </label>\n                  </div>\n              </div>\n            </span>\n            <span id="maskedCardView" style="display:none;">\n                <div id="maskedCardError" style="display:none;text-align:center;padding:10px;">\n                    <div id="maskedCardErrorMsg" class="alert alert-error">\n\n                    </div>\n                </div>\n                <div id="loadingMaskedCard" style="height:50px;display:none;text-align:center;padding:10px;">\n                </div>\n                <div id="maskedCard" class="creditcardfont" style="color:rgb(80,80,80);width:336px;margin:auto;padding:10px;display:none;">\n                    <div style="border-radius:8px;padding:10px;padding-top:0px;background-repeat:no-repeat;width:336px;height:181px;background-image:url(\'',i="/pages/images/maskedcard.png",b=n.assetUrl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"assetUrl",i,{hash:{}}):a,s+=w(i)+'\');">\n                         <br style="clear:both;"/>\n                         <div style="text-align:center;margin-top:10px;">\n                            <h3 id="cardNumber"></h3>\n                         </div>\n                         <div style="font-size:15px;">\n                             <span style="float:left;">',i="mm_payment_helper_expDate",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+' <span id="expiration"></span></span> <span style="float:right;margin-right:25px;"> ',i="mm_payment_helper_cvc",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+' <span id="cvc"></span></span>\n                             <br style="clear:both;"/>\n                             <div style="margin-left:60px;font-size:16px;letter-spacing:2px;">\n                                 ',i="mm_notification_helper_anyName",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'\n                             </div>\n                             <span id="street" style="margin-left: 100px;">280 SUMMER STREET</span><br><span id="cityStateZip" style="margin-left: 106px;">BOSTON MA 02210</span>\n                         </div>\n                    </div>\n                     <div style="text-align:center;">\n                        <input type="button" value="',i="mm_payment_helper_useMyMasked",b=n.intl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"intl",i,{hash:{}}):a,s+=w(i)+'" class="btn btn-primary" id="useMaskedCard" />\n                     </div>\n                </div>\n\n            </span>\n        '}function o(e){var t,i,a="";return a+='\n                    <div><p style="text-align:center;">',t="mm_email_helper_or",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+"</p></div>\n                "}function c(e){var t,i,a="";return a+='\n                  <a href="#" data-cardid="',b=n.id,t=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"id"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"id",{hash:{}})),a+=w(t)+'" class="mmKeyOption usedCard">\n                    <div class="element" id="mask">\n                      <span class="panelLeft">\n                          <img class="iconPos" src="',t="/pages/images/maskcard-icon.png",b=n.assetUrl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"assetUrl",t,{hash:{}}):i,a+=w(t)+'"/>\n                          ',t="mm_payment_helper_useCardEnding",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+" ",t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"getLastFour"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.getLastFour",{hash:{}})),a+=w(t)+'\n                      </span>\n                      <span class="panelRight">\n                          <span class="overflowText">',b=n.getOriginalValue,t=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"getOriginalValue"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"getOriginalValue",{hash:{}})),a+=w(t)+" card</span>\n                      </span>\n                    </div>\n                  </a>\n                "}function l(){return"\n        <!-- shouldn't be possible to get here.. -->\n        "}function d(e,t){var i,a,r="";return r+="\n        ",b=n.dynamicPanel,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"dynamicPanel"),a=n["if"],v=A.program(10,u,t),v.hash={},v.fn=v,v.inverse=A.program(13,f,t),i=a.call(e,i,v),(i||0===i)&&(r+=i),r+="\n    "}function u(e,t){var i,a,r="";return r+="\n            ",b=n.panelSections,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"panelSections"),a=n.each,v=A.program(11,h,t),v.hash={},v.fn=v,v.inverse=A.noop,i=a.call(e,i,v),(i||0===i)&&(r+=i),r+="\n        "}function h(e){var t,n="";return n+='\n                <div id="',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"id"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.id",{hash:{}})),n+=w(t)+'" style="height:',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"height"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.height",{hash:{}})),n+=w(t)+'" class="panelSection ',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"class_name"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.class_name",{hash:{}})),n+=w(t)+'">\n                    ',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"body"),typeof t===M?t=t.call(e,{hash:{}}):t===S&&(t=_.call(e,"this.body",{hash:{}})),(t||0===t)&&(n+=t),n+="\n                </div>\n            "}function f(e,t){var i,a,r="";return r+='\n            <div class="header">\n                <div class="buttons-panel close-header-margin">\n                    <span class="close-icon close-header" id="paneHover"></span>\n                </div>\n                <div class="buttons-panel question-header-margin">\n                 <a href="#" id="faqLink"><span class="question-icon" id="paneHover"></span></a>\n                </div>\n                <img class="panel-icon" src="',i="/pages/images/manage/maskme_logo_short_green.png",b=n.assetUrl,a=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===M?a.call(e,i,{hash:{}}):a===S?_.call(e,"assetUrl",i,{hash:{}}):a,r+=w(i)+'"/>\n            </div>\n            ',b=n.entitledToPayments,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"entitledToPayments"),a=n["if"],v=A.program(14,p,t),v.hash={},v.fn=v,v.inverse=A.program(16,m,t),i=a.call(e,i,v),(i||0===i)&&(r+=i),r+="\n        "}function p(e){var t,i,a="";return a+='\n            <!-- Setup card -->\n              <a href="#" class="mmKeyOption setupCard">\n                <div class="element" id="mask">\n                  <span class="panelLeft">\n                      ',t="mm_payment_helper_setupMasked",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+"\n                  </span>\n                </div>\n              </a>\n            "}function m(e){var t,i,a="";return a+='\n            <!-- Get Started -->\n                <a href="#" class="mmKeyOption setupCard">\n                    <div class="element" id="mask">\n                        <span class="panelLeft">\n                            ',t="mm_payment_helper_upgradeMaskedCard",b=n.intl,i=b||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===M?i.call(e,t,{hash:{}}):i===S?_.call(e,"intl",t,{hash:{}}):i,a+=w(t)+"\n                        </span>\n                    </div>\n                </a>\n            "}n=n||e.helpers;var g,y,b,v,E="",A=this,M="function",_=n.helperMissing,S=void 0,w=this.escapeExpression;return E+='<div class="panel">\n    ',b=n.hasEnabledPayments,g=b||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"hasEnabledPayments"),y=n["if"],v=A.program(1,r,a),v.hash={},v.fn=v,v.inverse=A.program(9,d,a),g=y.call(t,g,v),(g||0===g)&&(E+=g),E+="\n</div>\n"}),ABINEMASKME.CompiledTemplates["views/payment_helper/panel"]}),ABINEMASKME.define("abine/views/paymentHelperPanel",["documentcloud/underscore","jquery","duckbone/core","models","abine/views/panelBase","abine/timer","abine/views/loading_display","abine/contentMessenger","abine/intl","abine/responseCodes","abine/config","abine/proxies"],function(e,t,n,i,a,r,s,o,c,l,d,u){var h=a.extend({templateName:"payment_helper_panel",events:{"click a.primaryCard":"fillWithPrimaryCard","click a.disposableCard":"showNewMaskedCardView","click a.usedCard":"fillWithUsedCard","click a.getStarted":"getStarted","click a.setupCard":"getStartedWithPayments","click .panelSection":"performActions","click #createCard":"createCard","click #cancelCardCreate":"cancelCardCreate","click #confirmCardCreate":"confirmCardCreate","click #useMaskedCard":"fillWithDisposableCard","click #faqLink":"openFaqTab","click #linkToErrorReport":"makeErrorReport","click #maskedCardErrorMsg a":"makeErrorReport","click #phonesPageLink":"navigatePhonesPage","mousedown .subscription-option":"subscriptionClicked","click .close-header":"logClose"},logClose:function(){this.contentManager.messenger.send("update:panelActivity:closed",{panelId:this.panelId})},subscriptionClicked:function(){this.$("#cardAmount").add(this.field.element).unbind("blur")},navigatePhonesPage:function(){u.securityManager.openPage("home/phones",!0)},makeErrorReport:function(e){return e&&e.target&&"verificationLink"!=e.target.id&&"phonesPageLink"!=e.target.id&&e.preventDefault(),!e||e&&e.target&&"verificationLink"!=e.target.id&&"phonesPageLink"!=e.target.id?(this.messenger=this.messenger||new o.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#errorReport/loading_card_create_panel"}),!1):void 0},openFaqTab:function(){this.messenger=this.messenger||new o.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#helpCardsIndex"})},convertCentsToString:function(e){return"$"+(e/100).toFixed(2)},confirmCardCreate:function(e){this.cardBeingCreated||(this.cardBeingCreated=!0,this.model.maskedCard=new i.DisposableCard({domain:this.options.domain,amount:i.DisposableCard.convertStringToCents(this.amount),months:this.months,shielded_card_id:this.model.primaryCard.id}),!e.skipConfirmCheck&&t(this.el).find("#dontShowCardConfirm").is(":checked")&&this.contentManager.preferences.setPref("confirmProtectedCard",!1),this.model.maskedCard.bind("sync:success",function(){this.cardBeingCreated=!1,t(this.el).find("#loadingMaskedCard").hide(),t(this.el).find("#cardNumber").html(this.model.maskedCard.getPrettyNumber()),t(this.el).find("#expiration").html(this.model.maskedCard.getExpiry()),t(this.el).find("#cvc").html(this.model.maskedCard.getCVC()),t(this.el).find("#maskedCard").show(),this.trigger("render")},this),this.model.maskedCard.bind("sync:error",function(e){t(this.el).find("#loadingMaskedCard").hide(),e.errorCode==l.NO_BILLING_ACCOUNT_FOR_USER_ERROR_CODE||e.errorCode==l.BILLING_FAILED_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_billing")):e.errorCode==l.BILLING_DECLINED_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_declined")):e.errorCode==l.NO_CARDS_AVAILABLE_ERROR_CODE||e.errorCode==l.PROVIDER_READ_FAILED_ERROR_CODE||e.errorCode==l.PROVIDER_CARD_CREATION_FAILED_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_provider")):e.errorCode==l.REQUESTED_AMOUNT_OVER_LIMIT_ERROR_CODE?"verified"==e.responseJSON.data.category?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_validation_verified",[this.convertCentsToString(e.responseJSON.data.min),this.convertCentsToString(e.responseJSON.data.max)])):t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_validation_max",[this.convertCentsToString(e.responseJSON.data.max)])+"<a id='verificationLink' href="+d.protocol+d.licenseServerHost+"/fraud_verification?auth_token="+this.model.authToken+" target=_blank "+"> verify your card.</a>"):e.errorCode==l.REQUESTED_AMOUNT_BELOW_MINIMUM_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_validation_min",[this.convertCentsToString(e.responseJSON.data.min)])):e.errorCode==l.REQUEST_ALREADY_EXISTS_ERROR_CODE||e.errorCode==l.NO_CARD_FOUND_ERROR_CODE||e.errorCode==l.NO_BILLING_TRANSACTION_FOUND_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_abine")):e.errorCode==l.REFUND_FAILED_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_refund")):e.errorCode==l.GLOBAL_SOFT_LIMIT_REACHED?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_global_limit")):e.errorCode==l.FRAUD_SOFT_LIMIT_REACHED?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_soft_limit")+"<a id='verificationLink' href="+d.protocol+d.licenseServerHost+"/fraud_verification?auth_token="+this.model.authToken+" target=_blank "+"> verify your card.</a>"):e.errorCode==l.FRAUD_HARD_LIMIT_REACHED?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_hard_limit")):e.errorCode==l.FRAUD_VERIFIED_SOFT_LIMIT_REACHED?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_verified_soft_limit")):e.errorCode==l.FRAUD_HIGH_RISK_COUNTRY_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_high_risk_country")):e.errorCode==l.GREY_LISTED_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_grey_listed")+"<a id='verificationLink' href="+d.protocol+d.licenseServerHost+"/fraud_verification?auth_token="+this.model.authToken+" target=_blank "+"> verify your card.</a>"):e.errorCode==l.BILLING_IN_NON_US_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_helper_non_us1")+'<a id="phonesPageLink"'+' href="javascript:void(0);">'+" Masked Phones"+"</a> "+c.getText("mm_payment_helper_non_us2")):e.errorCode==l.DUPLICATE_CARD_ERROR_CODE?t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error_duplicate_card_ban")):t(this.el).find("#maskedCardErrorMsg").html(c.getText("mm_payment_error")),t(this.el).find("#maskedCardError").show(),this.trigger("render")},this),t(this.el).find("#newMaskedCard").hide(),t(this.el).find("#confirmAmountView").hide(),t(this.el).find("#maskedCardView").show(),this.loadingDisplay=new s({customMessages:["mm_loading_display_Crunching","mm_loading_display_Clouds","mm_loading_display_Tubes","mm_loading_display_HangOn","mm_loading_display_Whoops_Panel"],el:t(this.el).find("#loadingMaskedCard"),pageName:"card_create_panel"}),t(this.el).find("#loadingMaskedCard").show(),this.trigger("render"),this.ignoreExplicitClose=!0,this.model.maskedCard.save())},cancelCardCreate:function(){t(this.el).find("#confirmAmountView").hide(),t(this.el).find("#newMaskedCard").show(),this.ignoreBlur(!1),t(this.el).find("#cardAmount").focus(),this.trigger("render")},createCard:function(){var e,n,i=/[^\d\.]/g,a=t(this.el).find("#subscriptionCard").is(":checked");if(a?(e=t(this.el).find("#subscriptionAmount").val(),n=t(this.el).find("#subscriptionMonths").val(),n=n.replace(i,""),n=parseInt(n)):e=t(this.el).find("#cardAmount").val(),e=e.replace(i,""),e=parseFloat(parseFloat(e).toFixed(2)),a){if(isNaN(n)||1>n)return t(this.el).find("#subscriptionError").html(c.getText("mm_payment_helper_nonzero_months")),t(this.el).find("#subscriptionErrorRow").show(),this.trigger("render"),void 0;t(this.el).find("#subscriptionErrorRow").hide(),t(this.el).find("#subscriptionError").html(""),e*=n}isNaN(e)?(t(this.el).find("#amountError").html(c.getText("mm_payment_error_validation_input")),this.trigger("render")):(t(this.el).find("#amountError").html(""),this.amount=e,this.months=n,this.contentManager.preferences.isPrefTrue("confirmProtectedCard")?this.showConfirmAmountView(e,n):this.confirmCardCreate({amount:e,months:n,skipConfirmCheck:!0}))},showConfirmAmountView:function(e,n){t(this.el).find("#newMaskedCard").hide(),t(this.el).find(".confirmAmount").html(e),n?(t(this.el).find("#monthsExpired").html(n),t(this.el).find("#confirmRegularMsg").hide(),t(this.el).find("#confirmSubscriptionMsg").show()):(t(this.el).find("#confirmRegularMsg").show(),t(this.el).find("#confirmSubscriptionMsg").hide()),t(this.el).find("#confirmAmountView").show(),this.ignoreBlur(!0),t(this.options.field).focus(),this.trigger("render")},showNewMaskedCardView:function(n){n&&n.preventDefault(),this.contentManager.messenger.send("update:panelActivity:masked",{panelId:this.panelId}),t(this.el).find("#panelOptions").hide(),t(this.el).find("#newMaskedCard").show(),this.ignoreBlur(!1),t(this.field.element).unbind("blur"),t(this.el).find("#cardAmount").focus(),this.bindPanelTextInput(t(this.el).find("#cardAmount")),t(this.el).find("#subscriptionCard").change(e.bind(function(){t(this.el).find("#subscriptionCard").is(":checked")?(t(this.el).find("#regularCardAmountRow").hide(),t(this.el).find("#subscriptioncardAmountRow").show(),t(this.el).find("#subscriptionErrorRow").show()):(t(this.el).find("#subscriptionErrorRow").hide(),t(this.el).find("#subscriptioncardAmountRow").hide(),t(this.el).find("#regularCardAmountRow").show()),this.trigger("render"),t(this.el).find("#subscriptionCard").is(":checked")?this.$("#subscriptionAmount").focus():(this.$("#cardAmount").focus(),this.bindPanelTextInput(this.$("#cardAmount")))
},this)),this.trigger("render")},afterInitialize:function(){this.field=this.options.field,this.numMenuOptions=2,this.bindBaseEvents(),this.applyFadingStyle(),this.fadeIn(),this.model={primaryCard:!1,authToken:this.options.authToken,hasRegistered:this.options.hasRegistered,entitledToPayments:this.options.entitledToPayments,hasEnabledPayments:this.options.hasEnabledPayments,dynamicPanel:this.options.dynamicPanel},this.options.dynamicPanel&&(this.setupDynamicPanel(),this.model.panelSections=this.panelSections),this.contentManager=this.options.contentManager,this.model.shieldedCard=new i.ShieldedCardCollection,this.model.shieldedCard.bind("sync:success",function(){this.model.shieldedCard.length>0&&(this.model.primaryCard=this.model.shieldedCard.at(0)),this.model.primaryCard?(this.panelId=this.contentManager.preferences.getPref("hasEnabledPayments")?4000001:9000001,this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.panelId}),this.model.disposableCards=new i.DisposableCardCollection,this.model.disposableCards.fetchAllByDomain(this.options.domain,e.bind(function(){this.bind("enter0",function(e){this.showNewMaskedCardView(e)}),this.bind("enter1",function(e){this.fillWithPrimaryCard(e)}),this.render()},this))):this.model.dynamicPanel?(this.panelId=this.model.dynamicPanel.id,this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.panelId})):(this.panelId=8000001,this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.panelId}),this.bind("enter0",function(e){this.getStarted(e)},this)),this.render()},this),this.model.shieldedCard.fetchAll(),this.options.fromContextMenu&&r.setTimeout(e.bind(function(){this.showNewMaskedCardView()},this),100)},fillWithPrimaryCard:function(e){e&&e.preventDefault();var t=this.model.primaryCard,n=this.fillPaymentFieldsWith(this.options.fields,t.get("number"),t.get("type"),t.get("issued_to"),t.get("expiry_month"),t.get("expiry_year"),t.get("verification"));this.triggerPanelFillEvent({domain:this.options.domain,origin:"primary",field:{name:this.field.name,value:n,dataType:"/financial/creditcard/number",origin:this.field.origin}}),this.closePanel()},fillWithDisposableCard:function(t){t&&t.preventDefault();var n=this.fillPaymentFieldsWith(this.options.fields,this.model.maskedCard.get("number"),this.model.maskedCard.get("type"),this.model.primaryCard.getFirstName()+" "+this.model.primaryCard.getLastName(),this.model.maskedCard.get("expiry_month"),this.model.maskedCard.get("expiry_year"),this.model.maskedCard.get("cvc"));this.triggerPanelFillEvent({domain:this.options.domain,origin:"disposable",field:{name:this.field.name,disposableGUID:this.model.maskedCard.get("guid"),value:n,dataType:"/financial/creditcard/number",origin:this.field.origin}}),r.setTimeout(e.bind(function(){this.options.contentManager.showNotification({msg:"<h4 style='display:inline;'>Masked Card</h4><div style='text-align:center;'><div>"+this.model.maskedCard.get("type")+"</div><div>"+this.model.maskedCard.get("number")+"</div><div>"+this.model.maskedCard.getExpiry()+"</div><div>"+this.model.maskedCard.getCVC()+"</div></div>",targetUrl:"pages/index.html#payments",targetId:"",model:this.model,height:260,neverFade:!0,type:"card"})},this),1e3),this.closePanel()},setupCard:function(e){this.messenger=this.messenger||new o.ContentMessenger,this.messenger.send("window:createTab",{localUrl:"pages/index.html#payments"}),this.closePanel(e)},fillWithUsedCard:function(n,i){n&&n.preventDefault(),this.contentManager.messenger.send("update:panelActivity:masked",{panelId:this.panelId});var a;if(i||0==i){var s=e(this.el.children[0].children).filter(function(e){return t(e).is("a")&&!t(e).hasClass("disabled")});a=t(s[i]).data("cardid")}else a=t(n.currentTarget).data("cardid");var o=e.find(this.model.disposableCards.models,function(e){return e.id==a?!0:void 0});o&&(this.fillPaymentFieldsWith(this.options.fields,o.get("number"),o.get("type"),this.model.primaryCard.getFirstName()+" "+this.model.primaryCard.getLastName(),o.get("expiry_month"),o.get("expiry_year"),o.get("cvc")),r.setTimeout(e.bind(function(){this.options.contentManager.showNotification({msg:"",targetUrl:"pages/index.html#payments",targetId:"",model:{maskedCard:o,primaryCard:this.model.primaryCard},height:260,neverFade:!0,type:"card"})},this),1e3)),this.closePanel()}});return h}),ABINEMASKME.require(["wycats/handlebars"],function(e){return ABINEMASKME.CompiledTemplates||(ABINEMASKME.CompiledTemplates={}),ABINEMASKME.CompiledTemplates["views/phone_helper/panel"]=e.template(function(e,t,n,i,a){function r(e,t){var i,a,r="";return r+='\n          <!-- Logo and Panel Buttons -->\n          <div class="header">\n              <div class="buttons-panel close-header-margin">\n                  <span class="close-icon close-header" id="paneHover"></span>\n              </div>\n              <div class="buttons-panel question-header-margin">\n                  <a href="https://www.abine.com/maskme/faq/#aliasphone" target="_blank"><span class="question-icon" id="paneHover"></span></a>\n              </div>\n              <img class="panel-icon" src="',i="/pages/images/manage/maskme_logo_short_green.png",g=n.assetUrl,a=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===E?a.call(e,i,{hash:{}}):a===M?A.call(e,"assetUrl",i,{hash:{}}):a,r+=_(i)+'"/>\n          </div>\n\n          ',g=n.primaryPhone,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"primaryPhone"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"isValidated"),a=n["if"],y=v.program(2,s,t),y.hash={},y.fn=y,y.inverse=v.program(4,o,t),i=a.call(e,i,y),(i||0===i)&&(r+=i),r+='\n          <!--Disclose My Phone-->\n          <a href="#" class="mmKeyOption primaryPhone"><div class="element" id="disclose">\n              <span class="panelLeft">\n                  <img class="iconPos" src="',i="/pages/images/disclosephone-icon.png",g=n.assetUrl,a=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===E?a.call(e,i,{hash:{}}):a===M?A.call(e,"assetUrl",i,{hash:{}}):a,r+=_(i)+'"/>\n                  ',i="mm_phone_helper_disclosePhone",g=n.intl,a=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),i=typeof a===E?a.call(e,i,{hash:{}}):a===M?A.call(e,"intl",i,{hash:{}}):a,r+=_(i)+'\n              </span>\n              <span class="panelRight">\n                  <span class="overflowText">',g=n.primaryPhone,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"primaryPhone"),i=null===i||void 0===i||i===!1?i:ABINEMASKME.Duckbone.Handlebars.getAttr(i,"getPrettyNumber"),typeof i===E?i=i.call(e,{hash:{}}):i===M&&(i=A.call(e,"primaryPhone.getPrettyNumber",{hash:{}})),r+=_(i)+"</span>\n              </span>\n          </div></a>\n    "}function s(e){var t,i,a="";return a+='\n              <!--Mask My Phone-->\n              <a href="#" class="mmKeyOption disposablePhone"><div class="element" id="mask">\n                  <span class="panelLeft">\n                      <img class="iconPos" src="',t="/pages/images/maskphone-icon.png",g=n.assetUrl,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===E?i.call(e,t,{hash:{}}):i===M?A.call(e,"assetUrl",t,{hash:{}}):i,a+=_(t)+'"/>\n                      ',t="mm_phone_helper_maskPhone",g=n.intl,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===E?i.call(e,t,{hash:{}}):i===M?A.call(e,"intl",t,{hash:{}}):i,a+=_(t)+'\n                  </span>\n                  <span class="panelRight">\n                      <img class="loading" style="display:none;" src="',t="/pages/images/ajax_loader.gif",g=n.assetUrl,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),t=typeof i===E?i.call(e,t,{hash:{}}):i===M?A.call(e,"assetUrl",t,{hash:{}}):i,a+=_(t)+'"/>\n                      <span class="overflowText">',t="mm_phone_helper_usesPhone",g=n.intl,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===E?i.call(e,t,{hash:{}}):i===M?A.call(e,"intl",t,{hash:{}}):i,a+=_(t)+"</span>\n                  </span>\n              </div></a>\n          "}function o(e){var t,i,a="";return a+='\n              <!-- Setup your Masked Phone -->\n              <a href="#" class="mmKeyOption setupPhone pleaseValidate"><div class="element" id="mask">\n                  ',g=n.idMeAppName,t=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"idMeAppName"),typeof t===E?t=t.call(e,{hash:{}}):t===M&&(t=A.call(e,"idMeAppName",{hash:{}})),a+=_(t)+" ",t="mm_phone_helper_pleaseValidate",g=n.intl,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===E?i.call(e,t,{hash:{}}):i===M?A.call(e,"intl",t,{hash:{}}):i,a+=_(t)+"\n              </div></a>\n          "}function c(e,t){var i,a,r="";return r+="\n\n        ",g=n.dynamicPanel,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"dynamicPanel"),a=n["if"],y=v.program(7,l,t),y.hash={},y.fn=y,y.inverse=v.program(10,u,t),i=a.call(e,i,y),(i||0===i)&&(r+=i),r+="\n    "}function l(e,t){var i,a,r="";return r+="\n            ",g=n.panelSections,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"panelSections"),a=n.each,y=v.program(8,d,t),y.hash={},y.fn=y,y.inverse=v.noop,i=a.call(e,i,y),(i||0===i)&&(r+=i),r+="\n        "}function d(e){var t,n="";return n+='\n                <div id="',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"id"),typeof t===E?t=t.call(e,{hash:{}}):t===M&&(t=A.call(e,"this.id",{hash:{}})),n+=_(t)+'" style="height:',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"height"),typeof t===E?t=t.call(e,{hash:{}}):t===M&&(t=A.call(e,"this.height",{hash:{}})),n+=_(t)+'" class="panelSection ',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"class_name"),typeof t===E?t=t.call(e,{hash:{}}):t===M&&(t=A.call(e,"this.class_name",{hash:{}})),n+=_(t)+'">\n                    ',t=ABINEMASKME.Duckbone.Handlebars.getAttr(e,"body"),typeof t===E?t=t.call(e,{hash:{}}):t===M&&(t=A.call(e,"this.body",{hash:{}})),(t||0===t)&&(n+=t),n+="\n                </div>\n            "}function u(e,t){var i,a,r="";return r+='\n            <div class="header">\n                <div class="buttons-panel close-header-margin">\n                    <span class="close-icon close-header" id="paneHover"></span>\n                </div>\n                <div class="buttons-panel question-header-margin">\n                    <a href="https://www.abine.com/maskme/faq/#aliasemail" target="_blank"><span class="question-icon" id="paneHover"></span></a>\n                </div>\n                <img class="panel-icon" src="',i="/pages/images/manage/maskme_logo_short_green.png",g=n.assetUrl,a=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"assetUrl"),i=typeof a===E?a.call(e,i,{hash:{}}):a===M?A.call(e,"assetUrl",i,{hash:{}}):a,r+=_(i)+'"/>\n            </div>\n\n            ',g=n.entitledToPhone,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"entitledToPhone"),a=n["if"],y=v.program(11,h,t),y.hash={},y.fn=y,y.inverse=v.program(13,f,t),i=a.call(e,i,y),(i||0===i)&&(r+=i),r+="\n        "}function h(e){var t,i,a="";return a+='\n                <a href="#" class="mmKeyOption upgradeToPhone">\n                    <div class="element" id="mask">\n                        <span class="panelLeft">\n                            ',t="mm_phone_helper_setupMasked",g=n.intl,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===E?i.call(e,t,{hash:{}}):i===M?A.call(e,"intl",t,{hash:{}}):i,a+=_(t)+"\n                        </span>\n                    </div>\n                </a>\n            "}function f(e){var t,i,a="";return a+='\n                <a href="#" class="mmKeyOption upgradeToPhone">\n                    <div class="element" id="mask">\n                        <span class="panelLeft" style="width:100%;">\n                            ',t="mm_phone_helper_upgradeMaskedPhone",g=n.intl,i=g||ABINEMASKME.Duckbone.Handlebars.getAttr(e,"intl"),t=typeof i===E?i.call(e,t,{hash:{}}):i===M?A.call(e,"intl",t,{hash:{}}):i,a+=_(t)+"\n                        </span>\n                    </div>\n                </a>\n            "}n=n||e.helpers;var p,m,g,y,b="",v=this,E="function",A=n.helperMissing,M=void 0,_=this.escapeExpression;return b+='<div class="panel">\n    ',g=n.primaryPhone,p=g||ABINEMASKME.Duckbone.Handlebars.getAttr(t,"primaryPhone"),m=n["if"],y=v.program(1,r,a),y.hash={},y.fn=y,y.inverse=v.program(6,c,a),p=m.call(t,p,y),(p||0===p)&&(b+=p),b+="\n</div>\n"}),ABINEMASKME.CompiledTemplates["views/phone_helper/panel"]}),ABINEMASKME.define("abine/views/phoneHelperPanel",["documentcloud/underscore","jquery","duckbone/core","models","abine/views/panelBase","abine/timer"],function(e,t,n,i,a,r){var s=a.extend({templateName:"phone_helper_panel",events:{"click a.primaryPhone":"fillWithPrimaryPhone","click a.disposablePhone":"fillWithDisposablePhone","click a.getStarted":"getStarted","click a.setupPhone":"setupPhone","click a.upgradeToPhone":"getStartedWithPhone","click .panelSection":"performActions","click .close-header":"logClose"},logClose:function(){this.contentManager.messenger.send("update:panelActivity:closed",{panelId:this.panelId})},afterInitialize:function(){this.field=this.options.field,this.numMenuOptions=2,this.bindBaseEvents(),this.applyFadingStyle(),this.fadeIn(),this.model={primaryPhone:!1,hasRegistered:this.options.hasRegistered,entitledToPhone:this.options.entitledToPhone,dynamicPanel:this.options.dynamicPanel},this.options.dynamicPanel&&(this.setupDynamicPanel(),this.model.panelSections=this.panelSections),this.contentManager=this.options.contentManager,this.contentManager.loadUserPreferences(e.bind(function(){this.model.hasRegistered=this.contentManager.preferences.getPref("hasRegistered")?!0:!1,this.model.hasRegistered?(this.model.shieldedPhones=new i.ShieldedPhoneCollection,this.model.shieldedPhones.bind("sync:success",function(){this.model.shieldedPhones.length>0&&(this.model.primaryPhone=this.model.shieldedPhones.at(0)),this.model.primaryPhone?(this.panelId=3000001,this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.panelId}),this.bind("enter0",function(e){this.fillWithDisposablePhone(e)}),this.bind("enter1",function(e){this.fillWithPrimaryPhone(e)})):this.model.dynamicPanel?(this.panelId=this.model.dynamicPanel.id,this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.panelId})):(this.panelId=this.contentManager.preferences.getPref("entitledToPhone")?7000001:6000001,this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.panelId}),this.bind("enter0",function(e){this.setupPhone(e)},this)),this.render()},this),this.model.shieldedPhones.fetchAll()):(this.model.dynamicPanel?this.contentManager.messenger.send("update:panelActivity:impression",{panelId:this.model.dynamicPanel.id}):this.bind("enter0",function(e){this.getStarted(e)},this),this.render())},this))},fillWithPrimaryPhone:function(e){e&&e.preventDefault(),this.contentManager.messenger.send("update:panelActivity:disclosed",{panelId:this.panelId});var t=this.fillPhoneFieldsWith(this.options.fields,this.model.primaryPhone.get("country_code"),this.model.primaryPhone.get("number"));this.triggerPanelFillEvent({domain:this.options.domain,origin:"primary",field:{name:"/contact/phone"==this.field.dataType?this.field.name:"dynamic",value:"/contact/phone"==this.field.dataType?this.field.value:t,dataType:"/contact/phone",origin:this.field.origin}}),this.closePanel()},fillWithDisposablePhone:function(t){t&&t.preventDefault(),this.contentManager.messenger.send("update:panelActivity:masked",{panelId:this.panelId}),this.$(".loading").show();var n=this.model.primaryPhone.generateDisposable();n.save({},{success:e.bind(function(){var t=this.fillPhoneFieldsWith(this.options.fields,n.get("country_code"),n.get("number"));this.triggerPanelFillEvent({domain:this.options.domain,origin:"disposable",field:{name:"/contact/phone"==this.field.dataType?this.field.name:"dynamic",disposableGUID:n.get("id"),value:"/contact/phone"==this.field.dataType?this.field.value:t,dataType:"/contact/phone",origin:this.field.origin}}),r.setTimeout(e.bind(function(){this.options.contentManager.showNotification({msg:"Click here to view your Masked Phone usage.",targetUrl:"pages/index.html#home/phones",targetId:""})},this),1e3),this.closePanel()},this)})}});return s}),ABINEMASKME.require(["abine/config","abine/assets","abine/views/commonhelpers"],function(){}),function(){function e(){ABINEMASKME.startTime=Date.now(),t(function(){n()})}function t(e){ABINEMASKME.requireDuckbone(function(){ABINEMASKME.requireModels(e)})}function n(){ABINEMASKME.require(["abine/contentManager","abine/formSubmitDetector","abine/eventLogger","abine/pageEventsImpl"],function(e,t,n,i){var a=new e.ContentManager({document:document,force:!0});a.start(),new t.FormSubmitContentHelper(a.messenger),i.startup(a.messenger,document),window.addEventListener("beforeunload",function(){a.destroy()},!1)})}function i(){document.webkitHidden||(document.removeEventListener("webkitvisibilitychange",i,!1),e())}var a=document.documentElement;"content.js"!=a.attributes.idmeScript&&(a.attributes.idmeScript="content.js","visible"!=document.webkitVisibilityState?(document.documentElement.hasAttribute("abine_webapp")&&document.documentElement.setAttribute("maskme",Config.mmVersion),document.addEventListener("webkitvisibilitychange",i,!1)):e(),chrome.extension.sendRequest({eventName:"contentScript:init",payload:{}}))}();