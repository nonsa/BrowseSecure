var Class=function(a){return function(){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);"function"===typeof this.initialize&&this.initialize.apply(this,arguments)}},XHR=new Class({initialize:function(a){this.options=a;this._method=(this.options.method||"get").toUpperCase();this._data=this.options.data||null;this._type=a.type||"text";this._async=a.async;this._xhr=new XMLHttpRequest;this._xhr.open(this._method,this.options.url,this.options.async);this._is_called_failure_callback=!1;"POST"===this._method&&
this._xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");return this},_onReadyStateChange:function(){if(4===this._xhr.readyState)if(200===this._xhr.status||!this._async&&0===this._xhr.status){var a=this._xhr["xml"===this._type?"responseXML":"responseText"];if(this.options.async&&this.options.callback)this.options.callback({call:"success",response:a});else return a}else if(this.options.async&&this.options.callback)this._callFailureCallback(this._xhr.status);else return null},
_handleSendException:function(a){var b="XHR EXCEPTION: "+a.message+", CODE: "+a.code+"\nURL: "+this.options.url+", METHOD: "+this.options.method+", IS ASYNC: "+this.options.async;"undefined"!==typeof Crossrider&&Crossrider.Utils.internalDebug(b);this._callFailureCallback(a)},_callFailureCallback:function(a){this.options.async&&this.options.hasOwnProperty("callback")&&!this._is_called_failure_callback&&(this._is_called_failure_callback=!0,this.options.callback({call:"failure",response:a}))},send:function(){if(this.options.async)try{this._xhr.onreadystatechange=
this._onReadyStateChange.bind(this),this._xhr.send(this._data)}catch(a){this._callFailureCallback(a),this._handleSendException(a)}else{try{this._xhr.send(this._data)}catch(b){return this._callFailureCallback(b),this._handleSendException(b),null}return this._onReadyStateChange()}}});